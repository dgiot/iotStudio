/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2023年02月17日11时16分14秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a86d5e0"],{"0948":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"konvadevice"},[t("div",{staticClass:"konva_wrap"},[e.topoFlag?t("topopreview",{ref:"topo"}):e._e(),e.vueFlag?t("div",e._l(e.vueComponents,(function(i,s){return t("div",{key:s,staticClass:"vue_component",style:{left:i.x+"px",top:i.y+"px",width:i.width+"px",height:i.height+"px"}},["line"==i.type?t("topo-line",{style:{width:i.width+"px",height:i.height+"px"},attrs:{comp:i}}):e._e(),"realcard"==i.type?t("topo-card",{style:{width:i.width+"px",height:i.height+"px"},attrs:{comp:i}}):e._e(),"konvaimage"==i.type?t("img",{style:{width:i.width+"px",height:i.height+"px"},attrs:{src:i.src}}):e._e()],1)})),0):e._e()],1)])},a=[],o=i("f664"),r=i("c3b11"),n=i("b9e9"),d=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())}),l={name:"KonvaDetails",components:{topopreview:n["default"],topoLine:o["default"],topoCard:r["default"]},data(){return{topoFlag:!0,vueFlag:!1,vueComponents:[]}},mounted(){this.vueComponents=[],this.vueFlag=!1,this.$dgiotBus.$off("vueComponent"),this.$dgiotBus.$on("vueComponent",(e,t)=>d(this,null,(function*(){this.vueComponents=e,this.vueFlag=t})))}},c=l,h=(i("69fe"),i("2877")),u=Object(h["a"])(c,s,a,!1,null,"7ecf7315",null);t["default"]=u.exports},"68d7":function(e,t,i){"use strict";var s=i("c4e6"),a=i("59ef"),o=i("b217"),r=i("c26a"),n=i("5880"),d=i("1285"),l=i("7dd9"),c=i("8ba7"),h=i("662c"),u=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,f=(e,t,i)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,v=(e,t)=>{for(var i in t||(t={}))b.call(t,i)&&f(e,i,t[i]);if(g)for(var i of g(t))y.call(t,i)&&f(e,i,t[i]);return e},$=(e,t)=>m(e,p(t)),C=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())});const I=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];var T={components:{Instruct:l["default"],info:s["default"],deviceLog:r["default"],SceneLog:a["default"],"device-task":o["default"],runningState:h["default"]},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{videoOptions:["m3u8","mp4","flv","mp3"],commandInfo:{dialog:!1,data:{}},amisTable:"0_j",bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:I,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"$dg/thing/{productId}/{deviceAddr}/properties/report",type:"pub",desc:"设备上报",isdef:!0},{topic:"$dg/device/{productId}/{deviceAddr}/profile",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:v({},Object(n["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:$(v({subRealtimedata(){return C(this,null,(function*(){try{yield this.$nopostsubscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payloadString)),console.log(JSON.parse(Base64.decode(e.payloadString)).data),console.log("Base64.decode(payload):",Base64.decode(e.payloadString)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payloadString));this.renderCard(t),t||this.CardDevice()})}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}},Object(n["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.subtopic=`$dg/user/trace/${this.$route.query.deviceid}/realtimecard/report`,this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return C(this,null,(function*(){var t;try{var i=yield Object(d["getDevice"])(e);const{location:a={longitude:"116.404",latitude:"39.915"}}=i;let o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(a.longitude),lat:Number(a.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});var s=null!=(t=i.product.objectId)?t:"";const r=i.devaddr;let n=[{topic:`$dg/thing/${s}/${r}/properties/report`,type:"pub",desc:"属性上报",isdef:!0},{topic:`$dg/device/${s}/${r}/properties`,type:"pub",desc:"属性采集",isdef:!0},{topic:`$dg/user/konva/${e}/report`,type:"pub",desc:"组态消息",isdef:!0},{topic:`$dg/user/realtimecard/${e}/report`,type:"pub",desc:"卡片消息",isdef:!0},{topic:`$dg/device/${s}/${r}/profile`,type:"pub",desc:"设备控制",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(n):n,this.deviceInfo=i,this.mapLabel=o,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(a){console.log(a),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+a,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return C(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:o,_function:r,startTime:n,endTime:l}=this.params;let c={starttime:moment(n).valueOf(),endtime:moment(l).valueOf(),interval:a+t,keys:i,limit:s,function:r,style:o};yield Object(d["getDabDevice"])(e,c).then(e=>{if(null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){return C(this,null,(function*(){switch(localStorage.removeItem("parse_objectid"),localStorage.setItem("parse_objectid",this.deviceid),yield this.$unSubscribe(this.subtopic),e.name){case"ninth":yield this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":yield this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":yield this.queryChart();break;case"right":yield this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":yield this.$refs.SceneLog.get_topic();break;case"view":const{results:e=[]}=yield Object(c["queryView"])({where:{class:"Product",type:{$ne:"topo"},title:{$ne:null},key:this.productId,objectId:{$ne:null}}});if(_.isEmpty(e))return!1;this.commandInfo.data=e,localStorage.setItem("parse_objectid",this.deviceid);break;case"devicetask":yield this.$refs["device-task"].featchData();break;case"first1":yield this.subRealtimedata(),yield this.CardDevice();break}}))},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",o=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",r=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+o+r+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){var e=this;e.loading=!0,Object(d["getCardDevice"])(e.$route.query.deviceid).then(t=>{(null==t?void 0:t.data)&&e.renderCard(t.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{e.loading=!1},800)},renderCard(e){var t=this;let i=[];e.forEach(e=>{e.devicetype=""===e.devicetype?"default":e.devicetype,e.devicetype&&i.push(e.devicetype)}),i=_.uniqBy(i);let s={};i.forEach(t=>{let i=[];e.forEach(e=>{e.module="card",t==e.devicetype&&i.push(e)}),s[t]=i}),t.machinelist=s,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return C(this,null,(function*(){const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false",productid:this.productId};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(t.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,this.subtopic=`$dg/user/realtimecard${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=t.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){this.$confirm("此操作将解除设备间的关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=JSON.parse(JSON.stringify(e.route)),i=this.deviceInfo.devaddr;delete t[i];const s={parentId:{__type:"Pointer",className:"Device",objectId:0},route:t};this.$putDevice(e.objectId,s).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"解除关联成功"}),this.getDevices())})}).catch(()=>{})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})},updatevideoSrc(e){const t={detail:e.detail};this.$putDevice(e.objectId,t),this.activeName="first",this.$nextTick((function(){this.activeName="video"}))}})};t["a"]=T},6986:function(e,t,i){},"69fe":function(e,t,i){"use strict";i("6986")},7030:function(e,t,i){"use strict";i.r(t);var s=i("c4e6"),a=i("59ef"),o=i("b217"),r=i("c26a"),n=i("5880"),d=i("1285"),l=i("7dd9"),c=i("8ba7"),h=i("662c"),u=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,f=(e,t,i)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,v=(e,t)=>{for(var i in t||(t={}))b.call(t,i)&&f(e,i,t[i]);if(g)for(var i of g(t))y.call(t,i)&&f(e,i,t[i]);return e},$=(e,t)=>m(e,p(t)),C=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())});const I=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];t["default"]={components:{Instruct:l["default"],info:s["default"],deviceLog:r["default"],SceneLog:a["default"],"device-task":o["default"],runningState:h["default"]},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{videoOptions:["m3u8","mp4","flv","mp3"],commandInfo:{dialog:!1,data:{}},amisTable:"0_j",bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:I,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"$dg/thing/{productId}/{deviceAddr}/properties/report",type:"pub",desc:"设备上报",isdef:!0},{topic:"$dg/device/{productId}/{deviceAddr}/profile",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:v({},Object(n["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:$(v({subRealtimedata(){return C(this,null,(function*(){try{yield this.$nopostsubscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payloadString)),console.log(JSON.parse(Base64.decode(e.payloadString)).data),console.log("Base64.decode(payload):",Base64.decode(e.payloadString)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payloadString));this.renderCard(t),t||this.CardDevice()})}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}},Object(n["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.subtopic=`$dg/user/trace/${this.$route.query.deviceid}/realtimecard/report`,this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return C(this,null,(function*(){var t;try{var i=yield Object(d["getDevice"])(e);const{location:a={longitude:"116.404",latitude:"39.915"}}=i;let o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(a.longitude),lat:Number(a.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});var s=null!=(t=i.product.objectId)?t:"";const r=i.devaddr;let n=[{topic:`$dg/thing/${s}/${r}/properties/report`,type:"pub",desc:"属性上报",isdef:!0},{topic:`$dg/device/${s}/${r}/properties`,type:"pub",desc:"属性采集",isdef:!0},{topic:`$dg/user/konva/${e}/report`,type:"pub",desc:"组态消息",isdef:!0},{topic:`$dg/user/realtimecard/${e}/report`,type:"pub",desc:"卡片消息",isdef:!0},{topic:`$dg/device/${s}/${r}/profile`,type:"pub",desc:"设备控制",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(n):n,this.deviceInfo=i,this.mapLabel=o,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(a){console.log(a),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+a,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return C(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:o,_function:r,startTime:n,endTime:l}=this.params;let c={starttime:moment(n).valueOf(),endtime:moment(l).valueOf(),interval:a+t,keys:i,limit:s,function:r,style:o};yield Object(d["getDabDevice"])(e,c).then(e=>{if(null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){return C(this,null,(function*(){switch(localStorage.removeItem("parse_objectid"),localStorage.setItem("parse_objectid",this.deviceid),yield this.$unSubscribe(this.subtopic),e.name){case"ninth":yield this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":yield this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":yield this.queryChart();break;case"right":yield this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":yield this.$refs.SceneLog.get_topic();break;case"view":const{results:e=[]}=yield Object(c["queryView"])({where:{class:"Product",type:{$ne:"topo"},title:{$ne:null},key:this.productId,objectId:{$ne:null}}});if(_.isEmpty(e))return!1;this.commandInfo.data=e,localStorage.setItem("parse_objectid",this.deviceid);break;case"devicetask":yield this.$refs["device-task"].featchData();break;case"first1":yield this.subRealtimedata(),yield this.CardDevice();break}}))},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",o=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",r=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+o+r+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){var e=this;e.loading=!0,Object(d["getCardDevice"])(e.$route.query.deviceid).then(t=>{(null==t?void 0:t.data)&&e.renderCard(t.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{e.loading=!1},800)},renderCard(e){var t=this;let i=[];e.forEach(e=>{e.devicetype=""===e.devicetype?"default":e.devicetype,e.devicetype&&i.push(e.devicetype)}),i=_.uniqBy(i);let s={};i.forEach(t=>{let i=[];e.forEach(e=>{e.module="card",t==e.devicetype&&i.push(e)}),s[t]=i}),t.machinelist=s,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return C(this,null,(function*(){const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false",productid:this.productId};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(t.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,this.subtopic=`$dg/user/realtimecard${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=t.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){this.$confirm("此操作将解除设备间的关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=JSON.parse(JSON.stringify(e.route)),i=this.deviceInfo.devaddr;delete t[i];const s={parentId:{__type:"Pointer",className:"Device",objectId:0},route:t};this.$putDevice(e.objectId,s).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"解除关联成功"}),this.getDevices())})}).catch(()=>{})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})},updatevideoSrc(e){const t={detail:e.detail};this.$putDevice(e.objectId,t),this.activeName="first",this.$nextTick((function(){this.activeName="video"}))}})}},7574:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("input",{ref:"uploader",staticStyle:{display:"none"},attrs:{accept:"zip",type:"file"},on:{change:function(t){return e.doUpload(t)}}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:i("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:"className",prop:"className","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:"fields","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("el-popover",{attrs:{placement:"top",trigger:"hover"}},[i.fields?t("dgiot-json-editor",{attrs:{lang:"zh",mode:"code"},model:{value:i.fields,callback:function(t){e.$set(i,"fields",t)},expression:"row.fields"}}):e._e(),t("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[t("el-tag",{attrs:{size:"medium"}},[e._v("fields")])],1)],1)]}}])}),t("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleExport("export",i)}}},[e._v(" "+e._s(e.$translateTitle("product.export"))+" ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleExport("import",i)}}},[e._v(" "+e._s(e.$translateTitle("product.import"))+" ")])]}}])})],1)],1)},a=[],o=i("ed07"),r=i("0af3"),n=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())}),d={name:"Parse",components:{},data(){return{isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+100,stripe:!1,lineHeight:"medium",list:[],listLoading:!0,parseFile:"",parseClass:""}},computed:{},mounted(){this.fetchData()},created(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{handleExport(e,t){return n(this,null,(function*(){const{className:i}=t;if(this.parseClass=i,"export"==e){const e=this.$baseColorfullLoading(2);try{const t=yield Object(r["ExportParse"])(this.parseClass,{});e.close(),this.$convertRes2Blob(t)}catch(s){e.close(),this.$baseMessage(s,"error","dgiot-hey-message-error")}e.close()}else this.$refs.uploader.click();dgiotlog.log(e,t)}))},doUpload(e){return n(this,null,(function*(){this.parseFile=e.target.files[0];const t=this.$baseColorfullLoading(3);try{const e=yield Object(r["ImportParse"])(this.parseClass,this.parseFile);t.close(),dgiotlog.log("eresresrror",e),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("user.update completed"),type:"success"})}catch(i){t.close(),dgiotlog.log("error",i),this.$baseMessage(i,"error","dgiot-hey-message-error")}}))},fetchData(){return n(this,null,(function*(){this.listLoading=!0;const{results:e=[]}=yield Object(o["getTable"])();this.list=e,this.listLoading=!1}))}}},l=d,c=i("2877"),h=Object(c["a"])(l,s,a,!1,null,null,null);t["default"]=h.exports},c4db:function(e,t,i){"use strict";i.r(t);var s,a,o,r,n,d,l=i("4351"),c=i("40d1"),h=i("22f9"),u=i("5880"),m=i("1285"),p=i("7212"),g=i("89e8"),b=i("1267"),y=i("e0e9"),f=i("1b07"),v=i("ef68"),$=i("bb22"),C=i("1ae2"),I=i("5118"),T=i("aed5"),w=i("30b0"),F=i("4013"),j=i("8ba7"),S=i("0c3c"),D=i("62b6"),A=i("c3b1"),G=i("cb88"),L=Object.defineProperty,x=Object.defineProperties,P=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,B=(e,t,i)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,E=(e,t)=>{for(var i in t||(t={}))k.call(t,i)&&B(e,i,t[i]);if(O)for(var i of O(t))q.call(t,i)&&B(e,i,t[i]);return e},N=(e,t)=>x(e,P(t)),M=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())}),z={};const V=i("f43e").Base64;var R="",K="";t["default"]={components:{mqttLog:l["default"],dgiotViews:S["default"],dgiotDict:A["default"],"dgiot-wmx":T["default"],"dgiot-profile":w["default"],"thing-form":c["default"],BmLocalSearch:G["BmLocalSearch"],BmPointCollection:G["BmPointCollection"],BmInfoWindow:G["BmInfoWindow"],BmScale:G["BmScale"],BmMapType:G["BmMapType"],BmView:G["BmView"],BmOverviewMap:G["BmOverviewMap"],BmPanorama:G["BmPanorama"],BmControl:G["BmControl"],BmLabel:G["BmLabel"],BaiduMap:G["BaiduMap"],BmNavigation:G["BmNavigation"],BmGeolocation:G["BmGeolocation"],BmCityList:G["BmCityList"],BmMarker:G["BmMarker"],BmlMarkerClusterer:G["BmlMarkerClusterer"]},data(){const e=(e,t,i)=>{const s=/[0-9a-zA-Z]/;s.test(t)?i():i(new Error("协议名称由数字和字母组合"))},t=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.sizeForm.endnumber&&(t>=this.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.sizeForm.startnumber&&(t<=this.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},s=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.sizeForm.endnumber-this.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},a=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.structform.endnumber&&(t>=this.structform.endnumber?i(new Error("最小值小于最大值")):i())},o=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.structform.startnumber&&(t<=this.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},r=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.structform.endnumber-this.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{ak:this.$dgiot.secret.baidu.map,viewForm:{showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]},dlinkUnit:[],dlinkTopic:{basic:[],thing:[]},mergeObj:{basic:[],thing:[]},tabsChild:"properties",modules:{data:{properties:[],events:[],services:[],tags:[]},type:"events",disabled:!1,visible:!1,events:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],types:[{required:!0,message:"请选择调用方式",trigger:"change"}],output:[{type:"array",required:!0,message:"请至少选择一个输出参数",trigger:"blur"}]},visible:!1,data:{outputParams:[],name:"",identifier:"",types:"info",output:[],describe:""}},services:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:40,message:"长度在 1 到 40 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],transfer:[{required:!0,message:"请选择调用方式",trigger:"change"}]},visible:!1,data:{name:"",identifier:"",enter:[],transfer:"sync",output:[],describe:""}}},moduletype:"properties",amisproductInfo:[],upKey:moment.now(),codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[],events:[],services:[],tags:[]},config:{parser:[],profile:[],basedate:{params:[]}}},productObj:{thing:{properties:[],events:[],services:[],tags:[]}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{profile:"",topic:"",type:"",desc:"",value:"",info:"basic",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{info:[{required:!0,message:"请选择topic所属类型",trigger:"change"}],topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:s}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:t,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:r}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:o,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0,data:{}},ProductSecret:"",dynamicReg:!1,dialog_address:!1,productId:"",productName:"",productdetail:{config:{address:"余杭区良渚平高创业城c1座",location:{longitude:"120.161324",latitude:"30.262441"}},thing:{properties:[],events:[],services:[],tags:[]}},topicData:[],topicDefault:{},topic:[{topic:"$dg/user/${deviceid}/post",type:"sub",desc:"设备属性上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"pub",desc:"消息下发",isdef:!0}],isshow:!0,isstorage:!0,isaccumulate:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:e,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,eventsStart:1,eventsPageSize:10,servicesStart:1,servicesPageSize:10,tagsStart:1,tagsPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],topicKey:"",refreshFlag:"99",msgList:[],submessage:"Starting the log\n",mqtt:{router:"",subtopic:"",pubtopic:""},warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,channelid:"",channelInfo:[],textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1,atbas:{visible:!1,childrenDrawer:!1},editIndex:-1,eventType:"add",formType:"output",thingType:"events",eventForm:{},ruleForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},amisShow:!0,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]},filelist:[],listLoading:!1,detailView:!1,ViewLoading:!1,detailinfo:{},inputParams:{},fileParams:{scene:"app"}}},computed:E({treeData(){const e=JSON.parse(JSON.stringify(this.option));return e.filter(t=>{const i=e.filter(e=>t.id==e.parentid);return i.length>0&&(t.children=i),0==t.parentid})},showNewItem(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(u["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler(e){this.subtimer=window.setInterval(()=>{this.subAce("formInline",!1)},5e3)}}},mounted(){if(this.query_notification(),this.getAllunit(),this.getDefaultTopic(),this.$nextTick(()=>{this.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",this.mqtt.router=this.$dgiotBus.router(this.$route.fullPath)}),this.Industry(),this.getAllunit(),o=ace.edit("editor2"),o.session.setMode("ace/mode/text"),o.setTheme("ace/theme/monokai"),o.setReadOnly(!0),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.id){let e=this.$route.query.id;this.fileParams.path="product/"+e,this.get_filelist("dgiot_file/product/"+e)}this.$route.query.activeName&&(this.activeName=this.$route.query.activeName),this.$route.query.id&&this.queryProductInfo(this.$route.query.id)},beforeDestroy(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:N(E({uploadCkick(){this.loading=!0,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"));this.$route.query.id;this.inputParams={file:"",scene:this.fileParams.scene?this.fileParams.scene:"default",path:this.fileParams.path?this.fileParams.path:"default",filename:moment(new Date).valueOf().toString()}},fileInfo(e){this.listLoading=!0;let t=this.$route.query.id;e.url?(this.$message({showClose:!0,duration:2e3,type:"success",message:"上传成功"}),this.get_filelist("dgiot_file/product/"+t)):this.$message({showClose:!0,duration:2e3,type:"error",message:"上传失败"}),this.listLoading=!1},get_fileinfo(e){this.detailView=!0,this.ViewLoading=!0,Object(C["file_info"])("files/"+e.path+"/"+e.name).then(t=>{this.detailinfo={},t.data&&(this.detailinfo=t.data,this.detailinfo.url=this.$FileServe+"/"+e.path+"/"+e.name),this.ViewLoading=!1})},delete_file(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(C["delete_file"])("files/"+e.path+"/"+e.name).then(t=>{"ok"==t.status?(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),this.get_filelist(e.path)):this.$message({showClose:!0,duration:2e3,type:"error",message:t.message})}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"error",message:"删除失败"})})}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消删除"})})},download_file(e){window.open(this.$FileServe+"/"+e.path+"/"+e.name)},files(e){this.inputParams.filename=e.name,this.inputParams.file=e},get_filelist(e){this.listLoading=!0,Object(C["list_dir"])(e).then(e=>{"ok"==e.status?this.filelist=e.data:this.filelist=[],this.listLoading=!1})},blurinterval(e){return M(this,null,(function*(){yield Object(p["putProduct"])(e.objectId,{config:e.config}),this.$message({message:"物模型缓存延时修改成功",type:"success",showClose:!0,duration:1500})}))},handleAddressClose(){return M(this,null,(function*(){this.dialog_address=!this.dialog_address,yield Object(p["putProduct"])(this.productObj.objectId,{config:this.productdetail.config}),this.$message({type:"success",message:"安装位置更新成功",showClose:!0,duration:2e3})}))},inputAddress(){const e=this.productdetail.config.address;var t=new BMapGL.Map("container");t.centerAndZoom(new BMapGL.Point(116.331398,39.897445),12);var i=new BMapGL.Geocoder;i.getPoint(e,(function(i){i?(t.centerAndZoom(i,16),t.addOverlay(new BMapGL.Marker(i,{title:e}))):alert("您选择的地址没有解析到结果！")}),"北京市")},mapClick(e){this.productdetail.config.location={latitude:e.point.lat,longitude:e.point.lng};const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.productdetail.config.address=e.address})},toggleSwitch(e){e.isshow=!e.isshow,this.preserve("isshow")},toggleStore(e){e.isstorage=!e.isstorage,this.preserve("isstorage")},thingParameters(e,t,i){this.editIndex=t,this.modules.data[i].data.output.push(e),this.atbas.childrenDrawer=!1},editParameters(e,t){this.modules[t].data.output[this.editIndex]=e,this.atbas.childrenDrawer=!1},showDrawer(){this.atbas.visible=!0},onClose(){this.atbas.visible=!1},showChildrenDrawer(){this.eventForm={name:"",unit:"/",isread:"rw",dataType:"int32",identifier:"",min:"",max:"",step:""},this.eventType="add",this.atbas.childrenDrawer=!0},onChildrenDrawerClose(){this.atbas.childrenDrawer=!1,console.log("清空子组件的规则校验和表单数据")},basicMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},thingMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},editEvent(e,t,i){return M(this,null,(function*(){this.editIndex=t,this.atbas.childrenDrawer=!0,this.eventForm=e,this.eventType="edit",this.formType=i}))},getDefaultTopic(){return M(this,null,(function*(){const e=yield Object(h["getDlinkJson"])("Topic"),{UnifyUnitSpecsDTO:t=[]}=yield Object(h["getDlinkJson"])("Unit");for(var i in this.dlinkUnit=t,this.dlinkUnit.unshift({Symbol:"/",Name:"无"}),this.dlinkTopic=e,this.dlinkTopic)yield this.mergeTable(i,this.dlinkTopic[i])}))},topicChange(e){return M(this,null,(function*(){"user"==e&&(yield this.getTopic())}))},mergeTable(e,t){return M(this,null,(function*(){let i=0;for(let s in t[0])this.mergeObj[e][s]=[],t.forEach((a,o)=>{0===o?this.mergeObj[e][s].push(1):a[s]===t[o-1][s]?(this.mergeObj[e][s][i]+=1,this.mergeObj[e][s].push(0)):(i=o,this.mergeObj[e][s].push(1))})}))},clearfix(e){this.$refs[e].clearValidate(),"services"==e?this.$refs.services.resetFields():this.$refs.events.resetFields(),this.modules.events.data.types="info",this.modules.services.data.transfer="sync"},editModus(e){this.modules[""+e.type].data=e,this.modules.type=e.type,this.modules.visible=!0,this.modules.disabled=!0,dgiotlogger.info("editModus",e,this.modules[""+e.type])},deleteModus(e,t,i){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>M(this,null,(function*(){t.splice(e,1),yield this.saveExpand(this.productObj.thing)})))},handleClose(){"events"==this.modules.type&&(this.$refs.events.clearValidate()&&this.$refs.events.resetFields()),"services"==this.modules.type&&(this.$refs.services.clearValidate()&&this.$refs.services.resetFields()),this.modules.events.data.types="info",this.modules.services.data.transfer="sync",this.modules.visible=!1,this.modules.disabled&&this.saveExpand(this.productObj.thing)},saveExpand(e){return M(this,null,(function*(){const t=yield Object(p["putProduct"])(this.productObj.objectId,{thing:e});t.updatedAt?this.$message({type:"success",message:"更新成功",showClose:!0,duration:2e3}):this.$message({type:"warning",message:"更新失败"+t.msg,showClose:!0,duration:2e3})}))},queryProductInfo(e){return M(this,null,(function*(){const t=yield Object(p["getProduct"])(e);localStorage.setItem("parse_productid",e);let{thing:i={properties:[],events:[],services:[],tags:[]}}=t;_.merge({properties:[],events:[],services:[],tags:[]},i);let s=_.merge({properties:[],events:[],services:[],tags:[]},i);this.productObj=t;E(E({},this.productdetail.config),t.config);this.$set(this.productdetail,"thing",this.productObj.thing),this.$set(this.productdetail,"config",this.productObj.config),this.modules.data=s}))},submitModules(e,t){return M(this,null,(function*(){t.data.outputParams=[],t.data.output.forEach((e,i)=>{t.data.outputParams.push({identifier:e.identifier,index:i})});const i=N(E({},t.data),{devicetype:t.data.name,required:!1,isshow:!0,isstorage:!0,isaccumulate:!1,dataForm:{order:moment(new Date).format("x")},dataType:{type:e},moduleType:e,updateAt:moment(new Date).format("x")});return window._item=i,yield this.submitForm(i),this.atbas.visible=!1,yield this.queryProductInfo(this.$route.query.id),!1}))},feateditorParser1(e,t,i){let s=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:i,productInfo:s})}},Object(u["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{tableRowClassName({row:e,rowIndex:t}){return 1===t?"warning-row":3===t?"success-row":""},selectStruct(e){},toggleList(){this.showList=!this.showList},getFormOrginalData(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,isstorage:!0,isaccumulate:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%{s}",control:"%{d}",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%{s}"}},changeValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},changeStructValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},getRowClass(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleChildClick(e){return M(this,null,(function*(){yield this.queryProductInfo(this.$route.query.id);const{properties:t=[],events:i=[],services:s=[],tags:a=[]}=this.productObj.thing;switch(e.name){case"properties":this.modules.data.properties=t||[];break;case"events":this.modules.data.events=i||[];break;case"services":this.modules.data.services=s||[];break;case"tags":this.modules.data.tags=a||[];break;default:break}dgiotlogger.info(this.modules.data)}))},handleClick(e){switch(e.name){case"view":this.viewForm={class:"Product",key:this.$route.query.id||"",title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:[]};break;case"notification":this.viewForm={showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",notification:!0,disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]};break;case"fiveth":this.getProductChannel();break;case"second":this.getTopic();break;case"seven":this.getResourceChannel();break;case"sixeth":this.orginRule();break;case"eighth":this.isreload++;break;default:window.clearInterval(this.subtimer),this.subtimer=null;break}},getAllunit(){return M(this,null,(function*(){this.allunit=[];const{UnifyUnitSpecsDTO:e=[]}=yield Object(h["getDlinkJson"])("Unit");this.allunit=e}))},getTopic(){return M(this,null,(function*(){this.topicData=[],this.topicDefault={};const{topics:e={}}=yield Object(p["getProduct"])(this.productId);this.topicDefault=e;for(let t in e){let i={};for(let e in this.dlinkTopic.basic)this.dlinkTopic.basic[e].info="basic",this.dlinkTopic.basic[e].id===t&&(i=this.dlinkTopic.basic[e]);for(let e in this.dlinkTopic.thing)this.dlinkTopic.thing[e].info="thing",this.dlinkTopic.thing[e].id===t&&(i=this.dlinkTopic.thing[e]);i.name=t,i.value=e[t],this.topicData.push(i)}}))},exportProduct(e){return M(this,null,(function*(){try{const t={name:e},i=this.$baseColorfullLoading(),s=yield Object(b["downBinary"])("iotapi/product",t);F["dgiotlog"].log(s),this.$baseMessage(this.$translateTitle("alert.Data request successfully"),"success","dgiot-hey-message-success"),i.close(),this.$downBinary(s)}catch(t){F["dgiotlog"].log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},seeDecoder(e){return M(this,null,(function*(){try{this.ace_editor=V.decode(e.code)}catch(t){F["dgiotlog"].log(t)}}))},setTemplate(e){return M(this,null,(function*(){const t=this.$baseColorfullLoading(),{category:i="IotHub",config:s={konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}},decoder:a={code:""},desc:o="",icon:r="",name:n="",netType:d="Modbus",nodeType:l=0,thing:c={properties:[]}}=e;try{const e={"*":{read:!0,write:!0}},h={ACL:e,category:i,config:s,decoder:a,desc:o,icon:r,name:n,netType:d,nodeType:l,thing:c},u=yield Object(v["postProductTemplet"])(h);F["dgiotlog"].log(u),u?this.$baseMessage(this.$translateTitle("user.Save the template successfully"),"success","dgiot-hey-message-success"):this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error"),t.close()}catch(h){F["dgiotlog"].log(h),t.close(),this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error")}}))},updatesubdialog(){return M(this,null,(function*(){this.protoldialog=!0;const e="1",t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.protolchannel=e.results,this.$refs.multipleTable.toggleAllSelection()}).catch(e=>{F["dgiotlog"].log(e),this.$baseMessage("请求出错",e.error,3e3)})}))},handleSelectionChange(e){this.multipleSelection=e},updateAllChannel(){if(0==this.multipleSelection.length)this.protoldialog=!1;else{var e=[];this.multipleSelection.map(t=>{e.push(new Promise((e,i)=>Object($["subupadte"])(t.objectId,"update").then(t=>{t&&e(t)}).catch(e=>{i(e)})))}),Promise.all(e).then(e=>{this.$message({showClose:!0,duration:2e3,message:"热加载成功",type:"success"}),e.length==this.multipleSelection.length&&(this.protoldialog=!1)}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:e,type:"error"})})}},showAllChannel(e=""){F["dgiotlog"].log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;const t={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(""!=e?this.allChannellength:this.channellength,""!=e?this.allChannelstart:this.channelstart,i,t).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},getProductChannel(){const e={$in:["1","3"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.channeltotal=e.count,this.channelData=e.results,0==e.results.length}).catch(e=>{F["dgiotlog"].log(e)})},resourceShowAllChannel(){this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;const e={$in:["2"]},t={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},getResourceChannel(){const e={$in:["2"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.resourcetotal=e.count,this.resourcechannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},addProductChannel(e){return M(this,null,(function*(){const t={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}},i=yield Object(g["saveChanne"])(e,t);i&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),1==this.channeltype?(this.showAllChannel(),this.getProductChannel()):(this.resourceShowAllChannel(),this.getResourceChannel()))}))},deleteRelation(e){const t={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(g["saveChanne"])(e.objectId,t).then(e=>{e&&this.$message({showClose:!0,duration:2e3,type:"success",message:"移除成功"}),this.getProductChannel(),this.getResourceChannel()})},channelSizeChange(e){this.channellength=e,this.getProductChannel()},channelCurrentChange(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize(e){this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,z=JSON.parse(JSON.stringify(e.config)),Object(I["setTimeout"])(()=>{r=ace.edit("editormodel"),r.session.setMode("ace/mode/json"),r.setTheme("ace/theme/twilight"),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r.setReadOnly(!0),r.setValue(JSON.stringify(this.productdetail.thing,null,4)),n=ace.edit("editorcreate"),n.session.setMode("ace/mode/mysql"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?n.setValue(e.config.datamodel):n.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')})},questionModel(){Object(I["setTimeout"])(()=>{d=ace.edit("editorinsert"),d.session.setMode("ace/mode/mysql"),d.setTheme("ace/theme/gob"),d.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),d.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')})},addData(){return M(this,null,(function*(){z.datamodel=n.getValue();const e={config:z};yield Object(g["putChannel"])(this.rproductdetailesourcechannelid,e),this.$message("添加成功")}))},closeWuDialog(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1(){this.structform.specs.push({value:"",name:""})},submitForm(e){F["dgiotlog"].log("obj",e);let t={item:e,productid:this.productId};"新增"==this.wmxSituation?Object(p["postThing"])(t).then(e=>{F["dgiotlog"].log("新增",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"新增成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}):"编辑"==this.wmxSituation&&Object(p["putThing"])(t).then(e=>{F["dgiotlog"].log("编辑",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}),this.wmxdialogVisible=!1,this.queryProductInfo(this.$route.query.id)},createThing(e){switch(this.modules.disabled=!1,this.moduletype=e,this.wmxSituation="新增",this.setSizeForm(this.getFormOrginalData()),e){case"properties":this.wmxdialogVisible=!0;break;case"services":this.atbas.visible=!0,this.modules.type="services";break;case"events":this.atbas.visible=!0,this.modules.type="events";break;case"tags":this.wmxdialogVisible=!0;break}this.$nextTick(()=>{this.$refs[e]&&this.$refs[e].clearValidate(),this.$refs[e]&&this.$refs[e].resetFields()})},wmxDataFill(e,t,i){return M(this,null,(function*(){if(this.$nextTick(()=>{this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol(),this.upKey=moment.now()}),this.moduletype=i,this.modules.type=i,this.wmxSituation="编辑",this.thingType=i,this.eventType="edit",this.modules[i]&&(this.modules[i].data=e),"events"===i||"services"===i)return this.atbas.visible=!0,dgiotlogger.log(this.modules.type,this.modules[i].data),!1;this.modifyIndex=t,this.wmxdialogVisible=!0;var s={},a=[];if(e.dataType.das.forEach(e=>{a.push({addr:e})}),-1!=["float","double","int","long"].indexOf(e.dataType.type))s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:a,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0},e.dataForm&&(s.collection=e.dataForm.collection,s.control=e.dataForm.control,s.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var o=[];for(const t in e.dataType.specs)o.push({attribute:t,attributevalue:e.dataType.specs[t]});s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:o,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0});F["dgiotlog"].log("editrowData",e),s.protocol=e.dataForm.protocol,s.profile=e.profile,this.setSizeForm(s),this.upKey=moment.now(),this.$nextTick(()=>M(this,null,(function*(){yield this.$refs["sizeForm"].queryResource(),yield this.$refs["sizeForm"].queryProtocol(),this.$refs["sizeForm"].resource.value=e.dataForm.protocol,this.$refs["sizeForm"].resource.disabled=!!e.dataForm.protocol.length,this.$refs["sizeForm"].resource.arrlist=e.dataSource;yield Object(D["getProtocol"])();this.$nextTick(()=>{this.$refs["sizeForm"].resource.data.forEach((t,i)=>{if(this.$refs["sizeForm"].resource.value===t.cType){for(var s in console.info(t,"物模型回显事件"),t.arr.forEach(t=>{t.allowCreate&&this.$refs["sizeForm"].dynamicTable(t,"回显",e.dataSource[t.showname])}),console.info(e.dataSource,"rowData.dataSource"),e.dataSource)for(var a in t.obj)s===a&&(t.obj[s]=e.dataSource[a]);console.info(t.obj,"set resource.obj"),this.$refs["sizeForm"].resource.addchannel=t.obj}this.$refs["sizeForm"].resource.changeData=e.dataSource,t.cType,e.dataForm.protocol})})})))}))},submitStruct(e){this.$refs[e].validate(t=>{if(t){var i={};if("float"==this.structform.type||"double"==this.structform.type||"int"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{max:this.structform.endnumber,min:this.structform.startnumber,step:this.structform.step,unit:""==this.structform.unit?"":this.structform.unit}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("bool"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{0:this.structform.false,1:this.structform.true}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!1,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("enum"==this.structform.type){var s={};this.structform.struct.map(e=>{var t=e["attribute"];s[t]=e["attributevalue"]}),i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),struct:this.structform.struct,specs:s},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}}else"text"==this.structform.type?i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),size:this.structform.string},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}:"date"==this.structform.type&&(i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase()},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier});-1==this.isupdatedstruct?this.sizeForm.struct.push(i):(this.sizeForm.struct.splice(this.isupdatedstruct,1,i),this.isupdatedstruct=-1),this.$refs[e].resetFields(),this.structdialog=!1}})},addStruct(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct(e,t){if(F["dgiotlog"].log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((t,s)=>{i.attribute=t,i.attributevalue=e.dataType.specs[t],this.structform.specs.push(i)})}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct(e){this.sizeForm.struct.splice(e,1)},preserve(e){return M(this,null,(function*(){const t="json"===e?"物模型修改成功":"物模型状态更新成功",i="json"===e?{thing:JSON.parse(a.getValue())}:{thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,i),Object(I["setTimeout"])(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:t}),"json"===e&&(this.schemadialogVisible=!1,this.handleChildClick(this.tabsChild),this.getProDetail())},1e3)}))},Industry(){return M(this,null,(function*(){this.option=[];const{results:e}=yield this.$getIndustry("category",100);e.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.option.push(t)}),this.getProDetail()}))},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData(e){0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;const t={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(t.where.type=this.category[this.category.length-1]),Object(y["getDictCount"])(t).then(e=>{this.producttotal=e.count,this.PropData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},productSizeChange(e){this.productlength=e,this.getPropData()},productCurrentChange(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest(){this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(I["setTimeout"])(()=>{this.editorList.push(ace.edit(this.wmxData[0].identifier)),this.editorList[0].session.setMode("ace/mode/erlang"),this.editorList[0].setTheme("ace/theme/monokai"),this.editorList[0].setHighlightActiveLine(!0),this.editorList[0].setFontSize(20),this.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.ed3isShow=!0,this.editorList[0].setValue(void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection)},1)},handleRightTopTabClick(e,t){this.activeIndex=e.label},menuTabClick(e,t){this.activeIndex=e.identifier;const i=this.editableTabs;let s=!1,a=0;i.forEach((t,i)=>{t.name===e.identifier&&(s=!0,a=i)}),0==s?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(I["setTimeout"])(()=>{this.editorList.push(ace.edit(e.identifier)),this.editorList[this.editorList.length-1].session.setMode("ace/mode/erlang"),this.editorList[this.editorList.length-1].setTheme("ace/theme/monokai"),this.editorList[this.editorList.length-1].setHighlightActiveLine(!0),this.editorList[this.editorList.length-1].setFontSize(20),this.editorList[this.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.editorList[this.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)},1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[a].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab(e){const t=this.editableTabs;let i=this.editableTabsValue;i===e&&t.forEach((s,a)=>{if(s.name===e){const e=t[a+1]||t[a-1];e&&(i=e.name)}}),this.editableTabsValue=i,this.activeIndex=i,this.editableTabs=t.filter(t=>t.name!==e)},onSaveTap(e){return M(this,null,(function*(){const t=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[t].dataForm.collection=this.editorList[e].getValue();const i={thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}))},handleCloseCollecttion(e){this.$confirm("确认关闭？").then(t=>{e()}).catch(e=>{})},onReductionTap(e){const t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema(){this.schemadialogVisible=!0,Object(I["setTimeout"])(()=>{a=ace.edit("editor1"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.setValue(JSON.stringify(this.productdetail.thing,null,4))},1)},query_notification(){return M(this,null,(function*(){let e={count:"objectId",where:{key:{$regex:this.$route.query.id},type:{$regex:"notification"}}};this.$route.query.id&&(e.where.key={$regex:this.$route.query.id});const{results:t,count:i=0}=yield Object(j["queryView"])(e);this.amisShow=i>0,this.amisproductInfo=t}))},getProDetail(){this.query_notification(),s=ace.edit("editor"),s.session.setMode("ace/mode/erlang"),s.setTheme("ace/theme/monokai"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.FromMachine=[{name:"ALL"}],this.$get_object("Product",this.productId).then(e=>{var t,i,a,o,r;if(console.log("response",e),e){for(var n in this.productInfo=_.merge(e,{decoder:{code:""},thing:{properties:[]},config:{address:(null==(t=e.config)?void 0:t.address)||"余杭区良渚平高创业城c1座",location:{longitude:(null==(a=null==(i=e.config)?void 0:i.location)?void 0:a.longitude)||"120.161324",latitude:(null==(r=null==(o=e.config)?void 0:o.location)?void 0:r.latitude)||"30.262441"}}}),this.productName=e.name,e)this.productdetail[n]=e[n];this.option.map(e=>{this.productdetail.category==e.value&&(this.productdetail.category=e.label)}),this.productdetail.createdAt=this.utc2beijing(e.createdAt),this.productdetail.id=e.id,this.dynamicReg=e.dynamicReg,this.productdetail.isshow=0,this.productdetail.category&&this.$get_object("Category",this.productdetail.category.objectId).then(e=>{F["dgiotlog"].log("catcat",e),this.$set(this.productdetail,"categoryname",e.name)}),this.form.Productname=e.name,this.ProductSecret=e.productSecret,this.form.Productkey=this.productId,this.productimg=e.icon,e.decoder?(R=e.decoder.code,this.formInline.name=e.decoder.name,this.formInline.version=e.decoder.version,this.formInline.desc=e.decoder.desc):R="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=this.productdetail.thing&&"{}"!=JSON.stringify(this.productdetail.thing)||(this.productdetail.thing={properties:[]}),this.wmxData=[],this.wmxDataBk=[],this.wmxData=this.productdetail.thing.properties.filter((e,t)=>(e.index=t,e.name&&e.dataType)),this.wmxDataBk=this.productdetail.thing.properties,this.wmxDataBk.forEach(e=>{if(e.devicetype){let t={name:e.devicetype};this.FromMachine.push(t)}}),this.FromMachine=_.uniqBy(this.FromMachine,"name"),s.setValue(V.decode(R)),s.gotoLine(s.session.getLength())}}).catch(e=>{this.$baseMessage("请求出错",e.error,3e3)})},queryDeviceCount(e){return M(this,null,(function*(){this.form.ProductAll=yield Object(m["getDeviceCountByProduct"])(e)}))},handelUpdate(e,t){return M(this,null,(function*(){var t;t=1!=e,this.dynamicReg=t;const i={dynamicReg:!t};yield Object(p["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"修改成功"}),this.dynamicReg=!t}))},wmxhandleClose(e){return M(this,null,(function*(){this.wmxSituation="新增",e?(this.wmxdialogVisible=!1,yield this.$refs["sizeForm"].$refs["sizeForm"].resetFields(),yield this.setSizeForm(this.getFormOrginalData()),this.$refs["sizeForm"].resource.disabled=!1,yield this.handleChildClick(this.tabsChild),this.$refs["sizeForm"]&&(yield this.$refs["sizeForm"].queryResource()),this.upKey=moment.now()):(this.wmxdialogVisible=!1,this.upKey=moment.now())}))},protol(){var e="";Object($["Compile"])(V.encode(s.getValue())).then(t=>{t&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"编译成功"}),e="编译成功"+t.mod+"\r\n",this.warningeditror=t.warnings,this.warningeditror.map(t=>{e+=t+"\r\n"}),K+=e,o.setValue(K))}).catch(t=>{this.warningeditror=t.error,this.warningeditror.map(t=>{e+=t+"\r\n"}),K+=e,o.setValue(K)})},decoderSizeChange(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata(e){this.$del_object("Dict",e).then(e=>{e&&(this.$message("成功删除"),this.chaxun())}).catch(e=>{F["dgiotlog"].log(e)})},subAce(e,t){this.$refs[e].validate(e=>M(this,null,(function*(){if(e){var i={name:this.formInline.name,version:this.formInline.version,code:V.encode(s.getValue()),desc:this.formInline.desc};const e={decoder:i};yield Object(p["putProduct"])(this.productId,e),0==this.issub&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"保存成功"}),1==t&&(K+="保存成功",o.setValue(K))),this.issub=!0}else this.$message({type:"warning",message:"输入格式有误"})})))},subAce1(e){this.$refs[e].validate(e=>{if(e){const e={where:{"data.name":this.formInline.name,"data.version":this.formInline.version}};this.$query_object("Dict",e).then(e=>{e.results&&e.results.length>=1?this.$message("此协议版本已存在"):this.$get_object("Product",this.productId).then(e=>{if(e){var t={name:this.formInline.name,version:this.formInline.version,code:V.encode(s.getValue()),desc:this.formInline.desc};const i={key:this.formInline.name+":"+this.formInline.version,type:"decoder",data:t,ACL:e.ACL};this.$create_object("Dict",i).then(e=>{e.error?this.$message({type:"error",message:e.error}):this.$message({showClose:!0,duration:2e3,type:"success",message:"保存到公共协议库成功"})}).catch(e=>{F["dgiotlog"].log(e)})}})}).catch(e=>{F["dgiotlog"].log(e)})}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"输入格式有误"})})},updatesub(e){Object($["subupadte"])(e.objectId,"update").then(e=>{e&&this.$message("重载成功")}).catch(e=>{this.$message(e.error)})},chaxun(){const e={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",e).then(e=>{e&&(this.decodertotal=e.count,this.gridData=e.results)}).catch(e=>{F["dgiotlog"].log(e)})},editordata(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,s.setValue(V.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory(){this.originwmx=!0,this.getPropData()},addMachine(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine(e,t,i){"ALL"==e.name?(this.wmxDataBk.forEach(e=>{e.dataType||(e.dataType={das:[],specs:{},type:"float",identification:"function"})}),this.wmxData=this.wmxDataBk):(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter(t=>t.devicetype==e.name&&!t.dataType.identification),this.wmxstart=1),this.upKey=moment.now()},handleChange(e,t,i){},TypeInstall(e,t){t.map((t,i)=>{if("enum"==t.DataType||"bool"==t.DataType){var s={dataType:{specs:{}}};s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{for(var t in e){var i=e["value"],a=e["name"];s.dataType.specs[i]=a}}),e.push(s)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){s={dataType:{specs:{}}};for(var a in s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))s.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],s.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],s.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],s.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(s)}else if("struct"==t.DataType){var o={dataType:{specs:[]}};o.name=t.Name,o.dataType.type=t.DataType,o.required=!t.Required,o.identifier=t.Identifier,o.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map(e=>{for(var i in e){var s=e["value"],a=e["name"];t.dataType.specs[s]=a}}),o.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var i in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];o.dataType.specs.push(t)}}),e.push(o)}});var i={};e=e.reduce((e,t)=>(!i[t.identifier]&&(i[t.identifier]=e.push(t)),e),[])},addProCategory(e){const t={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",t).then(e=>M(this,null,(function*(){const t=e.results;if(t&&t[0].data.Ability){this.TypeInstall(this.productdetail.thing.properties,t[0].data.Ability);const e={thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,e),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}else F["dgiotlog"].log("此选项没有属性功能")})))},deletewmx(e){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),this.$translateTitle("Maintenance.Delete reminder"),()=>M(this,null,(function*(){const t={productid:this.productId,item:e},i=yield Object(p["deleteThing"])(t);200==i.code?(this.$baseMessage(this.$translateTitle("user.successfully deleted"),"success","dgiot-hey-message-success"),yield this.getProDetail()):this.$baseMessage(this.$translateTitle("user.error deleted")+(null==i?void 0:i.msg)?i.msg:i,"error","dgiot-hey-message-error")})))},wmxSizeChange(e){this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange(e){this.wmxstart=e},eventsChange(e){this.eventsStart=1,this.eventsPageSize=e},eventsCurrentChange(e){this.eventsStart=e},serverSizeChange(e){this.servicesStart=1,this.servicesPageSize=e},serverCurrentChange(e){this.servicesStart=e},tagsSizeChange(e){this.tagsStart=1,this.tagsPageSize=e},tagsCurrentChange(e){this.eventsStart=e},nowtime(){var e=Date.parse(new Date),t=new Date(e),i=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",a=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+" "},subProTopic(e){return M(this,null,(function*(){this.channelid=e.objectId,this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.mqtt.subtopic="$dg/user/channel/"+e.objectId+"/#",yield this.$nopostsubscribe(this.mqtt.subtopic),Object($["subupadte"])(e.objectId,"start_logger"),this.msgList=[],this.submessage="Starting the log\n",this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{const{payloadString:t}=e;this.mqttMsg(t)})}))},mqttMsg(e){this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},handleCloseSubdialog(){Object($["subupadte"])(this.channelid,"stop_logger"),this.msgList=[],this.submessage="",this.subdialog=!1},stopsub(e){},subTopic(e,t){this.$refs[e].validate(i=>M(this,null,(function*(){if(!i)return F["dgiotlog"].log("error submit!!"),!1;{let i="";-1!=t?(this.topicDefault[this.topicform.id]=this.topicform.value,i="修改topic成功"):(this.topicDefault[this.topicform.topic]=this.topicform.value,i="添加自定义topic成功"),yield Object(p["putProduct"])(this.productId,{topics:this.topicDefault}),this.$message({showClose:!0,duration:2e3,type:"success",message:i}),this.topicform={isupdated:-1,value:"",info:"basic"},this.handleClick({name:"second"}),this.topicdialogVisible=!1,this.$refs[e].resetFields()}})))},topicSizeChange(e){this.topicstart=1,this.topiclength=e},topicCurrentChange(e){this.topicstart=e},updatetopic(e,t){this.topicform=e,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic(e,t,i){this.$baseConfirm("你确定要删除当前项topic吗",null,()=>M(this,null,(function*(){const t={};e.splice(i,1),e.forEach(e=>{t[e.id]=e.value}),yield Object(p["putProduct"])(this.productId,{topics:t}),this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"})})))},orginRule(){Object(f["getRule"])().then(e=>{e&&(this.engineData=e)}).catch(e=>{this.$message(e.error)})},handleSizeChange(e){},handleCurrentChange(e){},addEngine(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions(e){var t=[];return e.map(e=>{t.push(e.name)}),t.join(",")},getRowindex(e,t,i){if(0==e.columnIndex)return"firstcolumn"},detailRules(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})}},fe51:function(e,t,i){"use strict";var s,a,o,r,n,d,l=i("4351"),c=i("40d1"),h=i("22f9"),u=i("5880"),m=i("1285"),p=i("7212"),g=i("89e8"),b=i("1267"),y=i("e0e9"),f=i("1b07"),v=i("ef68"),$=i("bb22"),C=i("1ae2"),I=i("5118"),T=i("aed5"),w=i("30b0"),F=i("4013"),j=i("8ba7"),S=i("0c3c"),D=i("62b6"),A=i("c3b1"),G=i("cb88"),L=Object.defineProperty,x=Object.defineProperties,P=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,B=(e,t,i)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,E=(e,t)=>{for(var i in t||(t={}))k.call(t,i)&&B(e,i,t[i]);if(O)for(var i of O(t))q.call(t,i)&&B(e,i,t[i]);return e},N=(e,t)=>x(e,P(t)),M=(e,t,i)=>new Promise((s,a)=>{var o=e=>{try{n(i.next(e))}catch(t){a(t)}},r=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((i=i.apply(e,t)).next())}),z={};const V=i("f43e").Base64;var R="",K="",J={components:{mqttLog:l["default"],dgiotViews:S["default"],dgiotDict:A["default"],"dgiot-wmx":T["default"],"dgiot-profile":w["default"],"thing-form":c["default"],BmLocalSearch:G["BmLocalSearch"],BmPointCollection:G["BmPointCollection"],BmInfoWindow:G["BmInfoWindow"],BmScale:G["BmScale"],BmMapType:G["BmMapType"],BmView:G["BmView"],BmOverviewMap:G["BmOverviewMap"],BmPanorama:G["BmPanorama"],BmControl:G["BmControl"],BmLabel:G["BmLabel"],BaiduMap:G["BaiduMap"],BmNavigation:G["BmNavigation"],BmGeolocation:G["BmGeolocation"],BmCityList:G["BmCityList"],BmMarker:G["BmMarker"],BmlMarkerClusterer:G["BmlMarkerClusterer"]},data(){const e=(e,t,i)=>{const s=/[0-9a-zA-Z]/;s.test(t)?i():i(new Error("协议名称由数字和字母组合"))},t=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.sizeForm.endnumber&&(t>=this.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.sizeForm.startnumber&&(t<=this.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},s=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.sizeForm.endnumber-this.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},a=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.structform.endnumber&&(t>=this.structform.endnumber?i(new Error("最小值小于最大值")):i())},o=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.structform.startnumber&&(t<=this.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},r=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.structform.endnumber-this.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{ak:this.$dgiot.secret.baidu.map,viewForm:{showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]},dlinkUnit:[],dlinkTopic:{basic:[],thing:[]},mergeObj:{basic:[],thing:[]},tabsChild:"properties",modules:{data:{properties:[],events:[],services:[],tags:[]},type:"events",disabled:!1,visible:!1,events:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],types:[{required:!0,message:"请选择调用方式",trigger:"change"}],output:[{type:"array",required:!0,message:"请至少选择一个输出参数",trigger:"blur"}]},visible:!1,data:{outputParams:[],name:"",identifier:"",types:"info",output:[],describe:""}},services:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:40,message:"长度在 1 到 40 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],transfer:[{required:!0,message:"请选择调用方式",trigger:"change"}]},visible:!1,data:{name:"",identifier:"",enter:[],transfer:"sync",output:[],describe:""}}},moduletype:"properties",amisproductInfo:[],upKey:moment.now(),codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[],events:[],services:[],tags:[]},config:{parser:[],profile:[],basedate:{params:[]}}},productObj:{thing:{properties:[],events:[],services:[],tags:[]}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{profile:"",topic:"",type:"",desc:"",value:"",info:"basic",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{info:[{required:!0,message:"请选择topic所属类型",trigger:"change"}],topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:s}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:t,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:r}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:o,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0,data:{}},ProductSecret:"",dynamicReg:!1,dialog_address:!1,productId:"",productName:"",productdetail:{config:{address:"余杭区良渚平高创业城c1座",location:{longitude:"120.161324",latitude:"30.262441"}},thing:{properties:[],events:[],services:[],tags:[]}},topicData:[],topicDefault:{},topic:[{topic:"$dg/user/${deviceid}/post",type:"sub",desc:"设备属性上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"pub",desc:"消息下发",isdef:!0}],isshow:!0,isstorage:!0,isaccumulate:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:e,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,eventsStart:1,eventsPageSize:10,servicesStart:1,servicesPageSize:10,tagsStart:1,tagsPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],topicKey:"",refreshFlag:"99",msgList:[],submessage:"Starting the log\n",mqtt:{router:"",subtopic:"",pubtopic:""},warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,channelid:"",channelInfo:[],textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1,atbas:{visible:!1,childrenDrawer:!1},editIndex:-1,eventType:"add",formType:"output",thingType:"events",eventForm:{},ruleForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},amisShow:!0,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]},filelist:[],listLoading:!1,detailView:!1,ViewLoading:!1,detailinfo:{},inputParams:{},fileParams:{scene:"app"}}},computed:E({treeData(){const e=JSON.parse(JSON.stringify(this.option));return e.filter(t=>{const i=e.filter(e=>t.id==e.parentid);return i.length>0&&(t.children=i),0==t.parentid})},showNewItem(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(u["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler(e){this.subtimer=window.setInterval(()=>{this.subAce("formInline",!1)},5e3)}}},mounted(){if(this.query_notification(),this.getAllunit(),this.getDefaultTopic(),this.$nextTick(()=>{this.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",this.mqtt.router=this.$dgiotBus.router(this.$route.fullPath)}),this.Industry(),this.getAllunit(),o=ace.edit("editor2"),o.session.setMode("ace/mode/text"),o.setTheme("ace/theme/monokai"),o.setReadOnly(!0),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.id){let e=this.$route.query.id;this.fileParams.path="product/"+e,this.get_filelist("dgiot_file/product/"+e)}this.$route.query.activeName&&(this.activeName=this.$route.query.activeName),this.$route.query.id&&this.queryProductInfo(this.$route.query.id)},beforeDestroy(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:N(E({uploadCkick(){this.loading=!0,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"));this.$route.query.id;this.inputParams={file:"",scene:this.fileParams.scene?this.fileParams.scene:"default",path:this.fileParams.path?this.fileParams.path:"default",filename:moment(new Date).valueOf().toString()}},fileInfo(e){this.listLoading=!0;let t=this.$route.query.id;e.url?(this.$message({showClose:!0,duration:2e3,type:"success",message:"上传成功"}),this.get_filelist("dgiot_file/product/"+t)):this.$message({showClose:!0,duration:2e3,type:"error",message:"上传失败"}),this.listLoading=!1},get_fileinfo(e){this.detailView=!0,this.ViewLoading=!0,Object(C["file_info"])("files/"+e.path+"/"+e.name).then(t=>{this.detailinfo={},t.data&&(this.detailinfo=t.data,this.detailinfo.url=this.$FileServe+"/"+e.path+"/"+e.name),this.ViewLoading=!1})},delete_file(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(C["delete_file"])("files/"+e.path+"/"+e.name).then(t=>{"ok"==t.status?(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),this.get_filelist(e.path)):this.$message({showClose:!0,duration:2e3,type:"error",message:t.message})}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"error",message:"删除失败"})})}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消删除"})})},download_file(e){window.open(this.$FileServe+"/"+e.path+"/"+e.name)},files(e){this.inputParams.filename=e.name,this.inputParams.file=e},get_filelist(e){this.listLoading=!0,Object(C["list_dir"])(e).then(e=>{"ok"==e.status?this.filelist=e.data:this.filelist=[],this.listLoading=!1})},blurinterval(e){return M(this,null,(function*(){yield Object(p["putProduct"])(e.objectId,{config:e.config}),this.$message({message:"物模型缓存延时修改成功",type:"success",showClose:!0,duration:1500})}))},handleAddressClose(){return M(this,null,(function*(){this.dialog_address=!this.dialog_address,yield Object(p["putProduct"])(this.productObj.objectId,{config:this.productdetail.config}),this.$message({type:"success",message:"安装位置更新成功",showClose:!0,duration:2e3})}))},inputAddress(){const e=this.productdetail.config.address;var t=new BMapGL.Map("container");t.centerAndZoom(new BMapGL.Point(116.331398,39.897445),12);var i=new BMapGL.Geocoder;i.getPoint(e,(function(i){i?(t.centerAndZoom(i,16),t.addOverlay(new BMapGL.Marker(i,{title:e}))):alert("您选择的地址没有解析到结果！")}),"北京市")},mapClick(e){this.productdetail.config.location={latitude:e.point.lat,longitude:e.point.lng};const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.productdetail.config.address=e.address})},toggleSwitch(e){e.isshow=!e.isshow,this.preserve("isshow")},toggleStore(e){e.isstorage=!e.isstorage,this.preserve("isstorage")},thingParameters(e,t,i){this.editIndex=t,this.modules.data[i].data.output.push(e),this.atbas.childrenDrawer=!1},editParameters(e,t){this.modules[t].data.output[this.editIndex]=e,this.atbas.childrenDrawer=!1},showDrawer(){this.atbas.visible=!0},onClose(){this.atbas.visible=!1},showChildrenDrawer(){this.eventForm={name:"",unit:"/",isread:"rw",dataType:"int32",identifier:"",min:"",max:"",step:""},this.eventType="add",this.atbas.childrenDrawer=!0},onChildrenDrawerClose(){this.atbas.childrenDrawer=!1,console.log("清空子组件的规则校验和表单数据")},basicMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},thingMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},editEvent(e,t,i){return M(this,null,(function*(){this.editIndex=t,this.atbas.childrenDrawer=!0,this.eventForm=e,this.eventType="edit",this.formType=i}))},getDefaultTopic(){return M(this,null,(function*(){const e=yield Object(h["getDlinkJson"])("Topic"),{UnifyUnitSpecsDTO:t=[]}=yield Object(h["getDlinkJson"])("Unit");for(var i in this.dlinkUnit=t,this.dlinkUnit.unshift({Symbol:"/",Name:"无"}),this.dlinkTopic=e,this.dlinkTopic)yield this.mergeTable(i,this.dlinkTopic[i])}))},topicChange(e){return M(this,null,(function*(){"user"==e&&(yield this.getTopic())}))},mergeTable(e,t){return M(this,null,(function*(){let i=0;for(let s in t[0])this.mergeObj[e][s]=[],t.forEach((a,o)=>{0===o?this.mergeObj[e][s].push(1):a[s]===t[o-1][s]?(this.mergeObj[e][s][i]+=1,this.mergeObj[e][s].push(0)):(i=o,this.mergeObj[e][s].push(1))})}))},clearfix(e){this.$refs[e].clearValidate(),"services"==e?this.$refs.services.resetFields():this.$refs.events.resetFields(),this.modules.events.data.types="info",this.modules.services.data.transfer="sync"},editModus(e){this.modules[""+e.type].data=e,this.modules.type=e.type,this.modules.visible=!0,this.modules.disabled=!0,dgiotlogger.info("editModus",e,this.modules[""+e.type])},deleteModus(e,t,i){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>M(this,null,(function*(){t.splice(e,1),yield this.saveExpand(this.productObj.thing)})))},handleClose(){"events"==this.modules.type&&(this.$refs.events.clearValidate()&&this.$refs.events.resetFields()),"services"==this.modules.type&&(this.$refs.services.clearValidate()&&this.$refs.services.resetFields()),this.modules.events.data.types="info",this.modules.services.data.transfer="sync",this.modules.visible=!1,this.modules.disabled&&this.saveExpand(this.productObj.thing)},saveExpand(e){return M(this,null,(function*(){const t=yield Object(p["putProduct"])(this.productObj.objectId,{thing:e});t.updatedAt?this.$message({type:"success",message:"更新成功",showClose:!0,duration:2e3}):this.$message({type:"warning",message:"更新失败"+t.msg,showClose:!0,duration:2e3})}))},queryProductInfo(e){return M(this,null,(function*(){const t=yield Object(p["getProduct"])(e);localStorage.setItem("parse_productid",e);let{thing:i={properties:[],events:[],services:[],tags:[]}}=t;_.merge({properties:[],events:[],services:[],tags:[]},i);let s=_.merge({properties:[],events:[],services:[],tags:[]},i);this.productObj=t;E(E({},this.productdetail.config),t.config);this.$set(this.productdetail,"thing",this.productObj.thing),this.$set(this.productdetail,"config",this.productObj.config),this.modules.data=s}))},submitModules(e,t){return M(this,null,(function*(){t.data.outputParams=[],t.data.output.forEach((e,i)=>{t.data.outputParams.push({identifier:e.identifier,index:i})});const i=N(E({},t.data),{devicetype:t.data.name,required:!1,isshow:!0,isstorage:!0,isaccumulate:!1,dataForm:{order:moment(new Date).format("x")},dataType:{type:e},moduleType:e,updateAt:moment(new Date).format("x")});return window._item=i,yield this.submitForm(i),this.atbas.visible=!1,yield this.queryProductInfo(this.$route.query.id),!1}))},feateditorParser1(e,t,i){let s=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:i,productInfo:s})}},Object(u["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{tableRowClassName({row:e,rowIndex:t}){return 1===t?"warning-row":3===t?"success-row":""},selectStruct(e){},toggleList(){this.showList=!this.showList},getFormOrginalData(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,isstorage:!0,isaccumulate:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%{s}",control:"%{d}",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%{s}"}},changeValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},changeStructValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},getRowClass(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleChildClick(e){return M(this,null,(function*(){yield this.queryProductInfo(this.$route.query.id);const{properties:t=[],events:i=[],services:s=[],tags:a=[]}=this.productObj.thing;switch(e.name){case"properties":this.modules.data.properties=t||[];break;case"events":this.modules.data.events=i||[];break;case"services":this.modules.data.services=s||[];break;case"tags":this.modules.data.tags=a||[];break;default:break}dgiotlogger.info(this.modules.data)}))},handleClick(e){switch(e.name){case"view":this.viewForm={class:"Product",key:this.$route.query.id||"",title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:[]};break;case"notification":this.viewForm={showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",notification:!0,disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]};break;case"fiveth":this.getProductChannel();break;case"second":this.getTopic();break;case"seven":this.getResourceChannel();break;case"sixeth":this.orginRule();break;case"eighth":this.isreload++;break;default:window.clearInterval(this.subtimer),this.subtimer=null;break}},getAllunit(){return M(this,null,(function*(){this.allunit=[];const{UnifyUnitSpecsDTO:e=[]}=yield Object(h["getDlinkJson"])("Unit");this.allunit=e}))},getTopic(){return M(this,null,(function*(){this.topicData=[],this.topicDefault={};const{topics:e={}}=yield Object(p["getProduct"])(this.productId);this.topicDefault=e;for(let t in e){let i={};for(let e in this.dlinkTopic.basic)this.dlinkTopic.basic[e].info="basic",this.dlinkTopic.basic[e].id===t&&(i=this.dlinkTopic.basic[e]);for(let e in this.dlinkTopic.thing)this.dlinkTopic.thing[e].info="thing",this.dlinkTopic.thing[e].id===t&&(i=this.dlinkTopic.thing[e]);i.name=t,i.value=e[t],this.topicData.push(i)}}))},exportProduct(e){return M(this,null,(function*(){try{const t={name:e},i=this.$baseColorfullLoading(),s=yield Object(b["downBinary"])("iotapi/product",t);F["dgiotlog"].log(s),this.$baseMessage(this.$translateTitle("alert.Data request successfully"),"success","dgiot-hey-message-success"),i.close(),this.$downBinary(s)}catch(t){F["dgiotlog"].log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},seeDecoder(e){return M(this,null,(function*(){try{this.ace_editor=V.decode(e.code)}catch(t){F["dgiotlog"].log(t)}}))},setTemplate(e){return M(this,null,(function*(){const t=this.$baseColorfullLoading(),{category:i="IotHub",config:s={konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}},decoder:a={code:""},desc:o="",icon:r="",name:n="",netType:d="Modbus",nodeType:l=0,thing:c={properties:[]}}=e;try{const e={"*":{read:!0,write:!0}},h={ACL:e,category:i,config:s,decoder:a,desc:o,icon:r,name:n,netType:d,nodeType:l,thing:c},u=yield Object(v["postProductTemplet"])(h);F["dgiotlog"].log(u),u?this.$baseMessage(this.$translateTitle("user.Save the template successfully"),"success","dgiot-hey-message-success"):this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error"),t.close()}catch(h){F["dgiotlog"].log(h),t.close(),this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error")}}))},updatesubdialog(){return M(this,null,(function*(){this.protoldialog=!0;const e="1",t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.protolchannel=e.results,this.$refs.multipleTable.toggleAllSelection()}).catch(e=>{F["dgiotlog"].log(e),this.$baseMessage("请求出错",e.error,3e3)})}))},handleSelectionChange(e){this.multipleSelection=e},updateAllChannel(){if(0==this.multipleSelection.length)this.protoldialog=!1;else{var e=[];this.multipleSelection.map(t=>{e.push(new Promise((e,i)=>Object($["subupadte"])(t.objectId,"update").then(t=>{t&&e(t)}).catch(e=>{i(e)})))}),Promise.all(e).then(e=>{this.$message({showClose:!0,duration:2e3,message:"热加载成功",type:"success"}),e.length==this.multipleSelection.length&&(this.protoldialog=!1)}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:e,type:"error"})})}},showAllChannel(e=""){F["dgiotlog"].log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;const t={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(""!=e?this.allChannellength:this.channellength,""!=e?this.allChannelstart:this.channelstart,i,t).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},getProductChannel(){const e={$in:["1","3"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.channeltotal=e.count,this.channelData=e.results,0==e.results.length}).catch(e=>{F["dgiotlog"].log(e)})},resourceShowAllChannel(){this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;const e={$in:["2"]},t={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},getResourceChannel(){const e={$in:["2"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.resourcetotal=e.count,this.resourcechannelData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},addProductChannel(e){return M(this,null,(function*(){const t={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}},i=yield Object(g["saveChanne"])(e,t);i&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),1==this.channeltype?(this.showAllChannel(),this.getProductChannel()):(this.resourceShowAllChannel(),this.getResourceChannel()))}))},deleteRelation(e){const t={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(g["saveChanne"])(e.objectId,t).then(e=>{e&&this.$message({showClose:!0,duration:2e3,type:"success",message:"移除成功"}),this.getProductChannel(),this.getResourceChannel()})},channelSizeChange(e){this.channellength=e,this.getProductChannel()},channelCurrentChange(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize(e){this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,z=JSON.parse(JSON.stringify(e.config)),Object(I["setTimeout"])(()=>{r=ace.edit("editormodel"),r.session.setMode("ace/mode/json"),r.setTheme("ace/theme/twilight"),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r.setReadOnly(!0),r.setValue(JSON.stringify(this.productdetail.thing,null,4)),n=ace.edit("editorcreate"),n.session.setMode("ace/mode/mysql"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?n.setValue(e.config.datamodel):n.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')})},questionModel(){Object(I["setTimeout"])(()=>{d=ace.edit("editorinsert"),d.session.setMode("ace/mode/mysql"),d.setTheme("ace/theme/gob"),d.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),d.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')})},addData(){return M(this,null,(function*(){z.datamodel=n.getValue();const e={config:z};yield Object(g["putChannel"])(this.rproductdetailesourcechannelid,e),this.$message("添加成功")}))},closeWuDialog(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1(){this.structform.specs.push({value:"",name:""})},submitForm(e){F["dgiotlog"].log("obj",e);let t={item:e,productid:this.productId};"新增"==this.wmxSituation?Object(p["postThing"])(t).then(e=>{F["dgiotlog"].log("新增",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"新增成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}):"编辑"==this.wmxSituation&&Object(p["putThing"])(t).then(e=>{F["dgiotlog"].log("编辑",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}),this.wmxdialogVisible=!1,this.queryProductInfo(this.$route.query.id)},createThing(e){switch(this.modules.disabled=!1,this.moduletype=e,this.wmxSituation="新增",this.setSizeForm(this.getFormOrginalData()),e){case"properties":this.wmxdialogVisible=!0;break;case"services":this.atbas.visible=!0,this.modules.type="services";break;case"events":this.atbas.visible=!0,this.modules.type="events";break;case"tags":this.wmxdialogVisible=!0;break}this.$nextTick(()=>{this.$refs[e]&&this.$refs[e].clearValidate(),this.$refs[e]&&this.$refs[e].resetFields()})},wmxDataFill(e,t,i){return M(this,null,(function*(){if(this.$nextTick(()=>{this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol(),this.upKey=moment.now()}),this.moduletype=i,this.modules.type=i,this.wmxSituation="编辑",this.thingType=i,this.eventType="edit",this.modules[i]&&(this.modules[i].data=e),"events"===i||"services"===i)return this.atbas.visible=!0,dgiotlogger.log(this.modules.type,this.modules[i].data),!1;this.modifyIndex=t,this.wmxdialogVisible=!0;var s={},a=[];if(e.dataType.das.forEach(e=>{a.push({addr:e})}),-1!=["float","double","int","long"].indexOf(e.dataType.type))s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:a,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0},e.dataForm&&(s.collection=e.dataForm.collection,s.control=e.dataForm.control,s.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var o=[];for(const t in e.dataType.specs)o.push({attribute:t,attributevalue:e.dataType.specs[t]});s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:o,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isstorage:e.isstorage,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0});F["dgiotlog"].log("editrowData",e),s.protocol=e.dataForm.protocol,s.profile=e.profile,this.setSizeForm(s),this.upKey=moment.now(),this.$nextTick(()=>M(this,null,(function*(){yield this.$refs["sizeForm"].queryResource(),yield this.$refs["sizeForm"].queryProtocol(),this.$refs["sizeForm"].resource.value=e.dataForm.protocol,this.$refs["sizeForm"].resource.disabled=!!e.dataForm.protocol.length,this.$refs["sizeForm"].resource.arrlist=e.dataSource;yield Object(D["getProtocol"])();this.$nextTick(()=>{this.$refs["sizeForm"].resource.data.forEach((t,i)=>{if(this.$refs["sizeForm"].resource.value===t.cType){for(var s in console.info(t,"物模型回显事件"),t.arr.forEach(t=>{t.allowCreate&&this.$refs["sizeForm"].dynamicTable(t,"回显",e.dataSource[t.showname])}),console.info(e.dataSource,"rowData.dataSource"),e.dataSource)for(var a in t.obj)s===a&&(t.obj[s]=e.dataSource[a]);console.info(t.obj,"set resource.obj"),this.$refs["sizeForm"].resource.addchannel=t.obj}this.$refs["sizeForm"].resource.changeData=e.dataSource,t.cType,e.dataForm.protocol})})})))}))},submitStruct(e){this.$refs[e].validate(t=>{if(t){var i={};if("float"==this.structform.type||"double"==this.structform.type||"int"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{max:this.structform.endnumber,min:this.structform.startnumber,step:this.structform.step,unit:""==this.structform.unit?"":this.structform.unit}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("bool"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{0:this.structform.false,1:this.structform.true}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!1,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("enum"==this.structform.type){var s={};this.structform.struct.map(e=>{var t=e["attribute"];s[t]=e["attributevalue"]}),i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),struct:this.structform.struct,specs:s},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}}else"text"==this.structform.type?i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),size:this.structform.string},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}:"date"==this.structform.type&&(i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase()},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier});-1==this.isupdatedstruct?this.sizeForm.struct.push(i):(this.sizeForm.struct.splice(this.isupdatedstruct,1,i),this.isupdatedstruct=-1),this.$refs[e].resetFields(),this.structdialog=!1}})},addStruct(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct(e,t){if(F["dgiotlog"].log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((t,s)=>{i.attribute=t,i.attributevalue=e.dataType.specs[t],this.structform.specs.push(i)})}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct(e){this.sizeForm.struct.splice(e,1)},preserve(e){return M(this,null,(function*(){const t="json"===e?"物模型修改成功":"物模型状态更新成功",i="json"===e?{thing:JSON.parse(a.getValue())}:{thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,i),Object(I["setTimeout"])(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:t}),"json"===e&&(this.schemadialogVisible=!1,this.handleChildClick(this.tabsChild),this.getProDetail())},1e3)}))},Industry(){return M(this,null,(function*(){this.option=[];const{results:e}=yield this.$getIndustry("category",100);e.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.option.push(t)}),this.getProDetail()}))},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData(e){0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;const t={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(t.where.type=this.category[this.category.length-1]),Object(y["getDictCount"])(t).then(e=>{this.producttotal=e.count,this.PropData=e.results}).catch(e=>{F["dgiotlog"].log(e)})},productSizeChange(e){this.productlength=e,this.getPropData()},productCurrentChange(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest(){this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(I["setTimeout"])(()=>{this.editorList.push(ace.edit(this.wmxData[0].identifier)),this.editorList[0].session.setMode("ace/mode/erlang"),this.editorList[0].setTheme("ace/theme/monokai"),this.editorList[0].setHighlightActiveLine(!0),this.editorList[0].setFontSize(20),this.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.ed3isShow=!0,this.editorList[0].setValue(void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection)},1)},handleRightTopTabClick(e,t){this.activeIndex=e.label},menuTabClick(e,t){this.activeIndex=e.identifier;const i=this.editableTabs;let s=!1,a=0;i.forEach((t,i)=>{t.name===e.identifier&&(s=!0,a=i)}),0==s?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(I["setTimeout"])(()=>{this.editorList.push(ace.edit(e.identifier)),this.editorList[this.editorList.length-1].session.setMode("ace/mode/erlang"),this.editorList[this.editorList.length-1].setTheme("ace/theme/monokai"),this.editorList[this.editorList.length-1].setHighlightActiveLine(!0),this.editorList[this.editorList.length-1].setFontSize(20),this.editorList[this.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.editorList[this.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)},1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[a].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab(e){const t=this.editableTabs;let i=this.editableTabsValue;i===e&&t.forEach((s,a)=>{if(s.name===e){const e=t[a+1]||t[a-1];e&&(i=e.name)}}),this.editableTabsValue=i,this.activeIndex=i,this.editableTabs=t.filter(t=>t.name!==e)},onSaveTap(e){return M(this,null,(function*(){const t=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[t].dataForm.collection=this.editorList[e].getValue();const i={thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}))},handleCloseCollecttion(e){this.$confirm("确认关闭？").then(t=>{e()}).catch(e=>{})},onReductionTap(e){const t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema(){this.schemadialogVisible=!0,Object(I["setTimeout"])(()=>{a=ace.edit("editor1"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.setValue(JSON.stringify(this.productdetail.thing,null,4))},1)},query_notification(){return M(this,null,(function*(){let e={count:"objectId",where:{key:{$regex:this.$route.query.id},type:{$regex:"notification"}}};this.$route.query.id&&(e.where.key={$regex:this.$route.query.id});const{results:t,count:i=0}=yield Object(j["queryView"])(e);this.amisShow=i>0,this.amisproductInfo=t}))},getProDetail(){this.query_notification(),s=ace.edit("editor"),s.session.setMode("ace/mode/erlang"),s.setTheme("ace/theme/monokai"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.FromMachine=[{name:"ALL"}],this.$get_object("Product",this.productId).then(e=>{var t,i,a,o,r;if(console.log("response",e),e){for(var n in this.productInfo=_.merge(e,{decoder:{code:""},thing:{properties:[]},config:{address:(null==(t=e.config)?void 0:t.address)||"余杭区良渚平高创业城c1座",location:{longitude:(null==(a=null==(i=e.config)?void 0:i.location)?void 0:a.longitude)||"120.161324",latitude:(null==(r=null==(o=e.config)?void 0:o.location)?void 0:r.latitude)||"30.262441"}}}),this.productName=e.name,e)this.productdetail[n]=e[n];this.option.map(e=>{this.productdetail.category==e.value&&(this.productdetail.category=e.label)}),this.productdetail.createdAt=this.utc2beijing(e.createdAt),this.productdetail.id=e.id,this.dynamicReg=e.dynamicReg,this.productdetail.isshow=0,this.productdetail.category&&this.$get_object("Category",this.productdetail.category.objectId).then(e=>{F["dgiotlog"].log("catcat",e),this.$set(this.productdetail,"categoryname",e.name)}),this.form.Productname=e.name,this.ProductSecret=e.productSecret,this.form.Productkey=this.productId,this.productimg=e.icon,e.decoder?(R=e.decoder.code,this.formInline.name=e.decoder.name,this.formInline.version=e.decoder.version,this.formInline.desc=e.decoder.desc):R="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=this.productdetail.thing&&"{}"!=JSON.stringify(this.productdetail.thing)||(this.productdetail.thing={properties:[]}),this.wmxData=[],this.wmxDataBk=[],this.wmxData=this.productdetail.thing.properties.filter((e,t)=>(e.index=t,e.name&&e.dataType)),this.wmxDataBk=this.productdetail.thing.properties,this.wmxDataBk.forEach(e=>{if(e.devicetype){let t={name:e.devicetype};this.FromMachine.push(t)}}),this.FromMachine=_.uniqBy(this.FromMachine,"name"),s.setValue(V.decode(R)),s.gotoLine(s.session.getLength())}}).catch(e=>{this.$baseMessage("请求出错",e.error,3e3)})},queryDeviceCount(e){return M(this,null,(function*(){this.form.ProductAll=yield Object(m["getDeviceCountByProduct"])(e)}))},handelUpdate(e,t){return M(this,null,(function*(){var t;t=1!=e,this.dynamicReg=t;const i={dynamicReg:!t};yield Object(p["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"修改成功"}),this.dynamicReg=!t}))},wmxhandleClose(e){return M(this,null,(function*(){this.wmxSituation="新增",e?(this.wmxdialogVisible=!1,yield this.$refs["sizeForm"].$refs["sizeForm"].resetFields(),yield this.setSizeForm(this.getFormOrginalData()),this.$refs["sizeForm"].resource.disabled=!1,yield this.handleChildClick(this.tabsChild),this.$refs["sizeForm"]&&(yield this.$refs["sizeForm"].queryResource()),this.upKey=moment.now()):(this.wmxdialogVisible=!1,this.upKey=moment.now())}))},protol(){var e="";Object($["Compile"])(V.encode(s.getValue())).then(t=>{t&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"编译成功"}),e="编译成功"+t.mod+"\r\n",this.warningeditror=t.warnings,this.warningeditror.map(t=>{e+=t+"\r\n"}),K+=e,o.setValue(K))}).catch(t=>{this.warningeditror=t.error,this.warningeditror.map(t=>{e+=t+"\r\n"}),K+=e,o.setValue(K)})},decoderSizeChange(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata(e){this.$del_object("Dict",e).then(e=>{e&&(this.$message("成功删除"),this.chaxun())}).catch(e=>{F["dgiotlog"].log(e)})},subAce(e,t){this.$refs[e].validate(e=>M(this,null,(function*(){if(e){var i={name:this.formInline.name,version:this.formInline.version,code:V.encode(s.getValue()),desc:this.formInline.desc};const e={decoder:i};yield Object(p["putProduct"])(this.productId,e),0==this.issub&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"保存成功"}),1==t&&(K+="保存成功",o.setValue(K))),this.issub=!0}else this.$message({type:"warning",message:"输入格式有误"})})))},subAce1(e){this.$refs[e].validate(e=>{if(e){const e={where:{"data.name":this.formInline.name,"data.version":this.formInline.version}};this.$query_object("Dict",e).then(e=>{e.results&&e.results.length>=1?this.$message("此协议版本已存在"):this.$get_object("Product",this.productId).then(e=>{if(e){var t={name:this.formInline.name,version:this.formInline.version,code:V.encode(s.getValue()),desc:this.formInline.desc};const i={key:this.formInline.name+":"+this.formInline.version,type:"decoder",data:t,ACL:e.ACL};this.$create_object("Dict",i).then(e=>{e.error?this.$message({type:"error",message:e.error}):this.$message({showClose:!0,duration:2e3,type:"success",message:"保存到公共协议库成功"})}).catch(e=>{F["dgiotlog"].log(e)})}})}).catch(e=>{F["dgiotlog"].log(e)})}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"输入格式有误"})})},updatesub(e){Object($["subupadte"])(e.objectId,"update").then(e=>{e&&this.$message("重载成功")}).catch(e=>{this.$message(e.error)})},chaxun(){const e={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",e).then(e=>{e&&(this.decodertotal=e.count,this.gridData=e.results)}).catch(e=>{F["dgiotlog"].log(e)})},editordata(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,s.setValue(V.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory(){this.originwmx=!0,this.getPropData()},addMachine(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine(e,t,i){"ALL"==e.name?(this.wmxDataBk.forEach(e=>{e.dataType||(e.dataType={das:[],specs:{},type:"float",identification:"function"})}),this.wmxData=this.wmxDataBk):(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter(t=>t.devicetype==e.name&&!t.dataType.identification),this.wmxstart=1),this.upKey=moment.now()},handleChange(e,t,i){},TypeInstall(e,t){t.map((t,i)=>{if("enum"==t.DataType||"bool"==t.DataType){var s={dataType:{specs:{}}};s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{for(var t in e){var i=e["value"],a=e["name"];s.dataType.specs[i]=a}}),e.push(s)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){s={dataType:{specs:{}}};for(var a in s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))s.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],s.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],s.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],s.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(s)}else if("struct"==t.DataType){var o={dataType:{specs:[]}};o.name=t.Name,o.dataType.type=t.DataType,o.required=!t.Required,o.identifier=t.Identifier,o.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map(e=>{for(var i in e){var s=e["value"],a=e["name"];t.dataType.specs[s]=a}}),o.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var i in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];o.dataType.specs.push(t)}}),e.push(o)}});var i={};e=e.reduce((e,t)=>(!i[t.identifier]&&(i[t.identifier]=e.push(t)),e),[])},addProCategory(e){const t={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",t).then(e=>M(this,null,(function*(){const t=e.results;if(t&&t[0].data.Ability){this.TypeInstall(this.productdetail.thing.properties,t[0].data.Ability);const e={thing:this.productdetail.thing};yield Object(p["putProduct"])(this.productId,e),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}else F["dgiotlog"].log("此选项没有属性功能")})))},deletewmx(e){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),this.$translateTitle("Maintenance.Delete reminder"),()=>M(this,null,(function*(){const t={productid:this.productId,item:e},i=yield Object(p["deleteThing"])(t);200==i.code?(this.$baseMessage(this.$translateTitle("user.successfully deleted"),"success","dgiot-hey-message-success"),yield this.getProDetail()):this.$baseMessage(this.$translateTitle("user.error deleted")+(null==i?void 0:i.msg)?i.msg:i,"error","dgiot-hey-message-error")})))},wmxSizeChange(e){this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange(e){this.wmxstart=e},eventsChange(e){this.eventsStart=1,this.eventsPageSize=e},eventsCurrentChange(e){this.eventsStart=e},serverSizeChange(e){this.servicesStart=1,this.servicesPageSize=e},serverCurrentChange(e){this.servicesStart=e},tagsSizeChange(e){this.tagsStart=1,this.tagsPageSize=e},tagsCurrentChange(e){this.eventsStart=e},nowtime(){var e=Date.parse(new Date),t=new Date(e),i=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",a=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+" "},subProTopic(e){return M(this,null,(function*(){this.channelid=e.objectId,this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.mqtt.subtopic="$dg/user/channel/"+e.objectId+"/#",yield this.$nopostsubscribe(this.mqtt.subtopic),Object($["subupadte"])(e.objectId,"start_logger"),this.msgList=[],this.submessage="Starting the log\n",this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{const{payloadString:t}=e;this.mqttMsg(t)})}))},mqttMsg(e){this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},handleCloseSubdialog(){Object($["subupadte"])(this.channelid,"stop_logger"),this.msgList=[],this.submessage="",this.subdialog=!1},stopsub(e){},subTopic(e,t){this.$refs[e].validate(i=>M(this,null,(function*(){if(!i)return F["dgiotlog"].log("error submit!!"),!1;{let i="";-1!=t?(this.topicDefault[this.topicform.id]=this.topicform.value,i="修改topic成功"):(this.topicDefault[this.topicform.topic]=this.topicform.value,i="添加自定义topic成功"),yield Object(p["putProduct"])(this.productId,{topics:this.topicDefault}),this.$message({showClose:!0,duration:2e3,type:"success",message:i}),this.topicform={isupdated:-1,value:"",info:"basic"},this.handleClick({name:"second"}),this.topicdialogVisible=!1,this.$refs[e].resetFields()}})))},topicSizeChange(e){this.topicstart=1,this.topiclength=e},topicCurrentChange(e){this.topicstart=e},updatetopic(e,t){this.topicform=e,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic(e,t,i){this.$baseConfirm("你确定要删除当前项topic吗",null,()=>M(this,null,(function*(){const t={};e.splice(i,1),e.forEach(e=>{t[e.id]=e.value}),yield Object(p["putProduct"])(this.productId,{topics:t}),this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"})})))},orginRule(){Object(f["getRule"])().then(e=>{e&&(this.engineData=e)}).catch(e=>{this.$message(e.error)})},handleSizeChange(e){},handleCurrentChange(e){},addEngine(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions(e){var t=[];return e.map(e=>{t.push(e.name)}),t.join(",")},getRowindex(e,t,i){if(0==e.columnIndex)return"firstcolumn"},detailRules(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})};t["a"]=J}}]);