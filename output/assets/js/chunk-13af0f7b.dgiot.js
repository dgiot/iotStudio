/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年07月01日19时10分34秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-13af0f7b"],{"025f":function(e,t,a){},"05c0":function(e,t,a){},"0736":function(e,t,a){"use strict";a("b0c6")},"07a3":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"08c8":function(e,t,a){"use strict";a("2056")},"0b52":function(e,t,a){"use strict";a("664e")},"1d48":function(e,t,a){},2056:function(e,t,a){},40958:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gateway"},[t("el-card",{staticClass:"wayheader",attrs:{shadow:"always"}},[t("div",{staticClass:"wayheaderone"},[t("span",{staticClass:"oneheader"},[e._v("网络设备")]),t("span",{staticClass:"twoheader"},[e._v("网络层级:"+e._s(e.cengji))]),t("span",{staticClass:"threeheader"})])])],1)},l=[],o={data(){return{cengji:2}},mounted(){},methods:{}},r=o,s=(a("ba6d"),a("2877")),n=Object(s["a"])(r,i,l,!1,null,"421e4474",null);t["default"]=n.exports},"51cc":function(e,t,a){},"576e":function(e,t,a){"use strict";a("7ddd")},5861:function(e,t,a){"use strict";a("025f")},5887:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"devproduct"},[t("div",{staticClass:"prosecond"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[t("el-form-item",[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),t("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addgroup.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")])],1)],1),t("div",{staticClass:"protable"},[t("el-table",{key:e.total,staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.groupData,"header-cell-style":{"text-align":"center"}}},[t("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),t("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.name))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.devType))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[1==a.nodeType?t("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==a.nodeType?t("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e(),2==a.nodeType?t("span",[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")]):e._e()]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.category?a.category.name:""))])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.addingtime"),prop:"row.createdAt","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"420"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-button",{attrs:{size:"mini",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goKonva(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.GoTodevices(a)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),t("el-popover",{ref:"popover-"+i,staticStyle:{"margin-left":"10px"},attrs:{placement:"top"}},[t("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(a.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),t("div",{staticStyle:{margin:"0","text-align":"right"}},[t("el-button",{attrs:{size:"mini"},on:{click:function(e){a._self.$refs["popover-"+i].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(a)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),t("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[t("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1),t("div",{staticClass:"prodialog"},[t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"50%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("div",{staticClass:"content"},[t("div",{staticClass:"contentone"},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[t("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}]}},[t("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,a){return t("el-option",{key:a,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),t("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[t("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[t("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),t("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),t("el-radio",{attrs:{label:2}},[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")])],1)],1)],1)],1),t("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[t("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,a){return t("el-option",{key:a,attrs:{label:a+1+":"+e.label,title:"当前第"+(a+1)+"项",value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.productmodel")}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):t("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),t("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[t("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?t("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),t("div",{staticClass:"add-group"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.newvirtualgroup"),visible:e.groupform,width:"30%"},on:{"update:visible":function(t){e.groupform=t}}},[t("el-form",{ref:"addGroup",staticClass:"demo-ruleForm",attrs:{"label-width":"80px",model:e.addGroup}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:e.$translateTitle("developer.groupname"),prop:"name",rules:[{required:!0,message:e.$translateTitle("developer.cannotbeempty")}]}})],1),t("el-col",{attrs:{span:18}},[t("el-input",{attrs:{autocomplete:"off",type:"text"},model:{value:e.addGroup.name,callback:function(t){e.$set(e.addGroup,"name",t)},expression:"addGroup.name"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addDeviceGroup()}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm()}}},[e._v(" "+e._s(e.$translateTitle("zetadevices.reset"))+" ")])],1)],1)],1),t("div",{staticClass:"import-dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[t("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[t("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),t("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)])},l=[],o=a("7212"),r=a("5da9"),s=a("1285"),n=a("7497"),c=a("e0e9"),d=a("d0fdb"),u=a("be65"),p=a.n(u),m=a("5638"),h=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())}),v={data(){return{category:[],hashkey:"",addGroup:{name:""},groupform:!1,length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:p.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",groupData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted(){this.Industry(),this.searchProduct(0)},beforeDestroy(){this.projectName=""},methods:{addDeviceGroup(){this.$refs["addGroup"].validate(e=>{if(!e)return!1;Object(m["addGroup"])(this.addGroup.name).then(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组成功",type:"success"}),this.searchProduct(),this.groupform=!1}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组失败"+e.computed,type:"error"}),this.groupform=!1})})},resetForm(){this.$refs["addGroup"].resetFields()},changeNode(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp(e){e&&Object(r["getRole"])(e).then(e=>{e&&(this.fileServer=e.file,this.access_token=e.access_token)})},treeData(e){const t=JSON.parse(JSON.stringify(e));return t.filter(e=>{const a=t.filter(t=>e.id==t.parentid);return a.length>0&&(e.children=a),0==e.parentid})},deleteImgsrc(){event.stopPropagation(),this.imageUrl=""},upload(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,l=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!l)return this.$message({showClose:!0,duration:2e3,message:"请上传图片",type:"error"}),!1;var o=new FileReader;o.readAsDataURL(t);var r=this;o.onloadend=function(){var e=o.result,t=r.dataURItoBlob(e);r.uploadFile(t,a)}}},dataURItoBlob(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),l=new Uint8Array(i),o=0;o<t.length;o++)l[o]=t.charCodeAt(o);return new Blob([i],{type:a})},uploadFile(e,t){var a=new FormData;a.append("file",e,t),a.append("output","json"),a.append("path",this.form.relationApp),a.append("auth_token",this.access_token);this.$http.post(this.fileServer,a).then(e=>{e&&(this.imageUrl=e.body.url,this.loading=!1)}).catch(e=>{this.loading=!1,this.$message(e.bodyText)})},submitUpload(){this.uploadAction="/product",this.$nextTick(()=>{this.uploadData.appid=p.a.get("appids"),this.$refs.fileUpload.submit()})},handleUploadSuccess(e,t,a){this.$message({type:"success",showClose:!0,duration:2e3,message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError(e,t,a){this.$message({showClose:!0,duration:2e3,message:e})},handleChange(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict(e,t){return h(this,null,(function*(){const e={limit:1e3,where:{"data.key":"category"}},{results:t}=yield Object(c["queryDict"])(e)}))},searchProduct(e){return h(this,null,(function*(){0==e&&(this.start=0);const t={order:"-updatedAt",skip:this.start,limit:this.length,include:"category",where:{nodeType:"2"}};this.formInline.productname&&(t.where.name={$regex:this.formInline.productname});const{results:a}=yield Object(o["queryProduct"])(t);dgiotlogger.log("results",a),this.groupData=a,this.total=this.groupData.length;const i=yield Object(r["queryRole"])({limit:100});this.allApps=i.results}))},handleClose(){this.dialogFormVisible=!1},addproduct(){this.dialogFormVisible=!0},addgroup(){this.groupform=!0},getParent(e,t,a){return t.map(i=>{e==i.id?(a.unshift(i.value),this.getParent(i.parentid,t,a)):0==i.parentid&&i.id==e&&a.unshift(i.value)}),this.form.category=a,a},getIndustryParent(e,t){t.map(a=>{a.value==e&&this.getParent(a.id,t,[])})},editorProduct(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.id,this.getIndustryParent(e.attributes.category,this.categoryList),this.form.desc=e.attributes.desc,this.form.name=e.attributes.name,this.form.nodeType=e.attributes.nodeType,this.form.netType=e.attributes.netType,this.form.devType=e.attributes.devType,this.form.productSecret=e.attributes.productSecret,this.changeNode(e.attributes.nodeType,0),e.attributes.icon&&(this.imageUrl=e.attributes.icon),e.attributes.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry(){return h(this,null,(function*(){this.categoryList=[];const e={limit:1e3,where:{"data.key":"category"}},{results:t}=yield Object(c["queryDict"])(e);t.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.categoryList.push(t)}),this.categoryListOptions=this.treeData(this.categoryList)}))},submitForm(e){},resetProductForm(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},goKonva(e){this.$router.push({path:"/Topo?productid",query:{productid:e}})},GoTodevices(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure(e){const t={count:"objectId",skip:0,limit:1,where:{product:e.objectId}};Object(s["queryDevice"])(t).then(t=>{t.count>0?this.$message("请先删除该产品下设备"):Object(o["getProduct"])(e.objectId).then(t=>{Object(o["delProduct"])(e.objectId).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),this.searchProduct())}).catch(e=>{dgiotlog.log("delProduct ",e.error)})}).catch(e=>{dgiotlog.log("getProduct ",e.error)})}).catch(e=>{dgiotlog.log("queryDevice ",e.error)})},productSizeChange(e){this.length=e,this.searchProduct()},productCurrentChange(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict(e,t){return h(this,null,(function*(){const a={data:t,key:e,type:"Product"},i=yield Object(c["postDict"])(a);i?this.$message({showClose:!0,duration:2e3,type:"success",message:"备份成功"}):this.$message({showClose:!0,duration:2e3,type:"error",message:"备份失败"})}))},CloneData(e){return h(this,null,(function*(){const t={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},{objectId:a,code:i}=yield Object(n["getHashClass"])("Product",t);200==i&&this.blackDict(a,t)}))},proudctClone(e){return h(this,null,(function*(){e.attributes.config.cloneState=!0;const t=e,a=Object(o["putProduct"])(e.id,t);a&&this.CloneData(e)}))},proudctEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:a}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i=`${t}/#?drawProudctid=${e.objectId}&proudctid=${e.objectId}`;localStorage.setItem("rowId",e.objectId),window.open(i,"__blank")},proudctView(e){var t=window.location.origin+"/spa";const{NODE_ENV:a}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i=`${t}/#/views/${e.objectId}`;window.open(i,"__blank")},exportpro(){this.allTableDate?Object(d["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",showClose:!0,duration:2e3,message:"数据为空,无法导出"})}}},f=v,b=(a("add98"),a("ed9a"),a("2877")),g=Object(b["a"])(f,i,l,!1,null,"f9a47bc6",null);t["default"]=g.exports},5964:function(e,t,a){},6024:function(e,t,a){},"664e":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"6ac7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"editdevices"},[t("div",[t("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.deviceinformation"),name:"first"}},[t("info",{attrs:{devicedetail:e.deviceInfo}}),t("el-card",[t("dgiot-baidu-map",{ref:"map",attrs:{bmLabel:e.bmLabel,markers:[e.mapLabel.position],label:e.mapLabel,navShow:!0,scaleShow:!0,mapCenter:e.mapLabel.position}})],1)],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.realTime data"),name:"first1"}},[t("running-state",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{loading:e.loading,thirdtbKey:e.thirdtbKey,machinelist:e.machinelist}})],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.historical data"),name:"third"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[t("div",{staticClass:"chartsinfo"},[t("div",{staticClass:"queryHeader",style:{height:"desktop"==e.Device?"50px":"240px"}},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"desktop"==e.Device?"80px":"70px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("developer.startTime")}},[t("el-date-picker",{staticStyle:{width:"83%"},attrs:{"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.startTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.startTime,callback:function(t){e.$set(e.params,"startTime",t)},expression:"params.startTime"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.EndTime")}},[t("el-date-picker",{staticStyle:{width:"83%"},attrs:{clearable:!1,"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.EndTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.endTime,callback:function(t){e.$set(e.params,"endTime",t)},expression:"params.endTime"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.type")}},[t("el-select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.toggleChart},model:{value:e.params.style,callback:function(t){e.$set(e.params,"style",t)},expression:"params.style"}},e._l(e.chartType,(function(a,i){return t("el-option",{key:i,attrs:{disabled:-1!=e.disabledChart.indexOf(a.type),label:a.name,value:a.type}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.interval")}},[t("el-input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:"请输入内容",size:"mini"},model:{value:e.params.number,callback:function(t){e.$set(e.params,"number",t)},expression:"params.number"}}),t("el-select",{staticStyle:{width:"70px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params.interval,callback:function(t){e.$set(e.params,"interval",t)},expression:"params.interval"}},e._l(e.interval,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.type}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.function")}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params._function,callback:function(t){e.$set(e.params,"_function",t)},expression:"params._function"}},e._l(e.functionarr,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1),t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.queryChart}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1)],1)],1)],1),t("div",{key:e.chartKey,staticClass:"chartsmain"},[t("dgiotChart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1),t("div",{staticClass:"chartOther"},[t("el-row",{attrs:{gutter:20}},[e._l(e.chartData.child,(function(a,i){return t("el-col",{directives:[{name:"show",rawName:"v-show",value:"日期"!=a.columns[1],expression:"item.columns[1] != '日期'"}],key:i,attrs:{md:e.md,sm:e.sm,xl:e.xl,xs:e.xs}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(a.columns[1])+" : "+e._s(a.unit))]),t("el-button-group",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[t("el-button",{attrs:{icon:"el-icon-warning-outline"}}),t("el-button",{attrs:{icon:"el-icon-full-screen"},on:{click:function(t){return e.toggleCardRow(i,e.xs,e.sm,e.md,e.xl)}}})],1)],1),t("dgiotChart",{ref:"charts",refInFor:!0,attrs:{"after-config":e.afterConfig,data:e.chartData.child[i],"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,"legend-visible":!1,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style,height:"300px"}})],1)],1)})),t("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.chartData.child,expression:"!chartData.child"}],attrs:{span:24}},[t("dgiot-empty")],1)],2)],1)])]),t("div",{staticClass:"twofirsttable",staticStyle:{"box-sizing":"border-box",padding:"10px","margin-top":"20px",background:"#ffffff"}})]),"0"!=e.$route.query.nodeType?t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.subdevice"),name:"children"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"childrendevices"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.childrendevices,size:"small"}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber")+":"}},[t("el-input",{attrs:{placeholder:e.$translateTitle("equipment.devicenumber")},model:{value:e.childrendevices.devicesname,callback:function(t){e.$set(e.childrendevices,"devicesname",t)},expression:"childrendevices.devicesname"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),t("el-form-item",[t("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")]),t("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.unactiveDevice}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),t("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.activeDevice}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),t("el-form-item",[t("el-button",{attrs:{plain:"",type:"info"},nativeOn:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("equipment.Refresh"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.childDialog=!0}}},[e._v(" "+e._s(e.$translateTitle("equipment.addchilddevice"))+" ")])],1)],1),t("div",{staticClass:"devicetable"},[t("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.devicesTableData,height:e.$baseTableHeight(0)-120},on:{"selection-change":e.DevicesSelectionChange}},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicenumber"),align:"center",width:"170"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.devaddr))])]}}],null,!1,3690553824)}),t("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicename"),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.name))])]}}],null,!1,2611166627)}),t("el-table-column",{attrs:{label:e.$translateTitle("equipment.state"),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{class:a.status},[e._v(" "+e._s(a.status)+" ")])]}}],null,!1,2814795006)}),t("el-table-column",{attrs:{align:"center",label:"子网地址",width:"165"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(" "+e._s(void 0==a.route?"":a.route[e.deviceInfo.devaddr])+" ")])]}}],null,!1,22614245)}),t("el-table-column",{attrs:{label:e.$translateTitle("equipment.product"),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{attrs:{type:"success"}},[e._v(e._s(a.productName))])]}}],null,!1,2863909087)}),t("el-table-column",{attrs:{label:e.$translateTitle("developer.prohibit")+"/"+e.$translateTitle("developer.enable"),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,a.$index)}},model:{value:a.isEnable,callback:function(t){e.$set(a,"isEnable",t)},expression:"row.isEnable"}})]}}],null,!1,1514546268)}),t("el-table-column",{attrs:{label:e.$translateTitle("equipment.lastonlinetime"),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.lastOnlineTime?t("span",[e._v(" "+e._s(e.timestampToTime(a.lastOnlineTime))+" ")]):t("span",[e._v("—")])]}}],null,!1,1578731938)}),t("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center",width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(a,i)}}},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")])]}}],null,!1,2051581016)})],1)],1),t("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[t("el-pagination",{attrs:{"page-size":e.childrenDeviceLength,"page-sizes":[10,20,30,50],total:e.childrenDeviceTotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.childrenDeviceCurrentChange,"size-change":e.childrenDeviceSizeChange}})],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.$translateTitle("equipment.addchilddevice"),visible:e.childDialog,width:"40%"},on:{"update:visible":function(t){e.childDialog=t}}},[t("div",{staticClass:"childdialog"},[t("el-form",{ref:"childrenForm",staticClass:"demo-form-inline",attrs:{"label-position":"left",model:e.childrenForm,"label-width":"120px"}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),rules:[{required:!0,message:"选择产品",trigger:"change"}],prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("equipment.products")},on:{change:e.checkProduct},model:{value:e.childrenForm.product,callback:function(t){e.$set(e.childrenForm,"product",t)},expression:"childrenForm.product"}},e._l(e.allProudct,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.equipment"),rules:[{required:!0,message:"选择设备",trigger:"change"}],prop:"device"}},[t("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],staticStyle:{width:"100%"},attrs:{disabled:!e.ischange,placeholder:e.$translateTitle("product.equipment")},model:{value:e.childrenForm.device,callback:function(t){e.$set(e.childrenForm,"device",t)},expression:"childrenForm.device"}},e._l(e.productDevices,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{rules:[{required:!0,message:"请输入子网地址",trigger:"blur"}],label:"子网地址",prop:"route"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"子网地址"},model:{value:e.childrenForm.route,callback:function(t){e.$set(e.childrenForm,"route",t)},expression:"childrenForm.route"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.childDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitDevice("childrenForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1):e._e(),e.isshowchild?t("el-tab-pane",{attrs:{label:e.$translateTitle("device.instruct"),name:"instruct"}},[t("Instruct",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"devices-id":e.deviceid,"product-id":e.productid}})],1):e._e(),t("el-tab-pane",{directives:[{name:"show",rawName:"v-show",value:"task"==e.activeName,expression:"activeName == 'task'"}],attrs:{label:e.$translateTitle("device.trace"),name:"task"}},[t("scene-log",{directives:[{name:"show",rawName:"v-show",value:"task"==e.activeName,expression:"activeName == 'task'"}],ref:"SceneLog",attrs:{"device-info":e.deviceInfo,name:e.activeName}})],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("device.log"),name:"trace"}},[t("device-log",{directives:[{name:"show",rawName:"v-show",value:"trace"==e.activeName,expression:"activeName == 'trace'"}],attrs:{devaddr:e.devicedevaddr,deviceid:e.deviceid,"is-device-info":!0,productid:e.productId}})],1),t("el-tab-pane",{attrs:{label:"可视化",name:"view"}},[t("el-row",{staticStyle:{margin:"0 !important"},attrs:{gutter:24}},[t("el-col",{attrs:{span:22}},[t("el-alert",{attrs:{title:"可视化控制表单",type:"info",description:"信息可视化是利用人的视觉能力，将信息通过图形图像设计的方式视觉呈现，使枯燥的信息数据变得更为直观，更易于被接受，从而提升信息的传播速度和准确度。","show-icon":""}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.$router.push({path:"/design",query:{type:"amis",_class:"Product",key:e.productId}})}}},[e._v(" 前往配置 ")])],1)],1),t("el-tabs",{attrs:{type:"border-card"},model:{value:e.amisTable,callback:function(t){e.amisTable=t},expression:"amisTable"}},e._l(e.commandInfo.data,(function(e,a){return t("el-tab-pane",{key:a+"_j",attrs:{label:e.title,name:a+"_j"}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1),t("el-tab-pane",{attrs:{label:"视频监控",name:"video"}},["video"===e.activeName?t("dgiot-aliplayer",{ref:"dgiotPlayer",attrs:{height:"76vh",playsource:e.deviceInfo.detail&&e.deviceInfo.detail.videoSrc?e.deviceInfo.detail.videoSrc:"https://media.w3.org/2010/05/sintel/trailer.mp4",type:e.deviceInfo.detail&&e.deviceInfo.detail.videoType?e.deviceInfo.detail.videoType:"mp4",width:"100%"}}):e._e()],1)],1)],1)])},l=[],o=a("68d7"),r=(a("8bde"),a("6c42"),a("2877")),s=Object(r["a"])(o["a"],i,l,!1,null,"6759c7f0",null);t["default"]=s.exports},"6c0f":function(e,t,a){"use strict";a("51cc")},"6c42":function(e,t,a){"use strict";a("07a3")},"775d":function(e,t,a){"use strict";a("8336")},"7ddd":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},8300:function(e,t,a){"use strict";a("e3ac")},8336:function(e,t,a){},"86f8":function(e,t,a){"use strict";a("e160")},"8bde":function(e,t,a){"use strict";a("b888")},"96e1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"group"},[t("el-container",[t("el-container",[t("el-main",[t("div",{staticClass:"main"},[t("el-drawer",{attrs:{direction:"ltr",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[e.showTree?t("div",{staticClass:"tree"},[e._v(" 搜索 : "),t("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),t("el-tree",{ref:"tree",staticClass:"treeitems",attrs:{"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,data:e.treeData,"default-expand-all":"",draggable:"","filter-node-method":e.filterNode,"node-key":"id",props:e.defaultProps},on:{"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("span",{staticClass:"custom-tree-node"},[1==i.roles.seen?t("span",[t("el-input",{staticStyle:{width:"80%"},model:{value:e.editLabel,callback:function(t){e.editLabel=t},expression:"editLabel"}})],1):t("span",{staticStyle:{color:"#409eff"}},[e._v(e._s(a.label))]),0==i.roles.seen?t("span",{staticStyle:{"margin-left":"5px"}},[t("i",{staticClass:"el-icon-plus",staticStyle:{color:"#67c23a"},attrs:{title:"新增"},on:{click:function(t){return t.stopPropagation(),e.append(i)}}}),t("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"},on:{click:function(t){return t.stopPropagation(),e.deletes(i)}}}),t("i",{staticClass:"el-icon-edit",staticStyle:{color:"#909399"},attrs:{title:"编辑"},on:{click:function(t){return t.stopPropagation(),e.rename(i)}}})]):t("span",[t("i",{staticClass:"el-icon-check",attrs:{slot:"suffix",title:"保存"},on:{click:function(t){return t.stopPropagation(),e.savename(i)}},slot:"suffix"})])])}}],null,!1,3055715610)})],1):e._e()]),t("el-tabs",{staticStyle:{display:"none"},on:{"tab-click":e.goTo},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsNav,(function(e){return t("el-tab-pane",{key:e.url,attrs:{label:e.label,name:e.url}})})),1),t("router-view")],1),t("div",{staticClass:"setting"},[t("i",{class:[e.drawer?"el-icon-s-fold":"el-icon-s-unfold"],on:{click:function(t){return e.toggleTree()}}})])])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,center:"",title:"添加角色",visible:e.centerDialogRole,width:"35%"},on:{close:e.closeDialogRole}},[t("addroles",{ref:"addRoleRef"})],1)],1)},l=[],o=a("5da9"),r=a("5638"),s=a("d10c"),n={name:"Group",components:{addroles:s["default"]},data(){return{drawer:!1,tabsNav:[{label:"统计预览",url:"platform"},{label:"虚拟分组",url:"devproduct"},{label:"通道列表",url:"resourcechannel"},{label:"设备列表",url:"devicelist"},{label:"产品列表",url:"productlist"},{label:"规则列表",url:"engine"}],numberValidateForm:{name:""},centerDialogRole:!1,editLabel:"",filterText:"",addForm:{seen:!1,date:"",name:"",address:""},treeData:[],defaultProps:{children:"children",label:"alias",isLeaf:"leaf"},showTree:!0}},computed:{activeName:{get:function(){return""!=this.$route.path.replace("/dashboard/","")?this.$route.path.replace("/dashboard/",""):"platform"},set:function(){}}},watch:{filterText(e){this.$refs.tree.filter(e)}},mounted(){this.$dgiotBus.$on("dialogHide",()=>{this.centerDialogRole=!1,this.getTree()}),this.getTree()},methods:{goTo(e){this.$router.push({path:"/dashboard/"+e.name})},toggleTree(){this.drawer=!this.drawer},getTree(){function e(t){var a=Array.isArray(t)?[]:{};if(t&&"object"===typeof t)for(var i in t)t.roles&&(t.roles.seen=!1),t.hasOwnProperty(i)&&(t[i]&&"object"===typeof t[i]?a[i]=e(t[i]):a[i]=t[i]);return a}Object(o["roletree"])().then(t=>{this.treeData=e(t.results),dgiotlog.log(this.treeData)}).catch(e=>{dgiotlog.log(e),this.treeData=[]})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return!1;Object(r["addGroup"])(this.numberValidateForm.name).then(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组成功",type:"success"})}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组失败"+e.computed,type:"error"})})})},resetForm(e){this.$refs[e].resetFields()},append(e){this.centerDialogRole=!0,this.$nextTick(()=>{this.$refs["addRoleRef"].getData(e)})},closeDialogRole(){this.centerDialogRole=!1,this.getTree()},deletes(e){this.$confirm("此操作将永久删除该节点,包括其子节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(o["delRole"])(e.objectId).then(e=>{this.getTree(),this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功!"})}).catch(e=>{this.$message({showClose:!0,duration:2e3,type:"error",message:"删除失败"+e.error})})}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消删除"})})},rename(e){this.editLabel=e.alias,e.roles.seen=!0},savename(e){e.alias!=this.editLabel&&Object(o["putRole"])(e.objectId,this.editLabel).then(t=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),e.alias=this.editLabel}).catch(e=>{dgiotlog.log(e)}),e.roles.seen=!1},allowDrop(e,t,a){return e.level===t.level&&(e.data.parentId===t.data.parentId?"prev"===a||"next"===a:void 0)},allowDrag(e){return 1!==e.level},handleDrop(e,t,a,i){const l=[],o=t.parent.childNodes;for(var r in o)l.push({id:o[r].data.id})},filterNode(e,t){return!e||-1!==t.label.indexOf(e)}}},c=n,d=(a("5861"),a("2877")),u=Object(d["a"])(c,i,l,!1,null,"7e7ca3c7",null);t["default"]=u.exports},"974c":function(e,t,a){"use strict";a("6024")},"9b1b":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"equipment equipment-container"},[t("div",{staticClass:"dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[t("div",{staticClass:"deviceTree"},[t("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),t("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-tree-node"},[t("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(i)}}},[e._v(" "+e._s(a.label)+" ")])])}}])})],1)]),t("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.mapDialog,width:"80vh"},on:{"update:visible":function(t){e.mapDialog=t}}},[t("baidu-map",{staticStyle:{height:"80vh"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[t("bm-marker",{attrs:{animation:"BMAP_ANIMATION_BOUNCE",dragging:!0,position:e.center}},[t("bm-label",{attrs:{content:e.deviceId,"label-style":{color:"red",fontSize:"12px"},offset:{width:-25,height:30}}})],1),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}})],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.devicedetail.name,top:"5vh",visible:e.InfoDialog,width:"80%"},on:{"update:visible":function(t){e.InfoDialog=t}}},[t("el-tabs",{attrs:{size:"mini",type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.activeparseTbas,callback:function(t){e.activeparseTbas=t},expression:"activeparseTbas"}},e._l(e.parseTbas,(function(a){return t("el-tab-pane",{key:a.name,attrs:{label:a.name,name:a.name}},[t("ele-form",e._b({attrs:{"request-fn":e.handleSubmit},on:{"request-success":function(t){return e.handleSuccess(a)}},model:{value:a.config,callback:function(t){e.$set(a,"config",t)},expression:"item.config"}},"ele-form",a.config,!1))],1)})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.CloseState,title:e.stateDialog.name,top:"5vh",visible:e.stateDialog,width:"80%"},on:{"update:visible":function(t){e.stateDialog=t}}},[t("deviceState",{attrs:{devicedetail:e.stateDetail},on:{ParserSave:e.ParserSave}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),t("div",{staticClass:"equtabs"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("div",{staticClass:"equdevices"},[t("dgiot-query-form",[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",disabled:!e.productenable},on:{change:e.selectProdChange},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.device status")}},[t("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},on:{change:function(t){return e.getDevices()}},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[t("el-option",{attrs:{value:e.$translateTitle("zetadevices.online")}}),t("el-option",{attrs:{value:e.$translateTitle("zetadevices.offline")}})],1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit")}},[t("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},on:{change:function(t){return e.getDevices()}},model:{value:e.statusdevices,callback:function(t){e.statusdevices=t},expression:"statusdevices"}},[t("el-option",{attrs:{label:e.$translateTitle("developer.enable"),value:"true"}}),t("el-option",{attrs:{label:e.$translateTitle("developer.prohibit"),value:"false"}})],1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.condition")}},[e.selectdevice==e.$translateTitle("equipment.devicename")?t("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterproductname")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[t("el-select",{staticStyle:{width:"140px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[t("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),t("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),t("i",{staticClass:"el-icon-search",staticStyle:{"line-height":"32px",color:"#606266",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){return e.getDevices({start:0})}},slot:"suffix"})],1):t("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[t("el-select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[t("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),t("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),t("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices({start:0})}},slot:"append"})],1)],1),t("el-form-item",[t("el-button",{staticClass:"el-icon-plus",attrs:{size:"small",title:e.$translateTitle("equipment.adddevice"),type:"primary"},on:{click:e.addDeviceForm}}),t("el-button",{staticClass:"el-icon-delete",attrs:{disabled:!e.selectedList.length,size:"small",title:e.$translateTitle("aintenance.batch deletion"),type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}})],1),t("el-form-item",{staticStyle:{display:"none"}},[t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")])],1)],1)],1)],1)],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.list"),name:"first"}},[t("div",{staticClass:"tabstable"},[t("el-table",{directives:[{name:"show",rawName:"v-show",value:e.isALL,expression:"isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticClass:"tab_wrap_1",staticStyle:{"margin-top":"20px","text-align":"center"},attrs:{border:e.border,data:e.tableData,"row-style":e.rowClass,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.changeBox}},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"100"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return["ONLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==a.status?t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==a.status?t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=a.status&&"ONLINE"!=a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),prop:"Company","show-overflow-tooltip":"",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,a,i)}},model:{value:a.isEnable,callback:function(t){e.$set(a,"isEnable",t)},expression:"row.isEnable"}})]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),"min-width":"220",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),t("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editorDevice(a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),t("el-dropdown",{staticStyle:{margin:"0 10px"}},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(a,a.objectId,a.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],1),t("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.isALL,expression:"!isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.changeBox}},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),"show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return["ONLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==a.status?t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==a.status?t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=a.status&&"ONLINE"!=a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.product&&a.product.name?t("span",[e._v(" "+e._s(a.product.name)+" ")]):e._e()]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(" "+e._s(a.Company)+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),"show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,a,i)}},model:{value:a.isEnable,callback:function(t){e.$set(a,"isEnable",t)},expression:"row.isEnable"}})]}}])}),e._l(e.dialogtempconfig,(function(a,i){return["bool"==a.type&&a.isshow?t("el-table-column",{key:i,attrs:{align:"center",label:a.name,prop:a.identifier},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[i[a.default]?t("span",[e._v(" "+e._s(e.$translateTitle("product.yes"))+" ")]):t("span",[e._v(" "+e._s(e.$translateTitle("product.no"))+" ")])]}}],null,!0)}):"enum"==a.type&&a.isshow?t("el-table-column",{key:i,attrs:{align:"center",label:a.name},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("span",[e._v(" "+e._s(a.struct[i[a.identifier]])+" ")])]}}],null,!0)}):a.isshow?t("el-table-column",{key:i,attrs:{align:"center",label:a.name,prop:a.identifier},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("span",[e._v(e._s(i[a.identifier])+" "+e._s(a.unit))])]}}],null,!0)}):e._e()]})),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"180"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),t("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editorDevice(a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),t("el-dropdown",{staticStyle:{margin:"0 10px"}},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(a,a.objectId,a.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),t("el-dropdown-item",[t("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],2),t("div",{staticClass:"elpagination"},[t("el-pagination",e._b({attrs:{background:e.ination.background,"current-page":e.ination.currentPage,layout:e.ination.layout,"page-size":e.ination.pageSize,"page-sizes":e.ination.pageSizes,total:e.ination.total},on:{"update:currentPage":function(t){return e.$set(e.ination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.ination,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.ination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.ination,"pageSize",t)},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}},"el-pagination",e.$attrs,!1))],1)],1)]),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.map"),name:"second"}},[t("baidu-map",{staticClass:"map",staticStyle:{height:"67vh"},attrs:{ak:e.secret.baidu.map,center:{lng:116.404,lat:39.915},"scroll-wheel-zoom":!0,zoom:e.sizeZoom}},[t("bm-control",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=19}}},[e._v(" 缩放至最大 ")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=10}}},[e._v("还原")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=3}}},[e._v(" 缩放至最小 ")]),t("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:460,height:0}}}),t("bm-overview-map",{attrs:{"is-open":!0}}),t("bm-scale",{attrs:{offset:{width:200,height:0}}}),t("bm-city-list",{attrs:{offset:{width:280,height:0}}}),t("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"],offset:{width:360,height:0}}})],1),e._l(e.tableData,(function(a){return t("bm-marker",{key:a.objectId,attrs:{animation:"BMAP_ANIMATION_BOUNCE",content:a.name,dragging:!0,position:{lng:a.location.longitude,lat:a.location.latitude}}},[t("bm-label",{attrs:{content:a.name,"label-style":{color:"red",fontSize:"24px"},offset:{width:-35,height:30}},on:{click:function(t){return e.deviceToDetail(a)}}})],1)})),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}})],2)],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.edit")+e.equipmentEditor,visible:e.devicedialogVisible,width:"70%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[t("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[t("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),t("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1)]),t("div",{staticClass:"devicecontent"},[t("el-tabs",{model:{value:e.imeideviceName,callback:function(t){e.imeideviceName=t},expression:"imeideviceName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.commdevice"),name:"first"}},[t("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[t("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[t("el-input",{attrs:{disabled:"编辑"==e.equipmentEditor},model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"编辑"==e.equipmentEditor,placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[t("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[t("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[t("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[t("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoSrc")}},[t("el-input",{model:{value:e.deviceform.videoSrc,callback:function(t){e.$set(e.deviceform,"videoSrc",t)},expression:"deviceform.videoSrc"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoType")}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.deviceform.videoType,callback:function(t){e.$set(e.deviceform,"videoType",t)},expression:"deviceform.videoType"}},e._l(e.videoOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._l(e.arrlist,(function(a,i){return t("el-col",{key:i,attrs:{span:12}},[t("el-form-item",{attrs:{label:a.name,prop:a.identifier,required:a.required}},["bool"==a.type?t("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:a.readonly},model:{value:e.deviceform[a.identifier],callback:function(t){e.$set(e.deviceform,a.identifier,t)},expression:"deviceform[item.identifier]"}},[t("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),t("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==a.type?t("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:a.readonly},model:{value:e.deviceform[a.identifier],callback:function(t){e.$set(e.deviceform,a.identifier,t)},expression:"deviceform[item.identifier]"}},e._l(a.specs,(function(e,a){return t("el-option",{key:a,attrs:{label:e.attributevalue,value:e.attribute?e.attribute:""}})})),1):"switch"==a.type?t("el-switch",{attrs:{"active-color":"#13ce66","active-value":a.activevalue,"inactive-color":"#ff4949","inactive-value":a.inactivevalue},model:{value:e.deviceform[a.identifier],callback:function(t){e.$set(e.deviceform,a.identifier,t)},expression:"deviceform[item.identifier]"}}):a.readonly?t("el-input",{attrs:{disabled:a.readonly,value:e.deviceform[a.identifier]?e.deviceform[a.identifier]:""}},[t("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(a.unit?a.unit:"")+" ")])],1):t("el-input",{attrs:{disabled:a.readonly},model:{value:e.deviceform[a.identifier],callback:function(t){e.$set(e.deviceform,a.identifier,t)},expression:"deviceform[item.identifier]"}},[t("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(a.unit?a.unit:"")+" ")])],1)],1)],1)})),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[t("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],2)],1),t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),t("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1),"编辑"!=e.equipmentEditor?t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.imeidevice"),name:"second"}},[t("el-form",{ref:"imeiform",attrs:{"label-width":"150px",model:e.imeiform,rules:e.rules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"IMEI",prop:"devimei"}},[t("el-input",{model:{value:e.imeiform.devimei,callback:function(t){e.$set(e.imeiform,"devimei",t)},expression:"imeiform.devimei"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.imeiform.productName,callback:function(t){e.$set(e.imeiform,"productName",t)},expression:"imeiform.productName"}},e._l(e.proTableData1,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[t("el-input",{on:{focus:e.updateLocation},model:{value:e.imeiform.address,callback:function(t){e.$set(e.imeiform,"address",t)},expression:"imeiform.address"}})],1)],1)],1)],1),t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitimeiForm("imeiform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),t("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1):e._e()],1)],1)]),t("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:e.$translateTitle("developer.equipmentinstallationaddress"),visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[t("div",[t("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[t("el-form-item",{attrs:{label:e.$translateTitle("developer.addressname")}},[t("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.selectaddress")}},[t("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),t("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[t("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),t("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),t("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1)])},l=[],o=a("2db0"),r=a("5880"),s=a("dcc6"),n=a("4be7"),c=a("7212"),d=a("cb88"),u=a("926a"),p=a("1285"),m=a("bc35"),h=a("14ba"),v=Object.defineProperty,f=Object.defineProperties,b=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,T=(e,t,a)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,k=(e,t)=>{for(var a in t||(t={}))y.call(t,a)&&T(e,a,t[a]);if(g)for(var a of g(t))w.call(t,a)&&T(e,a,t[a]);return e},x=(e,t)=>f(e,b(t)),D=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())}),C={components:{BmScale:d["BmScale"],BmMapType:d["BmMapType"],BmOverviewMap:d["BmOverviewMap"],BmPanorama:d["BmPanorama"],BmControl:d["BmControl"],BmLabel:d["BmLabel"],BaiduMap:d["BaiduMap"],BmLocalSearch:d["BmLocalSearch"],BmNavigation:d["BmNavigation"],BmGeolocation:d["BmGeolocation"],BmCityList:d["BmCityList"],BmMarker:d["BmMarker"],deviceState:o["default"]},data(){let e=/^[0-9]{15}$/,t=(t,a,i)=>{if(!e.test(a))return i(new Error("请输入15位IMEI"));i()};this.chartSettings={radius:[5,40],offsetY:70},this.chartExtend={yAxisType:["percent"],tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}};const a=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("安装位置不能为空")):i.test(t)?a():a(new Error("安装位置必须为大小写字母数字"))};return{queryPayloads:{where:{},include:"",order:"-updatedAt",limit:10,skip:0,count:"objectId"},pagination:{pageSizes:[5,10,20,50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",background:!0,hidden:!1,small:!1,pageSize:10,total:0,pageCount:0,pagerCount:7,currentPage:1,popperClass:"",prevText:"",nextText:"",disabled:!1,hideOnSinglePage:!1},deviceInfo:{},paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},secret:h["secret"],productDetail:{},addACL:{},videoOptions:["m3u8","mp4","flv","mp3"],queryInfo:{},isFullscreen:!1,border:!0,stripe:!0,lineHeight:"medium",aclObj:{},editRow:{},selectedList:[],formData:{},topicData:[],InfoDialog:!1,devicedetail:{},stateDialog:!1,stateDetail:{},chartOnlone:{columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},chartwaring:{},parseTbas:[],activeparseTbas:"",chartProduct:{},queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,statusFlag:!1,status:"",number:"",product:"",type:"",limit:20,skip:0,order:"-createdAt",keys:"count(*)"},treeDataValue:"",isALL:!0,sizeZoom:10,activeName:"first",imeideviceName:"first",mapDialog:!1,dialogtempconfig:[],arrlist:[],deviceId:"",deciceCompany:"",gutter:24,leftRow:3,rightRow:21,popoverVisible:!1,dgioticon:"ancient-gate-fill",Company:sessionStorage.getItem("title")||"",curDepartmentId:"",roleProps:{children:"children",label:"name"},listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"",cities:[],selectdevice:"",onlinedevices:"",statusdevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,imeiform:{devimei:"",productName:"",address:""},deviceform:{videoSrc:"",videoType:"m3u8",name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:""},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:a}],devimei:[{required:!0,message:"请输入设备IMEI",trigger:"blur"},{validator:t}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:k({query:function(){return _.merge(this.queryPayload,this.queryPayloads)},ination:function(){return _.merge(this.pagination,this.paginations)}},Object(r["mapGetters"])({_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role",currentDepartment:"user/currentDepartment"})),watch:{multipleTable(e){this.selectRow=[],e.length>0&&e.forEach((e,t)=>{this.selectRow.push(this.tableData.indexOf(e))})}},mounted(){this.onlinedevices="dev_online"==this.$route.query.deciceType?"在线":"dev_unline"==this.$route.query.deciceType?"离线":"",this.selectdevice="zh"==this.language?"设备名称":"devicename",this.queryProduct(),this.getDevices(),this.aclObj=this.$aclObj(this._role),dgiotlog.log("this.aclObj",this.aclObj)},methods:x(k({handleSizeChange(e){console.log(this.$route);let t=this.query;t.limit=e,this.queryPayloads.limit=e,this.queryPayload.limit=e,this.queryForm.limit=e,this.paginationQuery(t),this.getDevices(t)},handleCurrentChange(e){console.log(this.$route.path);let t=this.query;t.skip=(e-1)*this.ination.pageSize,this.queryPayloads.skip=(e-1)*this.ination.pageSize,this.queryPayload.skip=(e-1)*this.ination.pageSize,this.queryForm.skip=(e-1)*this.ination.pageSize,this.paginationQuery(t),this.getDevices(t)},paginationQuery(e){return D(this,null,(function*(){this.queryPayload=e}))},goLink(e,t){return D(this,null,(function*(){var e;const{basedata:a={}}=yield Object(p["getDevice"])(t);if(console.error(t,a),!(null==(e=null==a?void 0:a.videoSrc)?void 0:e.length))return this.$baseMessage(this.$translateTitle("equipment.The device is not bound to the video address yet"),"info","dgiot-hey-message-error"),!1;this.$router.push({path:"/Tools/player",query:{type:a.videoType||"m3u8",url:a.videoSrc}})}))},handleTabClick(e,t){dgiotlog.log(this.activeparseTbas),dgiotlog.log(this.parseTbas)},updateParse(e,t,a,i){return D(this,arguments,(function*(e,t,a,i,l={}){console.clear(),dgiotlog.log("字段",t),l[""+t]={};let o=[],r=[];dgiotlog.log(this.queryInfo),dgiotlog.log("frender ",i);for(let d in i.config)this.queryInfo[""+d]?(dgiotlog.log(i.config[""+d],d),l[""+t][""+d]=i.config[""+d]):(dgiotlog.log(i.config[""+d],"字段不存在"),r.push[i.config[""+d]]);dgiotlog.log("isField",o),dgiotlog.log("noField",r),dgiotlog.log("params",l.field);let s={};s[""+t]=this.queryInfo;const n=_.merge(s,l);dgiotlog.log(n,"合并后的數據"),dgiotlog.log({field:n[""+t]});try{const t=yield this.$update_object(e,a,n);dgiotlog.log(t),this.$message({showClose:!0,message:this.$translateTitle("user.update completed"),type:"success"})}catch(c){dgiotlog.log(c),this.$baseMessage(c,"error","dgiot-hey-message-error")}}))}},Object(r["mapMutations"])({set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{handleSubmit(e){return dgiotlog.log("data",e),n["Promise"].resolve()},handleSuccess(e){e.table&&e.field&&e.config.order?this.$get_object(e.table,this.deviceId).then(t=>{dgiotlog.log(t),this.queryInfo=t[""+e.field],this.queryInfo?this.updateParse(e.table,e.field,this.deviceId,e):this.$baseMessage(`${e.table} no field ${e.field}`,"error","dgiot-hey-message-error")}):this.$baseMessage(`${e.table} no field ${e.field}`,"error","dgiot-hey-message-error")},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Device/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Device/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>D(this,null,(function*(){yield Object(s["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.getDevices({start:0})},1500)})))},ParserSave(e){dgiotlog.log("如果监听到有修改,则更新vuex 并 存入到数据库 "+JSON.stringify(e))},queryProduct(){return D(this,null,(function*(){this.proTableData=[],this.proTableData1=[];const{results:e=[]}=yield Object(c["queryProduct"])({count:"objectId",order:"-updatedAt",where:{}});this.proTableData=e,dgiotlog.log(this.proTableData,"  this.proTableData"),this.$route.query.product&&this.proTableData.forEach((e,t)=>{e.objectId==this.$route.query.product&&(this.equvalue=this.proTableData[t].objectId,this.productenable=!0,this.queryForm.access_token=this.token,this.$nextTick(()=>{this.selectProdChange(this.$route.query.product)}))}),this.proTableData1=e.filter(e=>"0"!=e.objectId),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.productenable=!1),dgiotlog.log("this.equvalue",this.equvalue)}))},change(e){dgiotlog.log(e),e&&$(".el-tree").css({height:"120px",display:"block"})},selectProdChange(e){return D(this,null,(function*(){if(e){if(this.listLoading=!0,"0"==e)this.isALL=!0;else{yield Object(c["getProduct"])(e).then(e=>{this.listLoading=!1;const{config:t={basedate:{}}}=e,{basedate:a={params:[]}}=t;dgiotlog.log(e,a),this.dialogtempconfig=[],"undefined"!=a.params&&(this.dialogtempconfig=a.params,dgiotlog.log("this.dialogtempconfig",this.dialogtempconfig))}),this.isALL=!1,this.tableData=[];const t={limit:this.devicelength,skip:this.devicestart,order:"-createdAt",count:"objectId",include:"product,name",where:{name:{$ne:null,$exists:!0}}};""!=this.deviceinput&&("设备名称"==this.selectdevice?t.where.name=this.deviceinput:t.where.devaddr=this.deviceinput),""!=this.onlinedevices&&("在线"==this.onlinedevices?t.where.status="ONLINE":t.where.status="OFFLINE"),""!=this.statusdevices&&(t.where.isEnable=this.statusdevices),""!=this.devicenumber&&(t.where.devaddr=this.devicenumber),t.where.product=e,this.devicestart=0;const{results:a=[],count:i=0}=yield Object(p["querycompanyDevice"])(t,this.queryForm.access_token);a.forEach(e=>{if(_.isEmpty(e.location)&&(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company="";if(e.profile)for(var t in e.profile)e[t]=e.profile[t]}),dgiotlog.log(a),this.tableData=a,this.devicetotal=i,this.pagination.total=i,this.chartOnlone.rows[1]["数量"]=this.devicetotal,dgiotlog.log("tableData",this.tableData)}this.listLoading=!1}}))},showTree(e,t,a){this.deviceInfo=e,this.deviceId=t,this.deciceCompany=a,this.popoverVisible=!this.popoverVisible},CloseState(){this.stateDialog=!1},showMap(e,t){this.deviceId=t;const{latitude:a=0,longitude:i=0}=e;Number(a)&&Number(i)?(this.mapDialog=!0,this.center.lng=i,this.center.lat=a):this.$baseMessage("位置信息获取失败","error","dgiot-hey-message-error")},transferAcl(e){const t="role:"+e.name,a={};a[t]={read:!0,write:!0},this.deviceInfo.detail["factory"]=e.depname;const i={ACL:a,detail:this.deviceInfo.detail};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>D(this,null,(function*(){yield Object(p["putDevice"])(this.deviceId,i).then(e=>{e.updatedAt?(this.popoverVisible=!1,this.$message({type:"success",message:this.$translateTitle("迁移成功")})):this.$message({type:"success",message:this.$translateTitle("迁移成功")})})}))).catch(e=>{dgiotlog.log(e)}),dgiotlog.log(e.name)},handleNodeClick(e,t){return D(this,null,(function*(){const a=this._role.map(e=>e.name);$(".el-tree").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),this.queryForm.workGroupName=e.label;const{name:i,objectId:l}=e;if(this.curDepartmentId=l,a.includes(e.name))this.queryForm.access_token=this.token;else if(1!=t.level){const{access_token:t=""}=yield Object(m["getToken"])(e.name);this.queryForm.access_token=t}else this.queryForm.access_token=this.token;this.getDevices({start:0})}))},rolesSelect(e){return D(this,null,(function*(){this.productroleslist=[];const{results:t}=yield this.$get_object("Product",e)}))},goEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:a}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i=`${t}/#?devaddr=${e.devaddr}&proudctid=${e.productid}`;window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword,this.imeiform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler({BMap:e,map:t}){this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick(e){this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.bmapform.address=e.address,this.deviceform.address=e.address,this.imeiform.address=e.address})},updateLocation(){this.bmapdialogVisible=!0},handleClosebmap(){this.bmapdialogVisible=!1},getOnlineDevices(){return D(this,null,(function*(){this.chartOnlone={columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]};var e={limit:1,count:"objectId",include:"product,name",keys:"name",where:{status:"ONLINE",name:{$ne:null,$exists:!0}}};""!=this.deviceinput&&("设备名称"==this.selectdevice?e.where.name={$regex:this.deviceinput}:e.where.devaddr={$regex:this.deviceinput}),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&this.selectProdChange(this.equvalue);try{const{count:t=0}=yield Object(p["querycompanyDevice"])(e,this.queryForm.access_token);this.chartOnlone.rows[1]["数量"]=this.devicetotal-t,this.chartOnlone.rows[0]["数量"]=t}catch(t){dgiotlog.log(t),this.$baseMessage(t,"error","dgiot-hey-message-error")}}))},getDevices(){return D(this,arguments,(function*(e={}){this.listLoading=!0,this.tableData=[],this.queryPayload.excludeKeys="channel,children,config,thing,decoder,data,basedata,content",this.queryPayload.include="product.name,name",this.queryPayload.where={name:"设备名称"===this.selectdevice&&this.deviceinput?{$regex:this.deviceinput}:{$ne:null,$exists:!0},devaddr:"设备编号"===this.selectdevice&&this.deviceinput?{$regex:this.deviceinput}:{$ne:null},status:"在线"==this.onlinedevices?"ONLINE":"离线"==this.onlinedevices?"OFFLINE":{$ne:null},isEnable:this.statusdevices?this.statusdevices:{$ne:null}},0!=this.equvalue&&(this.devicestart=e.skip,this.selectProdChange(this.equvalue)),0==e.start&&(this.devicestart=0),delete this.queryPayload.productid;try{const{results:e=[],count:t=0}=yield Object(p["querycompanyDevice"])(this.queryPayload,this.queryForm.access_token);if(this.listLoading=!1,!(null==e?void 0:e.length))return;e.forEach(e=>{if(e.location||(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company=""}),this.tableData=e,this.devicetotal=t,this.pagination.total=t}catch(t){dgiotlog.log(t),this.listLoading=!1,this.tableData=[],this.devicetotal=0,this.$baseMessage(t,"error","dgiot-hey-message-error")}}))},handelUpdate(e,t,a){return D(this,null,(function*(){var i={};for(var l in t)i[l]=t[l];i.isEnable=1!=i.isEnable,this.tableData[a]=i,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>D(this,null,(function*(){console.log("row",t);var a=yield this.$update_object("Device",t.objectId,{isEnable:e});void 0!=a?(this.$message({type:"success",message:"状态修改成功"}),this.getDevices()):(dgiotlog.log("Device error",error),Object(u["returnLogin"])(error))}))).catch(()=>D(this,null,(function*(){this.$message({type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.tableData[a]=e})))}))},timestampToTime(e){var t=new Date(1200*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",l=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",o=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",r=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",s=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+l+o+r+s},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag(e,t){return t.tag===e},deleteDevcie(e){return D(this,null,(function*(){this.multipleTable.map(e=>D(this,null,(function*(){yield this.$del_object("Device",e.objectId)}))),this.$message({message:"删除成功",type:"success"}),this.getDevices()}))},editDevice(){return D(this,null,(function*(){const e=yield this.$update_object("Device",item.objectId,params);e.updatedAt?this.initQuery("设备修改成功","success"):this.$message({type:"error",message:e.error})}))},unactiveDevice(e){return D(this,null,(function*(){const t=[],a=[];this.multipleTable.map(e=>{t.push(e.objectId)});const i={isEnable:e},l=yield Object(s["Batchdelete"])("PUT","Device",t,i);l&&(l.forEach((e,i)=>{e.objectId=t[i],e.sortIndex=i+1,"success"==Object.keys(l[i])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg=`<ol>\n              edit error <br>\n              message: ${e.error.error} <br>\n              code: ${e.error.code} <ol>`,e.dangerouslyUseHTMLString=!0),a.push({type:Object.keys(l[i])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})}),a.forEach((e,a)=>{this.$baseNotify(e.message,""+t[a],e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)}),this.getDevices())}))},rowClass({row:e,rowIndex:t}){if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange(e){this.devicelength=e,this.getDevices()},deviceCurrentChange(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",videoSrc:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm(){this.devicedialogVisible=!0,this.arrlist=[],this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue,this.selectChange(this.equvalue,"add")):this.deviceform.productName=""},handleClose1(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure(e,t){return D(this,null,(function*(){const a=yield this.$del_object("Device",row.objectId);a.error?this.$message({type:"error",message:"删除失败"}):(this.$message({type:"success",message:"删除成功"}),this.getDevices()),e._self.$refs["popover-"+t].doClose()}))},editorDevice(e){return D(this,null,(function*(){for(var t in this.editRow={},this.selectChange(e.product.objectId,"edit"),this.deviceform={},dgiotlog.log("row",e),this.editRow=e,this.deviceid=e.objectId,this.devicedialogVisible=!0,this.imeideviceName="first",this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:e.detail.assetNum||"",devModel:e.detail.devModel||"",desc:e.detail.desc||"",productid:e.product.objectId,brand:e.detail.brand||"",productName:e.product.objectId,status:e.status,isEnable:e.isEnable,videoType:e.detail.videoType||"",videoSrc:e.detail.videoSrc||"",address:e.detail.address||""},dgiotlog.log("this.deviceform12131",this.deviceform),dgiotlog.log("row.basedata",e.basedata),e.basedata)this.$set(this.deviceform,t,e.basedata[t]);dgiotlog.log("this.deviceform",this.deviceform),this.bmapform={address:e.detail.address},this.center={lat:location.latitude,lng:location.longitude},this.addresspointer=void 0==e.detail||void 0==location||location.latitude+e.detail==void 0?"":location.longitude,this.equipmentEditor="编辑"}))},initQuery(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices({start:0})},updateDevice(e){return D(this,null,(function*(){const t=yield Object(p["getDevice"])(this.deviceid),{content:a={},detail:i={},profile:l={},basedata:o={}}=t,r=_.merge({content:a,detail:i,profile:l,basedata:o},e);console.log("params",e),console.log("deviceInfo",t),console.log("mergeParams",r);const s=yield Object(p["putDevice"])(this.deviceid,e);s.updatedAt||s.devaddr?this.initQuery("设备更新成功","success"):this.$message({type:"error",message:s.error})}))},createDevice(e){return D(this,null,(function*(){const t=yield this.$create_object("Device",e);t.objectId?(this.deviceform={},this.handleClose(),this.initQuery("设备创建成功","success")):this.$message({type:"error",message:t})}))},selectChange(e,t="add"){this.arrlist=[],Object(c["getProduct"])(e).then(e=>{const{config:a={basedate:{}},ACL:i}=e;this.productDetail=e,a.basedate&&a.basedate.params.length>0&&(this.arrlist=a.basedate.params,"add"==t&&this.arrlist.map(e=>{var t,a,i,l,o;"bool"==e.type?this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(t=e.default)?void 0:t.length)?e.default:""):"enum"==e.type?this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(l=null==(i=null==(a=e.specs)?void 0:a[0])?void 0:i.attribute)?void 0:l.length)?e.specs[0].attribute:""):this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(o=e.default)?void 0:o.length)?e.default:""),e.required&&("bool"==e.type?this.rules[e.identifier]=[{required:!0,message:"请选择"+e.name,trigger:"change"}]:this.rules[e.identifier]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}])}),dgiotlog.log("afd",this.arrlist),dgiotlog.log("deviceform",this.deviceform),dgiotlog.log("rules",this.rules))})},submitForm(e){return D(this,null,(function*(){this.$refs[e].validate(e=>D(this,null,(function*(){if(!e)return this.$message({type:"error",message:"请按照要求填写参数"}),!1;var t={__type:"GeoPoint",latitude:this.center.lat?this.center.lat:0,longitude:this.center.lng?this.center.lng:0},a={assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.bmapform.address,desc:this.deviceform.desc,videoType:this.deviceform.videoType,videoSrc:this.deviceform.videoSrc},i={};for(var l in this.deviceform)i[l]=this.deviceform[l];if(this.$delete(i,"address"),this.$delete(i,"assetNum"),this.$delete(i,"batchId"),this.$delete(i,"brand"),this.$delete(i,"desc"),this.$delete(i,"devModel"),this.$delete(i,"devType"),this.$delete(i,"devaddr"),this.$delete(i,"isEnable"),this.$delete(i,"name"),this.$delete(i,"netType"),this.$delete(i,"nodeType"),this.$delete(i,"productName"),this.$delete(i,"status"),this.$delete(i,"productid"),""!=this.deviceid){var o={name:this.deviceform.name,devaddr:this.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:this.editRow.product.objectId},detail:a,location:t,basedata:i,profile:i};this.updateDevice(o),this.handleClose(),this.getDevices({start:0})}else{var r={count:"objectId",where:{name:{$in:[this.deviceform.name]},devaddr:{$in:[this.deviceform.devaddr]}}};this.$query_object("Device",r).then(e=>{if(e.count>0)this.$message("此设备已被创建");else{const e="role:"+this.currentDepartment.name,o={};o[e]={read:!0,write:!0};var l={product:{__type:"Pointer",className:"Product",objectId:this.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:o,name:this.deviceform.name,devaddr:this.deviceform.devaddr,objectId:this.deviceform.devaddr,lastOnlineTime:0,detail:a,location:t,basedata:i};l.detail.devType=this.productDetail.devType,l.detail.category=this.productDetail.category.objectId,console.log("createDevice params\n ",l),this.createDevice(l)}})}})))}))},submitimeiForm(e){return D(this,null,(function*(){this.$refs[e].validate(e=>D(this,null,(function*(){if(!e)return this.$message({type:"error",message:"请按照要求填写参数"}),!1;var t={productid:this.imeiform.productName,devaddr:this.imeiform.devimei,latitude:this.center.lat?this.center.lat:0,longitude:this.center.lng?this.center.lng:0};Object(p["addimeidevice"])(t).then(e=>{e.objectId?(this.deviceform={},this.handleClose(),this.initQuery("设备创建成功","success")):this.$message({type:"error",message:e})})})))}))},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})}})},I=C,q=(a("c23a"),a("2877")),S=Object(q["a"])(I,i,l,!1,null,"60c04d1a",null);t["default"]=S.exports},a6f6:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"editdevices"},[t("div",[t("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.deviceinformation"),name:"first"}},[t("info",{attrs:{devicedetail:e.deviceInfo}}),t("el-card",[t("dgiot-baidu-map",{ref:"map",attrs:{bmLabel:e.bmLabel,markers:[e.mapLabel.position],label:e.mapLabel,navShow:!0,scaleShow:!0,mapCenter:e.mapLabel.position}})],1)],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.realTime data"),name:"first1"}},[t("running-state",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{loading:e.loading,thirdtbKey:e.thirdtbKey,machinelist:e.machinelist}})],1),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.historical data"),name:"third"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[t("div",{staticClass:"chartsinfo"},[t("div",{staticClass:"queryHeader",style:{height:"desktop"==e.Device?"50px":"240px"}},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"desktop"==e.Device?"80px":"70px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("developer.startTime")}},[t("el-date-picker",{staticStyle:{width:"83%"},attrs:{"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.startTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.startTime,callback:function(t){e.$set(e.params,"startTime",t)},expression:"params.startTime"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.EndTime")}},[t("el-date-picker",{staticStyle:{width:"83%"},attrs:{clearable:!1,"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.EndTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.endTime,callback:function(t){e.$set(e.params,"endTime",t)},expression:"params.endTime"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.type")}},[t("el-select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.toggleChart},model:{value:e.params.style,callback:function(t){e.$set(e.params,"style",t)},expression:"params.style"}},e._l(e.chartType,(function(a,i){return t("el-option",{key:i,attrs:{disabled:-1!=e.disabledChart.indexOf(a.type),label:a.name,value:a.type}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.interval")}},[t("el-input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:"请输入内容",size:"mini"},model:{value:e.params.number,callback:function(t){e.$set(e.params,"number",t)},expression:"params.number"}}),t("el-select",{staticStyle:{width:"70px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params.interval,callback:function(t){e.$set(e.params,"interval",t)},expression:"params.interval"}},e._l(e.interval,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.type}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.function")}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params._function,callback:function(t){e.$set(e.params,"_function",t)},expression:"params._function"}},e._l(e.functionarr,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1),t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.queryChart}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1)],1)],1)],1),t("div",{key:e.chartKey,staticClass:"chartsmain"},[t("dgiotChart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1),t("div",{staticClass:"chartOther"},[t("el-row",{attrs:{gutter:20}},[e._l(e.chartData.child,(function(a,i){return t("el-col",{directives:[{name:"show",rawName:"v-show",value:"日期"!=a.columns[1],expression:"item.columns[1] != '日期'"}],key:i,attrs:{md:e.md,sm:e.sm,xl:e.xl,xs:e.xs}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(a.columns[1])+" : "+e._s(a.unit))]),t("el-button-group",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[t("el-button",{attrs:{icon:"el-icon-warning-outline"}}),t("el-button",{attrs:{icon:"el-icon-full-screen"},on:{click:function(t){return e.toggleCardRow(i,e.xs,e.sm,e.md,e.xl)}}})],1)],1),t("dgiotChart",{ref:"charts",refInFor:!0,attrs:{"after-config":e.afterConfig,data:e.chartData.child[i],"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,"legend-visible":!1,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style,height:"300px"}})],1)],1)})),t("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.chartData.child,expression:"!chartData.child"}],attrs:{span:24}},[t("dgiot-empty")],1)],2)],1)])]),t("div",{staticClass:"twofirsttable",staticStyle:{"box-sizing":"border-box",padding:"10px","margin-top":"20px",background:"#ffffff"}})])],1)],1)])},l=[],o=a("bf0f"),r=(a("86f8"),a("0b52"),a("2877")),s=Object(r["a"])(o["a"],i,l,!1,null,"426149b0",null);t["default"]=s.exports},a858:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"comprehensive-table-container"},[t("div",{staticClass:"dialog"},[t("Modal",{attrs:{"footer-hide":"",query:e.routerInfo.query,width:"1200"},on:{"on-cancel":e.closeModal},model:{value:e.topoFlag,callback:function(t){e.topoFlag=t},expression:"topoFlag"}},[e._e(),e._e(),e.topoFlag?t("topopreview",{ref:"topo"}):e._e()],1),t("el-dialog",{attrs:{"append-to-body":"","before-close":e.handleCloseAmis,center:"",top:"5vh",visible:e.commandInfo.dialog,width:"80%"},on:{"update:visible":function(t){return e.$set(e.commandInfo,"dialog",t)}}},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.commandInfo.data,(function(e,a){return t("el-tab-pane",{key:a+"i",attrs:{label:e.title,name:a+""}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1),t("el-dialog",{staticClass:"map_dialog",attrs:{"append-to-body":"","before-close":e.closeMap,title:"安装位置",visible:e.dialog_device,width:"60%"},on:{"update:visible":function(t){e.dialog_device=t}}},[t("el-card",[t("label",[e._v(" 关键词： "),t("el-input",{model:{value:e.map.keyword,callback:function(t){e.$set(e.map,"keyword",t)},expression:"map.keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),t("label",[e._v(" 安装位置： "),t("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[t("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.map.innerVisible=!e.map.innerVisible}},slot:"suffix"})])],1),t("baidu-map",{staticStyle:{height:"300px"},style:{height:e.mapHeight,width:e.mapWidth},attrs:{ak:e.$dgiot.secret.baidu.map,center:{lng:116.404,lat:39.915},"map-click":!1,"scroll-wheel-zoom":!0,zoom:15},on:{click:e.mapClick}},[t("bm-view",{staticClass:"map"}),t("bm-local-search",{attrs:{"auto-viewport":!0,keyword:e.map.keyword,location:e.map.location}}),t("bm-control",[t("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:500,height:0}}}),t("bm-overview-map",{attrs:{"is-open":!0}}),t("bm-scale",{attrs:{offset:{width:260,height:0}}}),t("bm-city-list",{attrs:{offset:{width:330,height:0}}}),t("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],offset:{width:400,height:0}}})],1),t("bml-marker-clusterer",[t("bm-marker",[e._v("1")]),t("bm-label",[e._v("1")])],1),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0,"show-zoom-info":!0}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialog_device=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.editMap}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[t("div",{staticClass:"deviceTree"},[t("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),t("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-tree-node"},[t("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(i)}}},[e._v(" "+e._s(a.label)+" ")])])}}])})],1)]),t("dgiot-dialog",{attrs:{show:e.form.sync,title:"add"==e.form.type?"添加设备":"修改设备："+e.form.name,width:"60%"},on:{"update:show":function(t){return e.$set(e.form,"sync",t)},beforeClose:e.handleClose}},[t("dgiot-dialog",{attrs:{"append-to-body":"",show:e.map.innerVisible,width:"55%"},on:{"update:show":function(t){return e.$set(e.map,"innerVisible",t)}}},[t("label",[e._v(" 关键词： "),t("el-input",{model:{value:e.map.keyword,callback:function(t){e.$set(e.map,"keyword",t)},expression:"map.keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),t("label",[e._v(" 安装位置： "),t("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[t("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.map.innerVisible=!e.map.innerVisible}},slot:"suffix"})])],1),e.map.innerVisible?t("baidu-map",{staticStyle:{height:"300px"},style:{height:e.mapHeight,width:e.mapWidth},attrs:{ak:e.$dgiot.secret.baidu.map,center:{lng:116.404,lat:39.915},"map-click":!1,"scroll-wheel-zoom":!0,zoom:15},on:{click:e.mapClick}},[t("bml-marker-clusterer",[t("bm-marker"),t("bm-label")],1),t("bm-view",{staticClass:"map"}),t("bm-local-search",{attrs:{"auto-viewport":!0,keyword:e.map.keyword,location:e.map.location}}),t("bm-control",[t("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:500,height:0}}}),t("bm-overview-map",{attrs:{"is-open":!0}}),t("bm-scale",{attrs:{offset:{width:260,height:0}}}),t("bm-city-list",{attrs:{offset:{width:330,height:0}}}),t("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],offset:{width:400,height:0}}})],1),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0,"show-zoom-info":!0}})],1):e._e()],1),t("el-form",{ref:"form",staticClass:"demo-form",attrs:{"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.form.type,expression:"form.type == 'add'"}],attrs:{label:"所属厂家"}},[t("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.currentDepartment.name,callback:function(t){e.$set(e.currentDepartment,"name",t)},expression:"currentDepartment.name"}})],1),t("el-form-item",{attrs:{label:"所属产品",prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",disabled:"edit"==e.form.type,placeholder:"请选择产品"},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.product,(function(e){return t("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"设备地址",prop:"devaddr"}},[t("el-input",{attrs:{disabled:"edit"==e.form.type,placeholder:"请输入设备地址"},model:{value:e.form.devaddr,callback:function(t){e.$set(e.form,"devaddr",t)},expression:"form.devaddr"}})],1),t("el-form-item",{attrs:{label:"资产编号"}},[t("el-input",{attrs:{placeholder:"请输入资产编号"},model:{value:e.form.detail.assetNum,callback:function(t){e.$set(e.form.detail,"assetNum",t)},expression:"form.detail.assetNum"}})],1),t("el-form-item",{attrs:{label:"安装位置",prop:"address"}},[t("el-input",{attrs:{placeholder:"请选择安装位置"},on:{focus:function(t){e.map.innerVisible=!e.map.innerVisible}},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[t("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),t("el-form-item",{attrs:{label:"到期时间"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期：",type:"date","value-format":"timestamp"},model:{value:e.form.detail.expirationTime,callback:function(t){e.$set(e.form.detail,"expirationTime",t)},expression:"form.detail.expirationTime"}})],1),t("el-form-item",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form",e.form.type)}}},[e._v(" "+e._s("add"==e.form.type?"新建":"修改")+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("重置")])],1)],1)],1)],1),t("dgiot-query-form",[t("dgiot-query-form-top-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"75px",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"产品名称"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择产品"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.product,(function(e){return t("el-option",{key:e.objectId+"j",attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",[t("el-input",{staticClass:"input-with-select",staticStyle:{"margin-left":"20px"},attrs:{placeholder:"请输入查询参数"},model:{value:e.queryForm.search,callback:function(t){e.$set(e.queryForm,"search",t)},expression:"queryForm.search"}},[t("el-select",{staticStyle:{width:"160px"},attrs:{slot:"prepend",clearable:"",placeholder:"请选择查询类型"},slot:"prepend",model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}},[t("el-option",{attrs:{label:"设备名称",value:"name"}}),t("el-option",{attrs:{label:"资产编号",value:"detail.assetNum"}}),t("el-option",{attrs:{label:"设备地址",value:"devaddr"}})],1)],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择设备状态"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},[t("el-option",{attrs:{label:"在线",value:"ONLINE"}}),t("el-option",{attrs:{label:"离线",value:"OFFLINE"}})],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"开关机"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择开关机状态"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.isEnable,callback:function(t){e.$set(e.queryForm,"isEnable",t)},expression:"queryForm.isEnable"}},[t("el-option",{attrs:{label:"开机",value:"true"}}),t("el-option",{attrs:{label:"关机",value:"false"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.form.sync=!0}}},[e._v(" 新增 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.upkey+"t",ref:"tableSort",attrs:{border:"",data:e.list,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),gutter:20}},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"设备名称",prop:"name","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-form",{attrs:{model:a}},[t("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{size:"mini"}},[a.isEdit?t("el-input",{directives:[{name:"focus",rawName:"v-focus"}],staticStyle:{margin:"0 auto"},attrs:{size:"mini"},on:{blur:function(t){return e.blurEvent(a)},focus:function(e){a.oldName=a.name}},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"row.name"}}):t("p",{staticStyle:{float:"left",height:"8px"},domProps:{innerHTML:e._s(a.name)},on:{click:function(e){a.isEdit=!a.isEdit}}})],1)],1)]}}])},[t("template",{slot:"header"},[t("span",[e._v("设备名称")]),t("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[t("i",{staticClass:"el-icon-edit-outline"}),t("div",{staticClass:"tooltip-content",attrs:{slot:"content"},slot:"content"},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击修改设备名称")])])])],1)],2),t("el-table-column",{attrs:{align:"center",label:"设备地址",prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:"资产编号",prop:"detail.assetNum","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:"安装位置",prop:"address","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{key:a.address,staticStyle:{color:"#67c23a"},attrs:{type:"success"},on:{click:function(t){return e.showAdddress(a)}}},[e._v(" "+e._s(a.address||a.detail.address||"---")+" ")])]}}])},[t("template",{slot:"header"},[t("span",[e._v("安装位置")]),t("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[t("i",{staticClass:"el-icon-edit-outline"}),t("div",{attrs:{slot:"content"},slot:"content"},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击修改安装位置")])])])],1)],2),t("el-table-column",{attrs:{align:"center",label:"所属产品",prop:"product.objectId","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getProductName(t.product.objectId))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"所属部门",prop:"ACL","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return e._l(e.getAcl(a.ACL),(function(a,i){return t("el-tag",{key:i,attrs:{effect:"plain",type:a}},[e._v(" "+e._s(a)+" ")])}))}}])}),t("el-table-column",{attrs:{align:"center",label:"状态",prop:"status","show-overflow-tooltip":"",sortable:"",width:"180"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-tag",{attrs:{type:a.isEnable?"info":"danger"}},[e._v(" "+e._s(1==a.isEnable?"开机":"关机")+" ")]),t("el-tag",{attrs:{type:"ONLINE"==a.status?"success":"warning"}},[e._v(" "+e._s("ONLINE"==a.status?"在线":"离线")+" ")])]}}])},[t("template",{slot:"header"},[t("span",[e._v("状态")]),t("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[t("i",{staticClass:"el-icon-warning-outline"}),t("div",{staticClass:"tooltip-content",attrs:{slot:"content"},slot:"content"},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 开机关机属于网关子设备 "),t("br"),e._v(" 2. 在线离线属于网关网络状态 ")])])])],1)],2),t("el-table-column",{attrs:{align:"center",label:"最后更新时间","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.lastOnlineTime?e.$moment.unix(t.lastOnlineTime).format("YYYY-MM-DD HH:mm:ss"):"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.konvaDevice(a)}}},[e._v(" 设备面板 ")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.info(a)}}},[e._v(" 设备信息 ")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.command(a)}}},[e._v(" 控制 ")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),t("a-dropdown",{staticStyle:{"margin-left":"10px"},scopedSlots:e._u([{key:"overlay",fn:function(){return[t("a-menu",[t("a-menu-item",[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.showTree(a,a.objectId,a.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),t("a-menu-item",[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleDelete(a.objectId,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)]},proxy:!0}],null,!0)},[t("a",{staticClass:"el-icon-more",on:{click:function(e){e.preventDefault()}}})])]}}])})],1),t("el-pagination",{key:e.paginationKey,attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},l=[],o=a("1285"),r=a("5880"),s=a("3248"),n=a("7212"),c=a("cb88"),d=a("8ba7"),u=a("b9e9"),p=Object.defineProperty,m=Object.defineProperties,h=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,g=(e,t,a)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&g(e,a,t[a]);if(v)for(var a of v(t))b.call(t,a)&&g(e,a,t[a]);return e},w=(e,t)=>m(e,h(t)),T=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())}),$={name:"Device",components:{topopreview:u["default"],TableEdit:s["default"],BmLocalSearch:c["BmLocalSearch"],BmPointCollection:c["BmPointCollection"],BmInfoWindow:c["BmInfoWindow"],BmScale:c["BmScale"],BmMapType:c["BmMapType"],BmView:c["BmView"],BmOverviewMap:c["BmOverviewMap"],BmPanorama:c["BmPanorama"],BmControl:c["BmControl"],BmLabel:c["BmLabel"],BaiduMap:c["BaiduMap"],BmNavigation:c["BmNavigation"],BmGeolocation:c["BmGeolocation"],BmCityList:c["BmCityList"],BmMarker:c["BmMarker"],BmlMarkerClusterer:c["BmlMarkerClusterer"]},data(){return{activeName:"0",commandInfo:{dialog:!1,data:{}},settingInfo:{dialog:!1},statisticsInfo:{dialog:!1},moveInfo:{dialog:!1},topoFlag:!1,routerInfo:{},paginationKey:moment(new Date).valueOf()+"",upkey:moment(new Date).valueOf()+"",dialog_device:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},bmLabel:!1,popoverVisible:!1,deciceCompany:"",roleProps:{children:"children",label:"name"},curDepartmentId:"",mapHeight:"300px",mapWidth:"100%",map:{innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},form:{sync:!1,type:"add",product:"",name:"",devaddr:"",address:"",location:{__type:"GeoPoint",latitude:"120.161324",longitude:"30.262441"},detail:{assetNum:"",expirationTime:moment().format("x")}},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],product:[{required:!0,message:"请选择所属产品",trigger:"change"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"change"}],address:[{required:!1,message:"请选择设备安装位置",trigger:"change"}],"detail.assetNum":[{required:!0,message:"请输入资产编号",trigger:"blur"}]},product:[],editRow:{},fold:!1,height:this.$baseTableHeight(0),imgShow:!0,list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{type:"name",excludeKeys:"channel,children,config,thing,decoder,data,basedata,content",include:"product",product:this.$route.query.product?this.$route.query.product:"",title:"",name:"",isEnable:this.$route.query.isEnable?this.$route.query.isEnable:"",devaddr:"",all:!0,status:this.$route.query.status?this.$route.query.status:"",skip:0,limit:10}}},computed:y({},Object(r["mapGetters"])({routes:"routes/routes",_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role",currentDepartment:"user/currentDepartment"})),created(){this.fetchProduct(),this.fetchData()},methods:w(y({},Object(r["mapActions"])({addVisitedRoute:"tabs/addVisitedRoute",changeTabsMeta:"tabs/changeTabsMeta",set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{blurEvent(e){return T(this,null,(function*(){e.isEdit=!e.isEdit,e.name!==e.oldName&&(yield Object(o["putDevice"])(e.objectId,{name:e.name}),this.$message({message:"设备名称修改成功",type:"success",showClose:!0,duration:1500}))}))},info(e){return T(this,null,(function*(){localStorage.setItem("parse_objectid",e.objectId),localStorage.setItem("product_objectid",e.product.objectId);const{results:t=[]}=yield Object(d["queryView"])({where:{class:"Product",type:"deviceInfo",key:e.product.objectId}});if(_.isEmpty(t))return this.$baseMessage("暂未配置下发控制表单","info","dgiot-hey-message-error"),!1;this.commandInfo.dialog=!0,this.commandInfo.data=t}))},command(e){return T(this,null,(function*(){localStorage.setItem("parse_objectid",e.objectId),localStorage.setItem("product_objectid",e.product.objectId);const{results:t=[]}=yield Object(d["queryView"])({where:{class:"Product",type:{$in:["amis","profile","content"]},key:e.product.objectId}});if(_.isEmpty(t))return this.$baseMessage("暂未配置下发控制表单","info","dgiot-hey-message-error"),!1;this.commandInfo.dialog=!0,this.commandInfo.data=t}))},editMap(){return T(this,null,(function*(){const e={location:this.location,address:this.form.address};yield Object(o["putDevice"])(this.editRow.objectId,e),this.dialog_device=!1,this.$message({message:"设备位置更新成功",showClose:!0,type:"success"}),this.fetchData()}))},closeMap(){this.dialog_device=!1,this.map={innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},this.mapLabel={content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"}},showAdddress(e){console.log(e),this.editRow=e,this.map.keyword=(null==e?void 0:e.address)?e.address:this.map.keyword,this.form.address=(null==e?void 0:e.address)?e.address:this.form.keyword;const t={lng:Number(e.location.longitude),lat:Number(e.location.latitude)};this.mapLabel={content:e.name,style:{color:"red",fontSize:"12px"},position:t,title:e.address},this.bmLabel=!0,this.dialog_device=!0},transferAcl(e){const t="role:"+e.name,a={};a[t]={read:!0,write:!0};const i={ACL:a};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>T(this,null,(function*(){yield Object(o["putDevice"])(this.editRow.objectId,i),this.$message({showClose:!0,type:"success",message:this.$translateTitle("迁移成功")}),this.popoverVisible=!1,this.fetchData()}))),dgiotlog.log(e.name)},showTree(e,t,a){this.editRow=e,this.deciceCompany=a,this.popoverVisible=!this.popoverVisible},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>T(this,null,(function*(){yield Object(o["delDevice"])(e),this.$baseMessage("设备已成功删除","success","dgiot-hey-message-success"),yield this.fetchData()})))},handler({BMap:e,map:t}){this.map=t},mapClick(e){console.log(e),this.location={__type:"GeoPoint",latitude:e.point.lat,longitude:e.point.lng};const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.form.address=e.address}),this.editRow.objectId&&(this.editRow.location=this.location,this.editRow.address=this.form.address)},getProductName(e){let t="";return this.product.forEach(a=>{a.objectId===e&&(t=a.name)}),t},submitForm(e,t){this.$refs[e].validate(a=>T(this,null,(function*(){if(!a)return console.log("error submit!!"),!1;if("add"==t){const t="role:"+this.currentDepartment.name,a={};a[t]={read:!0,write:!0};const i={name:this.form.name,devaddr:this.form.devaddr,address:this.form.address,location:this.location,detail:this.form.detail,ACL:a,product:{__type:"Pointer",className:"Product",objectId:this.form.product},profile:{},route:{},isEnable:!0,status:"OFFLINE"},{error:l="",objectId:r=""}=yield Object(o["postDevice"])(i);if(l)return this.$message({type:"error",message:l,showClose:!0,duration:2e3}),!1;this.$message({type:"success",message:"设备添加成功",showClose:!0,duration:2e3}),this.form.sync=!1,this.resetForm(e),this.fetchData()}else{const t={name:this.form.name,devaddr:this.form.devaddr,address:this.form.address,location:this.location,detail:this.form.detail},{error:a=""}=yield Object(o["putDevice"])(this.editRow.objectId,t);if(a)return this.$message({type:"error",message:a,showClose:!0,duration:2e3}),!1;this.$message({type:"success",message:"设备信息修改成功",showClose:!0,duration:2e3}),this.form.sync=!1,this.resetForm(e),this.fetchData()}})))},resetForm(e){this.$refs[e].resetFields()},handleCloseAmis(){this.coordinate={lng:116.404,lat:39.915},this.dialog_device=!1,this.commandInfo.dialog=!1,this.fetchData(!1)},handleClose(e){this.form={sync:!1,type:"add",product:"",name:"",devaddr:"",address:"",location:{__type:"GeoPoint",latitude:"120.161324",longitude:"30.262441"},detail:{assetNum:""}}},getAcl(e){let t=[];for(let a in e)"*"==a?delete e[a]:a.split(":")[1]&&t.push(a.split(":")[1]);return t},handelUpdate(e,t,a){return T(this,null,(function*(){var i={};for(var l in t)i[l]=t[l];i.isEnable=1!=i.isEnable,this.list[a]=i,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>T(this,null,(function*(){yield this.$update_object("Device",t.objectId,{isEnable:e}),this.$message({duration:2e3,showClose:!0,type:"info",message:"设备状态修改成功修改"}),this.fetchData()}))).catch(()=>T(this,null,(function*(){this.$message({duration:2e3,showClose:!0,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.list[a]=e})))}))},fetchProduct(){return T(this,null,(function*(){try{const{results:e=[]}=yield Object(n["queryProduct"])({excludeKeys:"children,thing,decoder,topics,productSecret,desc,view,category,producttemplet"});this.product=e}catch(error){console.log(error)}}))},editorDevice(e){this.editRow=e,console.log(e),this.form={sync:!0,type:"edit",product:e.product.objectId,name:e.name,devaddr:e.devaddr,address:e.address,location:e.detail,detail:e.detail},this.map={innerVisible:!1,keyword:e.address?e.address:"余杭区良渚平高创业城c1座",location:"杭州"}},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},closeModal(){return T(this,null,(function*(){this.$router.go(-1),this.topoFlag=!1}))},konvaDevice(e){this.topoFlag=!0,this.$router.push({path:"/dashboard/devicelist",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})},handleAdd(){this.$refs["edit"].showEdit()},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDetail(e){},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){return T(this,null,(function*(){this.queryForm.limit=20,this.queryForm.skip=0,this.paginationKey=moment(new Date).valueOf()+"",yield this.fetchData()}))},fetchData(){return T(this,null,(function*(){console.log(this.queryForm),this.listLoading=!0;let e={skip:this.queryForm.skip,limit:this.queryForm.limit,excludeKeys:this.queryForm.excludeKeys,order:"-createdAt",count:"objectId",where:{}};console.log(this.$route.query),this.queryForm.product&&(e.where.product=this.queryForm.product),this.queryForm.search&&(e.where[this.queryForm.type]={$regex:this.queryForm.search}),this.queryForm.status.length&&(e.where.status=this.queryForm.status),this.queryForm.isEnable&&(e.where.isEnable=this.queryForm.isEnable);const{results:t=[],count:a=0}=yield Object(o["querycompanyDevice"])(e,this.token);t.forEach(e=>{var t;e.address=""==e.address?"---":e.address,e.detail=(null==e?void 0:e.detail)?e.detail:{},e.detail.address=(null==e?void 0:e.detail)&&(null==(t=null==e?void 0:e.detail)?void 0:t.address)?e.detail.address:"---",e.isEdit=!1,e.oldName=e.name}),this.list=t,this.total=a,this.listLoading=!1,yield this.subAllDevice()}))},subAllDevice(){return T(this,null,(function*(){let e=this;e.$dgiotBus.$on("$dg/user/devicestate",t=>{let a={};const i=JSON.parse(t.payloadString);if(i){const t=Object.keys(i);console.groupCollapsed("%c收到devicestate消息 "+t,"color:#009a61; font-size: 28px; font-weight: 300"),a.key=t[0],console.log(i),a.parseString=i,e.list.forEach(l=>{t.forEach(t=>{if(l.objectId==t){const o=_.merge(l,i[t],{detail:{address:i[t].address}});console.log("更新设备"+l.name),a.name=l.name,console.log(o,i[t]),a.Info=i[t],a.mergeInfo=o,e.upkey=moment(new Date).valueOf()+""}})})}console.info(a),console.groupEnd()})}))}})},k=$,x=(a("576e"),a("2877")),D=Object(x["a"])(k,i,l,!1,null,null,null);t["default"]=D.exports},add98:function(e,t,a){"use strict";a("05c0")},b0c6:function(e,t,a){},b888:function(e,t,a){},ba6d:function(e,t,a){"use strict";a("5964")},c23a:function(e,t,a){"use strict";a("f600")},d98d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"xinmahe-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("Modal",{attrs:{"footer-hide":"",query:e.routerInfo.query,width:"1200"},on:{"on-cancel":e.closeModal},model:{value:e.topoFlag,callback:function(t){e.topoFlag=t},expression:"topoFlag"}},[e._e(),e._e(),e.topoFlag?t("topopreview",{ref:"topo"}):e._e()],1),t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入查询参数"},model:{value:e.queryForm.search,callback:function(t){e.$set(e.queryForm,"search",t)},expression:"queryForm.search"}},[t("el-select",{staticStyle:{width:"160px"},attrs:{slot:"prepend",clearable:"",placeholder:"请选择查询类型"},slot:"prepend",model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}},[t("el-option",{attrs:{label:"设备名称",value:"name"}}),t("el-option",{attrs:{label:"外壳编号",value:"detail.assetNum"}}),t("el-option",{attrs:{label:"主板编号",value:"devaddr"}}),t("el-option",{attrs:{label:"sim卡号",value:"content.simserialno"}})],1)],1)],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.createDeviceDialog=!0}}},[e._v(" 添加 ")])],1)],1),t("div",{staticClass:"dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[t("div",{staticClass:"deviceTree"},[t("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),t("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-tree-node"},[t("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(i)}}},[e._v(" "+e._s(a.label)+" ")])])}}])})],1)]),t("el-dialog",{attrs:{"append-to-body":"","before-close":e.handleClose,center:"",top:"5vh",visible:e.commandInfo.dialog,width:"80%"},on:{"update:visible":function(t){return e.$set(e.commandInfo,"dialog",t)}}},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.commandInfo.data,(function(e,a){return t("el-tab-pane",{key:a,attrs:{label:e.title,name:a+""}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1),t("el-dialog",{attrs:{"append-to-body":"",center:"",title:"提示",visible:e.settingInfo.dialog,width:"30%"},on:{"update:visible":function(t){return e.$set(e.settingInfo,"dialog",t)}}},[t("span",[e._v("需要注意的是内容是默认不居中的")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.settingInfo.dialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.settingInfo.dialog=!1}}},[e._v(" 确 定 ")])],1)]),t("el-dialog",{attrs:{"append-to-body":"",center:"",title:"提示",visible:e.statisticsInfo.dialog,width:"30%"},on:{"update:visible":function(t){return e.$set(e.statisticsInfo,"dialog",t)}}},[t("span",[e._v("需要注意的是内容是默认不居中的")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.statisticsInfo.dialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.statisticsInfo.dialog=!1}}},[e._v(" 确 定 ")])],1)]),t("el-dialog",{attrs:{"append-to-body":"",center:"",title:"提示",visible:e.moveInfo.dialog,width:"30%"},on:{"update:visible":function(t){return e.$set(e.moveInfo,"dialog",t)}}},[t("span",[e._v("需要注意的是内容是默认不居中的")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.moveInfo.dialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.moveInfo.dialog=!1}}},[e._v(" 确 定 ")])],1)]),t("el-dialog",{staticClass:"map_dialog",attrs:{"append-to-body":"","before-close":e.handleClosedevice,title:"安装位置",visible:e.dialog_device,width:"50%"},on:{"update:visible":function(t){e.dialog_device=t}}},[t("el-card",[t("dgiot-baidu-map",{ref:"map",attrs:{"bm-label":e.bmLabel,label:e.mapLabel,"map-center":e.mapLabel.position,markers:[e.mapLabel.position],"nav-show":!0,"scale-show":!0,"scroll-wheel-zoom":!0}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialog_device=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialog_device=!1}}},[e._v(" 确 定 ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":"",title:"添加设备",visible:e.createDeviceDialog,width:"30%"},on:{"update:visible":function(t){e.createDeviceDialog=t}}},[t("el-form",{ref:"deviceFormRules",attrs:{"label-position":"left","label-width":"100px",model:e.deviceForm,rules:e.deviceFormRules}},[t("el-form-item",{attrs:{label:"设备名称：",prop:"name"}},[t("el-input",{model:{value:e.deviceForm.name,callback:function(t){e.$set(e.deviceForm,"name",t)},expression:"deviceForm.name"}})],1),t("el-form-item",{attrs:{label:"外壳编号：",prop:"detail.assetNum"}},[t("el-input",{model:{value:e.deviceForm.detail.assetNum,callback:function(t){e.$set(e.deviceForm.detail,"assetNum",t)},expression:"deviceForm.detail.assetNum"}})],1),t("el-form-item",{attrs:{label:"主板编号：",prop:"devaddr"}},[t("el-input",{model:{value:e.deviceForm.devaddr,callback:function(t){e.$set(e.deviceForm,"devaddr",t)},expression:"deviceForm.devaddr"}})],1),t("el-form-item",{attrs:{label:"到期时间：",prop:"detail.expirationTime"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期：",type:"date","value-format":"timestamp"},model:{value:e.deviceForm.detail.expirationTime,callback:function(t){e.$set(e.deviceForm.detail,"expirationTime",t)},expression:"deviceForm.detail.expirationTime"}})],1),t("el-form-item",{attrs:{label:"所属产品：",prop:"productId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.productId,callback:function(t){e.productId=t},expression:"productId"}},e._l(e.Product,(function(a){return t("el-option",{key:a.objectId,attrs:{label:a.name,value:a.objectId}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(a.name))]),t("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[e._v(" "+e._s(a.objectId)+" ")])])})),1)],1),t("el-form-item",{attrs:{label:"归属厂家：",prop:"detail.factory"}},[t("el-input",{attrs:{autocomplete:"off",disabled:""},model:{value:e.deviceForm.detail.factory,callback:function(t){e.$set(e.deviceForm.detail,"factory",t)},expression:"deviceForm.detail.factory"}})],1),t("el-form-item",{staticStyle:{"text-align":"center"},attrs:{"label-width":"0"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("deviceFormRules")}}},[e._v(" 立即创建 ")]),t("el-button",{nativeOn:{click:function(t){return e.onCloseDialog("deviceFormRules")}}},[e._v(" 取消 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.upkey,ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"55"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),e._l(e.finallyColumns,(function(a,i){return t("el-table-column",{key:i,attrs:{align:"center",label:a.label,prop:a.label,sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:i}){return["string"==typeof i[a.prop]?t("span",[e._v(" "+e._s(i[a.prop])+" ")]):t("span",{domProps:{textContent:e._s(e.getItems(a.prop,i.basedata,i))}})]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",label:"外壳编号",prop:"detail.assetNum","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.detail.assetNum)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"开关机状态",prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-tag",{attrs:{type:a.isEnable?"success":"danger"}},[e._v(" "+e._s(1==a.isEnable?"开机":"关机")+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-tag",{attrs:{type:"ONLINE"==a.status?"success":"warning"}},[e._v(" "+e._s("ONLINE"==a.status?"在线":"离线")+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"添加时间",prop:"createdAt","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD")||"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"到期时间",prop:"detail.expirationTime","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.detail.expirationTime?e.getTime(t.detail.expirationTime,t):"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"最后在线时间",prop:"lastOnlineTime","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e._f("dateUnix")(t.lastOnlineTime))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"安装位置",prop:"createdAt",sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.detail.address||a.row.address?t("el-button",{staticClass:"el-icon-location",attrs:{type:"text"},on:{click:function(t){return e.clickRow(a.row.location,a.row.name)}}},[e._v(" "+e._s(a.row.detail.address||a.row.address)+" ")]):t("span")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","show-overflow-tooltip":"",width:"380px"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.konvaDevice(a)}}},[e._v(" 实时数据 ")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.info(a)}}},[e._v(" 设备信息 ")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.command(a)}}},[e._v(" 控制 ")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.move(a)}}},[e._v("迁移")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" 详情 ")])]}}])})],2),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},l=[],o=a("3248"),r=a("7212"),s=a("13ce"),n=a("5880"),c=a("8ba7"),d=a("1285"),u=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))v.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))f.call(t,a)&&b(e,a,t[a]);return e},y=(e,t)=>p(e,m(t)),w=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())}),T={name:"Xinmahe",components:{topopreview:s["default"],TableEdit:o["default"]},props:{},data(){const e=(e,t,a)=>{if(!t)return a(new Error("外壳编号不能为空"));setTimeout(()=>{8!=t.length?a(new Error("外壳编号必须为8位")):a()},1e3)};return{topoFlag:!1,routerInfo:{},Product:[],productId:"",deviceInfo:{},roleProps:{children:"children",label:"name"},curDepartmentId:"",commandInfo:{dialog:!1,data:{}},settingInfo:{dialog:!1},statisticsInfo:{dialog:!1},moveInfo:{dialog:!1},popoverVisible:!1,deciceCompany:"",bmLabel:!1,upkey:moment(new Date).valueOf()+"",mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},map:null,activeName:"0",deviceFormRules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"}],"detail.assetNum":[{required:!0,validator:e,trigger:"blur"}],"detail.expirationTime":[{required:!0,message:"请选择服务到期时间",trigger:"blur"}],"detail.factory":[{required:!0,message:"请选择归属场景",trigger:"blur"}]},dialog_device:!1,curentDeviceInfo:{},coordinate:{lng:116.404,lat:39.915},deviceForm:{detail:{assetNum:"",expirationTime:moment().format("x"),factory:""},name:"",isEnable:!0,status:"OFFLINE",devaddr:"",basedata:{},route:{},product:{__type:"Pointer",className:"Product",objectId:""}},content:{simserialno:""},product:"",createDeviceDialog:!1,drawerAdd:!1,infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["设备名称","外壳编号","安装位置"],columns:[{label:"设备名称",width:"160",prop:"name",sortable:!0,disableCheck:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:20,name:"",search:"",type:"name"}}},computed:y(g({},Object(n["mapGetters"])({currentDepartment:"user/currentDepartment",roleTree:"user/roleTree"})),{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}}),watch:{},created(){this.getProduct(),this.queryForm.search=this.$route.query.devicename?this.$route.query.devicename:"",this.fetchData();const e="role:"+this.currentDepartment.alias,t={};t[e]={read:!0,write:!0},this.deviceForm.detail.factory=this.currentDepartment.alias,this.deviceForm.ACL=t},mounted(){},destroyed(){},methods:y(g({},Object(n["mapMutations"])({setCurrentDepartment:"user/setCurrentDepartment"})),{toggleSwitch(e){return new Promise(t=>{this.$Modal.confirm({title:1==e.isEnable?"修改设备状态为关机":"修改设备状态为开机",content:"您确认要手动操作设备开关机吗？",onOk:()=>{t(),e.isEnable=!e.isEnable,this.switchTask(e)}})})},switchTask(e){return w(this,null,(function*(){yield Object(d["putDevice"])(e.objectId,{isEnable:e.isEnable});const t=1==e.isEnable?"该设备已开机":"该设备已关机";this.$message({type:"success",message:t,showClose:!0})}))},doPostDevice(e){return w(this,null,(function*(){try{const{objectId:t="",error:a=""}=yield Object(d["postDevice"])(e);if(!t)throw this.$baseMessage(this.$translateTitle("alert.Data request error")+""+a,"error","dgiot-hey-message-error"),new Error(a);this.fetchData(),this.createDeviceDialog=!1}catch(t){throw new Error(t)}}))},getProduct(){return w(this,null,(function*(){const{results:e=[]}=yield Object(r["queryProduct"])({});this.Product=e,this.productId=e[0].objectId,this.product=e[0].objectId,this.deviceForm.product={__type:"Pointer",className:"Product",objectId:this.productId},console.log("deviceForm",this.deviceForm)}))},print(e){return w(this,null,(function*(){console.log(yield Object(d["getDevice"])(e.objectId)),console.log(e,e.isEnable)}))},getTime(e,t){return e?moment(Number(e)).format("YYYY-MM-DD"):moment(1e3*Number(t.basedata.expirationTime)).format("YYYY-MM-DD")},handleMenuClick(e){console.error(e)},deviceToDetail(e){this.$router.push({path:"/roles/devicesDetailLite",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},handleClosedevice(){this.fetchData(!1),this.dialog_device=!1,this.coordinate={lng:116.404,lat:39.915}},transferAcl(e){const t="role:"+e.name,a={};console.log(this.deviceInfo),a[t]={read:!0,write:!0},this.deviceInfo.detail.factory=e.depname;const i={ACL:a,basedata:this.deviceInfo.basedata};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>w(this,null,(function*(){yield Object(d["putDevice"])(this.deviceInfo.objectId,i).then(e=>{e.updatedAt?(this.popoverVisible=!1,this.$message({showClose:!0,duration:2e3,type:"success",message:this.$translateTitle("迁移成功")}),this.fetchData()):this.$message({showClose:!0,duration:2e3,type:"success",message:this.$translateTitle("迁移成功")})})}))).catch(e=>{dgiotlog.log(e)}),dgiotlog.log(e.name)},timestampToTime(e){const t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",l=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",o=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",r=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",s=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return e?a+i+l+o+r+s:""},handleClose(){this.coordinate={lng:116.404,lat:39.915},this.dialog_device=!1,this.commandInfo.dialog=!1,this.fetchData(!1)},onCloseDialog(e){this.$refs[e].resetFields(),this.$refs[e].clearValidate(),this.createDeviceDialog=!1},getItems(e,t,a){let i=t[e.split(".")[1]];return i&&!_.isObject(i)?i:a[e]?(console.error("basicdata",a[e]),a[e]):void 0},handler({BMap:e,map:t}){this.map=t,console.log(this.map)},clickRow(e,t){const a={lng:Number(e.longitude),lat:Number(e.latitude)};this.mapLabel={content:t,style:{color:"red",fontSize:"24px"},position:a,title:t},this.bmLabel=!0,console.log(this.mapLabel),this.dialog_device=!0},onSubmit(e){this.$refs[e].validate(e=>w(this,null,(function*(){if(!e)return console.log("error submit!!"),!1;{let e=this.deviceForm;e.detail[this.deviceForm.devaddr]=this.deviceForm.detail.expirationTime,e.detail.assetNum=this.deviceForm.detail.assetNum,yield this.doPostDevice(e)}})))},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>w(this,null,(function*(){yield Object(d["delDevice"])(e.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),yield this.fetchData()})))},info(e){return w(this,null,(function*(){localStorage.setItem("parse_objectid",e.objectId),localStorage.setItem("product_objectid",e.product.objectId);const{results:t=[]}=yield Object(c["queryView"])({where:{class:"Product",type:"deviceInfo",key:e.product.objectId}});if(_.isEmpty(t))return this.$baseMessage("暂未配置下发控制表单","info","dgiot-hey-message-error"),!1;this.commandInfo.dialog=!0,this.commandInfo.data=t}))},command(e){return w(this,null,(function*(){localStorage.setItem("parse_objectid",e.objectId),localStorage.setItem("product_objectid",e.product.objectId);const{results:t=[]}=yield Object(c["queryView"])({where:{class:"Product",type:{$in:["amis","profile","content"]},key:e.product.objectId}});if(_.isEmpty(t))return this.$baseMessage("暂未配置下发控制表单","info","dgiot-hey-message-error"),!1;this.commandInfo.dialog=!0,this.commandInfo.data=t}))},setting(e){this.settingInfo.dialog=!0,console.log(e)},closeModal(){return w(this,null,(function*(){this.$router.go(-1),this.topoFlag=!1}))},konvaDevice(e){this.topoFlag=!0,this.$router.push({path:"/dashboard/device",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})},move(e){if(console.log(e),this.deviceInfo=e,e.ACL)for(var t in e.ACL)this.deciceCompany=t.substr(5);else this.deciceCompany="";this.popoverVisible=!this.popoverVisible},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=20,this.fetchData()},fetchData(e=!0){return w(this,null,(function*(){console.log(this.queryForm.type,this.queryForm);let t={skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",excludeKeys:"properties",where:{}};this.queryForm.type&&(t.where[this.queryForm.type]=this.queryForm.search.length?{$regex:this.queryForm.search}:t.where={}),console.info(t),this.listLoading=e;const{results:a,count:i}=yield Object(d["querycompanyDevice"])(t);a.forEach(e=>{_.isEmpty(e.detail)&&(e.detail={}),_.isEmpty(e.content)&&(e.content={}),_.isEmpty(e.profile)&&(e.profile={})}),this.list=a,this.total=i,this.listLoading=!1,yield this.subAllDevice()}))},subAllDevice(){return w(this,null,(function*(){let e=this;e.$dgiotBus.$on("$dg/user/devicestate",t=>{let a={};const i=JSON.parse(t.payloadString);if(i){const t=Object.keys(i);console.groupCollapsed("%c收到devicestate消息 "+t,"color:#009a61; font-size: 28px; font-weight: 300"),a.key=t,console.log(i),a.parseString=i,e.list.forEach(l=>{t.forEach(t=>{if(l.objectId==t){const o=_.merge(l,i[t],{detail:{address:i[t].address}});console.log("更新设备"+l.name),a.name=l.name,console.log(o,i[t]),a.Info=i[t],a.mergeInfo=o,e.upkey=moment(new Date).valueOf()+""}})})}console.info(a),console.groupEnd()})}))}})},$=T,k=(a("8300"),a("08c8"),a("2877")),x=Object(k["a"])($,i,l,!1,null,"7216d0ee",null);t["default"]=x.exports},e160:function(e,t,a){},e3ac:function(e,t,a){},ed75:function(e,t,a){"use strict";a.r(t);var i,l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"equipment"},[t("div",{staticClass:"equ_header"},[t("ul",[t("li",[t("p",[t("span",{staticClass:"svg-container"},[t("dgiot-icon",{attrs:{icon:"device-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.totalequipment"))+" "),t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalequipment"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1),t("span",[e._v(e._s(e.devicetotal))])]),t("li",[t("p",[t("span",{staticClass:"svg-container"},[t("dgiot-icon",{attrs:{icon:"numbers-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.activationdevice"))+" "),t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalactive"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1),t("span",[e._v(e._s(e.activeall))])]),t("li",[t("p",[t("span",{staticClass:"svg-container"},[t("dgiot-icon",{attrs:{icon:"contrast-drop-fill"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.onlinedevices"))+" "),t("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalonline"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1),t("span",[e._v(e._s(e.onlineall))])]),t("li",[t("div",{staticClass:"block"},[e.productimg?t("el-image",{staticStyle:{position:"relative",top:"-55px",width:"250px",height:"200px","line-height":"200px","text-align":"center"},attrs:{src:e.productimg}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1)])])]),t("div",{staticClass:"equtabs"},[t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("route.设备管理"),name:"first"}},[t("div",[t("div",[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1)]),t("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[t("el-select",{staticClass:"selectdetail",attrs:{size:"small"},model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[t("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),t("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),e.selectdevice==e.$translateTitle("equipment.devicename")?t("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterproductname"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}):t("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}),t("el-button",{staticClass:"selectdetail",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),t("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),t("div",{staticClass:"tabstable"},[t("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber")+"/"+e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.name))]),t("p",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(a.devaddr)+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return["ONLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==a.status?t("el-tooltip",{attrs:{content:"设备已经上线",placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==a.status?t("span",{class:a.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==a.status?t("el-tooltip",{attrs:{content:"设备已经离线",placement:"top"}},[t("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=a.status&&"ONLINE"!=a.status?t("span",{class:a.status},[e._v(" 未注册 ")]):e._e()]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.product.name))])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.nodetype"),prop:"product.nodeType","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function({row:e}){return[t("dgiot-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{icon:0==e.nodeType?"hotel-bed-fill":"hotel-fill"}})]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"enable","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,i)}},model:{value:a.isEnable,callback:function(t){e.$set(a,"isEnable",t)},expression:"row.isEnable"}})]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.editorDevice(a)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.makeSure(a,i)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])]}}])})],1),t("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[t("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.devicelength,"page-sizes":[10,20,30,50],total:e.devicetotal},on:{"current-change":e.deviceCurrentChange,"size-change":e.deviceSizeChange}})],1)],1)]),t("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.batchmanagement"),name:"second"}},[t("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData}},[t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"200"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.data.batch_name))])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(a,a.objectId)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(a.objectId)}}},[e._v(" 删除 ")]),t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(a,a.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:"设备"+e.equipmentEditor,visible:e.devicedialogVisible,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[t("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[t("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),t("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1)]),t("div",{staticClass:"devicecontent"},[t("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[t("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[t("el-input",{model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"batchId"}},[t("el-input",{attrs:{disabled:""},model:{value:e.deviceform.batchId,callback:function(t){e.$set(e.deviceform,"batchId",t)},expression:"deviceform.batchId"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"suffix"},on:{click:e.addDeviceBatch},slot:"suffix"})])],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[t("el-input",{attrs:{readonly:""},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[t("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[t("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[t("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[t("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[t("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),t("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose1,"close-on-click-modal":!1,title:"批次添加",visible:e.pcdialogVisible,width:"50%"},on:{"update:visible":function(t){e.pcdialogVisible=t}}},[t("div",{staticClass:"pccontent"},[t("el-form",{ref:"pcformInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.pcformInline,rules:e.pcformrule}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"pcname"}},[t("el-input",{attrs:{placeholder:e.$translateTitle("equipment.batchname"),width:"100%"},model:{value:e.pcformInline.pcname,callback:function(t){e.$set(e.pcformInline,"pcname",t)},expression:"pcformInline.pcname"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.createdAt"),prop:"createdtime"}},[t("el-date-picker",{attrs:{type:"datetime",width:"100%"},model:{value:e.pcformInline.createdtime,callback:function(t){e.$set(e.pcformInline,"createdtime",t)},expression:"pcformInline.createdtime"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addbatch("pcformInline")}}},[e._v(" "+e._s(e.$translateTitle("equipment.addbatch"))+" ")])],1)],1),t("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData,height:"450"}},[t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"50"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.data.batch_name))])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(a,a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(a,a.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)]),t("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:"设备安装地址",visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[t("div",[t("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[t("el-form-item",{attrs:{label:"地址名称"}},[t("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),t("el-form-item",{attrs:{label:"选中地址"}},[t("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),t("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[t("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),t("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" 保 存 ")]),t("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v("取 消")])],1)])],1)])},o=[],r=a("4be7"),s=a("dcc6"),n=a("e0e9"),c=a("5880"),d=a("cb88"),u=a("7212"),p=a("926a"),m=a("14ba"),h=Object.defineProperty,v=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,g=(e,t,a)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&g(e,a,t[a]);if(v)for(var a of v(t))b.call(t,a)&&g(e,a,t[a]);return e},_=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())}),w={components:{BmNavigation:d["BmNavigation"],BaiduMap:d["BaiduMap"],BmLocalSearch:d["BmLocalSearch"],BmGeolocation:d["BmGeolocation"],BmCityList:d["BmCityList"]},data(){const e=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("安装位置不能为空")):i.test(t)?a():a(new Error("安装位置必须为大小写字母数字"))};return{secret:m["secret"],productimg:"",bmapdialogVisible:!1,onlineall:"",activeall:"",userId:"",batchid:"",pcdialogVisible:!1,devicedialogVisible:!1,equvalue:"0",cities:[],activeName:"first",selectdevice:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:"09"},yysSelect:[],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},aclObj:{},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},productName:"",deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:y({},Object(c["mapGetters"])({_role:"acl/role"})),watch:{multipleTable(e){this.selectRow=[],e.length>0&&e.forEach((e,t)=>{this.selectRow.push(this.tableData.indexOf(e))})}},mounted(){this.getDevices(0),this.addDeviceBatch(0),this.queryYysId(),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.searchProduct(this.equvalue)),this.aclObj=this.$aclObj(this._role)},methods:{queryYysId(){return _(this,null,(function*(){const e={order:"-createdAt",limit:100,skip:0,where:{type:"b83b5d9fc0"}};Object(n["queryDict"])(e).then(e=>{this.yysSelect=[{name:"空",key:""}],e.results.map(e=>{this.yysSelect.push(e.data)})})}))},rolesSelect(e){this.productroleslist=[],this.$queryProduct({}).then(e=>{if(e)for(var t in e.results[0].ACL)t.includes("role")&&this.productroleslist.push(t.substr(5))},e=>{Object(p["returnLogin"])(e)})},goEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:a}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i=`${t}/#?devaddr=${e.devaddr}&proudctid=${e.productid}`;window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler({BMap:e,map:t}){this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick(e){this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.bmapform.address=e.address,this.deviceform.address=e.address})},updateLocation(){this.bmapdialogVisible=!0},handleClosebmap(){this.bmapdialogVisible=!1},getOnlineDevices(){return _(this,null,(function*(){var e={where:{status:"ONLINE"}};""!=this.deviceinput&&("设备名称"==this.selectdevice?e.where.name=this.deviceinput:e.where.devaddr=this.deviceinput),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&(e.where.product=this.equvalue);var t=yield this.$queryDevice(e);this.onlineall=t.results.length}))},getActiveDevices(){return _(this,null,(function*(){var e={where:{status:"ACTIVE"}};""!=this.deviceinput&&("设备名称"==this.selectdevice||"Device Name"==this.selectdevice?e.where.name=this.deviceinput:e.where.devaddr=this.deviceinput),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&(e.where.product=this.equvalue);var t=yield this.$queryDevice(e);this.activeall=t.results.length}))},searchProduct(){return _(this,null,(function*(){Object(u["getProduct"])(this.equvalue).then(e=>{this.deviceform.productName=e.name,this.productName=e.name})}))},getDevices(e){return _(this,null,(function*(){0===e&&(this.devicestart=0),this.tableData=[];var t={order:"-updatedAt",limit:this.devicelength,skip:this.devicestart,count:"objectId",include:"product",where:{product:this.$route.query.productid}};""!=this.deviceinput&&("设备名称"==this.selectdevice?params.where.name=this.deviceinput:params.where.devaddr=this.deviceinput),""!=this.devicenumber&&(params.where.devaddr=this.devicenumber);const a=yield this.$queryDevice(t);this.devicetotal=a.count,this.tableData=a.results,this.getActiveDevices(),this.getOnlineDevices()}))},handelUpdate(e,t,a){dgiotlog.log("row",t);var i={};for(var l in t)i[l]=t[l];i.isEnable=1!=i.isEnable,this.tableData[a]=i,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var i={isEnable:e.isEnable};dgiotlog.log("row",t),this.$putDevice(t.objectId,i).then(e=>{e.error?this.initQuery("状态修改失败","error"):(this.initQuery("状态修改成功","success"),this.getDevices())})}).catch(()=>{this.$message({type:"info",message:"已取消修改",showClose:!0,duration:2e3});const e=t;e.isEnable=1!=e.isEnable,this.tableData[a]=e})},timestampToTime(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",l=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",o=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",r=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",s=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+l+o+r+s},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag(e,t){return t.tag===e},handleSelectionChange(e){this.multipleTable=e,dgiotlog.log(this.multipleTable)},deleteDevcie(e){return _(this,null,(function*(){const e=[];this.multipleTable.map(t=>{e.push(t.id)}),yield Object(s["Batchdelete"])("_Device",e,{}).then(t=>{t.error?this.initQuery(`设备${e}删除失败`,"error"):this.initQuery(`设备${e}删除成功`,"success")})}))},unactiveDevice(e){return _(this,null,(function*(){const t=[];this.multipleTable.map(e=>{t.push(e.id)});const a={isEnable:e};yield Object(s["Batchdelete"])("_Device",t,a).then(a=>{a.error?e?this.initQuery(`设备${t}启动失败`,"error"):this.initQuery(`设备${t}禁用失败`,"error"):e?this.initQuery(`设备${t}启动成功`,"success"):this.initQuery(`设备${t}禁用成功`,"success")})}))},rowClass({row:e,rowIndex:t}){if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},initQuery(e,t){this.$message({type:t||"info",message:e,showClose:!0,duration:2e3})},deviceSizeChange(e){this.devicelength=e,this.getDevices()},deviceCurrentChange(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:""},this.$refs["deviceform"].resetFields(),this.deviceform.productName=this.productName,this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm(){this.deviceid="",this.devicedialogVisible=!0,this.equipmentEditor="添加"},handleClose1(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure(e,t){this.$deleteDevice(e.objectId).then(e=>{e.error?this.initQuery("删除失败","error"):(this.initQuery("删除成功","success"),this.tableData.splice(t,1))})},addDeviceBatch(e){return _(this,null,(function*(){this.pcdialogVisible=0!=e;const{results:t}=yield Object(n["getBatchNumer"])();this.pctableData=t.filter(e=>e.data.batch_name)}))},editorDevice(e){dgiotlog.log("row",e),this.deviceid=e.objectId,this.devicedialogVisible=!0,this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:void 0==e.detail?"":e.detail.assetNum,devModel:void 0==e.detail?"":e.detail.devModel,desc:void 0==e.detail?"":e.detail.desc,productid:e.product.objectId,brand:void 0==e.detail?"":e.detail.brand,productName:e.product.name,status:e.status,isEnable:e.isEnable,address:void 0==e.detail?"":e.detail.address,auth:e.basedata&&e.basedata.auth?e.basedata.auth:"",yysId:e.basedata&&e.basedata.yysId?e.basedata.yysId:""},this.bmapform.address=e.address,this.batchid=e.detail.batchid,this.center.lat=e.latitude,this.center.lng=e.longitude,this.addresspointer=e.latitude+","+e.longitude,this.tagsid=e.tagid,this.equipmentEditor="编辑",this.rolesSelect(e.productid)},getBatch(){return new r["Promise"]((e,t)=>{i.length>0?e(i):t(!1)})},submitForm(e){var t={devaddr:this.deviceform.devaddr,name:this.deviceform.name};this.$refs[e].validate(e=>{if(e)if(""!=this.deviceid){var a={where:{devaddr:this.deviceform.devaddr}};this.$queryDevice(a).then(e=>{if(0==e.results.length){var i={ACL:this.aclObj,detail:{assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.deviceform.address,desc:this.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:this.$route.query.productid},basedata:{auth:this.deviceform.auth,yysId:this.deviceform.yysId}};a=Object.assign(t,i),this.$putDevice(this.deviceid,a).then(e=>{e.error?this.initQuery("修改失败","error"):(this.initQuery("修改成功","success"),this.devicedialogVisible=!1,this.getDevices(),this.deviceform={},this.deviceform.productName=this.productName)})}else this.initQuery("设备已经存在","error")})}else{a={where:{devaddr:this.deviceform.devaddr}};this.$queryDevice(a).then(e=>{if(0==e.results.length){var i={ACL:this.aclObj,detail:{assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.deviceform.address,desc:this.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:this.$route.query.productid},basedata:{auth:this.deviceform.auth,yysId:this.deviceform.yysId}};a=Object.assign(t,i),this.$postDevice(a).then(e=>{e.error?this.initQuery("创建失败","error"):(this.initQuery("创建成功","success"),this.devicedialogVisible=!1,this.getDevices(),this.deviceform={},this.deviceform.productName=this.productName)})}else this.initQuery("设备已经存在","error")})}else this.$message("必填项未填")})},addbatch(e){return _(this,null,(function*(){this.$refs[e].validate(t=>{if(!t)return dgiotlog.log("error submit!!"),!1;if(""===this.batchid){const t={data:{batch_name:this.pcformInline.pcname,createdtime:Math.ceil(this.pcformInline.createdtime/1e3)},ACL:this.aclObj,key:this.pcformInline.pcname,type:"batch_number"};this.$postDict(t).then(t=>{t.error?this.$message({message:"新增失败"+t.error,showClose:!0,duration:2e3,type:"error"}):(this.$message({message:"新增成功",showClose:!0,duration:2e3,type:"success"}),this.$refs[e].resetFields(),this.addDeviceBatch())})}else{const t={objectId:this.batchid,data:{batch_name:this.pcformInline.pcname,createdtime:Math.ceil(this.pcformInline.createdtime/1e3)},ACL:this.aclObj,type:"batch_number"};this.$putDict(t.objectId,t).then(t=>{t.error?this.initQuery("修改失败","error"):(this.initQuery("修改成功","success"),this.batchid="",this.pcformInline={pcname:"",createdtime:""},this.$refs[e].resetFields(),this.addDeviceBatch())})}})}))},updatebatch(e,t){this.pcformInline.pcname=e.data.batch_name,this.pcformInline.createdtime=1e3*e.data.createdtime,this.batchid=t},deletebatch(e){return _(this,null,(function*(){try{const t=yield Object(n["delDict"])(e);dgiotlog.log(t),this.queryDict(),this.addDeviceBatch()}catch(error){dgiotlog.log(error),this.$baseMessage(error,"error","dgiot-hey-message-error")}}))},selectbatch(e,t){this.batchid=t,this.deviceform.pc=e.data.batch_name,this.deviceform.batchId=e.data.batch_name,this.pcdialogVisible=!1,dgiotlog.log(this.batchid,"this.batchid ")},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},handleClick(e,t){"second"==e.name&&this.queryDict()},queryDict(){return _(this,null,(function*(){const{results:e}=yield this.$getBatchNumer();this.pctableData=e.filter(e=>e.data.batch_name)}))},deviceToChildren(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"true"}})}}},T=w,$=(a("0736"),a("6c0f"),a("2877")),k=Object($["a"])(T,l,o,!1,null,"5cec037a",null);t["default"]=k.exports},ed9a:function(e,t,a){"use strict";a("1d48")},edb3:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"devproduct"},[t("h3",[e._v(" "+e._s(e.$translateTitle("route.产品管理"))+" "),e.projectName?t("span",[e._v(e._s("(所属应用:"+e.projectName+")"))]):e._e()]),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("product.myproduct")+"("+e.total+")",name:"first"}},[t("div",{staticClass:"prosecond"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[t("el-form-item",[t("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),t("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.goTopoview.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.topoview"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.exportpro.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.importDialogShow=!0}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),t("div",{staticClass:"protable"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.proTableData}},[t("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),t("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.name))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.devType))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[0==a.nodeType?t("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):t("span",[e._v(e._s(e.$translateTitle("product.gateway")))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.CategoryKey))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(e.utc2beijing(a.createdAt)))])]}}])}),t("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"320"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:i}){return[t("el-link",{attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(a)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),t("el-popover",{ref:"popover-"+i,attrs:{placement:"top",width:"300"}},[t("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(a.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),t("div",{staticStyle:{margin:"0","text-align":"right"}},[t("el-button",{attrs:{size:"mini"},on:{click:function(e){a._self.$refs["popover-"+i].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(e.scope,i)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),t("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),t("el-link",{attrs:{icon:"el-icon-attract",type:"primary",underline:!1},on:{click:function(t){return e.GoTodevices(a)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),t("el-link",{attrs:{icon:"el-icon-edit",type:"success",underline:!1},on:{click:function(t){return e.editorProduct(a)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),t("el-link",{attrs:{icon:"el-icon-s-promotion",type:"primary",underline:!1},on:{click:function(t){return e.proudctView(a)}}},[e._v(" "+e._s(e.$translateTitle("product.monitorconfiguration"))+" ")])]}}])})],1)],1),t("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[t("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1)])],1),t("div",{staticClass:"prodialog"},[t("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("div",{staticClass:"content"},[t("div",{staticClass:"contentone"},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[t("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:e.$translateTitle("product.pleaseselectyourapp"),trigger:"blur"}]}},[t("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,a){return t("el-option",{key:a,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),t("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[t("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[t("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),t("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")])],1)],1)],1)],1),t("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[t("div",{staticStyle:{display:"flex"}},[t("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),t("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[t("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,a){return t("el-option",{key:a,attrs:{label:a+1+":"+e.label,title:"当前第"+(a+1)+"项",value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.productmodel")}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):t("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),t("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[t("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?t("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),t("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),t("div",{staticClass:"import-dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[t("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[t("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),t("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)],1)},l=[],o=a("e0e9"),r=a("58dd"),s=a("1285"),n=a("7212"),c=a("926a"),d=a("d0fdb"),u=a("be65"),p=a.n(u),m=a("5da9"),h=(e,t,a)=>new Promise((i,l)=>{var o=e=>{try{s(a.next(e))}catch(t){l(t)}},r=e=>{try{s(a.throw(e))}catch(t){l(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,t)).next())});const v=a("f43e").Base64;var f={data(){return{length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:p.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted(){this.Industry(),this.searchProduct(0)},beforeDestroy(){this.projectName=""},methods:{changeNode(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},getRoles(){return h(this,null,(function*(){return yield Object(r["app_count"])({where:{}})}))},selectApp(e){e&&Object(m["getServer"])(e).then(e=>{e&&(this.fileServer=e.file,this.access_token=e.access_token)})},treeData(e){const t=JSON.parse(JSON.stringify(e));return t.filter(e=>{const a=t.filter(t=>e.id==t.parentid);return a.length>0&&(e.children=a),0==e.parentid})},deleteImgsrc(){event.stopPropagation(),this.imageUrl=""},upload(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,l=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!l)return this.$message({showClose:!0,duration:2e3,message:"请上传图片",type:"error"}),!1;var o=new FileReader;o.readAsDataURL(t);var r=this;o.onloadend=function(){var e=o.result,t=r.dataURItoBlob(e);r.uploadFile(t,a)}}},dataURItoBlob(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),l=new Uint8Array(i),o=0;o<t.length;o++)l[o]=t.charCodeAt(o);return new Blob([i],{type:a})},uploadFile(e,t){var a=new FormData;a.append("file",e,t),a.append("output","json"),a.append("path",this.form.relationApp),a.append("auth_token",this.access_token);this.$http.post(this.fileServer,a).then(e=>{e&&(this.imageUrl=e.body.url,this.loading=!1)}).catch(e=>{this.loading=!1,this.$message(e.bodyText)})},submitUpload(){this.uploadAction="/product",this.$nextTick(()=>{this.uploadData.appid=p.a.get("appids"),this.$refs.fileUpload.submit()})},handleUploadSuccess(e,t,a){dgiotlog.log("### Success response",e),this.$message({showClose:!0,duration:2e3,type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError(e,t,a){this.$message({showClose:!0,duration:2e3,showClose:!0,message:e})},handleChange(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict(e,t){return h(this,null,(function*(){const{results:a}=yield this.$query_object("Dict",{limit:1e3,where:{type:{$in:t}}});dgiotlog.log(a,"resresres"),this.allTableDate=a,e.map(e=>{a.map(t=>{e.category==t.type&&(e.CategoryKey=t.data.CategoryName)})}),this.proTableData=e}))},searchProduct(e){return h(this,null,(function*(){0==e&&(this.start=0);var t=[],a={order:"-updatedAt",skip:this.start,limit:this.length,count:1,where:{devType:{$ne:"report"}}};""!=this.formInline.productname&&(a.where.name=this.formInline.productname);const{results:i,count:l}=yield Object(n["queryProduct"])(a);i.map((e,a)=>{""!=e.category&&e.category&&t.push(e.category)}),this.getDict(i,t),this.total=l,this.getRoles().then(e=>{this.allApps=e.results}).catch(e=>{Object(c["returnLogin"])(e)})}))},handleClose(){this.dialogFormVisible=!1},addproduct(){dgiotlog.log(new Date),this.dialogFormVisible=!0},getParent(e,t,a){return t.map(i=>{e==i.id?(a.unshift(i.value),this.getParent(i.parentid,t,a)):0==i.parentid&&i.id==e&&a.unshift(i.value)}),this.form.category=a,a},getIndustryParent(e,t){t.map(a=>{a.value==e&&this.getParent(a.id,t,[])})},editorProduct(e){for(var t in dgiotlog.log("row",e),this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.objectId,this.getIndustryParent(e.category,this.categoryList),this.form.desc=e.desc,this.form.name=e.name,this.form.nodeType=e.nodeType,this.form.netType=e.netType,this.form.devType=e.devType,this.form.productSecret=e.productSecret,this.changeNode(e.nodeType,0),e.icon&&(this.imageUrl=e.icon),e.ACL)dgiotlog.log(t),this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry(){return h(this,null,(function*(){this.categoryList=[];const e={limit:1e3,where:{"data.key":"category"}},{results:t}=yield Object(o["queryDict"])(e);t.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.categoryList.push(t)}),this.categoryListOptions=this.treeData(this.categoryList)}))},addProduct(){this.$message("新增产品")},editProduct(e){return h(this,null,(function*(){const t={productSecret:this.form.productSecret,nodeType:this.form.nodeType,netType:this.form.netType,dynamicReg:!1,category:this.form.category[this.form.category.length-1],icon:this.imageUrl,name:this.form.name,devType:this.form.devType,desc:this.form.desc,topics:{}},a=yield Object(n["putProduct"])(e,t);a&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),this.dialogFormVisible=!1,this.$refs["ruleForm"].resetFields(),this.searchProduct(),this.productid="")}))},submitForm(e){this.$Cookies.get("userId");this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;var t=Math.ceil(25*Math.random());v.encode(String.fromCharCode(65+t)+Math.ceil(1e7*Math.random())+Number(new Date));""==this.productid?this.addProduct():this.editProduct(this.productid)})},resetProductForm(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure(e,t){const a={count:"objectId",skip:0,limit:1,where:{product:row.objectId}};Object(s["queryDevice"])(a,t).then(a=>{a.count>0?this.$message("请先删除该产品下设备"):Object(n["getProduct"])(row.objectId).then(a=>{dgiotlog.log(a),Object(n["delProduct"])(row.objectId).then(a=>{a&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),e._self.$refs["popover-"+t].doClose(),this.searchProduct())}).catch(e=>{dgiotlog.log("delProduct ",e.error)})}).catch(e=>{dgiotlog.log("getProduct ",e.error)})}).catch(e=>{dgiotlog.log("queryDevice ",e.error)})},productSizeChange(e){this.length=e,this.searchProduct()},productCurrentChange(e){this.start=(e-1)*this.length,this.searchProduct()},proudctView(e){var t=window.location.origin+"/spa";const{NODE_ENV:a}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i=`${t}/#/views/${e.objectId}`;window.open(i,"__blank")},goTopoview(){var e=window.location.origin+"/spa";const{NODE_ENV:t}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"h7ml",VUE_APP_UPDATE_TIME:"2022年07月01日19时10分34秒",VUE_APP_VERSION:"4.5.4",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a=e+"/#/view";window.open(a,"__blank")},exportpro(){this.allTableDate?Object(d["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({showClose:!0,duration:2e3,type:"warning",message:"数据为空,无法导出"})}}},b=f,g=(a("974c"),a("775d"),a("2877")),y=Object(g["a"])(b,i,l,!1,null,"526a82a4",null);t["default"]=y.exports},f600:function(e,t,a){}}]);