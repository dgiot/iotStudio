/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年09月09日11时50分37秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-777c1ade"],{"009f":function(e,t,a){"use strict";a("974c")},"0670":function(e,t,a){"use strict";a("219c")},"0b06":function(e,t,a){"use strict";a("8db0")},"12fb":function(e,t,a){},1837:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"pressure-table",staticClass:"pressure-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("div",{staticClass:"modal"},[t("Drawer",{attrs:{width:"60%"},model:{value:e.Drawer,callback:function(t){e.Drawer=t},expression:"Drawer"}},[t("Tabs",{attrs:{size:"small",value:e.defaultTable}},e._l(e.draw.settings.data,(function(e,a){return t("TabPane",{key:a,attrs:{label:e.title,name:e.title}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1),t("Drawer",{attrs:{styles:e.styles,width:"80%"},model:{value:e.report,callback:function(t){e.report=t},expression:"report"}},[t("el-table",{attrs:{border:e.border,data:e.details.basedata.docxInfo,size:e.lineHeight,stripe:e.stripe}},[t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.生成时间"),prop:"unixtimestamp","show-overflow-tooltip":"",sortable:"",width:"200"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.文件地址"),prop:"docxUrl","show-overflow-tooltip":"",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("pressure.报告操作"),width:"320"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:r}){return[t("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.preview(a.docxUrl)}}},[e._v(" "+e._s(e.$translateTitle("pressure.预览"))+" ")]),t("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.download(a)}}},[e._v(" "+e._s(e.$translateTitle("pressure.下载"))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},nativeOn:{click:function(t){return e.delete_item(a,r,e.details.basedata.docxInfo)}}},[e._v(" "+e._s(e.$translateTitle("pressure.删除"))+" ")])]}}])})],1)],1),t("el-dialog",{staticClass:"map_dialog",attrs:{"append-to-body":"","before-close":e.closeMap,title:e.$translateTitle("pressure.安装位置"),visible:e.dialog_device,width:"60%"},on:{"update:visible":function(t){e.dialog_device=t}}},[t("el-card",[e._e(),t("label",[e._v(" "+e._s(e.$translateTitle("pressure.关键词"))+" "),t("el-input",{model:{value:e.map.keyword,callback:function(t){e.$set(e.map,"keyword",t)},expression:"map.keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),t("label",[e._v(" "+e._s(e.$translateTitle("pressure.安装位置"))+" "),t("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[t("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.map.innerVisible=!e.map.innerVisible}},slot:"suffix"})])],1),t("baidu-map",{staticStyle:{height:"500px"},style:{height:e.mapHeight,width:e.mapWidth},attrs:{ak:e.$dgiot.secret.baidu.map,center:e.mapLabel.position,"map-click":!1,"scroll-wheel-zoom":!0,zoom:14},on:{click:e.mapClick}},[t("bm-circle",{attrs:{center:e.mapLabel.position,editing:!0,radius:"1200","stroke-color":"blue","stroke-opacity":.5,"stroke-weight":1}}),t("bm-view",{staticClass:"map",style:{height:e.mapHeight,width:e.mapWidth}}),t("bm-local-search",{attrs:{"auto-viewport":!0,keyword:e.map.keyword,location:e.map.location}}),t("bm-control",[t("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:500,height:0}}}),t("bm-overview-map",{attrs:{"is-open":!0}}),t("bm-scale",{attrs:{offset:{width:260,height:0}}}),t("bm-city-list",{attrs:{offset:{width:330,height:0}}}),t("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],offset:{width:400,height:0}}})],1),t("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0,"show-zoom-info":!0}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialog_device=!1}}},[e._v(" "+e._s(e.$translateTitle("pressure.取消"))+" ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.editMap}},[e._v(" "+e._s(e.$translateTitle("pressure.确定"))+" ")])],1)],1),t("Modal",{attrs:{closable:!0,fullscreen:"",title:e.draw.row.name},on:{"on-cancel":e.beforeClose},model:{value:e.draw.settings.visibility,callback:function(t){e.$set(e.draw.settings,"visibility",t)},expression:"draw.settings.visibility"}},[t("div",[t("Tabs",{attrs:{size:"small",value:e.defaultTable}},e._l(e.draw.settings.data,(function(e,a){return t("TabPane",{key:a,attrs:{label:e.title,name:e.title}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"})])],1),t("div",{staticClass:"draw"},[t("a-drawer",{attrs:{"body-style":{paddingBottom:"80px"},title:"",visible:e.draw.form.visibility,width:720},on:{close:e.onClose}},[t("Tabs",{attrs:{size:"small",value:e.defaultTable}},e._l(e.draw.settings.data,(function(e,a){return t("TabPane",{key:a+"",attrs:{label:e.title,name:e.title}},[t("dgiot-amis",{attrs:{schema:e.data,"show-help":!1}})],1)})),1)],1)],1),t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:e.$translateTitle("pressure.请输入压测任务名")},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" "+e._s(e.$translateTitle("concentrator.search"))+" ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.handleView("_","reportFrom")}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.add"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:"table1",ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.$baseTableHeight(0),size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",sortable:"",width:"145"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),e._l(e.finallyColumns,(function(a,r){return t("el-table-column",{key:r,attrs:{align:"center",label:a.label,sortable:"",width:a.width},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[a.label===e.$translateTitle("pressure.评级")?t("span",[t("el-rate",{attrs:{disabled:""},model:{value:r.rate,callback:function(t){e.$set(r,"rate",t)},expression:"row.rate"}})],1):t("span",[e._v(e._s(r[a.prop]))])]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.压测启停"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("a-switch",{attrs:{checked:a.isEnable,"checked-children":e.$translateTitle("device.start"),"un-checked-children":e.$translateTitle("device.stop")},on:{click:function(t){return e.toggleSwitch(a)}}})]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.压测状态"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-tag",{attrs:{dark:"",type:"ONLINE"==a.status?"info":""}},[e._v(" "+e._s("ONLINE"==a.status?e.$translateTitle("pressure.压测中"):e.$translateTitle("pressure.未压测"))+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.报告操作"),width:"320"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.busButton(a,"pressureconfig")}}},[e._v(" "+e._s(e.$translateTitle("pressure.报告配置"))+" ")]),t("el-button",{attrs:{disabled:!a.basedata.templateUrl,loading:a.loading,size:"mini",type:"success"},nativeOn:{click:function(t){return e.generateReport(a)}}},[e._v(" "+e._s(e.$translateTitle("pressure.生成报告"))+" ")]),t("el-button",{attrs:{disabled:!a.basedata.docxInfo.length,size:"mini",type:"info"},nativeOn:{click:function(t){return e.showDocxInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("pressure.报告信息"))+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("pressure.安装位置"),prop:"address","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{staticStyle:{color:"#67c23a"},attrs:{type:"success"},on:{click:function(t){return e.showAdddress(a)}}},[e._v(" "+e._s(a.address||"---")+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("pressure.操作"),width:"280"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleClick(a,"setting")}}},[e._v(" "+e._s(e.$translateTitle("pressure.定时任务"))+" ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleClick(a,"task")}}},[e._v(" "+e._s(e.$translateTitle("pressure.压测配置"))+" ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleClick(a,"clone")}}},[e._v(" "+e._s(e.$translateTitle("pressure.克隆任务"))+" ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleClick(a,"delete")}}},[e._v(" "+e._s(e.$translateTitle("pressure.删除任务"))+" ")])]}}])})],2),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},s=[],i=a("1285"),o=a("7212"),l=a("ef68"),n=a("3248"),c=a("8ba7"),u=a("5880"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),$={name:"PressureCloud",components:{TableEdit:n["default"]},props:{},data(){return{report:!1,styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"},Drawer:!1,mapHeight:"500px",mapWidth:"100%",dialog_device:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},editRow:{},map:{innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},taskData:{},product:"",form:{address:"",name:"",url:"",owner:"",type:"",approver:"",dateTime:"",description:""},rules:{name:[{required:!0,message:"Please enter user name"}],url:[{required:!0,message:"please enter url"}],owner:[{required:!0,message:"Please select an owner"}],type:[{required:!0,message:"Please choose the type"}],approver:[{required:!0,message:"Please choose the approver"}],dateTime:[{required:!0,message:"Please choose the dateTime",type:"object"}],description:[{required:!0,message:"Please enter url description"}]},defaultTable:"",draw:{row:{},settings:{data:[],visibility:!1},form:{visibility:!1}},activeKey:"task",infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(1),stripe:!0,lineHeight:"medium",checkList:[this.$translateTitle("pressure.压测任务"),this.$translateTitle("pressure.开始时间"),this.$translateTitle("pressure.结束时间"),this.$translateTitle("pressure.压测任务状态")],columns:[{label:this.$translateTitle("pressure.压测任务"),width:"auto",prop:"name",sortable:!0,disableCheck:!0},{label:this.$translateTitle("pressure.开始时间"),width:"200",prop:"startTime",sortable:!0},{label:this.$translateTitle("pressure.结束时间"),width:"200",prop:"endTime",sortable:!0}],list:[],details:{basedata:{docxInfo:[]}},listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:10,name:"",search:"",type:"name"}}},computed:v(y({},Object(u["mapGetters"])({language:"settings/language",usertoken:"user/token"})),{finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}}),watch:{language:{handler(e){this.translateTbale(e)},immediate:!0}},created(){this.$nextTick(()=>{this.$refs.tableSort.doLayout()})},mounted(){return w(this,null,(function*(){yield this.setTreeFlag(!1),yield this.queryZetaProduct()}))},destroyed(){},methods:v(y({},Object(u["mapMutations"])({setTreeFlag:"settings/setTreeFlag"})),{beforeClose(){this.fetchData()},showDocxInfo(e){return w(this,null,(function*(){var t;const a=yield Object(i["getDevice"])(e.objectId),r=(null==(t=null==a?void 0:a.basedata)?void 0:t.docxInfo)?a.basedata.docxInfo:[];r.forEach(e=>{e.unixtimestamp=this.$moment.unix(e.timestamp).format("YYYY-MM-DD HH:mm:ss")}),this.details=a,this.report=!0}))},generateReport(e){return w(this,null,(function*(){e.loading=!0;const t={reportid:e.objectId,templateUrl:e.basedata.templateUrl,grafanaHost:location.hostname,parseHost:location.hostname};let a=20*Math.random()+30;yield axios.post("/grafana/generateReport",t,{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json",sessionToken:this.usertoken},withCredentials:!0});setTimeout(()=>w(this,null,(function*(){e.loading=!1,this.$baseMessage(this.$translateTitle("pressure.报告生成成功")),this.fetchData()})),1e3*a*10)}))},preview(e){return w(this,null,(function*(){const t=encodeURIComponent(Base64.encode(e)),a=`${location.protocol}//${location.hostname}/onlinePreview?url=${t}`;window.open(a,"_blank")}))},download(e){return w(this,null,(function*(){window.location=e.docxUrl}))},delete_item(e,t,a){return w(this,null,(function*(){a.splice(t,1),yield Object(i["putDevice"])(this.details.objectId,{basedata:this.details.basedata}),this.$baseMessage(this.$translateTitle("pressure.任务删除成功"),"success","dgiot-hey-message-success")}))},busButton(e,t){return w(this,null,(function*(){var a;this.Drawer=!this.Drawer,e.objectId?localStorage.setItem("parse_objectid",e.objectId):localStorage.removeItem("parse_objectid");let r={where:{class:"Product",type:t,language:this.language}};const{results:s=[]}=yield Object(c["queryView"])(r);if(_.isEmpty(s))return this.$message({type:"info",message:`${this.$translateTitle("pressure.暂未配置语言类型为")}${this.language}${this.$translateTitle("pressure.的")}${t}${this.$translateTitle("pressure.表单")}`,showClose:!0}),!1;this.draw.settings.data=s,this.defaultTable=(null==(a=null==s?void 0:s[0])?void 0:a.title)||"",this.Drawer=!0}))},close(e){return new Promise(e=>{this.$Modal.confirm({title:1==row.isEnable?this.$translateTitle("pressure.压测任务停止"):this.$translateTitle("pressure.压测任务启动"),content:this.$translateTitle("pressure.您确认要手动开始该压测任务吗")+"?",onOk:()=>{e(),row.isEnable=!row.isEnable,this.switchTask(row)}})})},showAdddress(e){var t,a;this.editRow=e,this.map.keyword=(null==e?void 0:e.address)?e.address:this.map.keyword,this.form.address=(null==e?void 0:e.address)?e.address:this.form.keyword;const r={lng:(null==(t=null==e?void 0:e.location)?void 0:t.longitude)?Number(e.location.longitude):120.161324,lat:(null==(a=null==e?void 0:e.location)?void 0:a.latitude)?Number(e.location.latitude):30.26244};this.mapLabel={content:e.name,style:{color:"red",fontSize:"12px"},position:r,title:e.address},this.bmLabel=!0,this.dialog_device=!0},translateTbale(e){this.checkList=[this.$translateTitle("pressure.压测任务"),this.$translateTitle("pressure.开始时间"),this.$translateTitle("pressure.结束时间"),this.$translateTitle("pressure.压测任务状态")],this.columns=[{label:this.$translateTitle("pressure.压测任务"),width:"auto",prop:"name",sortable:!0,disableCheck:!0},{label:this.$translateTitle("pressure.开始时间"),width:"200",prop:"startTime",sortable:!0},{label:this.$translateTitle("pressure.结束时间"),width:"200",prop:"endTime",sortable:!0}]},toggleSwitch(e){return new Promise(t=>{this.$Modal.confirm({title:1==e.isEnable?this.$translateTitle("pressure.压测任务停止"):this.$translateTitle("pressure.压测任务启动"),content:this.$translateTitle("pressure.您确认要手动开始该压测任务吗")+"?",onOk:()=>{t(),e.isEnable=!e.isEnable,this.switchTask(e)}})})},switchTask(e){return w(this,null,(function*(){yield Object(i["putDevice"])(e.objectId,{isEnable:e.isEnable});const t=!0!==e.isEnable?this.$translateTitle("pressure.压测任务已停止"):this.$translateTitle("pressure.压测任务已启动");this.$message({type:"success",message:t,showClose:!0})}))},queryZetaProduct(){return w(this,null,(function*(){var e,t,a,r;window._loading=this.$baseLoading(1);const{results:s=[]}=yield Object(l["queryProductTemplet"])({excludeKeys:"children,thing,decoder,topics,productSecret,view,category,producttemplet,content,profile",where:{name:"zeta压测报告"}}),{results:i=[]}=yield Object(o["queryProduct"])({excludeKeys:"channel,category,children,config,decoder,desc,producttemplet,topics,profile,content",where:(null==(e=null==s?void 0:s[0])?void 0:e.objectId)?{producttemplet:null==(t=null==s?void 0:s[0])?void 0:t.objectId}:{}});(null==(a=null==i?void 0:i[0])?void 0:a.objectId)&&(this.product=null==(r=null==i?void 0:i[0])?void 0:r.objectId,localStorage.setItem("product_objectid",this.product),this.fetchData())}))},handleView(e,t){return w(this,null,(function*(){var a;e.objectId?localStorage.setItem("parse_objectid",e.objectId):localStorage.removeItem("parse_objectid");let r={where:{class:"Product",type:t,language:this.language}};const{results:s=[]}=yield Object(c["queryView"])(r);if(_.isEmpty(s))return this.$message({type:"info",message:`${this.$translateTitle("pressure.暂未配置语言类型为")}${this.language}${this.$translateTitle("pressure.的")}${t}${this.$translateTitle("pressure.表单")}`,showClose:!0}),!1;this.draw.settings.data=s,this.defaultTable=(null==(a=null==s?void 0:s[0])?void 0:a.title)||"","_"===e?this.draw.form.visibility=!0:this.draw.settings.visibility=!0}))},mapClick(e){this.location={__type:"GeoPoint",latitude:e.point.lat,longitude:e.point.lng},this.mapLabel.position={lng:e.point.lng,lat:e.point.lat};const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.form.address=e.address}),this.editRow.objectId&&(this.editRow.location=this.location,this.editRow.address=this.form.address)},editMap(){return w(this,null,(function*(){const e={location:this.location,address:this.form.address};yield Object(i["putDevice"])(this.editRow.objectId,e),this.dialog_device=!1,this.$message({message:this.$translateTitle("pressure.设备位置更新成功"),showClose:!0,type:"success"})}))},closeMap(){this.dialog_device=!1,this.map={innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},this.mapLabel={content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"}},handleClone(e){return w(this,null,(function*(){this.$message({type:"success",message:this.$translateTitle("pressure.克隆任务成功"),showClose:!0}),delete e.createdAt,delete e.updatedAt,delete e.objectId,delete e.endTime,delete e.startTime,delete e.loading,e.isEnable=!1,e.devaddr=md5("Device"+Math.round(new Date)).substring(0,10),e.name="clone_"+e.name,yield Object(i["postDevice"])(e),yield this.fetchData()}))},onClose(){return w(this,null,(function*(){this.draw.form.visibility=!1,yield this.fetchData()}))},handleEdit(e){this.$refs["edit"].showEdit(e)},handleClick(e,t){return w(this,null,(function*(){switch(this.draw.row=e,localStorage.setItem("parse_objectid",e.objectId),t){case"setting":yield this.handleView(e,"profile");break;case"task":yield this.handleView(e,"content");break;case"clone":yield this.handleClone(this.draw.row);break;case"delete":this.handleDelete(e);break}}))},handleDelete(e){this.$baseConfirm(this.$translateTitle("pressure.你确定要删除当前项吗"),null,()=>w(this,null,(function*(){yield Object(i["delDevice"])(e.objectId),this.$baseMessage(this.$translateTitle("pressure.任务删除成功"),"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=10,this.fetchData()},fetchData(){return w(this,null,(function*(){this.listLoading=!0;let e={skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",where:{product:this.product}};this.queryForm.name&&(e.where.name={$regex:this.queryForm.name});const{count:t=0,results:a=[]}=yield Object(i["queryDevice"])(e);a.forEach(e=>{var t,a,r,s;e.loading=!1,!(null==e?void 0:e.basedata)&&(e.basedata={}),!(null==(t=null==e?void 0:e.basedata)?void 0:t.docxInfo)&&(e.basedata.docxInfo=[]),!(null==(a=null==e?void 0:e.basedata)?void 0:a.templateUrl)&&(e.basedata={templateUrl:"",docxInfo:[]}),e.startTime=(null==(r=null==e?void 0:e.profile)?void 0:r.startTime)?this.$moment.unix(e.profile.startTime).format("YYYY-MM-DD HH:mm:ss"):this.$translateTitle("pressure.暂未配置"),e.endTime=(null==(s=null==e?void 0:e.profile)?void 0:s.endTime)?this.$moment.unix(e.profile.endTime).format("YYYY-MM-DD HH:mm:ss"):this.$translateTitle("pressure.暂未配置")}),window._loading.close(),this.list=a,this.total=t,this.listLoading=!1}))}})},k=$,x=(a("0b06"),a("5cae"),a("2877")),T=Object(x["a"])(k,r,s,!1,null,"03302ff0",null);t["default"]=T.exports},1848:function(e,t,a){},18983:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"index-container"},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"单据编号"}},[t("el-input",{attrs:{placeholder:"请输入单据编号"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",{attrs:{label:"订单状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},on:{change:e.handleQuery},model:{value:e.queryForm.realstatus,callback:function(t){e.$set(e.queryForm,"realstatus",t)},expression:"queryForm.realstatus"}},e._l(e.statusList,(function(e){return t("el-option",{key:e.value+"j",attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows}},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"单据编号",prop:"name",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"单据类型",prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"单据日期",prop:"content.baseInfo.Document_date","show-overflow-tooltip":"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"物料表","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.handleDetail(a)}}},[e._v(" 查看 ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"单据状态",prop:"content.baseInfo.Documents_state","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{align:"center",label:"产品类型",prop:"content.baseInfo.Product_type","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{align:"center",label:"原料清单","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.handleMaterial(a)}}},[e._v(" 查看 ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"单位",prop:"content.baseInfo.Unit","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{align:"center",label:"工单状态",prop:"realstatus","show-overflow-tooltip":"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[0==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v(" 未派发 ")]):1==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v(" 待开始 ")]):2==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v(" 加工中 ")]):3==a.row.realstatus?t("el-tag",{attrs:{effect:"dark"}},[e._v(" 待首检 ")]):4==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v(" 首检完成 ")]):5==a.row.realstatus?t("el-tag",{attrs:{effect:"dark"}},[e._v(" 待尾检 ")]):6==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v(" 尾检完成 ")]):7==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v(" 待入库 ")]):8==a.row.realstatus?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v(" 已入库 ")]):9==a.row.realstatus?t("el-tag",{attrs:{effect:"dark"}},[e._v(" 已出库 ")]):t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v("暂停中")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"开始时间",prop:"detail.taskstart","show-overflow-tooltip":"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"结束时间",prop:"detail.taskend","show-overflow-tooltip":"",width:"140"}}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleOperation(a)}}},[e._v(" 操作 ")])]}}])})],1),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}}),t("el-dialog",{attrs:{"append-to-body":"","before-close":e.handleCloseDetailWl,center:"",top:"5vh",visible:e.wldialog,width:"70%"},on:{"update:visible":function(t){e.wldialog=t}}},[t("el-table",{ref:"tableSort",attrs:{border:e.border,data:e.wlList,height:e.height,size:e.lineHeight,stripe:e.stripe}},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"物料名称",prop:"DeviceName","show-overflow-tooltip":"",sortable:"",width:"300"}}),t("el-table-column",{attrs:{align:"center",label:"规格型号",prop:"Specifications","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:"订单数量",prop:"Number","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"生产车间",prop:"Production_workshop","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"物料编码",prop:"Material_code","show-overflow-tooltip":"",sortable:"",width:"140"}})],1)],1),t("el-dialog",{attrs:{"append-to-body":"","before-close":e.handleCloseDetailYl,center:"",top:"5vh",visible:e.yldialog,width:"70%"},on:{"update:visible":function(t){e.yldialog=t}}},[t("el-table",{ref:"tableSort",attrs:{border:e.border,data:e.ylList,height:e.height,size:e.lineHeight,stripe:e.stripe}},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"原料名称",prop:"material_name","show-overflow-tooltip":"",sortable:"",width:"300"}}),t("el-table-column",{attrs:{align:"center",label:"原料型号",prop:"material_spec","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:"总数量",prop:"material_total","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"生产车间",prop:"Production_workshop","show-overflow-tooltip":"",sortable:"",width:"160"}}),t("el-table-column",{attrs:{align:"center",label:"编码",prop:"Subitem_BOM_number","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:"单位",prop:"material_unit","show-overflow-tooltip":"",sortable:"",width:"140"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.commandInfo.dialog,expression:"commandInfo.dialog"}],staticClass:"dialog_wrap"},[t("div",{staticClass:"dialog_wrap_item"},[t("div",{staticStyle:{display:"flex","flex-direction":"row-reverse","font-size":"20px",cursor:"pointer",padding:"4px"}},[t("span",{on:{click:e.handleCloseAmis}},[e._v("✖")])]),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.commandInfo.data,(function(e,a){return t("el-tab-pane",{key:a+"i",attrs:{label:e.title,name:a+""}},[t("dgiot-amis",{attrs:{"modal-append-to-body":"",schema:e.data,"show-help":!1}})],1)})),1)],1)])],1)},s=[],i=a("5dca"),o=a("6a49"),l=a("1285"),n=a("8456"),c=a("3248"),u=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),d={name:"Index",components:{TableEdit:c["default"]},props:{},data(){return{infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",statusList:[{label:"未派发",value:0},{label:"待开始",value:1},{label:"加工中",value:2},{label:"待首检",value:3},{label:"首检完成",value:4},{label:"待尾检",value:5},{label:"尾检完成",value:6},{label:"待入库",value:7},{label:"已入库",value:8},{label:"已出库",value:9},{label:"暂停中",value:10}],queryForm:{skip:0,limit:20,name:""},wlList:[],wldialog:!1,ylList:[],yldialog:!1,commandInfo:{dialog:!1},activeName:"0"}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{handleCloseAmis(){this.coordinate={lng:116.404,lat:39.915},this.dialog_device=!1,this.commandInfo.dialog=!1,this.fetchData(!1)},handleCloseDetailYl(){this.yldialog=!1},handleMaterial(e){return u(this,null,(function*(){console.log(e);let t={objectId:e.objectId};const{data:a=[]}=yield Object(o["queryMaterial"])(t);console.log("原料清单",a),this.ylList=a,this.yldialog=!0}))},handleCloseDetailWl(){this.wldialog=!1},handleDetail(e){var t,a;console.log(e),this.wlList=(null==(a=null==(t=e.content)?void 0:t.baseInfo)?void 0:a.Material_List)||[],this.wldialog=!0},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleOperation(e){return u(this,null,(function*(){var t,a;let r=null==(a=null==(t=JSON.parse(Base64.decode(localStorage.getItem("role"))))?void 0:t.vuexinfo[0])?void 0:a.objectId;localStorage.setItem("parse_objectid",e.objectId),localStorage.setItem("product_objectid",e.product.objectId);const{results:s=[]}=yield Object(i["queryRelation"])({destClass:"_Role",destId:r,destField:"views",srcClass:"View"});if(_.isEmpty(s))return this.$baseMessage("暂未配置amis","info","dgiot-hey-message-error"),!1;this.commandInfo.dialog=!0,this.commandInfo.data=s}))},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>u(this,null,(function*(){const{msg:t}=yield Object(n["doDelete"])({ids:e.id});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){return u(this,null,(function*(){this.queryForm.limit=20,this.queryForm.skip=0,this.paginationKey=moment(new Date).valueOf()+"",yield this.fetchData()}))},fetchData(){return u(this,null,(function*(){console.log(this.queryForm),this.listLoading=!0;let e={skip:this.queryForm.skip,limit:this.queryForm.limit,excludeKeys:this.queryForm.excludeKeys,order:"-createdAt",count:"objectId",where:{product:"21efa507f6"}};console.log(this.$route.query),this.queryForm.name&&(e.where.name.$regex=this.queryForm.name),this.queryForm.realstatus&&(e.where.realstatus=this.queryForm.realstatus),this.queryForm.product&&(e.where.product=this.queryForm.product),this.queryForm.search&&(e.where[this.queryForm.type]={$regex:this.queryForm.search}),this.queryForm.status&&(e.where.status=this.queryForm.status),this.queryForm.isEnable&&(e.where.isEnable=this.queryForm.isEnable);const{results:t=[],count:a=0}=yield Object(l["querycompanyDevice"])(e,this.token);t.forEach(e=>{var t;e.address=""==e.address?"---":e.address,e.detail=(null==e?void 0:e.detail)?e.detail:{},e.detail.address=(null==e?void 0:e.detail)&&(null==(t=null==e?void 0:e.detail)?void 0:t.address)?e.detail.address:"---",e.isEdit=!1,e.oldName=e.name}),this.list=t,this.total=a,this.listLoading=!1}))}}},m=d,p=(a("8b5a"),a("2877")),h=Object(p["a"])(m,r,s,!1,null,"a8c86b2a",null);t["default"]=h.exports},"1c7b":function(e,t,a){},"219c":function(e,t,a){},"24ee":function(e,t,a){},2672:function(e,t,a){"use strict";a("49c9")},"2a9e":function(e,t,a){"use strict";a("3070")},"2bfbc":function(e,t,a){"use strict";a("eaf6")},"2e77":function(e,t,a){"use strict";a("d048")},3070:function(e,t,a){},3469:function(e,t,a){},"34f5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")+": "}},[t("span",[e._v(e._s(e.form.info.productname))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[t("span",[e._v(e._s(e.form.info.createdname))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[t("span",[e._v(e._s(e.form.info.createdname))])])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[t("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.description,callback:function(t){e.$set(e.form.info,"description",t)},expression:"form.info.description"}})],1)],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[t("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,a){return t("el-carousel-item",{key:a},[t("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[t("el-input",{staticStyle:{margin:"0 0 10px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",size:"1",type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[t("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1)],1)],1)],1),t("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[t("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[t("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),t("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[t("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(a){return t("el-timeline-item",{key:a.timestamp,attrs:{placement:"top",timestamp:a.timestamp}},[t("el-card",[t("h4",[e._v(e._s(a.h4))]),t("p",[e._v(e._s(a.p))])])],1)})),1)],1)],1)],1)],1)},s=[],i={props:{detail:{type:Object,default:()=>{}}},data(){return{reverse:!0,activeName:"first",form:this.detail}}},o=i,l=(a("8970"),a("2877")),n=Object(l["a"])(o,r,s,!1,null,"5f9f1ee4",null);t["default"]=n.exports},"355d":function(e,t,a){},"3aa5":function(e,t,a){},4393:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("div",{staticClass:"index-content"},[t("div",{staticClass:"dialog"},[t("dgiot-dialog",{attrs:{show:e.dialog.processes.visible},on:{"update:show":function(t){return e.$set(e.dialog.processes,"visible",t)},beforeClose:e.handleClose}},[t("el-form",{ref:"processes",staticClass:"demo-ruleForm",attrs:{"label-width":"100px",model:e.dialog.processes.form,rules:e.processes}},[t("el-form-item",{attrs:{label:"工序名称",prop:"title"}},[t("el-input",{model:{value:e.dialog.processes.form.title,callback:function(t){e.$set(e.dialog.processes.form,"title",t)},expression:"dialog.processes.form.title"}})],1),t("el-form-item",{attrs:{label:"工序编码",prop:"type"}},[t("el-input",{model:{value:e.dialog.processes.form.type,callback:function(t){e.$set(e.dialog.processes.form,"type",t)},expression:"dialog.processes.form.type"}})],1),t("el-form-item",{attrs:{label:"工序描述",prop:"key"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.dialog.processes.form.key,callback:function(t){e.$set(e.dialog.processes.form,"key",t)},expression:"dialog.processes.form.key"}})],1),t("el-form-item",{staticStyle:{"text-align":"center"},attrs:{"label-width":"0"}},[1==e.dialog.isAdd?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("processes","processes","submit")}}},[e._v(" 立即创建 ")]):e._e(),!1===e.dialog.isAdd?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("processes","processes","edit")}}},[e._v(" 修改 ")]):e._e(),t("el-button",{on:{click:function(t){return e.resetForm("processes","processes")}}},[e._v(" 重置 ")])],1)],1)],1),t("dgiot-dialog",{attrs:{show:e.dialog.properties.visible},on:{"update:show":function(t){return e.$set(e.dialog.properties,"visible",t)},beforeClose:e.handleClose}},[t("el-form",{ref:"properties",staticClass:"demo-ruleForm",attrs:{"label-width":"160px",model:e.dialog.properties.form,rules:e.properties}},[t("el-form-item",{attrs:{label:"工艺路径属性名称",prop:"title"}},[t("el-input",{model:{value:e.dialog.properties.form.title,callback:function(t){e.$set(e.dialog.properties.form,"title",t)},expression:"dialog.properties.form.title"}})],1),t("el-form-item",{attrs:{label:"工艺路径属性标识",prop:"type"}},[t("el-input",{model:{value:e.dialog.properties.form.type,callback:function(t){e.$set(e.dialog.properties.form,"type",t)},expression:"dialog.properties.form.type"}})],1),t("el-form-item",{attrs:{label:"工艺路径属性值",prop:"key"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.dialog.properties.form.key,callback:function(t){e.$set(e.dialog.properties.form,"key",t)},expression:"dialog.properties.form.key"}})],1),t("el-form-item",{staticStyle:{"text-align":"center"},attrs:{"label-width":"0"}},[1==e.dialog.isAdd?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("properties","properties","submit")}}},[e._v(" 立即创建 ")]):e._e(),!1===e.dialog.isAdd?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("properties","properties","edit")}}},[e._v(" 修改 ")]):e._e(),t("el-button",{on:{click:function(t){return e.resetForm("properties","properties")}}},[e._v(" 重置 ")])],1)],1)],1)],1),t("el-descriptions",{attrs:{border:"",column:5,direction:"vertical",size:"medium",title:e.detail.data.title}},[t("el-descriptions-item",{attrs:{label:"工艺路径编号"}},[e._v(" "+e._s(e.detail.data.code)+" "),t("DgiotQrcode",{attrs:{iconstyle:{type:"qrcode","font-size":"12px"},setting:{text:e.detail.data.code,binarizeThreshold:.5}}})],1),t("el-descriptions-item",{attrs:{label:"工艺路径名称"}},[e._v(" "+e._s(e.detail.data.title)+" ")]),t("el-descriptions-item",{attrs:{label:"工艺路径描述"}},[e._v(" "+e._s(e.detail.data.description)+" ")]),t("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(" "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]),t("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(" "+e._s(e.$moment(e.detail.updatedAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]),t("template",{slot:"extra"},[t("el-button",{nativeOn:{click:function(t){return e.busInfo("view",e.$route.query)}}},[e._v(" 表单 ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.busInfo("file",e.$route.query)}}},[e._v(" 归档 ")]),t("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.busInfo("delete",e.$route.query)}}},[e._v(" 删除 ")])],1)],2),t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"工序列表",name:"first"}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[e._v(" 工艺路径工序 ")]),t("dgiot-query-form-right-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.dialog.processes.visible=!0}}},[e._v(" 新增工序 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.amis.processes,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:"工序名称",prop:"title",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"工序编码",prop:"type",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"工序描述",prop:"key",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:r}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a,r,e.amis.processes,"processes")}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a,r,e.amis.processes,"processes")}}},[e._v(" 删除 ")])]}}])})],1)],1),t("el-tab-pane",{attrs:{label:"属性列表",name:"second"}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[e._v(" 工艺路径属性 ")]),t("dgiot-query-form-right-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入工艺路径名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.dialog.properties.visible=!0}}},[e._v(" 新增属性 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.amis.properties,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:"属性名称",prop:"title",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"属性标识",prop:"key",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"属性值",prop:"key",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:r}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a,r,e.amis.properties,"properties")}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a,r,e.amis.properties,"properties")}}},[e._v(" 删除 ")])]}}])})],1)],1)],1)],1)])},s=[],i=a("e0e9"),o=a("8456"),l=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{},data(){return{amis:{processes:[],properties:[]},detail:{},activeName:"first",properties:{title:[{required:!0,message:"请输入工艺路径属性名称",trigger:"blur"}],type:[{required:!0,message:"请输入工艺路径属性标识",trigger:"blur"}],key:[{required:!0,message:"请输入工艺路径属性值",trigger:"blur"},{min:0,max:50,message:"长度在 0 到 50 个字符",trigger:"blur"}]},processes:{name:[{required:!0,message:"请输入工序名称",trigger:"blur"}],code:[{required:!0,message:"请输入工序编码",trigger:"blur"}],title:[{required:!0,message:"请输入工序名称",trigger:"blur"}],type:[{required:!0,message:"请输入工序编码",trigger:"blur"}],key:[{required:!1,message:"请输入工序描述",trigger:"blur"},{min:0,max:50,message:"长度在 5 到 50 个字符",trigger:"blur"}]},dialog:{editRow:{},isAdd:!0,properties:{visible:!1,form:{name:"",code:"",value:""}},processes:{visible:!1,form:{name:"",code:"",description:""}},production:{visible:!1,form:{name:"",code:"",description:""}}},infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(1),stripe:!1,lineHeight:"medium",checkList:["标题","作者","评级","点击量","时间"],columns:[{label:"标题",width:"auto",prop:"title",sortable:!0,disableCheck:!0},{label:"作者",width:"auto",prop:"author",sortable:!0},{label:"评级",width:"200",prop:"rate",sortable:!0},{label:"点击量",width:"auto",prop:"pageViews",sortable:!0},{label:"时间",width:"auto",prop:"datetime",sortable:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},created(){this.queryDetails(this.$route.query.objectId),this.queryAmisDeatil(this.$route.query.objectId)},mounted(){this.fetchData()},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{submitForm(e,t,a){this.$refs[e].validate(r=>l(this,null,(function*(){if(!r)return console.log("error submit!!"),!1;{const r={title:this.dialog[t].form.title,data:{},type:this.dialog[t].form.type,class:t,key:this.dialog[t].form.key,parent:{__type:"Pointer",className:"Dict",objectId:this.$route.query.objectId}};"submit"==a?yield Object(i["postDict"])(r):yield Object(i["putDict"])(this.editRow.row.objectId,r),this.dialog[t].visible=!1,this.queryAmisDeatil(this.$route.query.objectId),this.resetForm(e)}})))},resetForm(e){this.$refs[e].resetFields()},handleEdit(e,t,a,r){this.dialog[r].form=e,this.dialog[r].visible=!0,this.dialog.isAdd=!1,this.editRow={row:e,index:t,list:a,type:r}},handleClose(){this.dialog={editRow:{},isAdd:!0,properties:{visible:!1,form:{name:"",code:"",value:""}},processes:{visible:!1,form:{name:"",code:"",description:""}},production:{visible:!1,form:{name:"",code:"",description:""}}}},handleDelete(e,t,a,r){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){a.splice(t,1),yield Object(i["delDict"])(e.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success")})))},queryAmisDeatil(e){return l(this,null,(function*(){const t={where:{parent:e,class:"processes"}},a={where:{parent:e,class:"properties"}};try{const{results:e=[]}=yield Object(i["queryDict"])(t),{results:r=[]}=yield Object(i["queryDict"])(a);this.amis.processes=e,this.amis.properties=r}catch(r){console.log(r),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+r,"error","dgiot-hey-message-error")}}))},queryDetails(e){return l(this,null,(function*(){try{this.detail=yield Object(i["getDict"])(e),_.merge(this.detail,{data:{processes:[],properties:[],production:[]}})}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},setSelectRows(e){this.selectRows=e},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return l(this,null,(function*(){this.listLoading=!0,this.imageList=[];const{data:{list:e,total:t}}=yield Object(o["getList"])(this.queryForm);this.list=e;const a=[];e.forEach(e=>{a.push(e.img)}),this.imageList=a,this.total=t,setTimeout(()=>{this.listLoading=!1},900)}))},busInfo(e,t){return l(this,null,(function*(){switch(e){case"view":this.$router.push({path:"/design",query:{type:"amis",_class:"Ftechnology",key:t.objectId}});break;case"file":this.$baseMessage("归档成功","success","dgiot-hey-message-success");break;case"release":this.$baseMessage("发布成功","success","dgiot-hey-message-success");break;case"delete":yield Object(i["delDict"])(t.objectId),this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功!"}),this.$router.go(-1)}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消删除"})});break;case"edit":this.$baseMessage("编辑成功","success","dgiot-hey-message-success");break;default:break}}))},handleClick(e,t){return l(this,null,(function*(){try{switch(this.fetchData(),e.name){case"first":break;case"second":break;case"third":break;case"fourth":break;default:break}}catch(t){this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))}}},c=n,u=(a("e845"),a("2877")),d=Object(u["a"])(c,r,s,!1,null,"3810b2fc",null);t["default"]=d.exports},"45be":function(e,t,a){},"49c9":function(e,t,a){},"4e73":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("div",{staticClass:"home_dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[t("change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[t("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[t("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,a){return t("div",{key:a},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),t("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status,t))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(a,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.showInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")])]}}])})],1),t("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},s=[],i=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("1267"),u=a("824b"),d=a("7212"),m=Object.defineProperty,p=Object.defineProperties,h=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,v=(e,t)=>{for(var a in t||(t={}))g.call(t,a)&&y(e,a,t[a]);if(f)for(var a of f(t))b.call(t,a)&&y(e,a,t[a]);return e},w=(e,t)=>p(e,h(t)),$=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),k={name:"DispatchTicket",components:{ChangeStep:u["default"]},data(){return{Product:{},created:0,Assigned:0,showdeviceFlag:!1,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:w(v({},Object(n["mapGetters"])({objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStepg(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.fetchData(),this.handleCreated("created")},methods:w(v({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(c["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return $(this,null,(function*(){const t={};t[""+this.objectid]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),s=yield Object(i["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",s),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return $(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(c["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>$(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;let{status:r}=e;this.detail=e,this.set_deviceStep(r),this.step=r+1,this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData(),this.getProduct()},getProduct(){return $(this,null,(function*(){const{results:e={}}=yield Object(d["queryProduct"])({});this.Product=e}))},fetchData(){return $(this,arguments,(function*(e={}){var t;e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{status:0}};this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return $(this,null,(function*(){dgiotlog.log(e),this.Device=[],this.Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},x=k,T=(a("6cdf"),a("2877")),F=Object(T["a"])(x,r,s,!1,null,"d4308328",null);t["default"]=F.exports},"4e90":function(e,t,a){},"4f46":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")+": "}},[t("span",[e._v(e._s(e.form.info.productname))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[t("span",[e._v(e._s(e.form.info.devicename))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[t("span",[e._v(e._s(e.form.info.createdname))])])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[t("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,a){return t("el-carousel-item",{key:a},[t("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[t("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1):e._e()],1)],1)],1),t("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[t("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[t("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),t("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[t("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(a){return t("el-timeline-item",{key:a.timestamp,attrs:{placement:"top",timestamp:a.timestamp}},[t("el-card",[t("h4",[e._v(e._s(a.h4))]),t("p",[e._v(e._s(a.p))])])],1)})),1)],1)],1)],1)],1)},s=[],i=a("ce31"),o=a("8665"),l=a("5880"),n=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,h=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))m.call(t,a)&&h(e,a,t[a]);if(d)for(var a of d(t))p.call(t,a)&&h(e,a,t[a]);return e},g=(e,t)=>c(e,u(t)),b=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),y={props:{detail:{type:Object,default:()=>{}},step:{type:Number,default:2},showFooter:{type:Boolean,default:!1}},data(){return{reverse:!0,activeName:"first",form:this.detail}},computed:f({},Object(l["mapGetters"])({username:"user/username"})),mounted(){this.featUser()},methods:g(f({},Object(l["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{featUser(){return b(this,null,(function*(){const{results:e}=yield Object(o["queryUser"])({});this.user=e}))},dispatchUser(){this.$refs["form"].validate(e=>b(this,null,(function*(){if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const{objectId:e,info:t}=this.form;t.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已处理",p:this.username+"处理了这条工单"});const a={status:2,info:t},r=yield Object(i["update_object"])("Maintenance",e,a);r.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},v=y,w=(a("2e77"),a("2877")),_=Object(w["a"])(v,r,s,!1,null,"c8a7340a",null);t["default"]=_.exports},5105:function(e,t,a){"use strict";a("fea7")},5385:function(e,t,a){},"58a6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("div",{staticClass:"index"},[t("div",{staticClass:"in_top"},[e._v("工厂建模")]),t("div",{staticClass:"in_ctr"},[e._v("工厂列表")]),t("div",{staticClass:"in_btm"},[t("el-button",{attrs:{type:"warning"},on:{click:e.openCreatePlant}},[e._v("新增工厂")]),t("el-row",{staticClass:"btm_wrap"},e._l(e.plantlist,(function(r){return t("el-col",{key:r.id,staticClass:"wrap_content",attrs:{lg:{span:7},md:{span:7},sm:{span:11},xl:{span:5},xs:{span:20}}},[t("div",{staticClass:"ct_top"},[t("img",{attrs:{src:a("35a1")}}),t("div",{staticClass:"top_right"},[t("div",{staticClass:"right_item right_title"},[e._v(e._s(r.name))]),t("div",{staticClass:"right_item"},[e._v("编码:"+e._s(r.objectId))]),t("div",{staticClass:"right_item"},[e._v(" 描述: "),r.desc?t("span",[e._v(e._s(r.desc))]):t("span",[e._v("--")])])])]),t("div",{staticClass:"ct_btm"},[t("el-button",{staticClass:"btm_left",nativeOn:{click:function(t){return e.modelToDetail(r)}}},[e._v(" 查看 ")]),t("div",{staticClass:"btm_right"},[e._v("组织类型:"+e._s(r.org_type))])],1)])})),1)],1)]),t("el-dialog",{attrs:{"append-to-body":!0,direction:e.direction,height:"60%",title:"新增工厂",visible:e.drawer,width:"30%"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"demo-drawer__content"},[t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"工厂名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入工厂名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"岗位",prop:"tempname"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择岗位"},model:{value:e.form.tempname,callback:function(t){e.$set(e.form,"tempname",t)},expression:"form.tempname"}},e._l(e.dict,(function(e){return t("el-option",{key:e.objectId,attrs:{label:e.key,value:e.key}})})),1)],1),t("el-form-item",{attrs:{label:"工厂描述"}},[t("el-input",{attrs:{maxlength:"500",placeholder:"不超过500个字符","show-word-limit":"",type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 立即创建 ")]),t("el-button",{on:{click:e.openCreatePlant}},[e._v("取消")])],1)],1)],1)])],1)},s=[],i=a("9ab53"),o=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),l={name:"Index",components:{},props:{},data(){return{plantlist:[],drawer:!1,parent:"",direction:"rtl",dict:[],wrapclose:!1,form:{name:"",tempname:"",desc:""},rules:{name:[{required:!0,message:"请输入工厂名称",trigger:"blur"},{min:2,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],tempname:[{required:!0,message:"请选择岗位",trigger:"blur"}]}}},computed:{},watch:{},created(){},mounted(){this.fetchData(),this.getDict()},destroyed(){},methods:{getDict(){return o(this,null,(function*(){const e={where:{type:"roletemp"}},{results:t}=yield Object(i["queryDictTemp"])(e);this.dict=t}))},fetchData(){return o(this,null,(function*(){const{results:e}=yield Object(i["queryRoleTree"])();this.plantlist=e[0].children,this.parent=e[0].objectId}))},modelToDetail(e){this.$router.push({path:"/oc/Modeling/modeldetail",query:{objectid:e.objectId,name:e.name}})},openCreatePlant(){this.form={name:"",tempname:"",desc:""},this.drawer=!this.drawer},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;{const e={depname:this.form.name,desc:this.form.desc,name:this.form.name,parent:this.parent,tempname:this.form.tempname};Object(i["postRole"])(e).then(e=>{this.fetchData(),this.drawer=!this.drawer})}})}}},n=l,c=(a("a23b"),a("2877")),u=Object(c["a"])(n,r,s,!1,null,"f59ac7f0",null);t["default"]=u.exports},"5cae":function(e,t,a){"use strict";a("7f4b")},"5d3e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("empty")],1)},s=[],i=a("43b8"),o={name:"Index",components:{empty:i["default"]},props:{},data(){return{}},computed:{},watch:{},created(){},mounted(){},destroyed(){},methods:{}},l=o,n=(a("8437"),a("2877")),c=Object(n["a"])(l,r,s,!1,null,"08e17772",null);t["default"]=c.exports},6379:function(e,t,a){"use strict";a("690f")},"68cc":function(e,t,a){"use strict";a("fa8b")},"690f":function(e,t,a){},"697b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("div",{staticClass:"home_dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e._deviceFlag,width:"100vh"},on:{"update:visible":function(t){e._deviceFlag=t}}},[t("change-info",{ref:"changeinfo",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceFlag(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[t("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[t("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,a){return t("div",{key:a},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),t("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(a){return t("el-option",{key:a.key,attrs:{label:e.$translateTitle(a.text),value:a.key}})})),1),t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),t("el-form-item",[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleFold}},[e.fold?t("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):t("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),t("dgiot-icon",{staticClass:"dgiot-dropdown",class:{"dgiot-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}]},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status,t))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(a,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==a.status,expression:"row.status == 1"}],attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==a.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=a.status,expression:"row.status != 3"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),t("el-pagination",{key:e.paginationKey+"key"+e.total,attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.total,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.channelCurrentChange,"size-change":e.channelSizeChange}})],1)},s=[],i=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("7212"),u=a("e915"),d=a("1267"),m=Object.defineProperty,p=Object.defineProperties,h=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,v=(e,t)=>{for(var a in t||(t={}))g.call(t,a)&&y(e,a,t[a]);if(f)for(var a of f(t))b.call(t,a)&&y(e,a,t[a]);return e},w=(e,t)=>p(e,h(t)),$=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),k={name:"MyWork",components:{ChangeInfo:u["default"]},data(){return{Product:{},created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",length:10,start:0,total:0,paginationKey:moment(new Date).valueOf()+"",status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:this.$route.query.id||"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:w(v({},Object(n["mapGetters"])({objectid:"user/objectId",role:"acl/role",currentDepartment:"user/currentDepartment",username:"user/username"})),{_deviceFlag:{get(){return console.log("this.$store.state.global._deviceFlag",this.$store.state.global._deviceFlag),this.$store.state.global._deviceFlag},set(e){this.set_deviceFlag(e)}},aclObj(){let e={};return this.role.map(t=>{e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceFlag:function(e){0==e&&this.fetchData()},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created(){},mounted(){this.handleCreated("created")},methods:w(v({channelSizeChange(e){this.length=e,this.fetchData()},channelCurrentChange(e){e<=1&&(this.total=0),this.start=(e-1)*this.length,this.fetchData()},myUpload(e){const t=e.file;let a=t.name.substring(t.name.lastIndexOf(".")+1);const r={file:t,path:"ticket",filename:`ticket${moment().format("x")}.${a}`};Object(d["UploadImg"])(r).then(e=>{e.data.url?this.form.photo.push(e.data.url):console.log("no up url ",e)}).catch(e=>{console.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return $(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[""+("role:"+this.currentDepartment.name)]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading();yield Object(i["create_object"])("Maintenance",a);r.close(),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)})}},Object(n["mapMutations"])({set_deviceFlag:"global/set_deviceFlag"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return $(this,null,(function*(){try{const t={results:[]};t["results"]=e;const a=yield Object(d["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>$(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceFlag(!0)},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData(),this.getProduct()},getProduct(){return $(this,null,(function*(){const{results:e={}}=yield Object(c["queryProduct"])({});this.Product=e}))},fetchData(){return $(this,arguments,(function*(e={}){var t;e.limit||(e=this.queryForm),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={order:e.order,skip:this.start,limit:this.length,keys:e.keys,count:"objectId",where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()})}))},prodChange(e){return $(this,null,(function*(){this.Device=[],this.Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)})},dispatch(){this.$refs.changeinfo.$refs.step1.dispatchUser()},backChange(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a},s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceFlag(!1)}))},Reassign(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a},s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceFlag(!1)}))},dealwith(){this.$refs.changeinfo.$refs.step2.dispatchUser()},check(){this.$refs.changeinfo.$refs.step3.dispatchUser()}})},x=k,T=(a("fba2"),a("2877")),F=Object(T["a"])(x,r,s,!1,null,"40d7ee23",null);t["default"]=F.exports},"6cdf":function(e,t,a){"use strict";a("3469")},"6d66":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"资产名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[e._l(e.finallyColumns,(function(a,r){return t("el-table-column",{key:r,attrs:{align:"center",label:a.label,sortable:"",width:a.width},scopedSlots:e._u([{key:"default",fn:function({row:r}){return["评级"===a.label?t("span",[t("el-rate",{attrs:{disabled:""},model:{value:r.rate,callback:function(t){e.$set(r,"rate",t)},expression:"row.rate"}})],1):t("span",[e._v(e._s(r[a.prop]))])]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],2),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("div",{staticClass:"draw"},[t("el-drawer",{attrs:{"append-to-body":"",title:"我是标题",visible:e.drawer,"with-header":!1},on:{"update:visible":function(t){e.drawer=t}}},[t("el-form",{ref:"form",attrs:{"label-position":"top","label-width":"80px",model:e.sizeForm,rules:e.rules,size:"mini","status-icon":""}},[t("el-form-item",{attrs:{label:"资产名称"}},[t("el-input",{model:{value:e.sizeForm.name,callback:function(t){e.$set(e.sizeForm,"name",t)},expression:"sizeForm.name"}})],1),t("el-form-item",{attrs:{label:"活动区域"}},[t("el-select",{attrs:{placeholder:"请选择活动区域"},model:{value:e.sizeForm.region,callback:function(t){e.$set(e.sizeForm,"region",t)},expression:"sizeForm.region"}},[t("el-option",{attrs:{label:"区域一",value:"shanghai"}}),t("el-option",{attrs:{label:"区域二",value:"beijing"}})],1)],1),t("el-form-item",{attrs:{label:"活动时间"}},[t("el-col",{attrs:{span:11}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期",type:"date"},model:{value:e.sizeForm.date1,callback:function(t){e.$set(e.sizeForm,"date1",t)},expression:"sizeForm.date1"}})],1),t("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:11}},[t("el-time-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择时间"},model:{value:e.sizeForm.date2,callback:function(t){e.$set(e.sizeForm,"date2",t)},expression:"sizeForm.date2"}})],1)],1),t("el-form-item",{attrs:{label:"活动性质"}},[t("el-checkbox-group",{model:{value:e.sizeForm.type,callback:function(t){e.$set(e.sizeForm,"type",t)},expression:"sizeForm.type"}},[t("el-checkbox-button",{attrs:{label:"美食/餐厅线上活动",name:"type"}}),t("el-checkbox-button",{attrs:{label:"地推活动",name:"type"}}),t("el-checkbox-button",{attrs:{label:"线下主题活动",name:"type"}})],1)],1),t("el-form-item",{attrs:{label:"特殊资源"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.sizeForm.resource,callback:function(t){e.$set(e.sizeForm,"resource",t)},expression:"sizeForm.resource"}},[t("el-radio",{attrs:{border:"",label:"线上品牌商赞助"}}),t("el-radio",{attrs:{border:"",label:"线下场地免费"}})],1)],1),t("el-form-item",{attrs:{size:"large"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即创建")]),t("el-button",[e._v("取消")])],1)],1)],1)],1)],1)])},s=[],i=a("8456"),o=a("3248"),l=a("7212"),n=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),c={name:"Index",components:{TableEdit:o["default"]},props:{},data(){return{rules:{name:[{required:!0,message:"请输入资产名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]},sizeForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},product:[],infoData:"Empty",isFullscreen:!1,border:!0,drawer:!1,height:this.$baseTableHeight(0),stripe:!0,lineHeight:"medium",checkList:["资产编号","资产名称","资产类型","颁发/认证机构","资产状态"],columns:[{label:"资产编号",width:"auto",prop:"author",sortable:!0,disableCheck:!0},{label:"资产名称",width:"auto",prop:"title",sortable:!0},{label:"资产类型",width:"rate",prop:"rate",sortable:!0},{label:"颁发/认证机构",width:"auto",prop:"description",sortable:!0},{label:"资产状态",width:"auto",prop:"status",sortable:!0}],list:[],imageList:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData(),this.fetchProduct()},mounted(){},destroyed(){},methods:{onSubmit(){console.log("submit!")},fetchProduct(){return n(this,null,(function*(){try{const{results:e=[]}=yield Object(l["queryProduct"])({excludeKeys:"channel,children,category,config,thing,producttemplet,topics,decoder"});this.product=e}catch(e){this.$baseMessage(e,"error","dgiot-hey-message-error")}}))},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleAdd(){this.drawer=!0},handleEdit(e){this.drawer=!1},handleDelete(e){if(e.id)this.$baseConfirm("你确定要删除当前项吗",null,()=>n(this,null,(function*(){const{msg:t}=yield Object(i["doDelete"])({ids:e.id});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})));else if(this.selectRows.length>0){const e=this.selectRows.map(e=>e.id).join();this.$baseConfirm("你确定要删除选中项吗",null,()=>n(this,null,(function*(){const{msg:t}=yield Object(i["doDelete"])({ids:e});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})))}else this.$baseMessage("未选中任何行","error","dgiot-hey-message-error")},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return n(this,null,(function*(){this.list=[],this.listLoading=!0;try{const{data:{list:e,total:t}}=yield Object(i["getList"])(this.queryForm);setTimeout(()=>{this.list=e,this.total=t,this.listLoading=!1},300)}catch(e){console.error(e)}}))}}},u=c,d=(a("2672"),a("2877")),m=Object(d["a"])(u,r,s,!1,null,"8065026e",null);t["default"]=m.exports},"758f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("dgiot-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),t("div",{staticClass:"ftechnology"},[t("div",{staticClass:"dlalog"},[t("dgiot-dialog",{key:e.ftechnology.type,attrs:{show:e.ftechnology.dialogVisible,title:"add"==e.ftechnology.type?"新增工艺路径":"修改工艺路径"},on:{"update:show":function(t){return e.$set(e.ftechnology,"dialogVisible",t)},beforeClose:e.handleClose}},[t("el-form",{ref:"ftechnology",staticClass:"demo-ruleForm",attrs:{"label-width":"110px",model:e.ftechnology,rules:e.rules,"status-icon":""}},[t("el-form-item",{attrs:{label:"工艺路径名称",prop:"form.title"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入工艺路径名称"},model:{value:e.ftechnology.form.title,callback:function(t){e.$set(e.ftechnology.form,"title",t)},expression:"ftechnology.form.title"}})],1),t("el-form-item",{attrs:{label:"工艺路径编码",prop:"form.code"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入工艺路径编码"},model:{value:e.ftechnology.form.code,callback:function(t){e.$set(e.ftechnology.form,"code",t)},expression:"ftechnology.form.code"}})],1),t("el-form-item",{attrs:{label:"工艺路径描述",prop:"form.description"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"不超过500个字符",rows:2,type:"textarea"},model:{value:e.ftechnology.form.description,callback:function(t){e.$set(e.ftechnology.form,"description",t)},expression:"ftechnology.form.description"}})],1),t("el-form-item",{key:e.ftechnology.form.img,attrs:{label:"工艺路径logo"}},[t("el-avatar",{key:e.imgKey,attrs:{size:100,src:e.$FileServe+e.ftechnology.form.img},nativeOn:{click:function(t){return e.uploadCkick("userinfo.avatar")}}},[e.ftechnology.form.img?e._e():t("div",{key:e.ftechnology.form.img,staticClass:"el-icon-plus avatar-uploader-icon",attrs:{slot:"error"},on:{click:function(t){return e.uploadCkick("userinfo.avatar")}},slot:"error"})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){return e.handleClose.apply(null,arguments)}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ftechnology",e.ftechnology.type)}}},[e._v(" 确 定 ")])],1)],1)],1),t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入工艺路径名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},nativeOn:{click:function(t){return e.handleQuery.apply(null,arguments)}}},[e._v(" 查询 ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.ftechnology.dialogVisible=!0}}},[e._v(" 添加工艺路径 ")])],1)],1)],1)],1),t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.total,expression:"total === 0"}],attrs:{"image-size":e.$baseTableHeight(0)-160}}),t("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingConfig,expression:"loadingConfig"}],staticClass:"box-card",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),gutter:20}},e._l(e.list,(function(a,r){return t("el-col",{key:r,attrs:{lg:6,md:8,sm:12,xl:6,xs:24}},[t("el-card",{staticClass:"card",attrs:{shadow:"hover"}},[t("div",{staticClass:"box"},[t("div",{staticClass:"left"},[t("el-avatar",{key:e.imgKey,staticStyle:{width:"100px",height:"100px"},attrs:{src:e.$FileServe+a.data.img}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])])],1),t("div",{staticClass:"right"},[t("el-descriptions",{attrs:{column:1,size:"medium",title:a.data.title}},[t("el-descriptions-item",{attrs:{label:"编码",title:a.data.code}},[e._v(" "+e._s(a.data.code)+" ")]),t("el-descriptions-item",{attrs:{label:"描述",title:a.data.description}},[e._v(" "+e._s(a.data.description)+" ")]),t("el-descriptions-item",{attrs:{label:"更新时间",title:a.updatedAt}},[e._v(" "+e._s(e.$moment(a.updatedAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])],1)],1)]),t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-size":"14px","font-weight":"700","line-height":"22px",color:"#333"}},[e._v(" "+e._s(a.data.title)+" ")]),t("div",{staticStyle:{float:"right"}},[t("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/Ftechnology/detail",query:{objectId:a.objectId}})}}},[e._v(" 查看 ")]),t("el-button",{attrs:{size:"mini",type:"warning"},nativeOn:{click:function(t){return e.editItem(a)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{size:"mini",type:"danger"},nativeOn:{click:function(t){return e.deleteItem(a.objectId,r,e.list)}}},[e._v(" 删除 ")])],1)])])],1)})),1),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)},s=[],i=a("e0e9"),o=a("5880"),l=Object.defineProperty,n=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,m=(e,t)=>{for(var a in t||(t={}))c.call(t,a)&&d(e,a,t[a]);if(n)for(var a of n(t))u.call(t,a)&&d(e,a,t[a]);return e},p=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),h={name:"Index",components:{},props:{},data(){return{imgKey:moment().format("x"),inputParams:{},layout:"total, sizes, prev, pager, next, jumper",total:0,rules:{"form.title":[{required:!0,message:"请输入工艺路径名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],"form.code":[{required:!0,message:"请输入工艺路径编码",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],"form.description":[{required:!1,message:"请输入工艺路径描述",trigger:"blur"},{min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"blur"}]},ftechnology:{type:"add",objectId:"",dialogVisible:!1,form:{title:"",description:"",code:""}},list:[],loadingConfig:!1,upNodeType:"",queryForm:{title:"",skip:0,limit:8,name:"",search:""},currentDate:(new Date).toLocaleString()}},computed:m({},Object(o["mapGetters"])({ObjectId:"user/objectId"})),watch:{},created(){this.fetechData()},mounted(){},destroyed(){},methods:{uploadCkick(e){this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"user/Ftechnology/",filename:`${this.ObjectId}_Ftechnology_${this.upNodeType.replace(".","_")}.${e}`}},fileInfo(e){this.$baseMessage("上传成功",e.name+" 上传成功，请点击确定按钮，查看图片","success",!1,"dgiot-hey-message-success"),this.imgKey=moment().format("x"),this.ftechnology.form.img=e.path+"?"+(new Date).getTime()},files(e,t){this.inputParams.filename=`${this.ObjectId}_${this.upNodeType.replace(".","_")}.${t}`,this.inputParams.file=e},editItem(e){this.ftechnology.objectId=e.objectId,this.ftechnology.dialogVisible=!0,this.ftechnology.form=e.data,this.ftechnology.type="edit"},deleteItem(e,t,a){return p(this,null,(function*(){this.$baseConfirm("你确定要删除选中项吗",null,()=>p(this,null,(function*(){yield Object(i["delDict"])(e),a.splice(t,1),this.$baseMessage("删除成功","success","dgiot-hey-message-success")})))}))},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetechData()},handleSizeChange(e){this.queryForm.limit=e,this.fetechData()},handleClose(){this.ftechnology.type="add",this.ftechnology.objectId="",this.ftechnology.dialogVisible=!1},submitForm(e,t){return p(this,null,(function*(){if(this.loadingConfig=!0,"add"===t)try{const{error:e}=yield Object(i["postDict"])({type:"technology",data:this.ftechnology.form,class:"technology",key:this.ftechnology.form.code});if(e)return this.$baseMessage(e,"error","dgiot-hey-message-error"),void(this.loadingConfig=!1);this.fetechData()}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}else yield Object(i["putDict"])(this.ftechnology.objectId,{data:this.ftechnology.form}),this.$baseMessage("数据更新成功","success","dgiot-hey-message-success");this.ftechnology.dialogVisible=!1,setTimeout(()=>{this.loadingConfig=!1},1200)}))},resetForm(e){this.$refs[e].resetFields()},fetechData(e){return p(this,null,(function*(){this.loadingConfig=!0;const e={where:{type:"technology"},skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt"};try{const{results:t=[],count:a}=yield Object(i["queryDict"])(e);this.list=t,this.total=a}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}setTimeout(()=>{this.loadingConfig=!1},100)}))},handleQuery(){return p(this,null,(function*(){this.loadingConfig=!0,this.queryForm.limit=8,yield this.fetechData()}))}}},f=h,g=(a("8be3"),a("2877")),b=Object(g["a"])(f,r,s,!1,null,"c6a6cd08",null);t["default"]=b.exports},"773d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("div",{staticClass:"dialog"},[t("el-dialog",{attrs:{"append-to-body":"",title:e.properties.types||"新增主数据: "+e.properties.title,visible:e.formDialog},on:{"update:visible":function(t){e.formDialog=t},close:e.closeDilog}},[t("div",{staticClass:"form"},[t("el-form",{key:e.properties.objectId,ref:"form",attrs:{"label-width":"auto","status-icon":""}},e._l(e.properties.data.properties,(function(a,r){return t("el-form-item",{key:r,attrs:{label:a.prop.label,rules:a.prop.rules}},[t("el-input",{model:{value:a.propertyValue,callback:function(t){e.$set(a,"propertyValue",t)},expression:"item.propertyValue"}})],1)})),1)],1),t("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.properties.types?"修改":"新增")+" ")])],1)])],1),t("el-row",[t("el-col",{attrs:{span:4}},[e._v(" 主数据列表: "),t("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.load,expression:"load"}],staticClass:"infinite-list",staticStyle:{height:"75vh",overflow:"scroll"},attrs:{"infinite-scroll-distance":50}},[t("el-row",{attrs:{gutter:24}},e._l(e.list,(function(a){return t("li",{key:a.objectId,staticClass:"infinite-list-item",staticStyle:{width:"90%"},on:{click:function(t){return e.queryItem(a)}}},[t("el-col",{attrs:{span:18}},[t("el-link",{attrs:{type:e.properties.objectId==a.objectId?"primary":"warning"}},[e._v(" "+e._s(a.title)+" ")])],1),t("el-col",{attrs:{span:4}},[t("el-button",{staticClass:"el-icon-edit",staticStyle:{float:"right"},attrs:{type:"text"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:a.objectId,type:"edit"}})}}})],1)],1)})),0)],1)]),t("el-col",{attrs:{span:20}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"元数据名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),t("el-button",{attrs:{disabled:!e.properties.objectId,icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.showDiloog(e.properties)}}},[e._v(" 新增主数据 ")])],1)],1)],1),t("dgiot-query-form-right-panel",[t("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"},on:{click:e.clickFullScreen}},[t("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}}),e._v(" 表格全屏 ")],1),t("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[t("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[t("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tableSort",attrs:{border:e.border,data:e.MasterData,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中",height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),e._l(e.finallyColumns,(function(a,r){return t("el-table-column",{key:r,attrs:{align:"center",label:a.label,prop:a.label,sortable:"",width:a.width},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[t("span",[e._v(e._s(r.data[a.prop]))])]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:r}){return[t("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.editItem(r,a,e.MasterData)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.handleDelete(r,a,e.MasterData)}}},[e._v(" 删除 ")])]}}])})],2),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.MasterData.length,expression:"MasterData.length"}],attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("el-empty",{directives:[{name:"show",rawName:"v-show",value:!e.properties.data.properties,expression:"!properties.data.properties"}],attrs:{"image-size":e.height-200}})],1)],1),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},s=[],i=a("3248"),o=a("e0e9"),l=a("d292"),n=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),c={name:"Index",components:{TableEdit:i["default"]},props:{},data(){return{clickRow:{},MasterData:[],formDialog:!1,loading:!1,count:0,properties:[],drawerAdd:!1,infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",columns:[],checkList:[],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:20,name:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{closeDilog(){delete this.properties.types},submitForm(e){return n(this,null,(function*(){var e={data:{}};if(this.properties.data.properties.forEach(t=>{e.data[t.propertyCode]=t.propertyValue}),this.clickRow.objectId)yield Object(o["putDict"])(this.clickRow.objectId,{data:e.data});else{yield Object(o["postDict"])({data:e.data,type:this.properties.objectId+"metaData",class:"metaData",title:this.properties.title,key:"metaData:"+moment().format("x"),dict:{__type:"Pointer",className:"Dict",objectId:this.properties.objectId},parent:{__type:"Pointer",className:"Dict",objectId:this.properties.objectId}});this.total=this.total+1}this.queryItem(this.clickItem,!1),this.formDialog=!1}))},load(){this.count+=2},showDiloog(e){return n(this,null,(function*(){e.data.properties?(yield this.properties.data.properties.forEach(e=>{e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyValue=""}),this.formDialog=!0):yield this.$baseMessage("元数据暂无配置信息","info","dgiot-hey-message-error")}))},queryItem(e,t=!0){return n(this,null,(function*(){this.clickItem=e,this.loading=t,this.checkList=[],this.columns=[];const a=yield Object(o["getDict"])(e.objectId),{results:r=[],count:s=0}=yield Object(o["queryDict"])({skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",where:{parent:e.objectId}});this.total=s,this.MasterData=r,_.isEmpty(a.data.properties)||a.data.properties.forEach(e=>{e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyDesc&&(this.checkList.push(e.propertyDesc),this.columns.push({label:e.propertyDesc,width:"auto",prop:e.propertyCode,sortable:!0,disableCheck:!0})),e.propertyValue=""}),this.properties=a,setTimeout(()=>{this.loading=!1},300)}))},onSubmit(){console.log("submit!")},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleEdit(e){this.$refs["edit"].showEdit(e)},editItem(e,t){this.clickRow=t,this.properties.data.properties.forEach(e=>{e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyValue=t.data[e.propertyCode]}),this.properties.types="修改主数据",this.formDialog=!0},handleDelete(e,t,a){this.$baseConfirm("你确定要删除当前项吗",null,()=>n(this,null,(function*(){yield Object(o["delDict"])(t.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),a.splice(e,1),this.total=this.total-1})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=0,this.queryForm.limit=20,this.fetchData()},masterTree(){return n(this,null,(function*(){const e={class:"Dict",filter:'{"keys":["parent","title"],"where":{"class":["metaData"]}}',parent:"parent"};yield Object(l["post_tree"])(e)}))},fetchData(){return n(this,null,(function*(){this.masterTree();const e={count:"objectId",order:"-createdAt",excludeKeys:"",where:{type:"metaData"}};this.queryForm.name&&(e.where.title={$regex:this.queryForm.name});const{results:t}=yield Object(o["queryDict"])(e);this.list=t,t.length>0&&this.queryItem(t[0],!1)}))}}},u=c,d=(a("f42d"),a("2877")),m=Object(d["a"])(u,r,s,!1,null,"4548dd1c",null);t["default"]=m.exports},"7b8f":function(e,t,a){},"7f4b":function(e,t,a){},"80e1":function(e,t,a){"use strict";a("3aa5")},"824b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return e.detail?t("div",{staticClass:"changeInfo"},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),t("el-col",{attrs:{span:7}},[t("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),t("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[t("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?t("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?t("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?t("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?t("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):t("div",{staticClass:"empty"},[t("dgiot-empty")],1)},s=[],i=a("f47e"),o=a("4f46"),l=a("bacb"),n=a("34f5"),c={name:"ChangeStep",components:{Step1:i["default"],Step2:o["default"],Step3:l["default"],Step4:n["default"]},props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data(){return{isStep:0}},mounted(){4==this.step&&(this.isStep=4),dgiotlog.log(this.step)},methods:{next(){this.isStep++>5&&(this.isStep=0)},handleSetStep(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("eea5"),a("2877")),m=Object(d["a"])(u,r,s,!1,null,"3a21f9ea",null);t["default"]=m.exports},8295:function(e,t,a){"use strict";a("355d")},"82a1a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"grafana-container"},[t("div",{staticClass:"grafana"},[t("iframe",{class:e.collapse?"":"iframe",attrs:{id:"horizontal"==e.theme.layout?"fm100":"",frameborder:"0",src:e.iframeSrc}})])])},s=[],i=a("5880"),o=Object.defineProperty,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,t,a)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,d=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&u(e,a,t[a]);if(l)for(var a of l(t))c.call(t,a)&&u(e,a,t[a]);return e},m={name:"Grafana",components:{},props:{},data(){return{iframeSrc:location.protocol+"//"+location.hostname+":3000"}},computed:d({},Object(i["mapGetters"])({collapse:"settings/collapse",theme:"settings/theme"})),watch:{theme:{handler(e){},deep:!0,immediate:!0}},created(){},mounted(){this.setTreeFlag(!1)},destroyed(){},methods:d({},Object(i["mapMutations"])({setTreeFlag:"settings/setTreeFlag"}))},p=m,h=(a("5105"),a("2877")),f=Object(h["a"])(p,r,s,!1,null,"3f7ff704",null);t["default"]=f.exports},8437:function(e,t,a){"use strict";a("4e90")},8970:function(e,t,a){"use strict";a("e9cd")},"89f9b":function(e,t,a){"use strict";a("12fb")},"8b5a":function(e,t,a){"use strict";a("daa4")},"8be3":function(e,t,a){"use strict";a("1c7b")},"8db0":function(e,t,a){},"8ef2":function(e,t,a){},9402:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Restore"})},s=[],i={name:"Restore",data(){return{}},methods:{}},o=i,l=a("2877"),n=Object(l["a"])(o,r,s,!1,null,null,null);t["default"]=n.exports},96388:function(e,t,a){},"974c":function(e,t,a){},"9c68":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"元数据名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.$router.push("/oc/MetaData/module")}}},[e._v(" 添加 ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"元数据名称",prop:"title",sortable:"",width:"auto"}}),t("el-table-column",{attrs:{align:"center",label:"多版本管理",prop:"data.multiVersion",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(" "+e._s("0"==a.data.multiVersion?"是":"否")+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"200"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:a.objectId,type:"edit"}})}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},s=[],i=a("3248"),o=a("e0e9"),l=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{TableEdit:i["default"]},props:{},data(){return{drawerAdd:!1,infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["元数据名称","多版本管理","描述"],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:20,name:""}}},computed:{dragOptions(){return{animation:600,group:"description"}}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{onSubmit(){console.log("submit!")},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){yield Object(o["delDict"])(e.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=0,this.queryForm.limit=20,this.fetchData()},fetchData(){return l(this,null,(function*(){const e={skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",excludeKeys:"",where:{parent:"0",type:"metaData"}};this.queryForm.name&&(e.where.title={$regex:this.queryForm.name}),this.listLoading=!0;const{results:t,count:a}=yield Object(o["queryDict"])(e);this.list=t,this.total=a,this.listLoading=!1}))}}},c=n,u=(a("8295"),a("2877")),d=Object(u["a"])(c,r,s,!1,null,"394fd115",null);t["default"]=d.exports},a0fe:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Generate"})},s=[],i={name:"Generate",data(){return{}},methods:{}},o=i,l=a("2877"),n=Object(l["a"])(o,r,s,!1,null,null,null);t["default"]=n.exports},a23b:function(e,t,a){"use strict";a("1848")},a9e7:function(e,t,a){"use strict";a("96388")},b175:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("div",{staticClass:"home_dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[t("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=e.detail.status,expression:"detail.status != 3"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[t("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[t("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,a){return t("div",{key:a},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),t("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(a){return t("el-option",{key:a.key,attrs:{label:e.$translateTitle(a.text),value:a.key}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status,t))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(a,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==a.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(a,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")])]}}])})],1),t("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},s=[],i=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),$={name:"EvaluationTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(u["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[this.currentDepartment.name]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),s=yield Object(i["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",s),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.showdeviceFlag=!0,this.set_deviceStep(r)},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),_.isNumber(this.queryForm.status)&&(r.where.status=this.queryForm.status),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(this.$translateTitle("node.export error")+""+e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("e53e"),a("2877")),T=Object(x["a"])(k,r,s,!1,null,"47ed6f50",null);t["default"]=T.exports},b7b1:function(e,t,a){"use strict";a("e23f")},b9d4:function(e,t,a){"use strict";a("d73d")},bacb:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")+": "}},[t("span",[e._v(e._s(e.form.info.productname))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[t("span",[e._v(e._s(e.form.info.devicename))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[t("span",[e._v(e._s(e.form.info.createdname))])])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[t("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,a){return t("el-carousel-item",{key:a},[t("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?t("el-col",{attrs:{span:24}},[e.form.info.step3.Remarks?t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[t("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1):e._e()],1):e._e()],1)],1)],1),t("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[t("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[t("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),t("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[t("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(a){return t("el-timeline-item",{key:a.timestamp,attrs:{placement:"top",timestamp:a.timestamp}},[t("el-card",[t("h4",[e._v(e._s(a.h4))]),t("p",[e._v(e._s(a.p))])])],1)})),1)],1)],1)],1)],1)},s=[],i=a("ce31"),o=a("8665"),l=a("5880"),n=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,h=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))m.call(t,a)&&h(e,a,t[a]);if(d)for(var a of d(t))p.call(t,a)&&h(e,a,t[a]);return e},g=(e,t)=>c(e,u(t)),b=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),y={props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1}},data(){return{reverse:!0,activeName:"first",form:this.detail}},computed:f({},Object(l["mapGetters"])({username:"user/username"})),mounted(){this.featUser()},methods:g(f({},Object(l["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{featUser(){return b(this,null,(function*(){const{results:e}=yield Object(o["queryUser"])({});this.user=e}))},dispatchUser(){this.$refs["form"].validate(e=>b(this,null,(function*(){if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const{objectId:e,info:t,number:a=""}=this.form;t.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已结单",p:this.username+" 已结束这条工单"}),this.$dgiotBus.$emit("MqttPublish","/workOrderCompletion/up",JSON.stringify({id:a}),0,!1);const r={status:3,info:t},s=yield Object(i["update_object"])("Maintenance",e,r);s.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},v=y,w=(a("b9d4"),a("2877")),_=Object(w["a"])(v,r,s,!1,null,"3cb79687",null);t["default"]=_.exports},bd5f:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("div",{staticClass:"home_dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[t("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),t("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[t("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[t("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,a){return t("div",{key:a},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),t("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(a){return t("el-option",{key:a.key,attrs:{label:e.$translateTitle(a.text),value:a.key}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status,t))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(a,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(a,!0,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])]}}])})],1),t("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},s=[],i=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),$={name:"ProcessTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.fetchData(),this.showdeviceFlag=!1)},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(u["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),s=yield Object(i["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",s),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return"待分配";case 1:return"已分配";case 2:return"已处理";case 3:return"已结单";default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),_.isNumber(this.queryForm.status)&&(r.where.status=this.queryForm.status),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&(this.set_deviceStep(-1),this.showdeviceFlag=!1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&(this.set_deviceStep(-1),this.showdeviceFlag=!1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("cbe1"),a("2877")),T=Object(x["a"])(k,r,s,!1,null,"21402647",null);t["default"]=T.exports},c06c:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index-container"},[t("empty")],1)},s=[],i=a("43b8"),o={name:"Index",components:{empty:i["default"]},props:{},data(){return{}},computed:{},watch:{},created(){},mounted(){},destroyed(){},methods:{}},l=o,n=(a("b7b1"),a("2877")),c=Object(n["a"])(l,r,s,!1,null,"7dc3f72f",null);t["default"]=c.exports},c559:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"CloudOT-container"},[t("div",{staticClass:"CloudOT-content"},[e._v(" "+e._s(e.infoData)+" ")])])},s=[],i={name:"CloudOT",components:{},data(){return{infoData:"CloudOT"}},computed:{},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{}},o=i,l=(a("2bfbc"),a("2877")),n=Object(l["a"])(o,r,s,!1,null,"1f287615",null);t["default"]=n.exports},c6b1:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("div",{staticClass:"home_dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[t("Change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(-1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),t("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products"),prop:"product"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[t("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[t("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,a){return t("div",{key:a},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),t("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status,t))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(a,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=a.status,expression:"row.status != 3"}],attrs:{disabled:0!=a.status,size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),t("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},s=[],i=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),$={name:"CreateTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&this.fetchData()},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){const t=e.file;let a=t.name.substring(t.name.lastIndexOf(".")+1);const r={file:t,path:"ticket",filename:`ticket${moment().format("x")}.${a}`};dgiotlog.log("extension",r),Object(u["UploadImg"])(r).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[""+("role:"+this.currentDepartment.name)]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),s=yield Object(i["create_object"])("Maintenance",a);this.set_deviceStep(-1),r.close(),dgiotlog.log("res",s),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const s=yield Object(i["update_object"])("Maintenance",t,r);s.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("6379"),a("2877")),T=Object(x["a"])(k,r,s,!1,null,"1a87b91e",null);t["default"]=T.exports},cbe1:function(e,t,a){"use strict";a("8ef2")},d048:function(e,t,a){},d73d:function(e,t,a){},daa4:function(e,t,a){},e207:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"index-container"},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",class:{"dgiot-fullscreen":e.isFullscreen},attrs:{"label-position":"top","label-width":"160px",model:e.ruleForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"元数据名称",prop:"name"}},[t("el-input",{attrs:{readonly:"edit"==e.$route.query.type},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"多版本管理",prop:"multiVersion"}},[t("el-radio-group",{model:{value:e.ruleForm.multiVersion,callback:function(t){e.$set(e.ruleForm,"multiVersion",t)},expression:"ruleForm.multiVersion"}},[t("el-radio",{attrs:{label:1}},[e._v("需要")]),t("el-radio",{attrs:{label:0}},[e._v("不需要")])],1)],1),t("el-form-item",{attrs:{label:"元数据描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),t("el-form-item",{attrs:{label:"唯一标识定义层级关系",prop:"prefixNested"}},[t("el-radio",{attrs:{label:!0},model:{value:e.ruleForm.prefixNested,callback:function(t){e.$set(e.ruleForm,"prefixNested",t)},expression:"ruleForm.prefixNested"}},[e._v("需要")]),t("el-radio",{attrs:{label:!1},model:{value:e.ruleForm.prefixNested,callback:function(t){e.$set(e.ruleForm,"prefixNested",t)},expression:"ruleForm.prefixNested"}},[e._v(" 不需要 ")])],1),t("el-form-item",{attrs:{label:"数据字典",prop:"properties",type:"primary"}},[t("el-card",[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.ruleForm.properties.push({propertyDesc:"",propertyCode:"",propertyType:"",isNull:!1,display:!0,isUnique:!1,array:!1,defaultValue:"",propertyLimit:{},propertyIndex:0,queryCondition:!1})}}},[e._v(" 添加数据 ")])],1)],1)],1),t("dgiot-query-form-right-panel",[t("el-button",{staticClass:"el-icon-edit",attrs:{type:"edit"!==e.$route.query.type?"primary":"info"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s("edit"!==e.$route.query.type?"立即创建":"修改")+" ")]),t("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[t("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[t("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),t("el-table",{ref:"tableSort",attrs:{border:e.border,data:e.ruleForm.properties,stripe:e.stripe}},[t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),e._l(e.finallyColumns,(function(a,r){return t("el-table-column",{key:r,attrs:{align:"center",label:a.label,sortable:"",width:a.width},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[e.$lodash.isBoolean(r[a.prop])?t("el-switch",{model:{value:r[a.prop],callback:function(t){e.$set(r,a.prop,t)},expression:"row[item.prop]"}}):"propertyType"===a.prop?t("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"请选择"},model:{value:r[a.prop],callback:function(t){e.$set(r,a.prop,t)},expression:"row[item.prop]"}},e._l(e.dataTypes,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1):t("el-input",{model:{value:r[a.prop],callback:function(t){e.$set(r,a.prop,t)},expression:"row[item.prop]"}})]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:r}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.handleDelete(r,e.ruleForm.properties)}}},[e._v(" 删除 ")])]}}])})],2)],1)],1)],1),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},s=[],i=a("5880"),o=a("e0e9"),l=a("f0d6"),n=a("22f9"),c=Object.defineProperty,u=Object.defineProperties,d=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t)=>u(e,d(t)),y=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),v={name:"Index",components:{TableEdit:l["default"]},props:{dataTypes:{type:Array,required:!1,default(){return["int32","float","double","enum","bool","text","date","struct","array"]}}},data(){return{ruleForm:{name:"",description:"",multiVersion:1,properties:[{propertyDesc:"",propertyCode:"",propertyType:"",isNull:!1,display:!0,isUnique:!1,array:!1,defaultValue:"",propertyLimit:{},propertyIndex:0,queryCondition:!1}],prefixNested:!1},rules:{name:[{required:!0,message:"请输入元数据名称",trigger:"blur"},{min:1,max:32,message:"长度在 1 到 32 个字符",trigger:"blur"}],multiVersion:[{required:!0,message:"请选择多版本管理",trigger:"change"}],description:[{required:!1,message:"请输入元数据描述",trigger:"blur"}],prefixNested:[{required:!0,message:"请选择是否需要唯一标识定义层级关系",trigger:"change"}]},infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["属性名称","属性类型","属性标识","唯一标识","是否必填","显示属性","查询属性","多值"],columns:[{label:"属性名称",width:"auto",prop:"propertyDesc",sortable:!0,disableCheck:!0},{label:"属性类型",width:"auto",prop:"propertyType",sortable:!0},{label:"属性标识",width:"200",prop:"propertyCode",sortable:!0},{label:"唯一标识",width:"auto",prop:"isUnique",sortable:!0},{label:"显示属性",width:"auto",prop:"display",sortable:!0},{label:"是否必填",width:"auto",prop:"isNull",sortable:!0},{label:"多值",width:"auto",prop:"array",sortable:!0}],list:[],imageList:[],listLoading:!!this.$route.query.objectId,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.featUnit(),this.$route.query.objectId&&this.fetchData()},mounted(){},destroyed(){},methods:b(g({},Object(i["mapActions"])({delVisitedRoute:"tabs/delVisitedRoute"})),{featUnit(){return y(this,null,(function*(){const{UnifyUnitSpecsDTO:e=[]}=yield Object(n["getDlinkJson"])("Unit")}))},handleEdit(e){this.$refs["edit"].showEdit(e)},submitForm(e){this.$refs[e].validate(t=>y(this,null,(function*(){if(!t)return console.log("error submit!!"),!1;{const t=this[e],a={data:t,type:"metaData",class:"metaData",title:this.ruleForm.name,key:this.ruleForm.name,parent:{__type:"Pointer",className:"Dict",objectId:"0"}};delete a.data.objectId,this.$route.query.objectId?yield Object(o["putDict"])(this.$route.query.objectId,a):yield Object(o["postDict"])(a),this.$router.go(-1)}})))},fetchData(){return y(this,null,(function*(){const e=this.$route.query.objectId;document.title=document.title.replace("新建","修改");const t=this.$baseColorfullLoading(2),a=yield Object(o["getDict"])(e);t.close(),delete a.createdAt,delete a.updatedAt,this.ruleForm=a.data}))},handleDelete(e,t){return y(this,null,(function*(){this.$baseConfirm("你确定要删除当前项吗",null,()=>y(this,null,(function*(){t.splice(e,1),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success")})))}))}})},w=v,_=(a("2a9e"),a("2877")),$=Object(_["a"])(w,r,s,!1,null,"0d57915c",null);t["default"]=$.exports},e23f:function(e,t,a){},e49b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.deviceFlag,width:"100vh"},on:{"update:visible":function(t){e.deviceFlag=t}}},[t("change-info",{attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}})],1)],1),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket number")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[t("el-select",{attrs:{placeholder:e.$translateTitle("equipment.Products")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,a){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type")}},[t("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.the starting time")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(a){return t("el-option",{key:a.key,attrs:{label:e.$translateTitle(a.text),value:a.key}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-folder-checked",type:"primary"},on:{click:function(t){return e.Export(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"140"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.getStatus(t.status))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.Products"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.productname?t.info.productname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.devicename?t.info.devicename:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t.info&&t.info.createdname?t.info.createdname:"")+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.showInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")])]}}])})],1),t("div",{staticClass:"elpagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.skip,layout:"total, sizes, prev, pager, next, jumper","page-size":e.queryForm.limit,"page-sizes":[5,10,20,30,50],total:e.total},on:{"update:currentPage":function(t){return e.$set(e.queryForm,"skip",t)},"update:current-page":function(t){return e.$set(e.queryForm,"skip",t)},"update:pageSize":function(t){return e.$set(e.queryForm,"limit",t)},"update:page-size":function(t){return e.$set(e.queryForm,"limit",t)},"current-change":e.fetchData,"size-change":e.fetchData}})],1)],1)},s=[],i=a("ce31"),o=a("1267"),l=a("1285"),n=a("e915"),c=a("5880"),u=Object.defineProperty,d=Object.defineProperties,m=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,a)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,b=(e,t)=>{for(var a in t||(t={}))h.call(t,a)&&g(e,a,t[a]);if(p)for(var a of p(t))f.call(t,a)&&g(e,a,t[a]);return e},y=(e,t)=>d(e,m(t)),v=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),w={name:"Index",components:{ChangeInfo:n["default"]},data(){return{selectedList:[],ishard:!0,isfooter:!1,step:1,length:20,detail:{},deviceFlag:!1,AllDevice:[],status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:y(b({},Object(c["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.height",this.height)},mounted(){this.fetchData()},methods:{changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},Export(e){return v(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(o["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},showInfo(e){this.ishard=!0,this.isfooter=!1;let{status:t=0}=e;dgiotlog.log("row",e),this.detail=e,this.step=t+1,this.deviceFlag=!0},getStatus(e=0){switch(e){case 0:return"待分配";case 1:return"已分配";case 2:return"已处理";case 3:return"已结单";default:return e}},fetchData(){return v(this,arguments,(function*(e={}){var t;dgiotlog.log(this.queryForm.toString(),"queryForm",e),e.limit||(e=this.queryForm),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:this.queryForm.limit,order:this.queryForm.order,skip:(this.queryForm.skip-1)*this.queryForm.limit,count:"objectId",where:{}};this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),_.isNumber(this.queryForm.status)&&(r.where.status=this.queryForm.status),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(i["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(5)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(this.$translateTitle("node.export error")+""+e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return v(this,null,(function*(){this.Device=[];const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},handleRemove(e){this.form.photo.forEach((t,a)=>{t.split("/")[""+(t.split("/").length-1)]==e.name&&this.form.photo.splice(a,1)}),dgiotlog.log(this.form.photo)},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},$=w,k=(a("0670"),a("2877")),x=Object(k["a"])($,r,s,!1,null,"479c0fa4",null);t["default"]=x.exports},e53e:function(e,t,a){"use strict";a("7b8f")},e80c:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"detail-container"},[t("div",{staticClass:"detail"},[t("div",{staticClass:"in_top"},[t("div",{staticClass:"top_name"},[e._v(e._s(e.name))]),t("div",{staticClass:"top_btn"},[t("el-button",[e._v("归档")]),t("el-button",{attrs:{type:"warning"}},[e._v("发布")]),t("el-button",[e._v("删除")]),t("el-button",[e._v("编辑")])],1)]),t("div",{staticClass:"in_ctr"},[e._v("工厂编码: "+e._s(e.objectid))]),t("div",{staticClass:"in_btm"},[t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"车间属性",name:"first"}},[t("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"warning"},on:{click:e.openCreatePlant}},[e._v(" 新增车间 ")]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",label:"车间名称",prop:"name","show-overflow-tooltip":"",width:"200"}}),t("el-table-column",{attrs:{align:"center",label:"车间编码",prop:"code","show-overflow-tooltip":"",width:"200"}}),t("el-table-column",{attrs:{align:"center",label:"状态",prop:"status","show-overflow-tooltip":"",width:"200"}}),t("el-table-column",{attrs:{align:"center",label:"车间描述",prop:"desc","show-overflow-tooltip":"",width:"300"}}),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"300"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:a.objectId,type:"edit"}})}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v(" 删除 ")])]}}])})],1),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),t("el-tab-pane",{attrs:{label:"属性列表",name:"second"}},[e._v("配置管理")])],1)],1)]),t("el-dialog",{attrs:{"append-to-body":!0,direction:e.direction,height:"60%",title:"新增工厂",visible:e.drawer,width:"30%"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"demo-drawer__content"},[t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"工厂名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入工厂名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"岗位",prop:"tempname"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择岗位"},model:{value:e.form.tempname,callback:function(t){e.$set(e.form,"tempname",t)},expression:"form.tempname"}},e._l(e.dict,(function(e){return t("el-option",{key:e.objectId,attrs:{label:e.key,value:e.key}})})),1)],1),t("el-form-item",{attrs:{label:"工厂描述"}},[t("el-input",{attrs:{maxlength:"500",placeholder:"不超过500个字符","show-word-limit":"",type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 立即创建 ")]),t("el-button",{on:{click:e.openCreatePlant}},[e._v("取消")])],1)],1)],1)])],1)},s=[],i=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),o={name:"Detail",components:{},props:{},data(){return{name:"",objectid:"",border:!0,height:this.$baseTableHeight(0)-100,stripe:!0,lineHeight:"mini",plantlist:[],activeName:"first",drawer:!1,parent:"",direction:"rtl",dict:[],wrapclose:!1,form:{name:"",tempname:"",desc:""},rules:{name:[{required:!0,message:"请输入工厂名称",trigger:"blur"},{min:2,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],tempname:[{required:!0,message:"请选择岗位",trigger:"blur"}]},queryForm:{skip:0,limit:20,name:""}}},computed:{},watch:{},created(){const{name:e,objectid:t}=this.$route.query;this.name=e,this.objectid=t},mounted(){},destroyed(){},methods:{handleSizeChange(e){this.queryForm.limit=e},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit)},handleClick(e,t){console.log(e,t)},getDict(){return i(this,null,(function*(){const e={where:{type:"roletemp"}},{results:t}=yield queryDictTemp(e);this.dict=t}))},fetchData(){return i(this,null,(function*(){const{results:e}=yield queryRoleTree();this.plantlist=e[0].children,this.parent=e[0].objectId}))},modelToDetail(e){this.$router.push({path:"/oc/Modeling/modeldetail",query:{objectid:e.objectId,name:e.name}})},openCreatePlant(){this.form={name:"",tempname:"",desc:""},this.drawer=!this.drawer},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;{const e={depname:this.form.name,desc:this.form.desc,name:this.form.name,parent:this.parent,tempname:this.form.tempname};postRole(e).then(e=>{this.fetchData(),this.drawer=!this.drawer})}})}}},l=o,n=(a("68cc"),a("2877")),c=Object(n["a"])(l,r,s,!1,null,"d64e9e0e",null);t["default"]=c.exports},e845:function(e,t,a){"use strict";a("24ee")},e915:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return e.detail?t("div",{staticClass:"changeInfo"},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),t("el-col",{attrs:{span:7}},[t("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),t("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[t("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),t("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?t("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?t("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?t("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?t("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):t("div",{staticClass:"empty"},[t("dgiot-empty")],1)},s=[],i=a("f47e"),o=a("4f46"),l=a("bacb"),n=a("34f5"),c={name:"ChangeInfo",components:{Step1:i["default"],Step2:o["default"],Step3:l["default"],Step4:n["default"]},props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data(){return{isStep:0}},mounted(){4==this.step&&(this.isStep=4),dgiotlog.log(this.step)},methods:{next(){this.isStep++>5&&(this.isStep=0)},handleSetStep(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("80e1"),a("2877")),m=Object(d["a"])(u,r,s,!1,null,"0c7079ac",null);t["default"]=m.exports},e9cd:function(e,t,a){},eaf6:function(e,t,a){},eafb8:function(e,t,a){},eea5:function(e,t,a){"use strict";a("5385")},f0d6:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"append-to-body":!0,title:e.title,visible:e.dialogFormVisible,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.save.apply(null,arguments)}}},[e._v("确 定")])]},proxy:!0}])},[t("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title","string"===typeof t?t.trim():t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"作者",prop:"author"}},[t("el-input",{model:{value:e.form.author,callback:function(t){e.$set(e.form,"author","string"===typeof t?t.trim():t)},expression:"form.author"}})],1)],1)],1)},s=[],i=a("8456"),o=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),l={name:"TableEdit",data(){return{form:{title:"",author:""},rules:{title:[{required:!0,trigger:"blur",message:"请输入标题"}],author:[{required:!0,trigger:"blur",message:"请输入作者"}]},title:"",dialogFormVisible:!1}},created(){},methods:{showEdit(e){e?(this.title="编辑",this.form=Object.assign({},e)):this.title="添加",this.dialogFormVisible=!0},close(){this.$refs["form"].resetFields(),this.form=this.$options.data().form,this.dialogFormVisible=!1},save(){this.$refs["form"].validate(e=>o(this,null,(function*(){if(e){const{msg:e}=yield Object(i["doEdit"])(this.form);this.$baseMessage(e,"success","dgiot-hey-message-success"),this.$emit("fetch-data"),this.close()}})))}}},n=l,c=a("2877"),u=Object(c["a"])(n,r,s,!1,null,null,null);t["default"]=u.exports},f2b6:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mycontainer"},[t("div",{staticClass:"ticker-dialog"},[t("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.parserView},on:{"update:visible":function(t){e.parserView=t}}},[t("ele-form",e._b({attrs:{config:e.formConfig,pure:"","request-fn":e.handleSubmit},on:{"request-success":function(t){return e.handleSuccess(e.alertConfig)}},model:{value:e.alertConfig.config,callback:function(t){e.$set(e.alertConfig,"config",t)},expression:"alertConfig.config"}},"ele-form",e.alertConfig.config,!1))],1),t("el-dialog",{attrs:{"append-to-body":!0,height:"20%",title:"告警内容",visible:e.dynamicformView,width:"50%"},on:{"update:visible":function(t){e.dynamicformView=t}}},[t("div",[t("el-form",{staticStyle:{"margin-left":"20px","margin-rigth":"20px"}},[t("el-form-item",{attrs:{label:"产品名称","label-width":"200"}},[t("span",[e._v(e._s(e.editRow.productname))])]),t("el-form-item",{attrs:{label:"设备编号","label-width":"200"}},[t("span",[e._v(e._s(e.devicename))])]),3==e.status?t("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm status")}},[e._v(" "+e._s("自动恢复")+" ")]):e._e(),e.status<3?t("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm status")}},[t("el-radio",{attrs:{label:"1"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("误报")]),t("el-radio",{attrs:{label:"2"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("手动恢复")])],1):e._e(),t("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm remark")}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.process,callback:function(t){e.process=t},expression:"process"}})],1)],1),t("el-form",{staticStyle:{"text-align":"right"}},[t("el-button",{on:{click:function(t){e.dynamicformView=!1}}},[e._v(" "+e._s(e.$translateTitle("tagsView.close"))+" ")]),t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitAlert(e.alertId)}}},[e._v(" "+e._s(e.$translateTitle("button.submit"))+" ")])],1),t("dgiot-amis",{attrs:{schema:e.amisData,"show-help":!1}})],1)])],1),t("dgiot-query-form",{staticClass:"query-form"},[t("dgiot-query-form-top-panel",[t("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:e.$translateTitle("alert.productname")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.entername")},model:{value:e.queryForm.productName,callback:function(t){e.$set(e.queryForm,"productName",t)},expression:"queryForm.productName"}},e._l(e._Product,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.objectId}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm status")}},[t("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("alert.Alarm status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.processAll,(function(e,a){return t("el-option",{key:a,attrs:{label:e.key,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[t("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),t("el-form-item",[t("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",type:"danger"},on:{click:function(t){return e.fetchDelete(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[t("dgiot-empty")]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.alert number"),prop:"objectId","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.productname"),prop:"productname","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.$moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-tag",{attrs:{effect:"dark",type:a.status>1?"success":"danger"}},[e._v(" "+e._s(1==a.status?e.$translateTitle("Maintenance.Distort"):2==a.status?e.$translateTitle("Maintenance.Manualrecovery"):3==a.status?e.$translateTitle("Maintenance.Automaticrecovery"):e.$translateTitle("Maintenance.Untreated"))+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Remarks"),prop:"process","show-overflow-tooltip":"",sortable:""}}),t("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showdynamicform(a)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),t("dgiot-parser-pagination",{key:e.paginationKey+"forensics",ref:"forensics",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}})],1)},s=[],i=a("4569"),o=a("dcc6"),l=a("7212"),n=a("5880"),c=a("4be7"),u=a("8ba7"),d=Object.defineProperty,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),y={name:"Index",components:{},data(){return{paginationKey:moment(new Date).valueOf()+"",editRow:{},amisData:{},paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"dynamicform",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},selectedList:[],isDisable:!1,parserView:!1,dynamicformView:!1,formConfig:{},alertConfig:{},dynamicformInfo:{},alertId:"",step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",process:"",status:"",devicename:"",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},processAll:[{key:"未确认",value:0},{key:"误报",value:1},{key:"手动恢复",value:2},{key:"自动恢复",value:3}],list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{productName:"",status:"",number:"",product:"",type:"",searchDate:[],limit:10,skip:0,order:"-createdAt",keys:"objectId"}}},computed:g({},Object(n["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),created(){},mounted(){this.fetchData()},methods:{paginationQuery(e){return b(this,null,(function*(){this.queryPayload=e}))},fetchDelete(e){let t=[];e.forEach(e=>{t.push({method:"DELETE",path:"/classes/Notification/"+e.objectId,body:{}})}),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>b(this,null,(function*(){yield Object(o["batch"])(t);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleSubmit(e){return dgiotlog.log("data",e),c["Promise"].resolve()},handleSuccess(e){return b(this,null,(function*(){const{table:t}=e,a={public:!0};if(!t)return;const r=this.$baseColorfullLoading(3);try{const e=yield this.$update_object(t,this.alertId,a);dgiotlog.log(e),r.close()}catch(s){dgiotlog.log(s),r.close(),this.$baseMessage(s,"error","dgiot-hey-message-error")}this.$nextTick(()=>{this.parserView=!1,this.fetchData()})}))},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},submitAlert(e){return b(this,null,(function*(){const t=this.$baseColorfullLoading(4);t.close();let a={process:this.process,status:Number(this.status)};console.log("alertId",e),console.log("alertParams",a);try{const t=yield Object(i["putNotification"])(e,a);dgiotlog.log(t),this.$message({showClose:!0,duration:2e3,message:"处理成功",type:"success"})}catch(r){dgiotlog.log(r),this.$baseMessage("处理失败","error","dgiot-hey-message-error")}this.fetchData(),this.dynamicformView=!1}))},showdynamicform(e){return b(this,null,(function*(){localStorage.setItem("parse_objectid",e.deviceid),localStorage.setItem("parse_notificationid",e.objectId);const{data:t}=yield Object(u["getView"])(e.content._viewid);this.alertId=e.objectId,this.amisData={},this.devicename=e.devaddr,this.editRow=e,this.status=String(e.status),this.process=e.process,this.dynamicformView=!0,this.amisData=t}))},showInfo(e,t,a){return b(this,null,(function*(){const r=this.$baseColorfullLoading(4);dgiotlog.log(e,t);var[s,i]=e.split("_");dgiotlog.log(s,i),this.alertId=a;try{const{config:e}=yield Object(l["getProduct"])(s);r.close();const{parser:t=[],profile:a=[]}=e,o=[].concat(a,t);dgiotlog.log(o,"_mergeProfile");let n=o.map(e=>{if(e.uid==i)return e});dgiotlog.log(n,"_profileConfig"),this.formConfig=n[0].config,this.alertConfig=n[0],dgiotlog.log(this.formConfig,"formConfig")}catch(o){dgiotlog.log(o),r.close(),this.$baseMessage(o,"error","dgiot-hey-message-error")}this.formConfig=_.merge(t,this.formConfig),dgiotlog.log("_profileConfig",this.formConfig),this.$nextTick(()=>{this.parserView=!0})}))},handleDelete(e){return b(this,null,(function*(){const t=yield Object(i["delNotification"])(e);t=={}&&this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("Maintenance.delete")+this.$translateTitle("message.success"),type:"success"}),this.fetchData()}))},fetchData(){return b(this,arguments,(function*(e={}){this.paginationKey=moment(new Date).valueOf()+"",e.limit||(e=this.queryForm),this.listLoading=!1;const t=this.$baseColorfullLoading(3);this.queryForm.productName?this.queryPayload={limit:e.limit,order:e.order,skip:e.skip,count:e.keys,where:{"content._productid":{$regex:this.queryForm.productName}}}:this.queryPayload={limit:e.limit,order:e.order,skip:e.skip,count:"objectId",where:{}},String(this.queryForm.status+"").length>0&&(this.queryPayload.where["status"]=this.queryForm.status),isNaN(this.queryPayload.where["status"])&&delete this.queryPayload.where["status"],this.queryForm.searchDate.length&&(this.queryPayload.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]+"T08:00:00.000Z"}},this.queryPayload.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]+"T08:00:00.000Z"}}),console.log("this.queryPayload",this.queryPayload);const{results:a=[],count:r=0}=yield Object(i["queryNotification"])(this.queryPayload);this.list=a,this.total=r,this.$refs["forensics"].ination.total=r,t.close()}))},prodChange(e){return b(this,null,(function*(){this.Device=[];const t={where:{product:e}},{results:a}=yield queryDevice(t);dgiotlog.log(a,"设备"),this.Device=a}))},handleRemove(e){this.form.photo.forEach((t,a)=>{t.split("/")[""+(t.split("/").length-1)]==e.name&&this.form.photo.splice(a,1)}),dgiotlog.log(this.form.photo)},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},v=y,w=(a("89f9b"),a("2877")),$=Object(w["a"])(v,r,s,!1,null,"5e3e215c",null);t["default"]=$.exports},f42d:function(e,t,a){"use strict";a("45be")},f47e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[t("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")+": "}},[t("span",[e._v(e._s(e.form.info.productname))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[t("span",[e._v(e._s(e.form.info.devicename))])])],1),t("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[t("span",[e._v(e._s(e.form.info.createdname))])])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),t("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[t("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,a){return t("el-carousel-item",{key:a},[t("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Remarks")}},[t("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step1.Remarks,callback:function(t){e.$set(e.form.info.step1,"Remarks",t)},expression:"form.info.step1.Remarks"}})],1)],1):e._e(),e.showFooter?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Maintenance staff"),prop:"info.receiveusername",required:""}},[t("el-tree",{ref:"workGroup",staticStyle:{float:"left",width:"50%"},attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function({node:a,data:r}){return t("div",{staticClass:"custom-tree-node"},[t("span",{class:{selected:r.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(r,a)}}},[e._v(" "+e._s(a.label)+" ")])])}}],null,!1,2722443036)}),t("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"50%"},attrs:{disabled:!e.user.length,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Data is loading"),placeholder:e.$translateTitle("product.selectdepartment")},model:{value:e.form.info.receiveusername,callback:function(t){e.$set(e.form.info,"receiveusername",t)},expression:"form.info.receiveusername"}},e._l(e.user,(function(a){return t("el-option",{key:a.objectId,attrs:{label:a.nick,value:a.objectId}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(a.nick))]),t("span",{staticStyle:{float:"right","font-size":"14px",color:"#8492a6"}},[e._v(" "+e._s(a.objectId)+" ")])])})),1)],1)],1):e._e()],1)],1)],1),t("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[t("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[t("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),t("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[t("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(a){return t("el-timeline-item",{key:a.timestamp,attrs:{placement:"top",timestamp:a.timestamp}},[t("el-card",[t("h4",[e._v(e._s(a.h4))]),t("p",[e._v(e._s(a.p))])])],1)})),1)],1)],1)],1)],1)},s=[],i=a("ce31"),o=a("5da9"),l=a("bc35"),n=a("5880"),c=Object.defineProperty,u=Object.defineProperties,d=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t)=>u(e,d(t)),y=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),v={props:{detail:{type:Object,default:()=>{}},step:{type:Number,default:1},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1}},data(){return{roleName:"",loading:!1,user:[],deptTreeData:[],reverse:!0,roleProps:{children:"children",label:"name"},rules:{reverse:!0,"info.receiveusername":[{required:!0,message:"请选择分配人员",trigger:"change"}]},curDepartmentId:"",activeName:"first",form:this.detail}},computed:g({},Object(n["mapGetters"])({username:"user/username",token:"user/token",objectId:"user/objectId"})),mounted(){this.getRoletree()},methods:b(g({},Object(n["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{getRoletree(){return y(this,null,(function*(){yield Object(l["Roletree"])().then(e=>{this.deptTreeData=e.results,this.handleNodeClick(e.results[0],0)}).catch(e=>{dgiotlog.log(e)})}))},handleNodeClick(e,t){return y(this,null,(function*(){this.loading=!0,this.curDepartmentId=e.objectId,this.user=[],this.roleName=e.name;const{users:t}=yield Object(o["queryRoledepartment"])({name:e.name});dgiotlog.log("res",t),this.user=t,this.loading=!1}))},dispatchUser(){this.$refs["form"].validate(e=>y(this,null,(function*(){let t=this.user.filter(e=>e.objectId==this.form.info.receiveusername);if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const e={},{objectId:a,info:r,ACL:s,user:o}=this.form;r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已分配",p:`${this.username} 分配给 ${t[0].nick}`}),dgiotlog.log("_user",t),r.receiveusername=t[0].nick,r.receiveuseid=t[0].objectId,r.receiveuserphone=t[0].phone,e[""+t[0].objectId]={read:!0,write:!0},e["role:"+this.roleName]={read:!0,write:!0};const l={status:1,info:r,ACL:_.merge(e,s),user:{objectId:t[0].objectId,__type:"Pointer",className:"_User"}};dgiotlog.log(a,l,e);const n=yield Object(i["update_object"])("Maintenance",a,l);n.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},w=v,$=(a("009f"),a("2877")),k=Object($["a"])(w,r,s,!1,null,"7005a4a0",null);t["default"]=k.exports},f684:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[t("dgiot-query-form",[t("dgiot-query-form-left-panel",[t("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"标题"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),t("el-form-item",[t("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.handleAdd.apply(null,arguments)}}},[e._v(" 添加 ")])],1)],1)],1),t("dgiot-query-form-right-panel",[t("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"},on:{click:e.clickFullScreen}},[t("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}}),e._v(" 表格全屏 ")],1),t("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[t("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[t("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function({$index:t}){return[e._v(" "+e._s(t+1)+" ")]}}])}),e._l(e.finallyColumns,(function(a,r){return t("el-table-column",{key:r,attrs:{align:"center",label:a.label,sortable:"",width:a.width},scopedSlots:e._u([{key:"default",fn:function({row:r}){return["评级"===a.label?t("span",[t("el-rate",{attrs:{disabled:""},model:{value:r.rate,callback:function(t){e.$set(r,"rate",t)},expression:"row.rate"}})],1):t("span",[e._v(e._s(r[a.prop]))])]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],2),t("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),t("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},s=[],i=a("8456"),o=a("3248"),l=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},o=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{TableEdit:o["default"]},props:{},data(){return{infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["标题","作者","评级","点击量","时间"],columns:[{label:"标题",width:"auto",prop:"title",sortable:!0,disableCheck:!0},{label:"作者",width:"auto",prop:"author",sortable:!0},{label:"评级",width:"200",prop:"rate",sortable:!0},{label:"点击量",width:"auto",prop:"pageViews",sortable:!0},{label:"时间",width:"auto",prop:"datetime",sortable:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleAdd(){this.$refs["edit"].showEdit()},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){const{msg:t}=yield Object(i["doDelete"])({ids:e.id});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return l(this,null,(function*(){this.listLoading=!0;const{data:{list:e,total:t}}=yield Object(i["getList"])(this.queryForm);this.list=e;const a=[];e.forEach(e=>{a.push(e.img)}),this.imageList=a,this.total=t,this.listLoading=!1}))}}},c=n,u=(a("a9e7"),a("2877")),d=Object(u["a"])(c,r,s,!1,null,"1822dde8",null);t["default"]=d.exports},fa8b:function(e,t,a){},fba2:function(e,t,a){"use strict";a("eafb8")},fea7:function(e,t,a){}}]);