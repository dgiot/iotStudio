/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年11月29日12时46分09秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9a07cf8e"],{"00c5":function(t,e,a){t.exports=a.p+"static/img/personal_video_black_24dp.57cfa0c3.svg"},"07f0":function(t,e,a){"use strict";e["a"]={name:"Fabric",data(){return{width:1280,height:720,rect:[],canvas:{},showMenu:!1,x:"",y:"",mouseFrom:{},mouseTo:{},drawType:null,canvasObjectIndex:0,textbox:null,rectangleLabel:"warning",drawWidth:2,color:"#E34F51",drawingObject:null,moveCount:1,doDrawing:!1,polygonMode:!1,pointArray:[],lineArray:[],activeShape:!1,activeLine:"",line:{},delectKlass:{},imgFile:{},imgSrc:""}},watch:{drawType(){this.canvas.selection=!this.drawType},width(){this.canvas.setWidth(this.width)},height(){this.canvas.setHeight(this.height)}},mounted(){this.canvas=new fabric.Canvas("canvas",{}),this.canvas.selectionColor="rgba(0,0,0,0.05)",this.canvas.on("mouse:down",this.mousedown),this.canvas.on("mouse:move",this.mousemove),this.canvas.on("mouse:up",this.mouseup),document.onkeydown=t=>{46==t.keyCode&&this.deleteObj(),90==t.keyCode&&t.ctrlKey&&this.canvas.remove(this.canvas.getObjects()[this.canvas.getObjects().length-1])}},methods:{save(){var t=document.getElementById("canvas"),e=t.toDataURL("png");e=e.replace("image/png","image/octet-stream");var a="drawingboard_"+(new Date).getTime()+".png";this.saveFile(e,a)},saveFile(t,e){var a=document.createElement("a");a.href=t,a.download=e;var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)},uploadImg(){document.getElementById("imgInput").click()},loadExpImg(){var t=document.getElementById("expImg"),e=new fabric.Image(t,{selectable:!1});this.canvas.add(e)},uploadImgChange(){var t=document.getElementById("imgInput");this.imgFile=t.files[0];if(/\.(jpe?g|png|gif)$/i.test(this.imgFile.name)){var e=new FileReader,a=this;e.addEventListener("load",(function(){a.imgFile.name,a.imgSrc=this.result}),!1),e.readAsDataURL(this.imgFile)}var o=document.getElementById("img");o.onload=()=>{this.width=o.width,this.height=o.height;var t=new fabric.Image(o,{zIndex:-1,selectable:!1});this.canvas.add(t)}},drawTypeChange(t){this.drawType=t,this.canvas.skipTargetFind=!!t,this.canvas.isDrawingMode="pen"==t},mousedown(t){var e=t.pointer||this.transformMouse(t.e.offsetX,t.e.offsetY);if(this.mouseFrom.x=e.x,this.mouseFrom.y=e.y,this.doDrawing=!0,"text"==this.drawType&&this.drawing(),this.textbox&&(this.textbox.enterEditing(),this.textbox.hiddenTextarea.focus()),"polygon"==this.drawType){this.canvas.skipTargetFind=!1;try{this.pointArray.length>1&&t.target&&t.target.id==this.pointArray[0].id&&this.generatePolygon(),this.polygonMode&&this.addPoint(t)}catch(a){console.log(a)}}},mouseup(t){var e=t.pointer||this.transformMouse(t.e.offsetX,t.e.offsetY);this.mouseTo.x=e.x,this.mouseTo.y=e.y,this.drawingObject=null,this.moveCount=1,"polygon"!=this.drawType&&(this.doDrawing=!1)},mousemove(t){if(!(this.moveCount%2)||this.doDrawing){this.moveCount++;var e=t.pointer||this.transformMouse(t.e.offsetX,t.e.offsetY);if(this.mouseTo.x=e.x,this.mouseTo.y=e.y,"text"==this.drawType&&"polygon"==this.drawType||this.drawing(t),"polygon"==this.drawType){if(this.activeLine&&"line"==this.activeLine.class){var a=this.canvas.getPointer(t.e);this.activeLine.set({x2:a.x,y2:a.y});var o=this.activeShape.get("points");o[this.pointArray.length]={x:a.x,y:a.y,zIndex:1},this.activeShape.set({points:o}),this.canvas.renderAll()}this.canvas.renderAll()}}},deleteObj(){this.canvas.getActiveObjects().map(t=>{this.canvas.remove(t)})},transformMouse(t,e){return{x:t/1,y:e/1}},drawPolygon(){this.drawType="polygon",this.polygonMode=!0,this.pointArray=new Array,this.lineArray=new Array,this.canvas.isDrawingMode=!1},addPoint(t){var e=Math.floor(1e4*Math.random()),a=(new Date).getTime()+e,o=new fabric.Circle({radius:5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:(t.pointer.x||t.e.layerX)/this.canvas.getZoom(),top:(t.pointer.y||t.e.layerY)/this.canvas.getZoom(),selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",id:a,objectCaching:!1});0==this.pointArray.length&&o.set({fill:"red"});var i=[(t.pointer.x||t.e.layerX)/this.canvas.getZoom(),(t.pointer.y||t.e.layerY)/this.canvas.getZoom(),(t.pointer.x||t.e.layerX)/this.canvas.getZoom(),(t.pointer.y||t.e.layerY)/this.canvas.getZoom()];if(this.line=new fabric.Line(i,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1}),this.activeShape){var s=this.canvas.getPointer(t.e);i=this.activeShape.get("points");i.push({x:s.x,y:s.y});var r=new fabric.Polygon(i,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.canvas.remove(this.activeShape),this.canvas.add(r),this.activeShape=r,this.canvas.renderAll()}else{var n=[{x:(t.pointer.x||t.e.layerX)/this.canvas.getZoom(),y:(t.pointer.y||t.e.layerY)/this.canvas.getZoom()}];r=new fabric.Polygon(n,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.activeShape=r,this.canvas.add(r)}this.activeLine=this.line,this.pointArray.push(o),this.lineArray.push(this.line),this.canvas.add(this.line),this.canvas.add(o)},generatePolygon(){var t=new Array;this.pointArray.map((e,a)=>{t.push({x:e.left,y:e.top}),this.canvas.remove(e)}),this.lineArray.map((t,e)=>{this.canvas.remove(t)}),this.canvas.remove(this.activeShape).remove(this.activeLine);var e=new fabric.Polygon(t,{stroke:this.color,strokeWidth:this.drawWidth,fill:"rgba(255, 255, 255, 0)",opacity:1,hasBorders:!0,hasControls:!1});this.canvas.add(e),this.activeLine=null,this.activeShape=null,this.polygonMode=!1,this.doDrawing=!1,this.drawType=null},drawing(t){this.drawingObject&&this.canvas.remove(this.drawingObject);var e=null,a=this.mouseFrom.x,o=this.mouseFrom.y,i=this.mouseFrom,s=this.mouseTo;switch(this.drawType){case"arrow":var r=i.x,n=s.x,l=i.y,d=s.y,c=n-r,u=d-l,p=16*Math.cos(Math.PI/4),m=u/Math.sqrt(Math.pow(c,2)+Math.pow(u,2)),h=c/Math.sqrt(Math.pow(c,2)+Math.pow(u,2)),g=16*m/4,b=16*h/4,y=p*h,f=p*m,v=" M "+r+" "+l;v+=" L "+(n-y+g)+" "+(d-f-b),v+=" L "+(n-y+2*g)+" "+(d-f-2*b),v+=" L "+n+" "+d,v+=" L "+(n-y-2*g)+" "+(d-f+2*b),v+=" L "+(n-y-g)+" "+(d-f+b),v+=" Z",e=new fabric.Path(v,{stroke:this.color,fill:this.color,strokeWidth:this.drawWidth});break;case"pentagram":r=i.x,n=s.x,l=i.y,d=s.y,c=Math.abs(n-r),u=Math.abs(d-l);var $=Math.sqrt(c*c+u*u),w=Math.cos(18*Math.PI/180),F=Math.sin(18*Math.PI/180),j=[r,l+$],x=[r+2*$*F,l+$-2*$*w],_=[r-$*w,l+$*F],T=[r+$*w,l+$*F],G=[r-2*$*F,l+$-2*$*w];v=" M "+j[0]+" "+j[1];v+=" L "+x[0]+" "+x[1],v+=" L "+_[0]+" "+_[1],v+=" L "+T[0]+" "+T[1],v+=" L "+G[0]+" "+G[1],v+=" Z",e=new fabric.Path(v,{stroke:this.color,fill:this.color,strokeWidth:this.drawWidth});break;case"ellipse":t.e.shiftKey&&(s.x-a>s.y-o?s.y=o+s.x-a:s.x=a+s.y-o);Math.sqrt((s.x-a)*(s.x-a)+(s.y-o)*(s.y-o));e=new fabric.Ellipse({left:(s.x-a)/2+a,top:(s.y-o)/2+o,stroke:this.color,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",rx:Math.abs(a-s.x)/2,ry:Math.abs(o-s.y)/2,strokeWidth:this.drawWidth});break;case"rectangle":t.e.shiftKey&&(s.x-a>s.y-o?s.y=o+s.x-a:s.x=a+s.y-o);v="M "+i.x+" "+i.y+" L "+s.x+" "+i.y+" L "+s.x+" "+s.y+" L "+i.x+" "+s.y+" L "+i.x+" "+i.y+" z";e=new fabric.Path(v,{left:a,top:o,stroke:this.color,strokeWidth:this.drawWidth,fill:"rgba(255, 255, 255, 0)",hasControls:!1});break;case"text":this.textbox=new fabric.Textbox("",{left:i.x,top:i.y-10,fontSize:16,borderColor:this.color,fill:this.color,hasControls:!1}),this.canvas.add(this.textbox),this.textbox.enterEditing(),this.textbox.hiddenTextarea.focus();break;default:break}e&&(this.canvas.add(e),this.drawingObject=e)}}}},"08e9":function(t,e,a){t.exports=a.p+"static/img/timeline_black_24dp.29d77d59.svg"},"0c3c":function(t,e,a){"use strict";a.r(e);var o=function(){var t,e,a=this,o=a._self._c;return o("div",{staticClass:"comprehensive-table-container"},[o("dgiot-query-form",[o("dgiot-query-form-top-panel",[o("el-form",{ref:"form",attrs:{inline:!0,"label-width":"49px",model:a.queryForm,size:"mini"}},[o("el-form-item",{attrs:{label:a.$translateTitle("product.Bind Table Name"),"label-width":"80px"}},[o("el-select",{attrs:{"allow-create":"",clearable:"","default-first-option":"",disabled:(null==(e=null==(t=a.$route.query)?void 0:t.id)?void 0:e.length)>0,filterable:"",size:"mini"},on:{change:a.changeClass},model:{value:a.queryForm.class,callback:function(t){a.$set(a.queryForm,"class",t)},expression:"queryForm.class"}},a._l(a.DbaTable,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[o("span",{staticStyle:{float:"left"}},[a._v(a._s(t.label))]),o("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[a._v(" "+a._s(t.value)+" ")])])})),1)],1),o("el-form-item",{attrs:{label:"表单Id","label-width":"60px"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:"",size:"mini"},on:{change:function(t){return a.fetchData()}},model:{value:a.queryForm.key,callback:function(t){a.$set(a.queryForm,"key",t)},expression:"queryForm.key"}},a._l(a.keys,(function(t){return o("el-option",{key:t.objectId,attrs:{label:t.objectId,value:t.objectId}},[o("span",{staticStyle:{float:"left"}},[a._v(a._s(t.objectId))]),o("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[a._v(" "+a._s(t.description||t.name||t.title||t.username||t.type)+" ")])])})),1)],1),o("el-form-item",{attrs:{label:a.$translateTitle("product.title")}},[o("el-input",{model:{value:a.queryForm.title,callback:function(t){a.$set(a.queryForm,"title",t)},expression:"queryForm.title"}})],1),o("el-form-item",{attrs:{label:"渲染框架","label-width":"80px"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:""},on:{change:a.changeFlag},model:{value:a.queryForm.flag,callback:function(t){a.$set(a.queryForm,"flag",t)},expression:"queryForm.flag"}},a._l(a.flags,(function(t){return o("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[o("span",{staticStyle:{float:"left"}},[a._v(a._s(t.label))]),o("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[a._v(" "+a._s(t.value)+" ")])])})),1)],1),o("el-form-item",{attrs:{label:a.$translateTitle("rule.Typetemplate"),"label-width":"80px"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",disabled:a.viewForm.notification,filterable:""},on:{change:function(t){return a.fetchData()}},model:{value:a.queryForm.type,callback:function(t){a.$set(a.queryForm,"type",t)},expression:"queryForm.type"}},a._l(a.Types,(function(t){return o("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[o("span",{staticStyle:{float:"left"}},[a._v(a._s(t.label))]),o("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[a._v(" "+a._s(t.value)+" ")])])})),1)],1),o("el-form-item",{attrs:{label:a.$translateTitle("home.language")}},[o("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:""},on:{change:function(t){return a.fetchData()}},model:{value:a.queryForm.language,callback:function(t){a.$set(a.queryForm,"language",t)},expression:"queryForm.language"}},a._l(a.lang,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),o("el-form-item",[o("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:a.handleAdd}}),o("el-button",{attrs:{icon:"el-icon-search",type:"success"},on:{click:function(t){return a.fetchData()}}})],1)],1)],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:a.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:a.list,height:a.$baseTableHeight(0)}},[o("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"55"},scopedSlots:a._u([{key:"default",fn:function({$index:t}){return[a._v(" "+a._s(t+1)+" ")]}}])}),o("el-table-column",{attrs:{align:"center",label:"视图ID",prop:"objectId","show-overflow-tooltip":"",width:"auto"}}),o("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!a.queryForm.hiddenRow.includes("title"),expression:"!queryForm.hiddenRow.includes('title')"}],attrs:{align:"center",label:a.$translateTitle("product.title"),prop:"title","show-overflow-tooltip":"",width:"200px"},scopedSlots:a._u([{key:"default",fn:function({row:t}){return[o("el-form",{attrs:{model:t}},[o("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{size:"mini"}},[t.isEdit?o("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{size:"mini"},on:{blur:function(e){return a.blurEvent(t)},focus:function(e){t.oldTitle=t.title}},model:{value:t.title,callback:function(e){a.$set(t,"title",e)},expression:"row.title"}}):o("p",{staticStyle:{float:"left",height:"8px","margin-left":"15px"},domProps:{innerHTML:a._s(t.title)}}),o("i",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!row.isEdit"}],staticClass:"el-icon-edit",staticStyle:{float:"right","line-height":"26px",cursor:"pointer"},on:{click:function(e){t.isEdit=!t.isEdit}}})],1)],1)]}}])}),o("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!a.queryForm.hiddenRow.includes("class"),expression:"!queryForm.hiddenRow.includes('class')"}],attrs:{align:"center",label:a.$translateTitle("product.Table Name"),prop:"class","show-overflow-tooltip":"",width:"auto"}}),o("el-table-column",{attrs:{align:"center",label:"表名Id",prop:"key","show-overflow-tooltip":"",width:"auto"}}),o("el-table-column",{attrs:{align:"center",label:a.$translateTitle("rule.Typetemplate"),prop:"type","show-overflow-tooltip":"",width:"auto"}}),o("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!a.queryForm.hiddenRow.includes("createdAt"),expression:"!queryForm.hiddenRow.includes('createdAt')"}],attrs:{align:"center",label:a.$translateTitle("application.createtime"),prop:"createdAt","show-overflow-tooltip":"",width:"auto"}}),o("el-table-column",{attrs:{align:"center",label:"渲染框架","show-overflow-tooltip":"",width:"140"},scopedSlots:a._u([{key:"default",fn:function({row:t,$index:e}){return[o("Select",{on:{"on-change":function(e){return a.switchflag(t)}},model:{value:t.flag,callback:function(e){a.$set(t,"flag",e)},expression:"row.flag"}},a._l(a.flags,(function(t){return o("Option",{key:t.value,staticStyle:{"z-index":"999"},attrs:{placement:0==e?"top-start":"bottom-start",value:t.value}},[a._v(" "+a._s(t.label)+" ")])})),1)]}}])}),o("el-table-column",{attrs:{align:"center",label:a.$translateTitle("home.language"),"show-overflow-tooltip":"",width:"140"},scopedSlots:a._u([{key:"default",fn:function({row:t,$index:e}){return[o("Select",{on:{"on-change":function(e){return a.switchlanguage(t)}},model:{value:t.language,callback:function(e){a.$set(t,"language",e)},expression:"row.language"}},a._l(a.lang,(function(t){return o("Option",{key:t.value,staticStyle:{"z-index":"999"},attrs:{placement:0==e?"top-start":"bottom-start",value:t.value}},[a._v(" "+a._s(t.label)+" ")])})),1)]}}])}),o("el-table-column",{attrs:{align:"center",label:a.$translateTitle("node.operation"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:a._u([{key:"default",fn:function({row:t}){return[o("el-button",{directives:[{name:"show",rawName:"v-show",value:a.queryForm.showRow,expression:"queryForm.showRow"}],attrs:{type:"text"},on:{click:function(e){return a.handleNotification(t)}}},[a._v(" 关联 ")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:"role"===a.type,expression:"type === 'role'"}],attrs:{type:"text"},on:{click:function(e){a.handleRelation(t,a.setRowState(a.selectRow,t))}}},[a._v(" "+a._s(a.setRowState(a.selectRow,t))+" ")]),o("el-button",{attrs:{type:"text"},on:{click:function(e){return a.handleLowCode(t)}}},[a._v(" "+a._s(a.$translateTitle("application.preview"))+" ")]),o("el-button",{attrs:{type:"text"},on:{click:function(e){return a.handleEdit(t)}}},[a._v(" "+a._s(a.$translateTitle("product.Design"))+" ")]),o("el-button",{attrs:{type:"text"},on:{click:function(e){return a.handleDelete(t)}}},[a._v(" "+a._s(a.$translateTitle("task.Delete"))+" ")])]}}])})],1),o("dgiot-parser-pagination",{attrs:{pagination:a.paginations,"query-payload":a.queryPayload},on:{pagination:a.fetchData,paginationQuery:a.paginationQuery}}),o("view-edit",{ref:"edit",on:{"fetch-data":a.fetchData}}),o("lowcodeDesign",{ref:"lowcodeDesign",on:{objectId:a.lowcodeId}})],1)},i=[],s=a("ed07"),r=a("5880"),n=a("209d"),l=a("8ba7"),d=a("22f9"),c=a("eb54"),u=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(t,e,a)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,f=(t,e)=>{for(var a in e||(e={}))g.call(e,a)&&y(t,a,e[a]);if(h)for(var a of h(e))b.call(e,a)&&y(t,a,e[a]);return t},v=(t,e)=>p(t,m(e)),$=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())});const w={class:"",type:"",title:"",key:"",data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},disabled:!1,hiddenRow:[]};var F={name:"ComprehensiveTable",components:{ViewEdit:c["default"],lowcodeDesign:n["default"]},props:{classDisable:{required:!1,type:Boolean,default:()=>!1},type:{required:!1,type:String,default:()=>""},viewForm:{required:!1,type:Object,default:()=>w},editRow:{required:!1,type:Object,default:()=>{}},selectRow:{required:!1,type:Array,default:()=>{}}},data(){return{lang:[{label:"中文简体",value:"zh"},{label:"english",value:"en"},{label:"日本語",value:"jp"}],flags:[{value:"Amis",label:"动态表单"},{value:"Konva",label:"工业组态"}],Types:[],DbaTable:[],keys:[],lowcodeId:"",paginations:{pageSizes:[5,10,20,50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",background:!0,hidden:!1,small:!1,pageSize:10,total:0,pageCount:0,pagerCount:7,currentPage:1,popperClass:"",prevText:"",nextText:"",disabled:!1,hideOnSinglePage:!1},queryPayload:{excludeKeys:"data",include:"",order:"-updatedAt",limit:10,skip:0,count:"objectId"},queryForm:this.viewForm,list:[],imageList:[],listLoading:!0,selectRows:""}},created(){this.setTreeFlag(!1),this.fetchData(),this.featchTable()},mounted(){if("amis"==this.$route.query.type){const{key:t,type:e,_class:a}=this.$route.query;this.queryForm.key=t,this.queryForm.type=e,this.queryForm.class=a,this.queryForm.data={type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.profile\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        profile:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]}}this.$dgiotBus.$off("saveLowCode"),this.$dgiotBus.$on("saveLowCode",t=>{this.saveLowCode(t.id,t.data)})},methods:v(f({},Object(r["mapMutations"])({set_amisJson:"amis/set_amisJson",setTreeFlag:"settings/setTreeFlag"})),{changeFlag(t){return $(this,null,(function*(){console.log(t);const e=yield Object(d["getDlinkJson"])(t,{subtype:"all"});console.log("列表",e),this.Types=e,this.fetchData()}))},switchlanguage(t){return $(this,null,(function*(){if(!t.language)return!1;yield Object(l["putView"])(t.objectId,{language:t.language}),this.$message({type:"success",message:"语言类型修改成功",showClose:!0})}))},switchflag(t){return $(this,null,(function*(){if(console.log(t),!t.flag)return!1;yield Object(l["putView"])(t.objectId,{flag:t.flag}),this.$message({type:"success",message:"修改成功",showClose:!0})}))},setRowState(t,e){let a="关联";return _.isEmpty(t)?a="关联":t.forEach(t=>{t.objectId==e.objectId&&(a="解除关联")}),a},handleRelation(t,e){this.$emit("BusRole",{row:t,type:e})},blurEvent(t){return $(this,null,(function*(){t.isEdit=!t.isEdit,t.title!==t.oldTitle&&(yield Object(l["putView"])(t.objectId,{title:t.title}),this.$message({message:"标题修改成功",type:"success",showClose:!0,duration:1500}))}))},changeClass(t){return $(this,null,(function*(){if(this.fetchData(),!t)return!1;try{console.log(t);const e={order:"-updatedAt"},{results:a=[]}=yield this.$query_object(t,e);console.log(a),this.keys=a}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},featchTable(){return $(this,null,(function*(){try{const t=yield Object(s["getViews"])();this.DbaTable=t}catch(t){console.log(t)}}))},handleNotification(t){return $(this,null,(function*(){yield this.$baseEventBus.$emit("showNotificationSettings",t)}))},handleAdd(){this.$refs["edit"].type="add",this.$refs["edit"].DbaTable=this.DbaTable,this.$refs["edit"].dialogFormVisible=!0,this.$refs["edit"].showEdit(this.queryForm)},handleEdit(t){return $(this,null,(function*(){localStorage.setItem("parse_objectid",t.key);const e=this.$baseLoading(1),{data:a={}}=yield Object(l["getView"])(t.objectId);"Konva"==t.flag?(console.log("跳转",t),"Dashboard"==t.type?this.$router.push({path:"/Topo",query:{viewid:t.objectId,dashboard:!0}}):"topo"==t.type.toLowerCase()&&this.$router.push({path:"/Topo",query:{productid:t.key}})):this.$router.push({path:"/design/editor/amis/",query:{viewId:t.objectId,type:t.type}}),e.close(),this.set_amisJson(a)}))},handleDelete(t){console.log(t.data,t.objectId),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>$(this,null,(function*(){yield Object(l["delView"])(t.objectId);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),this.fetchData()})))},handleLowCode(t){return $(this,null,(function*(){localStorage.setItem("parse_objectid",t.key);const e=this.$baseColorfullLoading(1);e.close(),this.$dgiotBus.$emit("lowcodePreview",yield Object(l["getView"])(t.objectId))}))},saveLowCode(t,e){return $(this,null,(function*(){const a=this.$baseColorfullLoading(1);yield Object(l["putView"])(t,e);a.close()}))},paginationQuery(t){return $(this,null,(function*(){this.queryPayload=t}))},fetchData(t){return $(this,null,(function*(){_.isEmpty(t)&&(t=this.queryPayload),this.queryPayload.where={},this.queryForm.class&&(this.queryPayload.where.class={$regex:this.queryForm.class}),this.queryForm.type&&(this.queryPayload.where.type={$regex:this.queryForm.type}),this.queryForm.title&&(this.queryPayload.where.title={$regex:this.queryForm.title}),this.queryForm.key&&(this.queryPayload.where.key={$regex:this.queryForm.key}),this.queryForm.flag&&(this.queryPayload.where.flag={$regex:this.queryForm.flag}),this.queryForm.objectId&&(this.queryPayload.where.objectId={$regex:this.queryForm.objectId}),this.queryForm.language&&(this.queryPayload.where.language={$regex:this.queryForm.language});const{count:e,order:a,excludeKeys:o,limit:i,skip:s,where:r}=t;console.log(this.queryForm),this.listLoading=!0;const{results:n,count:d}=yield Object(l["queryView"])({count:e,order:a,excludeKeys:o,limit:i,skip:s,where:r});n&&n.forEach(t=>{t.isEdit=!1,t.oldTitle=t.title,t.createdAt=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}),this.list=n,this.$dgiotBus.$emit("lowcodeLen",d),this.paginations.total=d,this.listLoading=!1}))}})},j=F,x=a("2877"),T=Object(x["a"])(j,o,i,!1,null,null,null);e["default"]=T.exports},"0ed6":function(t,e,a){t.exports=a.p+"static/img/volume_up_black_24dp.74a31953.svg"},1476:function(t,e,a){"use strict";a("b938")},"162e":function(t,e,a){},"17ea":function(t,e,a){"use strict";a("5cb5")},1812:function(t,e,a){},"1a89":function(t,e,a){"use strict";a("a12d")},"209d":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"index-container"},[e("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],key:t.type+t.objectId,attrs:{"append-to-body":"","before-close":t.handleClose,size:"90%",title:t.objectId,visible:t.flag,"with-header":t.withHeader},on:{"update:visible":function(e){t.flag=e}}},["topo"===t.type?e("topo",{attrs:{code:t.code.konva,"object-id":t.objectId}}):e("amis",{attrs:{code:t.code,"object-id":t.objectId}})],1)],1)},i=[],s=a("8e26"),r=a("f27c"),n=a("5880"),l=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,h=(t,e,a)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,g=(t,e)=>{for(var a in e||(e={}))p.call(e,a)&&h(t,a,e[a]);if(u)for(var a of u(e))m.call(e,a)&&h(t,a,e[a]);return t},b=(t,e)=>d(t,c(e)),y=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),f={name:"Index",components:{topo:r["default"],amis:s["default"]},data(){return{withHeader:!0,types:["amis","deviceInfo","amis_view","topo","profile","content","notification","reportFrom"],code:{},objectId:"",flag:!1,type:"amis"}},mounted(){localStorage.removeItem("parse_objectid"),this.$dgiotBus.$off("lowcodePreview"),this.$dgiotBus.$on("lowcodePreview",t=>{const e={},{type:a,data:o,objectId:i,class:s}=t;"Device"==s&&(e["parse_objectid"]=parse_objectid,localStorage.setItem("parse_objectid",parse_objectid),console.groupCollapsed("%c amis env","color:#009a61; font-size: 28px"),console.groupEnd()),this.designLowCode(a,i,o)})},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:b(g({},Object(n["mapMutations"])({setData:"view/setData"})),{handleClose(t){return y(this,null,(function*(){try{this.$confirm("确认关闭？").then(e=>{t(),this.$dgiotBus.$emit("lowcodeClose")}).catch(t=>{})}catch(e){console.log(e)}}))},designLowCode(t,e,a){return y(this,null,(function*(){this.code=a,this.type=t,this.objectId=e,this.flag=!0}))}})},v=f,$=(a("1a89"),a("2877")),w=Object($["a"])(v,o,i,!1,null,"0c55f901",null);e["default"]=w.exports},2369:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"iframe-container"},[e("iframe",{attrs:{frameborder:"0",src:t.url}})])},i=[],s={name:"Swagger",data(){return{url:location.origin+"/dgiot_swagger/"}}},r=s,n=(a("89fd"),a("2877")),l=Object(n["a"])(r,o,i,!1,null,"757fa2e1",null);e["default"]=l.exports},"27f8":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon-selector-popper"},[e("div",{staticClass:"dialog"},[e("dgiot-input",{ref:"uploadFinish",on:{fileInfo:t.fileInfo}})],1),e("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[e("el-collapse-item",{attrs:{name:"icon",title:"iconfont"}},[e("el-row",{attrs:{gutter:20}},t._l(t.iconfont.glyphs,(function(a,o){return e("el-col",{directives:[{name:"show",rawName:"v-show",value:o<=11,expression:"index <= 11"}],key:a.icon_id,attrs:{span:8}},[e("i",{directives:[{name:"svg-drag",rawName:"v-svg-drag",value:{callback:t.coordinate},expression:"{ callback: coordinate }"}],on:{mousedown:function(e){return t.moveSvg(a)}}},[e("DgiotIconfont",{attrs:{name:a.font_class,title:a.name,type:"svg"}})],1)])})),1)],1)],1)],1)},i=[],s=a("ac49"),r=s["a"],n=(a("99a6"),a("2877")),l=Object(n["a"])(r,o,i,!1,null,null,null);e["default"]=l.exports},"32ca":function(t,e,a){t.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"337b":function(t,e,a){t.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"38e5":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"TopoArom"},[e("el-dialog",{attrs:{"append-to-body":!0,"before-close":t.wmxhandleClose,"close-on-click-modal":!1,title:t.wmxSituation+"自定义属性",top:"5vh",visible:t.wmxdialogVisible,width:"60%"},on:{"update:visible":function(e){t.wmxdialogVisible=e}}},[e("div",{staticClass:"wmxheader"},[e("el-form",{ref:"sizeForm",attrs:{"label-position":"left","label-width":"150px",model:t.sizeForm,rules:t.sizerule,size:"mini"}},["int"==t.sizeForm.type||"float"==t.sizeForm.type||"double"==t.sizeForm.type?e("div",[e("el-collapse",{model:{value:t.collapseName,callback:function(e){t.collapseName=e},expression:"collapseName"}},[e("el-collapse-item",{attrs:{name:"1"}},[e("template",{slot:"title"},[e("h3",{staticStyle:{"font-size":"normal"}},[t._v("数据存储")])]),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.functionname"),prop:"name"}},[e("el-input",{model:{value:t.sizeForm.name,callback:function(e){t.$set(t.sizeForm,"name",e)},expression:"sizeForm.name"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.identifier"),prop:"identifier"}},[e("el-input",{model:{value:t.sizeForm.identifier,callback:function(e){t.$set(t.sizeForm,"identifier",e)},expression:"sizeForm.identifier"}})],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"取值范围(最小值)",prop:"startnumber"}},[e("el-input",{attrs:{placeholder:t.$translateTitle("product.minimumvalue"),type:"number"},model:{value:t.sizeForm.startnumber,callback:function(e){t.$set(t.sizeForm,"startnumber",t._n(e))},expression:"sizeForm.startnumber"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"取值范围(最大值)",prop:"endnumber"}},[e("el-input",{attrs:{placeholder:t.$translateTitle("product.maximumvalue"),type:"number"},on:{input:function(e){return t.changeValue("sizeForm")}},model:{value:t.sizeForm.endnumber,callback:function(e){t.$set(t.sizeForm,"endnumber",t._n(e))},expression:"sizeForm.endnumber"}})],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"步长",prop:"step"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,precision:2,step:.01},model:{value:t.sizeForm.step,callback:function(e){t.$set(t.sizeForm,"step",e)},expression:"sizeForm.step"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.readandwritetype"),prop:"isread"}},[e("el-radio-group",{staticStyle:{width:"100%"},attrs:{size:"medium"},model:{value:t.sizeForm.isread,callback:function(e){t.$set(t.sizeForm,"isread",e)},expression:"sizeForm.isread"}},[e("el-radio",{attrs:{label:"rw"}},[t._v(" "+t._s(t.$translateTitle("product.readandwrite"))+" ")]),e("el-radio",{attrs:{label:"r"}},[t._v(" "+t._s(t.$translateTitle("product.onlyread"))+" ")])],1)],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.datatype"),prop:"type"}},[e("el-select",{staticStyle:{width:"100%"},on:{change:t.selectStruct},model:{value:t.sizeForm.type,callback:function(e){t.$set(t.sizeForm,"type",e)},expression:"sizeForm.type"}},[e("el-option",{attrs:{label:t.$translateTitle("product.struct"),value:"struct"}}),e("el-option",{attrs:{label:t.$translateTitle("product.init"),value:"int"}}),e("el-option",{attrs:{label:t.$translateTitle("product.float"),value:"float"}}),e("el-option",{attrs:{label:t.$translateTitle("product.double"),value:"double"}}),e("el-option",{attrs:{label:t.$translateTitle("product.bool"),value:"bool"}}),e("el-option",{attrs:{label:t.$translateTitle("product.enum"),value:"enum"}}),e("el-option",{attrs:{label:t.$translateTitle("product.string"),value:"string"}}),e("el-option",{attrs:{label:t.$translateTitle("product.date"),value:"date"}})],1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.unit")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:t.$translateTitle("product.unit")},model:{value:t.sizeForm.unit,callback:function(e){t.$set(t.sizeForm,"unit",e)},expression:"sizeForm.unit"}},t._l(t.allunit,(function(t,a){return e("el-option",{key:a,attrs:{label:t.data.Name+"/"+t.data.Symbol,value:t.data.Symbol}})})),1)],1)],1)],1)],2),e("el-collapse-item",{attrs:{name:"2"}},[e("template",{slot:"title"},[e("h3",{staticStyle:{"font-size":"normal"}},[t._v("数据采集")]),e("el-row",{staticStyle:{margin:"0 auto"}},[e("el-col",{attrs:{span:2}},[e("el-popover",{attrs:{placement:"right",trigger:"click",width:"400"}},[e("el-table",{attrs:{data:t.wmxData.slice((t.wmxstart-1)*t.wmxPageSize,t.wmxstart*t.wmxPageSize)}},[e("el-table-column",{attrs:{label:"标识符"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("span",{staticStyle:{"margin-left":"10px"}},[t._v(" "+t._s(a.identifier)+" ")])]}}],null,!1,945501893)}),e("el-table-column",{attrs:{label:"功能名称"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("span",{staticStyle:{"margin-left":"10px"}},[t._v(" "+t._s(a.name)+" ")])]}}],null,!1,3608931969)}),e("el-table-column",{attrs:{label:"数据类型"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("span",{staticStyle:{"margin-left":"10px"}},[t._v(" "+t._s(a.dataType.type)+" ")])]}}],null,!1,404777272)})],1),e("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":t.wmxPageSize,"page-sizes":[10,20,30,50],total:t.wmxData.length},on:{"current-change":t.wmxCurrentChange,"size-change":t.wmxSizeChange}}),e("el-button",{staticStyle:{"text-align":"center"},attrs:{slot:"reference",size:"mini"},slot:"reference"},[t._v(" 添加变量 ")])],1)],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 采集策略表达式 。 "),e("br"),t._v(" 如： "),e("br"),t._v(" 5分钟 = 5 * 60 "),e("br"),t._v(" 1小时 = 60 * 60 "),e("br"),t._v(" 5小时 = 5 * 60 * 60 "),e("br"),t._v(" 1天 = 24 * 60 * 60 "),e("br")]),e("i",{staticClass:"el-icon-question"})]),e("el-form-item",{attrs:{label:"采集策略(单位：秒)"}},[e("el-select",{staticStyle:{width:"95%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:t.sizeForm.strategy,callback:function(e){t.$set(t.sizeForm,"strategy",e)},expression:"sizeForm.strategy"}},t._l(t.sizeOption,(function(t){return e("el-option",{key:t.val,attrs:{label:t.label,size:"mini",value:t.val}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"采集轮次"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:t.sizeForm.round,callback:function(e){t.$set(t.sizeForm,"round",e)},expression:"sizeForm.round"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("p",{staticStyle:{position:"absolute",top:"26px",margin:"0","font-size":"12px",color:"black"}},[t._v(" 例如:1,3,5,8;(可选可自主填写)(注意:逗号为英文逗号) ")])],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 1. 采集值 设备上行数据经采集公式计算后显示 。 "),e("br"),t._v(" 公式中的%s为占位符，是固定字段。 "),e("br"),t._v(" 如： "),e("br"),t._v(" 加：%s+10 "),e("br"),t._v(" 减：%s-10 "),e("br"),t._v(" 乘：%s*10 "),e("br"),t._v(" 除：%s/10 "),e("br"),t._v(" 余数：%s%10 "),e("br"),t._v(" 2. 计算值 添加变量按钮, "),e("br"),t._v(" 复制对应的标识符 "),e("br"),t._v(" 例：pressure_out "),e("br"),t._v(" 加：pressure_out+10 "),e("br"),t._v(" 减：pressure_out-10 "),e("br"),t._v(" 乘：pressure_out*10 "),e("br"),t._v(" 除：pressure_out/10 "),e("br"),t._v(" 余数：pressure_out%10 "),e("br"),t._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),e("br")]),e("i",{staticClass:"el-icon-question"})]),e("el-form-item",{attrs:{label:"采集公式"}},[e("el-input",{staticStyle:{width:"95%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:t.sizeForm.collection,callback:function(e){t.$set(t.sizeForm,"collection",e)},expression:"sizeForm.collection"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"采集顺序"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{label:"采集顺序",min:0},model:{value:t.sizeForm.Order,callback:function(e){t.$set(t.sizeForm,"Order",e)},expression:"sizeForm.Order"}})],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:24}},[e("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 1. 采集值: 主动向设备写数据经控制公式计算后下发 。 "),e("br"),t._v(" 公式中的%s为占位符，是固定字段。 "),e("br"),t._v(" 如： "),e("br"),t._v(" 加：%s+10 "),e("br"),t._v(" 减：%s-10 "),e("br"),t._v(" 乘：%s*10 "),e("br"),t._v(" 除：%s/10 "),e("br"),t._v(" 余数：%s%10 "),e("br"),t._v(" 2. 计算值: 点击添加变量按钮, "),e("br"),t._v(" 复制对应的标识符 "),e("br"),t._v(" 例：pressure_out "),e("br"),t._v(" 加：pressure_out+10 "),e("br"),t._v(" 减：pressure_out-10 "),e("br"),t._v(" 乘：pressure_out*10 "),e("br"),t._v(" 除：pressure_out/10 "),e("br"),t._v(" 余数：pressure_out%10 "),e("br"),t._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),e("br")]),e("i",{staticClass:"el-icon-question",staticStyle:{float:"left"}})]),e("el-form-item",{attrs:{label:"控制公式"}},[e("el-input",{staticStyle:{width:"98%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:t.sizeForm.control,callback:function(e){t.$set(t.sizeForm,"control",e)},expression:"sizeForm.control"}})],1)],1)],1)],2),e("el-collapse-item",{attrs:{name:"3"}},[e("template",{slot:"title"},[e("h3",{staticStyle:{"font-size":"normal"}},[t._v("数据来源")])]),e("el-divider"),e("div",{attrs:{name:"dataIdentification"}},[e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"数据标识",prop:"dis",required:""}},[e("el-input",{attrs:{placeholder:"数据标识"},model:{value:t.sizeForm.dis,callback:function(e){t.$set(t.sizeForm,"dis",e)},expression:"sizeForm.dis"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"数据",required:""}},[e("el-input",{attrs:{placeholder:"数据个数"},model:{value:t.sizeForm.dinumber,callback:function(e){t.$set(t.sizeForm,"dinumber",t._n(e))},expression:"sizeForm.dinumber"}})],1)],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"协议类型"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.sizeForm.protocol,callback:function(e){t.$set(t.sizeForm,"protocol",e)},expression:"sizeForm.protocol"}},t._l(["normal","modbus","DLT645"],(function(t,a){return e("el-option",{key:a,attrs:{label:t,value:t}})})),1)],1)],1),e("el-col",{directives:[{name:"show",rawName:"v-show",value:"modbus"==t.sizeForm.protocol,expression:"sizeForm.protocol == 'modbus'"}],attrs:{span:12}},[e("el-form-item",{attrs:{label:"字节序",prop:"byteorder"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.sizeForm.byteorder,callback:function(e){t.$set(t.sizeForm,"byteorder",e)},expression:"sizeForm.byteorder"}},t._l([{value:"big",label:"大端"},{value:"little",label:"小端"}],(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),e("el-row",{directives:[{name:"show",rawName:"v-show",value:t.showNewItem,expression:"showNewItem"}],attrs:{gutter:24}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"寄存器状态",prop:"byteorder"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.sizeForm.operatetype,callback:function(e){t.$set(t.sizeForm,"operatetype",e)},expression:"sizeForm.operatetype"}},t._l([{value:"coilStatus",label:"线圈状态"},{value:"输入状态",label:"输入状态"},{value:"holdingRegister",label:"保持寄存器"},{value:"inputRegister",label:"输入寄存器"}],(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"数据类型"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.sizeForm.originaltype,callback:function(e){t.$set(t.sizeForm,"originaltype",e)},expression:"sizeForm.originaltype"}},t._l(["int16","uint16","int32","uint32","int64","uint64","float","double","string","customizedData"],(function(t,a){return e("el-option",{key:a,staticStyle:{width:"100%"},attrs:{label:t,value:t}})})),1)],1)],1),e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"从机地址"}},[e("el-input",{attrs:{"auto-complete":"off"},model:{value:t.sizeForm.slaveid,callback:function(e){t.$set(t.sizeForm,"slaveid",e)},expression:"sizeForm.slaveid"}})],1)],1)],1)],2)],1)],1):t._e(),"bool"==t.sizeForm.type?e("div",[e("el-form-item",{attrs:{label:t.$translateTitle("product.attribute"),required:""}},[e("div",{staticStyle:{height:"40px"}},[e("el-col",{attrs:{span:11}},[e("el-form-item",[e("el-input",{staticClass:"inputnumber",staticStyle:{width:"100%"},attrs:{placeholder:t.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:t.sizeForm.truevalue,callback:function(e){t.$set(t.sizeForm,"truevalue",e)},expression:"sizeForm.truevalue"}})],1)],1),e("el-col",{attrs:{span:2}},[t._v("-")]),e("el-col",{attrs:{span:11}},[e("el-form-item",{attrs:{prop:"true"}},[e("el-input",{staticClass:"inputnumber",attrs:{placeholder:t.$translateTitle("product.egopen")},model:{value:t.sizeForm.true,callback:function(e){t.$set(t.sizeForm,"true",e)},expression:"sizeForm.true"}})],1)],1)],1),e("div",{staticStyle:{"margin-top":"20px"}},[e("el-col",{attrs:{span:11}},[e("el-form-item",[e("el-input",{staticClass:"inputnumber",attrs:{placeholder:t.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:t.sizeForm.falsevalue,callback:function(e){t.$set(t.sizeForm,"falsevalue",e)},expression:"sizeForm.falsevalue"}})],1)],1),e("el-col",{attrs:{span:2}},[t._v("-")]),e("el-col",{attrs:{span:11}},[e("el-form-item",{attrs:{prop:"true"}},[e("el-input",{staticClass:"inputnumber",attrs:{placeholder:t.$translateTitle("product.egclose")},model:{value:t.sizeForm.false,callback:function(e){t.$set(t.sizeForm,"false",e)},expression:"sizeForm.false"}})],1)],1)],1)])],1):t._e(),"enum"==t.sizeForm.type?e("div",[t._l(t.sizeForm.specs,(function(a,o){return e("el-form-item",{key:o,attrs:{required:""}},[e("el-col",{attrs:{span:9}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.attribute")+o,prop:"specs."+o+".attribute",rules:[{required:!0,message:"输入属性"}]}},[e("el-input",{attrs:{placeholder:t.$translateTitle("product.egnumber0")},model:{value:a.attribute,callback:function(e){t.$set(a,"attribute",e)},expression:"item.attribute"}})],1)],1),e("el-col",{staticClass:"line",attrs:{span:2}},[t._v("-")]),e("el-col",{attrs:{span:9}},[e("el-form-item",{attrs:{label:t.$translateTitle("product.attributevalue")+o,prop:"specs."+o+".attributevalue",rules:[{required:!0,message:"输入属性值"}]}},[e("el-input",{attrs:{placeholder:t.$translateTitle("developer.describe")},model:{value:a.attributevalue,callback:function(e){t.$set(a,"attributevalue",e)},expression:"item.attributevalue"}})],1)],1),e("el-col",{staticClass:"line",attrs:{span:2}}),e("el-col",{staticClass:"line",attrs:{span:4}},[e("el-link",{staticStyle:{"margin-top":"30px","margin-left":"5px"},attrs:{icon:"el-icon-minus",type:"primary",underline:!1},on:{click:function(e){return e.preventDefault(),t.removeDomain(a)}}},[t._v(" "+t._s(t.$translateTitle("developer.delete"))+" ")])],1)],1)})),e("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:t.addDomain}},[t._v(" "+t._s(t.$translateTitle("product.add"))+" ")])],2):t._e(),"struct"==t.sizeForm.type?e("div",[e("el-form-item",{attrs:{label:"JSON对象",required:""}},[e("ul",{staticStyle:{"padding-left":"20px",margin:"0"}},t._l(t.sizeForm.struct,(function(a,o){return e("li",{key:o,staticStyle:{display:"flex","list-style":"none"},attrs:{value:"item"}},[e("div",[e("span",[t._v(" "+t._s(t.$translateTitle("product.parametername")+":")+"} ")]),e("span",[t._v(t._s(a.name))])]),e("div",[e("el-link",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",underline:!1},on:{click:function(e){return t.editStruct(a,o)}}},[t._v(" "+t._s(t.$translateTitle("developer.edit"))+" ")]),e("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(e){return t.deleteStruct(o)}}},[t._v(" "+t._s(t.$translateTitle("developer.delete"))+" ")])],1)])})),0),e("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:function(e){return t.addStruct("structform")}}},[t._v(" "+t._s(t.$translateTitle("product.addparameter"))+" ")])],1)],1):t._e(),"string"==t.sizeForm.type?e("div",[e("el-form-item",{attrs:{label:t.$translateTitle("product.datalength"),prop:"string"}},[e("el-input",{attrs:{type:"number"},model:{value:t.sizeForm.string,callback:function(e){t.$set(t.sizeForm,"string",t._n(e))},expression:"sizeForm.string"}},[e("template",{slot:"append"},[t._v(" "+t._s(t.$translateTitle("product.byte"))+" ")])],2)],1)],1):t._e(),"date"==t.sizeForm.type?e("div",[e("el-form-item",{attrs:{label:t.$translateTitle("product.timeformat")}},[e("el-input",{attrs:{readonly:""},model:{value:t.sizeForm.date,callback:function(e){t.$set(t.sizeForm,"date",e)},expression:"sizeForm.date"}})],1)],1):t._e()])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.wmxhandleClose}},[t._v(" "+t._s(t.$translateTitle("developer.cancel"))+" ")]),e("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.submitForm("sizeForm")}}},[t._v(" "+t._s(t.$translateTitle("developer.determine"))+" ")])],1)])],1)},i=[],s={name:"TopoArom",components:{},data(){return{infoData:"TopoArom"}},computed:{},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{}},r=s,n=a("2877"),l=Object(n["a"])(r,o,i,!1,null,null,null);e["default"]=l.exports},"3ab6":function(t,e,a){"use strict";(function(t){var o=a("6dd4"),i=a("5880"),s=a("6db3"),r=a("bf14"),n=a("6951"),l=a("79fe"),d=a("c250"),c=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(t,e,a)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,y=(t,e)=>{for(var a in e||(e={}))h.call(e,a)&&b(t,a,e[a]);if(m)for(var a of m(e))g.call(e,a)&&b(t,a,e[a]);return t},f=(t,e)=>u(t,p(e)),v=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())});const $=/(\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/,w=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"xxb",VUE_APP_UPDATE_TIME:"2022年11月29日12时46分09秒",VUE_APP_VERSION:"4.7.1",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""}).CDN_URL,F=a("df7c"),j=$.test(w)?w+"/assets/images/dgiot_release/topo/":F.join(t,"/assets/images/dgiot_release/topo/"),x=a("e043");e["a"]={name:"TopoTabs",components:{Thing:r["default"],Amis:n["default"],Background:l["default"],Evidence:d["default"]},props:{isDirver:{type:Boolean,default:!1,required:!1}},data(){return{inputParams:{},upImgType:"bg",tabPosition:"left",iconfont:x,busData:{coordinate:{},paths:[]},accept:".jpg,.jpeg,.png,.gif,.bmp,.pdf,.JPG,.JPEG,.PBG,.GIF,.BMP,.PDF",imgHost:j,icon:"24-hours-fill",layout:"total, prev, next",total:0,background:!0,height:0,selectRows:"",queryIcon:[],queryForm:{pageNo:1,pageSize:30,title:""},images:[],imgParams:{},activeNames:"icon"}},computed:{},created(){},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:f(y({handleDragStart(t){t.dataTransfer.setData("index",t.target),this.$dgiotBus.$emit("dgiotDragStart",t)},coordinate(t){const e={x:t.pageX,y:t.pageY};this.busData.coordinate=e},moveSvg(t){let e=Object(s["default"])(t,"path");const a=JSON.stringify(e.topo);this.busData.paths=a,this.$dgiotBus.$emit("busTopo","path",this.busData)},createdText(t){Object(o["default"])({productid:"productid",thingid:"thingid"})},uploadCkick(t){this.upImgType=t,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"product/topo/",filename:this.$route.query.productid?this.$route.query.productid+"_bg":(new Date).getTime()+"_bg"}},files(t,e){this.inputParams.filename=this.$route.query.productid?this.$route.query.productid+"_bg":(new Date).getTime()+"_bg",this.inputParams.file=t}},Object(i["mapMutations"])({setFlag:"konva/setFlag",setDrawParams:"konva/setDrawParams",createThing:"topo/createThing",createBasicThing:"topo/createBasicThing",createBasicPrint:"topo/createBasicPrint",createBasicRect:"topo/createBasicRect",createAmis:"topo/createAmis",createHistory:"topo/createHistory",setKonvaBg:"topo/setKonvaBg"})),{fileInfo(t){return v(this,null,(function*(){"img"===this.upImgType?yield this.handleIcon(t.url):(localStorage.setItem("konvaBg",t.path),yield this.setKonvaBg(t.path))}))},handleIcon(t){var e=new Image;let a=this;e.src=t+"?"+(new Date).getTime(),e.onload=function(){a.$set(a.imgParams,"width",e.width),a.$set(a.imgParams,"height",e.height),a.$set(a.imgParams,"src",e.src),a.$baseMessage(a.$translateTitle("图片加载完成,可双击画图区域填充"),"success",!1,"dgiot-hey-message-success")},a.setFlag("image"),a.setDrawParams(a.imgParams)}})}}).call(this,"/")},"3b3a":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon-selector-popper"},[e("div",{staticClass:"dialog"},[e("dgiot-input",{ref:"uploadFinish",attrs:{params:t.inputParams},on:{fileInfo:t.fileInfo,files:t.files}})],1),e("Thing"),e("Amis"),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isDirver,expression:"isDirver"}],staticStyle:{margin:"0 auto","text-align":"center"}},[e("Evidence")],1),e("a-collapse",{directives:[{name:"show",rawName:"v-show",value:!t.isDirver,expression:"!isDirver"}],attrs:{accordion:""}},[e("a-collapse-panel",{key:"1",attrs:{header:t.$translateTitle("topo.background")}},[e("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(e){return t.uploadCkick("bg")}}},[t._v(" "+t._s(t.$translateTitle("topo.Upload background"))+" ")]),e("Background")],1),t.$route.query.dashboard?t._e():e("a-collapse-panel",{key:"2",attrs:{header:t.$translateTitle("product.button control")}},[e("el-button",{attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){return t.createThing({productid:t.$route.query.productid,hidden:!1})}}},[t._v(" 实时数据 ")]),e("el-divider"),e("el-button",{attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){return t.createAmis({productid:t.$route.query.productid,hidden:!1})}}},[t._v(" 数据下发 ")]),e("el-divider")],1),t.$route.query.dashboard?t._e():e("a-collapse-panel",{key:"3",attrs:{header:t.$translateTitle("topo.evidence control")}},[e("Evidence")],1),e("a-collapse-panel",{key:"4",attrs:{header:t.$translateTitle("topo.basic element")}},[e("el-button",{attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){return t.createBasicThing({productid:t.$route.query.productid,type:"static",hidden:!1})}}},[t._v(" 静态文本框 ")]),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v("动图")]),e("img",{staticStyle:{width:"40px",height:"40px",display:"inline-block","margin-left":"20px"},attrs:{draggable:"true",size:"mini",src:"https://mp0.usr.cn/uploads/drawimg/1612317621248_0251.gif",type:"primary"},on:{click:function(e){return t.createBasicThing({productid:t.$route.query.productid,type:"knovaimage",image:"https://mp0.usr.cn/uploads/drawimg/1612317621248_0251.gif",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 静态图 ")]),e("img",{staticStyle:{width:"40px",height:"40px",display:"inline-block","margin-left":"20px"},attrs:{draggable:"true",size:"mini",src:"https://mp0.usr.cn/uploads/drawimg/1612317616625_0334.png",type:"primary"},on:{click:function(e){return t.createBasicThing({productid:t.$route.query.productid,type:"staticimage",data:{width:180,height:200},image:"https://mp0.usr.cn/uploads/drawimg/1612317616625_0334.png",hidden:!1})}}}),e("img",{staticStyle:{width:"60px",height:"20px",display:"inline-block","margin-left":"20px"},attrs:{draggable:"true",size:"mini",src:" https://ucloud-web-sh.oss-cn-shanghai.aliyuncs.com/cloud/web/prod/screen/assets/1650512783877_0362.png",type:"primary"},on:{click:function(e){return t.createBasicThing({productid:t.$route.query.productid,type:"staticimage",data:{width:420,height:35},image:" https://ucloud-web-sh.oss-cn-shanghai.aliyuncs.com/cloud/web/prod/screen/assets/1650512783877_0362.png",hidden:!1})}}}),e("el-divider")],1),e("a-collapse-panel",{key:"5",attrs:{header:t.$translateTitle("topo.screen element")}},[e("el-button",{attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"line_historydata",width:400,height:260,fill:"rgba(30, 30, 30,0.7)",text:"折线图",source:"api"},chart:"line",hidden:!1})}}},[t._v(" 折线图 ")]),e("el-divider"),e("el-button",{staticStyle:{margin:"5px"},attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{width:262,height:72,fill:"rgba(80, 190, 240, 0.2)",text:"产品数量",source:"mqtt"},chart:"counter",hidden:!1})}}},[t._v(" 数据卡片 ")]),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 开关机饼图 ")]),e("img",{staticStyle:{width:"70px",height:"60px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/turnonoffpie.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"device_poweron_poweroff",width:350,height:300,fill:"rgba(30, 30, 30, 0.7)",text:"开关机饼图",source:"mqtt",src:"/dgiot_file/topo/png/turnonoffpie.png"},chart:"pie",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 告警列表 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/warninglist.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"warning_list",width:400,height:350,fill:"rgba(30, 30, 30, 0.7)",text:"告警列表",source:"api",src:"/dgiot_file/topo/png/warninglist.png"},chart:"list",hidden:!1})}}}),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 设备列表 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/devicelist.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"device_list",width:700,height:350,fill:"rgba(30, 30, 30, 0.7)",text:"设备列表",source:"api",src:"/dgiot_file/topo/png/devicelist.png"},chart:"list",hidden:!1})}}}),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 工单列表 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/workorderlist.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"workorder_list",width:400,height:350,fill:"rgba(30, 30, 30, 0.7)",text:"工单列表",source:"api",src:"/dgiot_file/topo/png/workorderlist.png"},chart:"list",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 设备地图 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/baidumap.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"baidumap",width:1800,height:630,x:40,y:230,fill:"rgba(30, 30, 30, 0.7)",text:"设备地图",source:"api",src:"/dgiot_file/topo/png/baidumap.png"},chart:"map",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 产品数量 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/product_count.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"product_count",width:400,height:215,x:40,y:5,fill:"rgba(30, 30, 30, 0.7)",text:"",source:"api",src:"/dgiot_file/topo/png/product_count.png"},chart:"count",hidden:!1})}}}),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 设备数量 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/device_count.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"device_count",width:400,height:215,x:490,y:5,fill:"rgba(30, 30, 30, 0.7)",text:"",source:"api",src:"/dgiot_file/topo/png/device_count.png"},chart:"count",hidden:!1})}}}),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 告警数量 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/warning_count.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"warning_count",width:400,height:215,x:940,y:5,fill:"rgba(30, 30, 30, 0.7)",text:"",source:"api",src:"/dgiot_file/topo/png/warning_count.png"},chart:"count",hidden:!1})}}}),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 工单数量 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/order_count.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"order_count",width:400,height:215,x:1390,y:5,fill:"rgba(30, 30, 30, 0.7)",text:"",source:"api",src:"/dgiot_file/topo/png/order_count.png"},chart:"count",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 视频监控 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px","margin-top":"10px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/videolive.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"vuecomponent",data:{id:"videolive",width:500,height:350,fill:"rgba(30, 30, 30, 0.7)",text:"视频监控",source:"api",src:"/dgiot_file/topo/png/videolive.png"},chart:"liveboard",hidden:!1})}}}),e("el-divider"),e("div",{staticStyle:{"text-align":"left",margin:"10px","font-weight":"600"}},[t._v(" 低代码视图组件 ")]),e("img",{staticStyle:{width:"70px",height:"40px",display:"inline-block","margin-left":"20px"},attrs:{draggable:"true",size:"mini",src:t.$FileServe+"/dgiot_file/topo/png/amiscomponent.png",type:"primary"},on:{click:function(e){t.createBasicThing({productid:t.$route.query.productid,type:"amiscomponent",data:{id:"a8d787d0ec",width:500,height:350,fill:"rgba(23, 37, 76, 0.7)",text:"低代码视图组件",source:"api",src:"/dgiot_file/topo/png/amiscomponent.png"},chart:"amisview",hidden:!1})}}}),e("el-divider")],1),t.$route.query.dashboard?t._e():e("a-collapse-panel",{key:"6",attrs:{header:t.$translateTitle("topo.print control")}},[e("el-button",{attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){return t.createBasicPrint({productid:t.$route.query.productid,type:"printer",hidden:!1})}}},[t._v(" 打印标签 ")]),e("el-button",{staticStyle:{margin:"10px"},attrs:{draggable:"true",size:"mini",type:"primary"},nativeOn:{click:function(e){return t.createBasicRect({productid:t.$route.query.productid,type:"printer",hidden:!1})}}},[t._v(" 打印矩形框 ")]),e("el-divider")],1)],1)],1)},i=[],s=a("3ab6"),r=s["a"],n=(a("1476"),a("f8a8"),a("2877")),l=Object(n["a"])(r,o,i,!1,null,null,null);e["default"]=l.exports},"3baa":function(t,e,a){"use strict";a("f8a2")},"459e":function(t,e,a){t.exports=a.p+"static/img/archive_black_24dp.64a01172.svg"},"48b0":function(t,e,a){"use strict";a.r(e);var o=a("b3c6"),i=a("0c20"),s=(a("3449"),a("2877")),r=Object(s["a"])(i["a"],o["a"],o["b"],!1,null,"758cb71a",null);e["default"]=r.exports},5168:function(t,e,a){"use strict";a("9a53")},5519:function(t,e,a){"use strict";a("7c31")},"5cb5":function(t,e,a){},"614c":function(t,e,a){var o={"./Amis.vue":"6951","./Background.vue":"79fe","./Thing.vue":"bf14","./TopoAllocation.vue":"27f8","./TopoArom.vue":"38e5","./TopoBase.vue":"65e3","./TopoEvidence.vue":"c250","./TopoOperation.vue":"bd42","./TopoScale.vue":"9bfd","./TopoTabs.vue":"3b3a","./TopoThing.vue":"b99f","./fabric.vue":"48b0","./topoHeader.vue":"5be3"};function i(t){var e=s(t);return a(e)}function s(t){if(!a.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}i.keys=function(){return Object.keys(o)},i.resolve=s,t.exports=i,i.id="614c"},"65e3":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{"append-to-body":"",title:t.$translateTitle("topo.topo")+t.$translateTitle("topo.tag"),visible:t.tagDialog,width:"50%"},on:{"update:visible":function(e){t.tagDialog=e}}},[e("span",[t._v("这是一段信息")]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.tagDialog=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.tagDialog=!1}}},[t._v("确 定")])],1)]),e("el-dialog",{attrs:{"append-to-body":"",title:t.$translateTitle("topo.topo")+t.$translateTitle("topo.thing"),visible:t.thingDialog,width:"50%"},on:{"update:visible":function(e){t.thingDialog=e}}},[e("span",[t._v("这是一段信息")]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.thingDialog=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.thingDialog=!1}}},[t._v("确 定")])],1)]),e("div",{staticClass:"topoBase",class:{"topoBase-fullscreen":t.isDevice},on:{contextmenu:t.showMenu,mousemove:t.handleMouseenter,mouseup:t.handleMouseDown}},[e("vue-context-menu",{staticStyle:{"font-size":"14px"},attrs:{"context-menu-data":t.contextMenuData},on:{copy:function(e){return t.contextMenu("copy")},deleteSahpe:function(e){return t.contextMenu("remove")},getPicture:function(e){return t.contextMenu("getPicture")},moveDown:function(e){return t.contextMenu("moveDown")},moveToBottom:function(e){return t.contextMenu("moveToBottom")},moveToTop:function(e){return t.contextMenu("moveToTop")},moveUp:function(e){return t.contextMenu("moveUp")}}}),e("div",{key:t.Sale,staticClass:"konvaTest",attrs:{id:"kevCurrent"}})],1)],1)},i=[],s=a("5880"),r=Object.defineProperty,n=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,m=(t,e)=>{for(var a in e||(e={}))c.call(e,a)&&p(t,a,e[a]);if(d)for(var a of d(e))u.call(e,a)&&p(t,a,e[a]);return t},h=(t,e)=>n(t,l(e)),g=(window.innerWidth,window.innerHeight,{name:"KonvaTest",prop:{},components:{},data(){return{dgiotDragEvent:!1,contextMenuData:{menuName:"demo",axis:{x:null,y:null},menulists:[{fnHandler:"getPicture",btnName:"导出"},{fnHandler:"moveUp",btnName:"上移"},{fnHandler:"moveDown",btnName:"下移"},{fnHandler:"moveToTop",btnName:"置顶"},{fnHandler:"moveToBottom",btnName:"置底"},{fnHandler:"deleteSahpe",btnName:"删除"}]},stage:{},konvajson:{},tagDialog:!1,thingDialog:!1,defaultJson:'{"attrs":{"width":2382,"height":1200,"draggable":false},"className":"Stage","children":[{"attrs":{"hitGraphEnabled":false},"className":"Layer","children":[{"attrs":{},"className":"Image"},{"attrs":{"source":"https://konvajs.org/assets/yoda.jpg"},"className":"Image"}]},{"attrs":{},"className":"Layer","children":[{"attrs":{"draggable":true,"x":306,"y":303,"transformsEnabled":"position"},"className":"Group","children":[{"attrs":{"radius":20,"stroke":"#231fff","strokeWidth":4,"fill":"#ffffff"},"className":"Circle"},{"attrs":{"text":"1","fontSize":14,"originX":"center","originY":"center","fill":"#231fff","x":-5,"y":-5},"className":"Text"},{"attrs":{"data":"M.91,0H29.09A.91.91,0,0,1,30,.91v243a.88.88,0,0,1-.26.63L15.65,258.86a.9.9,0,0,1-1.3,0L.26,244.52a.88.88,0,0,1-.26-.63V.91A.91.91,0,0,1,.91,0Z","originX":"center","originY":"bottom","x":10,"y":15,"angle":-30,"fill":"#231fff","scaleX":0.15,"scaleY":0.15,"rotation":-30},"className":"Path"}]},{"attrs":{"draggable":true,"x":490,"y":557,"transformsEnabled":"position"},"className":"Group","children":[{"attrs":{"radius":20,"stroke":"#231fff","strokeWidth":4,"fill":"#ffffff"},"className":"Circle"},{"attrs":{"text":"2","fontSize":14,"originX":"center","originY":"center","fill":"#231fff","x":-5,"y":-5},"className":"Text"},{"attrs":{"data":"M.91,0H29.09A.91.91,0,0,1,30,.91v243a.88.88,0,0,1-.26.63L15.65,258.86a.9.9,0,0,1-1.3,0L.26,244.52a.88.88,0,0,1-.26-.63V.91A.91.91,0,0,1,.91,0Z","originX":"center","originY":"bottom","x":10,"y":15,"angle":-30,"fill":"#231fff","scaleX":0.15,"scaleY":0.15,"rotation":-30},"className":"Path"}]}]}]}'}},computed:h(m({},Object(s["mapGetters"])({Sale:"topo/konvaSale"})),{isDevice:function(){return!("device"!=this.$route.query.type&&!this.$route.query.deviceid)}}),watch:{},mounted(){this.dgiotDragEvent=!1,this.$dgiotBus.$off("dgiotDragStart"),this.$dgiotBus.$on("dgiotDragStart",t=>{t&&(this.dgiotDragEvent=!0)})},methods:h(m(m({},Object(s["mapMutations"])({contextMenu:"topo/contextMenu",createThing:"topo/createThing"})),Object(s["mapActions"])({setKonva:"topo/Sale",initKonva:"topo/initKonva"})),{handleMouseDown(t){this.dgiotDragEvent&&(this.createThing({productid:this.$route.query.productid,hidden:!1,x:t.offsetX,y:t.offsetY}),this.dgiotDragEvent=!1)},handleMouseenter(t){this.dgiotDragEvent},showMenu(){event.preventDefault();var t=event.clientX,e=event.clientY;this.contextMenuData.axis={x:t,y:e}},getPicture(){const t=document.createElement("a");t.href=topo.toDataURL,t.download="stage.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}})}),b=g,y=(a("cb8d"),a("2877")),f=Object(y["a"])(b,o,i,!1,null,"66f161df",null);e["default"]=f.exports},6951:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",[t.nodeAttr.visible?e("div",[e("el-dialog",{attrs:{"append-to-body":"",center:"",visible:t.nodeAttr.visible,width:"80%"},on:{"update:visible":function(e){return t.$set(t.nodeAttr,"visible",e)}}},[e("dgiot-amis",{directives:[{name:"show",rawName:"v-show",value:t.nodeAttr.visible,expression:"nodeAttr.visible"}],key:t.nodeAttr.description.attrs.amis_id,attrs:{schema:t.nodeAttr.code,"show-help":!1}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.nodeAttr.visible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.nodeAttr.visible=!1}}},[t._v(" 确 定 ")])],1)],1)],1):t._e(),t.amisLoading?e("div",[e("el-dialog",{attrs:{"append-to-body":"",center:"",top:"5vh",visible:t.amisLoading},on:{"update:visible":function(e){t.amisLoading=e}}},[e("el-badge",{staticClass:"item",attrs:{slot:"title",type:"primary",value:t.amisCount},slot:"title"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.goDesign()}}},[t._v("amis列表")])],1),e("el-dialog",{attrs:{"append-to-body":"",visible:t.innerVisible},on:{"update:visible":function(e){t.innerVisible=e}}},[e("dgiot-amis",{directives:[{name:"show",rawName:"v-show",value:t.innerVisible,expression:"innerVisible"}],attrs:{schema:t.nodeAttr.code,"show-help":!1}})],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.amisDict},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.goDesign()}}},[t._v("前往添加")])],1)]},proxy:!0}],null,!1,1460458625)},[e("el-table-column",{attrs:{align:"center",label:"名称",prop:"title","show-overflow-tooltip":"",sortable:"",width:"180"}}),e("el-table-column",{attrs:{align:"center",label:"类型",prop:"type","show-overflow-tooltip":"",sortable:""}}),e("el-table-column",{attrs:{align:"center",label:"操作",width:"auto"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-button",{attrs:{disabled:t.amisNode.node.getAttr("amis_id")==a.objectId,size:"mini",type:t.amisNode.node.getAttr("amis_id")==a.objectId?"success":"primary"},on:{click:function(e){return t.bind_amis(a)}}},[t._v(" "+t._s(t.amisNode.node.getAttr("amis_id")==a.objectId?"已绑":"绑定")+" ")]),e("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(e){return t.preview_amis(a)}}},[t._v(" 预览 ")])]}}],null,!1,2219549427)})],1)],1)],1):t._e()])},i=[],s=a("7212"),r=a("7a1d"),n=a("5880"),l=a("8ba7"),d=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,g=(t,e,a)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,b=(t,e)=>{for(var a in e||(e={}))m.call(e,a)&&g(t,a,e[a]);if(p)for(var a of p(e))h.call(e,a)&&g(t,a,e[a]);return t},y=(t,e)=>c(t,u(e)),f=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),v={name:"Amis",components:{},data(){return{innerVisible:!1,nodeAttr:{description:{},visible:!1},amisCount:0,amisLoading:!1,thingType:"post",productconfig:{},amisDict:[],amisNode:{},thingDialog:!1,infoData:"Thing",thingArgs:{},text:"text",shapeid:"",viewInfo:{},das:[],daslist:[],toponobound:[],topokonvathing:{},preview:!1}},computed:b({},Object(n["mapGetters"])({sizeForm:"konva/sizeForm"})),mounted(){localStorage.removeItem("parse_objectid"),this.nodeAttr.visible=!1,this.$dgiotBus.$off("nodeInfo"),this.$dgiotBus.$on("nodeInfo",t=>{this.$route.query.deviceid&&(localStorage.setItem("parse_objectid",this.$route.query.deviceid),this.quertAmis(t.attrs.amis_id),this.nodeAttr.description=t)}),this.$baseEventBus.$off(this.$dgiotBus.topicKey("dgiot_amis","dgiotamis")),this.$baseEventBus.$on(this.$dgiotBus.topicKey("dgiot_amis","dgiotamis"),t=>f(this,null,(function*(){"bind_amis"==(null==t?void 0:t.type)&&(yield this.bindAmis(t))})))},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:y(b({},Object(n["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{view(t){return f(this,null,(function*(){const{data:e={}}=yield Object(l["getView"])(t);this.viewInfo=e}))},bind_amis(t){return f(this,null,(function*(){this.amisNode.node.setAttrs({fill:"red",bind_amis:!0,amis_id:t.objectId}),this.amisNode.node.children[1].setAttrs({text:t.title,bind_amis:!0,amis_id:t.objectId}),this.amisNode.node.children[0].setAttrs({fill:"#1e83d4",bind_amis:!0,amis_id:t.objectId}),this.$message({showClose:!0,duration:2e3,message:"绑定成功",type:"success"}),this.amisLoading=!1}))},bindAmis(t){return f(this,null,(function*(){const e=this.$baseLoading();this.amisNode=t;const{results:a=[],count:o=0}=yield Object(l["queryView"])({count:"objectId",order:"-updatedAt",excludeKeys:"data",skip:0,where:{key:this.$route.query.productid,type:"amis"}});this.amisDict=a,this.amisCount=o,this.nodeAttr.visible=!1,this.amisLoading=!0,e.close()}))},preview_amis(t){return f(this,null,(function*(){yield this.quertAmis(t.objectId)}))},goDesign(){return f(this,null,(function*(){this.$router.push({path:"/design",query:{key:this.$route.query.productid,_class:"Product",type:"amis",ischildren:"false"}})}))},quertAmis(t){return f(this,null,(function*(){const{data:e={}}=yield Object(l["getView"])(t);this.nodeAttr.code=e,this.innerVisible=!0,this.viewInfo=e,this.$route.query.deviceid&&(this.nodeAttr.visible=!0)}))},wmxhandleClose(){this.wmxdialogVisible=!1,this.setSizeForm({}),this.$dgiotBus.$emit("refresh",this.$route)},updataForm(t){this.setSizeForm(t)},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(t){var e=this.sizeForm.daslist.indexOf(t);-1!==e&&this.sizeForm.daslist.splice(e,1)},submitForm(t){1==_.isEmpty(this.topokonvathing)?this.thingType="post":this.thingType="put",this.toponobound.forEach(e=>{t.identifier==e.identifier&&(this.thingType="put")});let e={item:t,productid:this.$route.query.productid};"post"==this.thingType?Object(s["postThing"])(e).then(e=>{if(200==e.code){this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"});let e={identifier:t.identifier,name:t.name,productid:this.$route.query.productid,shapeid:this.shapeid};Object(r["edit_konva_thing"])(e).then(t=>{}),this.wmxhandleClose()}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"编辑失败"+e.msg})}):Object(s["putThing"])(e).then(e=>{if(200==e.code){this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"});let e={identifier:t.identifier,name:t.name,productid:this.$route.query.productid,shapeid:this.shapeid};Object(r["edit_konva_thing"])(e).then(t=>{}),this.wmxhandleClose()}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"编辑失败"+e.msg})})},removeDomain(t){var e=this.sizeForm.struct.indexOf(t);-1!==e&&this.sizeForm.struct.splice(e,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},updataTopo(){return f(this,null,(function*(){const t=this.$baseLoading();try{localStorage.setItem("konvaStale",canvas.stage.toJSON());const e={config:_.merge(this.productconfig,{konva:{Stage:JSON.parse(canvas.stage.toJSON())}})};this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("user.update completed"),type:"success"});"Evidence"==this.$route.query.type?yield Object(l["putView"])(this.$route.query.viewid,{data:_.merge({konva:{Stage:JSON.parse(canvas.stage.toJSON())}},this.viewInfo)}):yield Object(s["putProduct"])(this.$route.query.productid,e);t.close()}catch(e){t.close()}}))},bindTopo(t){return f(this,null,(function*(){const e=this.$baseLoading();this.thingArgs={args:t,id:t.id,productid:t.id.split("_")[0],text:t.text};try{let s={productid:t.id.split("_")[0],shapeid:t.id.slice(11).replace("_text","")};this.shapeid=t.id;const{data:n,code:l=200,message:d="",error:c=""}=yield Object(r["get_konva_thing"])(s);if(204==l||c)return this.$baseMessage(d||c,"error",!1,"dgiot-hey-message-error"),void e.close();const{konvathing:u={},nobound:p=[]}=n;if(this.toponobound=p,this.topokonvathing=u,Object.values(u).length>0){this.reset(p);var a={},o=[];if(u.dataType.das.forEach(t=>{o.push({addr:t})}),-1!=["float","double","int","long"].indexOf(u.dataType.type))a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,endnumber:this.$objGet(u,"dataType.specs.max"),startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),precision:this.$objGet(u,"dataType.specs.precision"),dis:this.$objGet(u,"dataForm.address"),round:this.$objGet(u,"dataForm.round"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),slaveid:this.$objGet(u,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,editdatatype:!0},u.dataForm&&(a.collection=u.dataForm.collection,a.control=u.dataForm.control,a.strategy=u.dataForm.strategy);else if("bool"==u.dataType.type)a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,true:u.dataType.specs[1],false:u.dataType.specs[0],startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!1,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0};else if("image"==u.dataType.type)a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,imagevalue:u.dataType.imagevalue,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!1,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0};else if("enum"==u.dataType.type){var i=[];for(const t in u.dataType.specs)i.push({attribute:t,attributevalue:u.dataType.specs[t]});a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,specs:u.dataType.specs,struct:i,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}}else"struct"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,struct:u.dataType.specs,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,identifier:void 0==u.dataForm?"":u.identifier,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}:"text"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,string:u.dataType.size,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}:"date"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),order:this.$objGet(u,"dataForm.order"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,editdatatype:!0}:"geopoint"==u.dataType.type&&(a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,gpstype:u.dataType.gpstype,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),order:this.$objGet(u,"dataForm.order"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,identifier:u.identifier,editdatatype:!0});a.nobound=[],this.setSizeForm(a)}else this.reset(p),this.wmxData=[],this.sizeForm.name=t.text,this.sizeForm.isdis=!0;this.thingDialog=!0,e.close()}catch(s){e.close(),console.log(s)}}))},reset(t){const e={name:"",identifier:"",strategy:"20",resource:1,dis:"0X10",dinumber:"528590",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,das:[],daslist:[],round:"all",struct:[{attribute:"",attributevalue:""}],rate:1,offset:0,order:0,byteorder:"big",protocol:"normal",operatetype:"holdingRegister",originaltype:"int16",slaveid:256,collection:"%s",control:"%q",nobound:t,editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"};this.setSizeForm(e)}})},$=v,w=a("2877"),F=Object(w["a"])($,o,i,!1,null,null,null);e["default"]=F.exports},"79fe":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"Background"},[e("div",{staticClass:"demo-image__lazy"},t._l(t.urls,(function(a){return e("el-image",{key:a,attrs:{lazy:"",src:a},nativeOn:{click:function(e){return t.setKonvaBg(a)}}})})),1)])},i=[],s=a("5880"),r=Object.defineProperty,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,u=(t,e)=>{for(var a in e||(e={}))l.call(e,a)&&c(t,a,e[a]);if(n)for(var a of n(e))d.call(e,a)&&c(t,a,e[a]);return t},p={name:"Background",components:{},data(){return{BackgroundData:[],productconfig:{},BackgroundDialog:!1,infoData:"Background",BackgroundArgs:{},urls:["//img7.ddove.com/upload/20181127/134600237598.jpg"]}},methods:u({},Object(s["mapActions"])({setKonvaBg:"topo/setKonvaBg"}))},m=p,h=(a("5168"),a("2877")),g=Object(h["a"])(m,o,i,!1,null,"2a8bcb9e",null);e["default"]=g.exports},"7c31":function(t,e,a){},"89fd":function(t,e,a){"use strict";a("9f8a")},"8c6c":function(t,e,a){"use strict";a("e35a")},"8d51a":function(t,e,a){t.exports=a.p+"static/img/volume_mute_black_24dp.8b96109a.svg"},"8e26":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("dgiot-amis",{key:t.objectId,attrs:{schema:t.code,"show-help":!1}})},i=[],s=a("5880"),r=Object.defineProperty,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,u=(t,e)=>{for(var a in e||(e={}))l.call(e,a)&&c(t,a,e[a]);if(n)for(var a of n(e))d.call(e,a)&&c(t,a,e[a]);return t},p={name:"Amis",components:{},props:{objectId:{default:"",required:!0,type:String},code:{default:()=>{},required:!0,type:Object}},data(){return{infoData:"dgiotAmis"}},computed:u({},Object(s["mapGetters"])({viewData:"view/viewData"})),mounted(){this.$dgiotBus.$off("setViewData"),this.$dgiotBus.$on("setViewData",t=>{this.setData(t)}),this.$dgiotBus.$off("submitCode"),this.$dgiotBus.$on("submitCode",t=>{this.$dgiotBus.$emit("saveLowCode",{id:this.objectId,data:{data:t}})})},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:u({},Object(s["mapMutations"])({setData:"view/setData"}))},m=p,h=a("2877"),g=Object(h["a"])(m,o,i,!1,null,null,null);e["default"]=g.exports},"99a6":function(t,e,a){"use strict";a("32ca")},"9a53":function(t,e,a){},"9bfd":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"TopoScale-container"},[e("div",{staticClass:"TopoScale-container-content"},[e("i",{staticClass:"el-icon-zoom-out",on:{click:function(e){return t.setSize("out")}}}),e("div",{staticClass:"scale"},[t._v(" "+t._s(t.scale)+" ")]),e("i",{staticClass:"el-icon-zoom-in",on:{click:function(e){return t.setSize("in")}}})])])},i=[],s=a("5880"),r=Object.defineProperty,n=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,m=(t,e)=>{for(var a in e||(e={}))c.call(e,a)&&p(t,a,e[a]);if(d)for(var a of d(e))u.call(e,a)&&p(t,a,e[a]);return t},h=(t,e)=>n(t,l(e)),g={name:"TopoScale",components:{},data(){return{infoData:"TopoScale"}},computed:m({},Object(s["mapGetters"])({scale:"topo/Sale"})),mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:h(m({},Object(s["mapActions"])({setSale:"topo/setSale"})),{setSize(t){"out"===t?this.setSale(this.scale-10>=40?this.scale-10:this.scale):this.setSale(this.scale+10<=200?this.scale+10:this.scale)}})},b=g,y=(a("5519"),a("2877")),f=Object(y["a"])(b,o,i,!1,null,"739284da",null);e["default"]=f.exports},"9d14":function(t,e,a){"use strict";a("e22f")},"9f8a":function(t,e,a){},a12d:function(t,e,a){},ac49:function(t,e,a){"use strict";(function(t){var o=a("5880"),i=a("6db3"),s=Object.defineProperty,r=Object.defineProperties,n=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,e,a)=>e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,p=(t,e)=>{for(var a in e||(e={}))d.call(e,a)&&u(t,a,e[a]);if(l)for(var a of l(e))c.call(e,a)&&u(t,a,e[a]);return t},m=(t,e)=>r(t,n(e));const h=/(\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/,g=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"xxb",VUE_APP_UPDATE_TIME:"2022年11月29日12时46分09秒",VUE_APP_VERSION:"4.7.1",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""}).CDN_URL,b=a("df7c"),y=h.test(g)?g+"/assets/images/dgiot_release/topo/":b.join(t,"/assets/images/dgiot_release/topo/"),f=a("e043");e["a"]={name:"Allocation",data(){return{iconfont:f,busData:{coordinate:{},paths:[]},accept:".jpg,.jpeg,.png,.gif,.bmp,.pdf,.JPG,.JPEG,.PBG,.GIF,.BMP,.PDF",imgHost:y,icon:"24-hours-fill",layout:"total, prev, next",total:0,background:!0,height:0,selectRows:"",queryIcon:[],queryForm:{pageNo:1,pageSize:30,title:""},images:[],imgParams:{},activeNames:"icon"}},computed:{},created(){},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:m(p({coordinate(t){const e={x:t.pageX,y:t.pageY};this.busData.coordinate=e},moveSvg(t){let e=Object(i["default"])(t,"path");const a=JSON.stringify(e.topo);this.busData.paths=a,this.$dgiotBus.$emit("busTopo","path",this.busData)},uploadCkick(){this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"))}},Object(o["mapMutations"])({setFlag:"konva/setFlag",setDrawParams:"konva/setDrawParams"})),{handleChange(t){},fileInfo(t){this.dialogVisible=!this.dialogVisible,this.handleIcon(t.url)},handleIcon(t){var e=new Image;let a=this;e.src=t+"?"+(new Date).getTime(),e.onload=function(){a.$set(a.imgParams,"width",e.width),a.$set(a.imgParams,"height",e.height),a.$set(a.imgParams,"src",e.src),a.$baseMessage(a.$translateTitle("图片加载完成,可双击画图区域填充"),"success",!1,"dgiot-hey-message-success")},a.setFlag("image"),a.setDrawParams(a.imgParams)}})}}).call(this,"/")},b938:function(t,e,a){},b99f:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"TopoThing-container"},[e("div",{staticClass:"TopoThing-content"},[e("span",{staticClass:"material-icons"},[t._v("home")]),t._v(" "+t._s(t.infoData)+" "),e("md-icon",[t._v("favorite")]),e("i",{staticClass:"material-icons"},[t._v("account_balance_wallet")])],1)])},i=[],s={name:"TopoThing",components:{},data(){return{infoData:"TopoThing"}},computed:{},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{}},r=s,n=(a("3baa"),a("2877")),l=Object(n["a"])(r,o,i,!1,null,"3f158633",null);e["default"]=l.exports},bc00:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_vuekonva"},[e("div",{staticClass:"_dialog"},[e("el-dialog",{staticClass:"_shape",attrs:{"append-to-body":!0,visible:t.ShapeVisible,width:"100vh"},on:{"update:visible":function(e){t.ShapeVisible=e}}},["ShapeJson"==t.tabsName?e("span",{attrs:{slot:"footer"},slot:"footer"}):t._e()])],1),e("div",{staticClass:"_header",style:{display:t.headevisible?"block":"none"}},[e("topo-header",{ref:"topoheader",attrs:{drawerflag:t.drawer,productid:t.productid,"stop-mqtt":t.stop_Mqtt,value:t.value},on:{ImageTable:t.ImageTable,messageData:t.set_mqttflag,removeShape:t.removeShape,uploadFinish:t.uploadFinishs}})],1),e("div",{staticClass:"_mian"},[e("el-row",{staticClass:"_row",attrs:{gutter:t.gutter}},[e("transition",{attrs:{name:"fade"}},[e("el-col",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}],attrs:{span:t.leftrow}},[e("div",{staticClass:"_left"},[e("topo-allocation")],1)])],1),e("el-col",{staticClass:"_konvarow",attrs:{span:24-t.rightrow}},[e("div",{ref:"konva",class:t.konvaClass,attrs:{id:"konva"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDevice&&t.productid,expression:"!isDevice && productid"}],staticClass:"_info",style:{display:(t.infoFlag,"block")}},[e("el-row",{staticStyle:{"text-align":"center"},attrs:{gutter:10}},[e("el-col",{attrs:{span:24}},[e("el-button",{attrs:{disabled:t.productid.length<1,icon:"el-icon-s-management",plain:"",type:"success"},on:{click:function(e){return t.regulate("save")}}},[t._v(" "+t._s(t.$translateTitle("konva.save"))+" ")]),e("el-button",{attrs:{icon:"el-icon-arrow-up",plain:"",type:"success"},on:{click:function(e){return t.regulate("top")}}},[t._v(" "+t._s(t.headevisible?t.$translateTitle("konva.hide"):t.$translateTitle("konva.show"))+t._s(t.$translateTitle("konva.top"))+" ")]),e("el-button",{attrs:{icon:"el-icon-arrow-right",plain:"",type:"success"},on:{click:function(e){return t.regulate("right")}}},[t._v(" "+t._s(t.rightrow?t.$translateTitle("konva.hide"):t.$translateTitle("konva.show"))+t._s(t.$translateTitle("konva.right"))+" ")])],1)],1)],1)]),e("el-col",{attrs:{span:t.rightrow}},[e("topo-operation",{ref:"operation",on:{clearImg:t.clearImg,handleCloseSub:t.handleCloseSub,upImg:t.upProduct,upconfig:t.saveKonvaitem}})],1)],1)],1)])},i=[],s=a("969d"),r=a.n(s),n=a("ed08"),l=a("d44d"),d=a("2b3e9"),c=a("5880"),u=a("7a1d"),p=a("7212"),m=Object.defineProperty,h=Object.defineProperties,g=Object.getOwnPropertyDescriptors,b=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,v=(t,e,a)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,w=(t,e)=>{for(var a in e||(e={}))y.call(e,a)&&v(t,a,e[a]);if(b)for(var a of b(e))f.call(e,a)&&v(t,a,e[a]);return t},F=(t,e)=>h(t,g(e)),j=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),x={components:w({},Object(l["default"])(a("614c"))),data(){return{per:"100",rightFlag:!1,paramsconfig:{},productconfig:{},backgroundImage:"",gutter:24,leftrow:0,rightrow:0,productid:this.$route.query.productid||"",isDevice:"device"==this.$route.query.type,konvaClass:["konva","_center"],drawer:!1,ShapeVisible:!1,arrowFlag:!1,headevisible:!1,infoFlag:!1,arrowClass:"arrowClass",topic:"",stop_Mqtt:!0,tabsName:"ShapeJson",globalStageid:"",value:!1,kovaUpType:"",showTable:!1}},computed:F(w({},Object(c["mapGetters"])({graphColor:"konva/graphColor",drawing:"konva/drawing",graphNow:"konva/graphNow",pointStart:"konva/pointStart",draw:"konva/draw",flag:"konva/flag",drawParams:"konva/drawParams"})),{stageConfig(){let t=document.getElementsByClassName("konva");return{width:t[0].clientWidth,height:t[0].clientHeight,container:"container",id:"container"}}}),watch:{rightrow:{deep:!0,handler(t){this.rightFlag=0!==t}}},mounted(){this.productid?this.handleCloseSub():this._initCreate()},destroyed(){this.$refs.topoheader&&this.handleCloseSub()},methods:F(w({},Object(c["mapMutations"])({setDrawing:"konva/setDrawing",setPointStart:"konva/setPointStart",setDraw:"konva/setDraw",setFlag:"konva/setFlag",setGraphNow:"konva/setGraphNow",setGraphColor:"konva/setGraphColor",setDrawParams:"konva/setDrawParams"})),{uploadFinishs(t){var e=this.stage.find("Image");e.forEach(e=>{e.setAttrs({source:t}),console.log("img node ",e),e.draw()}),console.log("this.stage",this.stage,JSON.parse(this.stage.toJSON())),this.updataProduct(this.productid)},_initCreate(){let t=r.a;this.$refs.konva.style.backgroundImage=`url(${t})`},set_mqttflag(t){this.stop_Mqtt=t},removeShape(t){var e;let a=this;const o=a.stage.find("Layer")[0];for(var i=a.stage.find("Image"),s=[],r=0;r<s.length;r++)s[r].destroy();(null==(e=null==t?void 0:t.attrs)?void 0:e.image)&&(console.log("is img",t.attrs.id),i.each(e=>{console.log("图片相关",e),e.attrs.id==t.attrs.id&&(e.remove(),e.destroy(),t.remove(),t.destroy(),o.draw())})),console.log("删除的节点",t.remove()),a.stage.find("Transformer").map(t=>{console.log(t,"_Transformer")}),console.log(a.stage.find("Transformer"),a.stage.find()),t.remove(),o.draw(),a.setGraphNow(""),t.attrs.id==a.$refs["operation"].Shapeconfig.attrs.id&&(a.$refs["operation"].Shapeconfig=[]),a.updataProduct(this.productid)},ImageTable(t){this.leftrow=t?3:0,this.showTable=t},saveKonvaitem(t,e={index:1,opacity:1}){let a=this;console.log(a.stage.find("#"+t.attrs.id)),console.log("config.attrs.id",t.attrs.id);const o=a.stage.find("Text"),i=a.stage.find("Image"),s=a.stage.find("Group"),r=a.stage.find(t.attrs.id),n=a.stage.find("Layer")[0];let l=r;console.log("stage",r);const d=[];for(let c=0;c<d.length;c++)d[c].destroy(),d[c].remove();i.each(o=>{o.attrs.id==t.attrs.id&&(console.log("updata type is image",o,t),l=o,a.kovaUpType="Image",l.zIndex(e.zIndex),l.opacity(e.opacity),n.draw(),d.push(new Konva.Tween({node:o,Opacity:e.opacity,duration:1,zIndex:e.zIndex,easing:Konva.Easings.ElasticEaseOut}).play()))}),s.each(e=>{e.attrs.id==t.attrs.id&&(a.kovaUpType="Group",l=e,d.push(new Konva.Tween({node:Object.assign(e,t),Opacity:.8,duration:1,easing:Konva.Easings.ElasticEaseOut}).play()))}),o.each(e=>{e.attrs.id==t.attrs.id&&(a.kovaUpType="Text",l=e,d.push(new Konva.Tween({node:Object.assign(e,t),Opacity:.8,duration:1,easing:Konva.Easings.ElasticEaseOut}).play()))}),"Image"!=a.kovaUpType&&(l.zIndex(e.index),l.opacity(e.opacity),n.draw()),a.stage.batchDraw(),a.stage.attrs.id==t.attrs.id&&(a.kovaUpType="Layer",a.stage=t),console.clear(),console.info("updata type is "+a.kovaUpType),console.log("konva数据更新成功"),a.updataProduct(a.productid)},regulate(t){switch(t){case"save":this.updataProduct(this.$route.query.productid);break;case"info":alert(this.stage.toJSON());break;case"top":this.headevisible=!this.headevisible;break;case"right":this.toggleClass("rightrow");break;case"search":this.$message({showClose:!0,duration:2e3,message:"开发中",type:"success"});break}},toggleClass(t){"rightrow"==t?this.rightrow=6==this.rightrow?0:6:this.leftrow=3==this.leftrow?0:3},clearImg(t){let e=" ";t&&(e=this.backgroundImage),console.log(t),console.log(this.backgroundImage),this.$refs["operation"].bachgroundurl=e},upProduct(t){return j(this,null,(function*(){if(Object(n["isImage"])(t)){let e=this.productconfig.config;e.konva.background=t;let a={config:e},o=yield Object(p["putProduct"])(this.productid,a);console.log(o),o&&this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("组态背景更新成功"),type:"success"})}else this.$baseMessage(this.$translateTitle("非图片类型"),"error","dgiot-hey-message-error")}))},updataProduct(t){return j(this,null,(function*(){console.log("updatatopo");let e,a=this.productconfig.config;if("Layer"!=this.kovaUpType){if(!this.stage.toJSON())return;e=JSON.parse(this.stage.toJSON())}else e=this.stage;a.konva.Stage=e;let o=Object.assign(a,this.paramsconfig),i={config:o};yield Object(p["putProduct"])(t,i).then(t=>{this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("产品组态更新成功"),type:"success"})}).catch(t=>{this.$baseMessage(this.$translateTitle(""+t.error),"error","dgiot-hey-message-error")})}))},handleMqttMsg(t){let e=this;const a=e.$dgiotBus.router(this.$route.fullPath);var o=new RegExp("$dg/user/konva/"+t+"/report");e.topicKey=e.$dgiotBus.topicKey(a,o),e.$dgiotBus.$off(t),e.$dgiotBus.$on(t,t=>{const a=t.payload;let o,i=[];if(!Object(n["isBase64"])(a))return;o=JSON.parse(Base64.decode(a));const s=o.konva,r=e.stage.find("Text"),l=[];for(var d=0;d<l.length;d++)l[d].destroy();s.each(t=>{r.each(e=>{t.id==e.attrs.id?(e.text(t.text),l.push(new Konva.Tween({node:e,duration:1,easing:Konva.Easings.ElasticEaseOut}).play())):i.push(t.id)})}),e.stage.batchDraw()})},handleCloseSub(){return j(this,null,(function*(){let t=this;"device"==t.$route.query.type&&(t.productid=t.$route.query.deviceid),t.handleMqttMsg(t.productid),t.stop_Mqtt=!0;var e=JSON.stringify({action:"stop_logger"}),a={topic:"$dg/user/konva/"+t.productid+"/report",text:e,retained:!0,qos:2};t.$refs.topoheader&&t.$refs.topoheader.handleCloseSub(a);const{productid:o,devaddr:i}=t.$route.query;let s={productid:o,devaddr:i};const{message:r="",data:n}=yield Object(u["_getTopo"])(s),{results:l=[]}=yield Object(p["queryProduct"])({where:{objectId:t.$route.query.productid}});t.productconfig=l[0],"SUCCESS"==r&&(t.$refs["operation"]?t.$refs["operation"].productconfig=l[0]:console.log(" _this.$refs['operation']",t.$refs["operation"]),t.globalStageid=n.Stage.attrs.id,t.createKonva(n,t.globalStageid,"create"),t.paramsconfig={konva:n})}))},createKonva(t,e,a){let o,i=this;o="create"!=a?t:t.Stage,o.attrs.height=i.stageConfig.height,o.attrs.width=i.stageConfig.width,console.log(o.attrs.height,o.attrs.width,"453");var s=document.querySelectorAll("._center")[0];let r=document.createElement("div");s.appendChild(r),r.setAttribute("id",e),console.log("globalStageid",e),console.log(JSON.stringify(o),"Stage"),i.stage=Konva.Node.create(o,e),i.$refs.topobase.createTopo(i.stage.toJSON(),moment(new Date).valueOf()),console.log("_this.$refs.topobase",i.$refs.topobase),console.log("data",t);var l=i.stage.find("Layer")[0];i.stage.on("click",t=>{var e=t.target;if(console.log(t,"stage node"),console.log(e,"stage target"),i.isDevice&&(e.attrs.draggable=!1,console.log("isDevice",e)),e==i.stage&&l.draw(),console.log(e.toJSON()),i.isDevice)return;if(i.setGraphNow(t.target),i.$refs["operation"].Shapeconfig=JSON.parse(e.toJSON()),!i.flag)return;console.log("类型",i.flag),console.log("this.draw",i.draw),console.log("color",i.graphColor),console.log("drawParams",i.drawParams);const a=i.graphColor,o=i.flag;console.log("params",i.drawParams);const s=i.stage.find("Group")[0],{offsetX:r,offsetY:n}=t.evt;var c=Object(d["default"])(o,r,n,a,i.drawParams);console.log("createState",c),s.add(c),l.draw(),l.batchDraw(),i.setFlag(""),i.setDraw(!1)});const c=i.stage.find("Group"),u=i.stage.find("Text");console.log(u,"Text"),!i.isDevice&&(null==u?void 0:u.length)&&u.forEach(t=>{t.on("mouseenter",(function(t){console.log(t,"Text mouseenter"),i.stage.container().style.cursor="move"})),t.on("mouseleave",(function(t){console.log(t,"Text mouseleave"),i.stage.container().style.cursor="default"})),t.on("dblclick",(function(t){var e;console.log(t,"Text dblclick"),console.log(i.stage.find("Transformer"),i.stage.find()),(null==(e=i.stage.find("Transformer"))?void 0:e.length)?i.stage.find("Transformer").destroy():console.log("_this.stage.find('Transformer')",i.stage.find("Transformer"));let a=this.getAbsolutePosition(),o=i.stage.container().getBoundingClientRect();console.log("eeeeeeeeeeeeeeeee",t);let s={x:o.left+a.x,y:o.top+a.y,color:t.target.attrs.fill,text:t.target.attrs.text},r=document.createElement("textarea");document.body.appendChild(r);let n=this.text();"双击编辑文字"===n?(r.value="",r.setAttribute("placeholder","请输入文字")):r.value=n,r.style.position="absolute",r.style.top=s.y+"px",r.style.left=s.x+"px",r.style.background="none",r.style.border="1px dashed #000",r.style.outline="none",r.style.color=s.color,r.focus(),this.setAttr("text",""),l.draw();let d=t=>{this.text(t||"双击编辑文字"),l.draw(),r&&document.body.removeChild(r)},c=t=>{13===t.keyCode&&(r.removeEventListener("blur",u),d(r.value))},u=()=>{r.removeEventListener("keydown",c),d(r.value)};r.addEventListener("keydown",c),r.addEventListener("blur",u)}))}),i.isDevice&&i.productconfig&&i.konvaClass.push("isDevice"),console.log(c,"Group"),!i.isDevice&&(null==c?void 0:c.length)&&c.forEach((function(t){t.on("dblclick",t=>{console.log(t,"Group dblclick");const e=new Konva.Transformer({borderStroke:"#000",borderStrokeWidth:1,borderDash:[5],keepRatio:!1,id:"Transformer_"+Object(n["uuid"])(6)});l.add(e),e.attachTo(t.target),l.draw(),console.log("#"+t.target.attrs.id);var a=t.target;console.log("当前图层层级",Number(a.zIndex())),i.setGraphNow(t.target),i.$refs["operation"].ShapeIndex=Number(a.zIndex()),i.$refs["operation"].ShapeOpacity=a.opacity(),i.rightrow||i.isDevice||(i.rightrow=6)}),t.on("mouseup",t=>{console.log(t,"_G mouseup"),!i.isDevice&&i.productid&&(i.headevisible=!0),document.body.style.cursor="pointer"}),t.on("mouseover",t=>{console.log(t,"_G mouseover"),document.body.style.cursor="pointer"}),t.on("mouseout",t=>{console.log(t,"_G mouseout");const e=t.target.id(),a=i.stage.find(t=>t.id===e);a.x=t.target.x(),a.y=t.target.y(),document.body.style.cursor="default"})}));var p=i.stage.find("Image");p.forEach(t=>{console.log("img node ",t);const e=new Image;e.src=t.getAttr("source");var a=t.getAttr("source")+"?"+Date.parse(new Date);console.log("img",e,"$('#konva')",$("#current1")),$("#current1").css("background-image",`url(${a})`),$("#current1").css("background-repeat","no-repeat"),$("#current1").css("background-size","100%,100%")}),!i.isDevice&&(null==c?void 0:c.length)&&c.forEach((function(t){t.on("dblclick",t=>{console.log(t,"Group dblclick");const e=new Konva.Transformer({borderStroke:"#000",borderStrokeWidth:1,borderDash:[5],keepRatio:!1,id:"Transformer_"+Object(n["uuid"])(6)});l.add(e),e.attachTo(t.target),l.draw(),console.log("#"+t.target.attrs.id);var a=t.target;console.log("当前图层层级",Number(a.zIndex())),i.setGraphNow(t.target),i.$refs["operation"].ShapeIndex=Number(a.zIndex()),i.$refs["operation"].ShapeOpacity=a.opacity(),i.rightrow||i.isDevice||(i.rightrow=6)}),t.on("mouseup",t=>{console.log(t,"Group mouseup"),!i.isDevice&&i.productid&&(i.headevisible=!0),document.body.style.cursor="pointer"}),t.on("mouseover",t=>{console.log(t,"Group mouseover"),document.body.style.cursor="pointer"}),t.on("mouseout",t=>{console.log(t,"Group mouseout");const e=t.target.id(),a=i.stage.find(t=>t.id===e);a.x=t.target.x(),a.y=t.target.y(),document.body.style.cursor="default"})})),l.draw(),l.batchDraw(),console.log("绘制完成"),this.$refs.topoheader&&this.$refs.topoheader.subscribe(i.productid)}})},_=x,T=(a("c2d1"),a("2877")),G=Object(T["a"])(_,o,i,!1,null,"e83656ce",null);e["default"]=G.exports},bd42:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"operation"},[t.Shapeconfig.attrs?e("el-tabs",{attrs:{stretch:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("div",{staticClass:"unvisible"},[e("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{display:"none"},attrs:{action:"https://jsonplaceholder.typicode.com/posts/","before-remove":t.beforeRemove,"file-list":t.fileList,limit:1,multiple:"","on-exceed":t.handleExceed,"on-preview":t.handlePreview,"on-remove":t.handleRemove}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1),e("el-tab-pane",{attrs:{label:t.$translateTitle("konva.Configuration"),name:"setting"}},[t._l(t.Shapeconfig.attrs,(function(a,o,i){return e("el-form",{key:i,ref:"numberValidateForm",refInFor:!0,staticClass:"demo-ruleForm",attrs:{disabled:t.disabledForm,"label-width":"80px"}},[e("el-form-item",{attrs:{label:t.$translateTitle("konva."+o)}},[t.$lodash.isString(t.Shapeconfig.attrs[o])?e("el-input",{attrs:{disabled:t.disableKey.includes(o)},model:{value:t.Shapeconfig.attrs[o],callback:function(e){t.$set(t.Shapeconfig.attrs,o,e)},expression:"Shapeconfig.attrs[key]"}},["fill"==o?e("el-color-picker",{attrs:{slot:"append","show-alpha":"",size:"mini"},slot:"append",model:{value:t.Shapeconfig.attrs[o],callback:function(e){t.$set(t.Shapeconfig.attrs,o,e)},expression:"Shapeconfig.attrs[key]"}}):t._e()],1):t._e(),t.$lodash.isNumber(t.Shapeconfig.attrs[o])?e("el-input-number",{staticStyle:{width:"100%"},model:{value:t.Shapeconfig.attrs[o],callback:function(e){t.$set(t.Shapeconfig.attrs,o,e)},expression:"Shapeconfig.attrs[key]"}}):t._e(),t.$lodash.isBoolean(t.Shapeconfig.attrs[o])?e("el-switch",{staticStyle:{width:"100%"},attrs:{"active-text":t.$translateTitle("konva.draggable"),"inactive-text":t.$translateTitle("konva.undraggable")},model:{value:t.Shapeconfig.attrs[o],callback:function(e){t.$set(t.Shapeconfig.attrs,o,e)},expression:"Shapeconfig.attrs[key]"}}):t._e()],1)],1)})),e("div",{staticClass:"footer-panel"},[e("el-button",{attrs:{type:"success"},nativeOn:{click:function(e){t.disabledForm=!t.disabledForm}}},[t._v(" "+t._s(t.$translateTitle("developer.edit"))+" ")]),e("el-button",{attrs:{type:"info"},nativeOn:{click:function(e){return t.saveKonvaitem(t.Shapeconfig)}}},[t._v(" "+t._s(t.$translateTitle("developer.determine"))+" ")]),e("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.handleModule(t.wmxdialogVisible)}}},[t._v(" "+t._s(t.$translateTitle("product.physicalmodel"))+" ")])],1)],2),e("div",{staticClass:"TopoArom"},[e("el-dialog",{attrs:{"append-to-body":!0,"before-close":t.wmxhandleClose,"close-on-click-modal":!1,title:t.wmxSituation+"自定义属性",top:"5vh",visible:t.wmxdialogVisible,width:"60%"},on:{"update:visible":function(e){t.wmxdialogVisible=e}}},[e("wmxdetail",{ref:"sizeForm",attrs:{"size-form1":t.sizeForm},on:{addDomain:t.addDomain,removeDomain:t.removeDomain,submitForm:t.submitForm,updataForm:t.updataForm,wmxhandleClose:t.wmxhandleClose}})],1)],1)],1):e("a-empty")],1)},i=[],s=a("aed5"),r=a("7212"),n=a("7a1d"),l=a("5880"),d=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,g=(t,e,a)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,b=(t,e)=>{for(var a in e||(e={}))m.call(e,a)&&g(t,a,e[a]);if(p)for(var a of p(e))h.call(e,a)&&g(t,a,e[a]);return t},y=(t,e)=>c(t,u(e)),f=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),v={name:"Operation",components:{wmxdetail:s["default"]},props:{stopMqtt:{type:Boolean,default:!1},drawerflag:{type:Boolean,default:!1},value:{type:Boolean,default:!1}},data(){return{disabledForm:!0,disableKey:["id","container","type"],ShapeIndex:0,ShapeOpacity:1,properties:[],wmxSituation:"",wmxdialogVisible:!1,disableLable:["id"],hideLable:["draggable"],ShowItem:["container"],collapseName:["1"],allunit:{},wmxData:[],showNewItem:!0,disabledModule:!1,options:[],sizeOption:[],wmxstart:1,wmxPageSize:2,isVisible:!0,showJson:!0,sizerule:{type:"int"},fileList:[{name:"food.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"},{name:"food2.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"}],Shapeconfig:{},productconfig:{},bachgroundurl:"",activeName:"setting"}},computed:b({},Object(l["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{Shapeconfig:{deep:!0,handler(t){this.disabledModule="Stage"==t.className}}},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:y(b({},Object(l["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{removeDomain(t){var e=this.sizeForm.struct.indexOf(t);-1!==e&&this.sizeForm.struct.splice(e,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},reset(t){const e={name:"",identifier:"",strategy:"20",resource:1,dis:"",dinumber:"528590",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},round:"all",struct:[{attribute:"",attributevalue:""}],rate:1,offset:0,byteorder:"big",protocol:"normal",operatetype:"holdingRegister",originaltype:"int16",slaveid:256,collection:"%s",control:"%q",nobound:t};this.setSizeForm(e)},setZIndex(t,e){return f(this,null,(function*(){this.$emit("upconfig",t,e)}))},handleModule(t){return f(this,null,(function*(){const{thing:e={properties:[]}}=this.productconfig;let a=e.properties;this.properties=a;let o={productid:this.$route.query.productid,shapeid:this.Shapeconfig.attrs.id};const{data:i}=yield Object(n["get_konva_thing"])(o),{konvathing:s,nobound:r}=i;if(Object.values(s).length>0){this.wmxSituation="修改",this.reset(r);var l={};if(-1!=["float","double","int","long"].indexOf(s.dataType.type))l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,endnumber:this.$objGet(s,"dataType.specs.max"),startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),precision:this.$objGet(s,"dataType.specs.precision"),dis:this.$objGet(s,"dataForm.address"),round:this.$objGet(s,"dataForm.round"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),slaveid:this.$objGet(s,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,editdatatype:!0},s.dataForm&&(l.collection=s.dataForm.collection,l.control=s.dataForm.control,l.strategy=s.dataForm.strategy);else if("bool"==s.dataType.type)l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,true:s.dataType.specs[1],false:s.dataType.specs[0],startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!1,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,strategy:void 0==s.dataForm?"":s.dataForm.strategy,editdatatype:!0};else if("image"==s.dataType.type)l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,imagevalue:s.dataType.imagevalue,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!1,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,strategy:void 0==s.dataForm?"":s.dataForm.strategy,editdatatype:!0};else if("enum"==s.dataType.type){var d=[];for(const t in s.dataType.specs)d.push({attribute:t,attributevalue:s.dataType.specs[t]});l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,specs:s.dataType.specs,struct:d,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,strategy:void 0==s.dataForm?"":s.dataForm.strategy,editdatatype:!0}}else"struct"==s.dataType.type?l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,struct:s.dataType.specs,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,identifier:void 0==s.dataForm?"":s.identifier,strategy:void 0==s.dataForm?"":s.dataForm.strategy,editdatatype:!0}:"text"==s.dataType.type?l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,string:s.dataType.size,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),order:this.$objGet(s,"dataForm.order"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,strategy:void 0==s.dataForm?"":s.dataForm.strategy,editdatatype:!0}:"date"==s.dataType.type?l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,strategy:void 0==s.dataForm?"":s.dataForm.strategy,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),order:this.$objGet(s,"dataForm.order"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,editdatatype:!0}:"geopoint"==s.dataType.type&&(l={name:s.name,devicetype:s.devicetype,type:s.dataType.type,gpstype:s.dataType.gpstype,collection:void 0==s.dataForm?"":s.dataForm.collection,control:void 0==s.dataForm?"":s.dataForm.control,strategy:void 0==s.dataForm?"":s.dataForm.strategy,startnumber:this.$objGet(s,"dataType.specs.min"),step:this.$objGet(s,"dataType.specs.step"),unit:this.$objGet(s,"dataType.specs.unit"),round:this.$objGet(s,"dataForm.round"),dis:this.$objGet(s,"dataForm.address"),order:this.$objGet(s,"dataForm.order"),dinumber:this.$objGet(s,"dataForm.data"),rate:this.$objGet(s,"dataForm.rate"),offset:this.$objGet(s,"dataForm.offset"),protocol:this.$objGet(s,"dataForm.protocol"),operatetype:this.$objGet(s,"dataForm.operatetype"),originaltype:this.$objGet(s,"dataForm.originaltype"),slaveid:this.$objGet(s,"dataForm.slaveid"),iscount:this.$objGet(s,"dataForm.iscount"),countstrategy:this.$objGet(s,"dataForm.countstrategy"),countround:this.$objGet(s,"dataForm.countround"),countcollection:this.$objGet(s,"dataForm.countcollection"),required:!0,ico:s.ico,isread:s.accessMode,isshow:s.isshow,identifier:s.identifier,editdatatype:!0});l.nobound=[],this.setSizeForm(l)}else this.wmxSituation="新增",this.reset(r),this.wmxData=[],this.sizeForm.name=this.Shapeconfig.attrs.text,this.sizeForm.isdis=!0;this.wmxdialogVisible=!t}))},wmxhandleClose(){this.wmxdialogVisible=!1,this.Shapeconfig={},this.setSizeForm({}),this.$refs["sizeForm"].resource.disabled=!1,this.$dgiotBus.$emit("refresh",this.$route)},updataForm(t){this.setSizeForm(t)},submitForm(t){var e={name:t.name,devicetype:t.devicetype,dataForm:{round:t.round,data:t.dinumber,address:t.dis,rate:t.rate,offset:t.offset,order:t.order,protocol:t.protocol,operatetype:t.operatetype,originaltype:t.originaltype,slaveid:t.slaveid,collection:t.collection,control:t.control,strategy:t.strategy,iscount:t.iscount,countstrategy:t.countstrategy,countround:t.countround,countcollection:t.countcollection},ico:t.ico,required:!0,accessMode:t.isread,isshow:t.isshow,identifier:t.identifier};if("float"==t.type||"double"==t.type||"int"==t.type||"long"==t.type){var a={dataType:{type:t.type.toLowerCase(),specs:{max:t.endnumber,min:t.startnumber,step:t.step,unit:""==t.unit?"":t.unit}}};Object.assign(e,a),this.showNewItem||(delete e.dataForm.operatetype,delete e.dataForm.originaltype,delete e.dataForm.slaveid)}else if("image"==t.type){a={dataType:{type:t.type.toLowerCase(),imagevalue:t.imagevalue,specs:{}}};Object.assign(e,a)}else if("bool"==t.type){a={dataType:{type:t.type.toLowerCase(),specs:{0:t.false,1:t.true}}};Object.assign(e,a)}else if("enum"==t.type){var o={};t.struct.map(t=>{var e=t["attribute"];o[e]=t["attributevalue"]});a={dataType:{type:t.type.toLowerCase(),specs:o}};Object.assign(e,a)}else if("struct"==t.type){a={dataType:{type:t.type.toLowerCase(),specs:t.struct}};Object.assign(e,a)}else if("string"==t.type){a={dataType:{type:t.type.toLowerCase(),size:t.string}};Object.assign(e,a)}else if("text"==t.type){a={dataType:{type:t.type.toLowerCase(),size:t.string,specs:{}}};Object.assign(e,a)}else if("date"==t.type){a={dataType:{type:t.type.toLowerCase()}};Object.assign(e,a)}else if("geopoint"==t.type){a={dataType:{type:t.type.toLowerCase(),gpstype:t.gpstype,specs:{}}};Object.assign(e,a)}let i={item:e,productid:this.$route.query.productid};Object(r["putThing"])(i).then(t=>{if(200==t.code){this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"});let t={identifier:e.identifier,name:e.name,productid:this.$route.query.productid,shapeid:this.Shapeconfig.attrs.id};Object(n["edit_konva_thing"])(t).then(t=>{this.handleCloseSub()}),this.wmxhandleClose()}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"编辑失败"+t.msg})})},selectStruct(){},wmxCurrentChange(){},wmxSizeChange(){},isShowItem(t){return!this.ShowItem.includes(t)},isdisabled(t){return this.disableLable.includes(t)},isShowLable(t){return!this.hideLable.includes(t)},updataImg(t){this.$emit("upImg",t)},saveKonvaitem(t){this.$emit("upconfig",t)},handleCloseSub(){this.$emit("handleCloseSub")},clearImg(){this.isVisible=!this.isVisible,this.$emit("clearImg",this.isVisible)},upload(){this.$refs["upload"].$children[0].$refs.input.click()},handleRemove(t,e){},handlePreview(t){},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm(`确定移除 ${t.name}？`)}})},$=v,w=(a("c3d8"),a("2877")),F=Object(w["a"])($,o,i,!1,null,"df0708e4",null);e["default"]=F.exports},bf14:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"thing"},[e("el-dialog",{attrs:{"append-to-body":"",fullscreen:"",title:t.$translateTitle("topo.topo")+t.$translateTitle("topo.thing"),visible:t.thingDialog},on:{"update:visible":function(e){t.thingDialog=e}}},[e("dgiot-wmx",{ref:"sizeForm",attrs:{"size-form1":t.sizeForm},on:{addDas:t.addDas,addDomain:t.addDomain,removeDas:t.removeDas,removeDomain:t.removeDomain,submitForm:t.submitForm,updataForm:t.updataForm,wmxhandleClose:t.wmxhandleClose}})],1)],1)},i=[],s=a("aed5"),r=a("7212"),n=a("7a1d"),l=a("5880"),d=a("8ba7"),c=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(t,e,a)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,y=(t,e)=>{for(var a in e||(e={}))h.call(e,a)&&b(t,a,e[a]);if(m)for(var a of m(e))g.call(e,a)&&b(t,a,e[a]);return t},f=(t,e)=>u(t,p(e)),v=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),$={name:"Thing",components:{"dgiot-wmx":s["default"]},data(){return{thingType:"post",productconfig:{},thingDialog:!1,infoData:"Thing",thingArgs:{},text:"text",shapeid:"",viewInfo:{},das:[],daslist:[],toponobound:[],topokonvathing:{}}},computed:y({},Object(l["mapGetters"])({sizeForm:"konva/sizeForm"})),mounted(){this.$route.query.viewid&&this.view(this.$route.query.viewid),this.$dgiotBus.$off("busUpdata"),this.$dgiotBus.$on("busUpdata",()=>{}),this.$dgiotBus.$off("thingType"),this.$dgiotBus.$on("thingType",t=>{this.thingType=t}),this.$baseEventBus.$off(this.$dgiotBus.topicKey("dgiot_thing","dgiotThing")),this.$baseEventBus.$on(this.$dgiotBus.topicKey("dgiot_thing","dgiotThing"),t=>{t&&"bind_topo"==t.type&&this.bindTopo(t)})},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:f(y({},Object(l["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{view(t){return v(this,null,(function*(){const{data:e={}}=yield Object(d["getView"])(t);this.viewInfo=e}))},wmxhandleClose(){this.wmxdialogVisible=!1,this.setSizeForm({}),this.$refs["sizeForm"].resource.disabled=!1,this.$dgiotBus.$emit("refresh",this.$route)},updataForm(t){this.setSizeForm(t)},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(t){var e=this.sizeForm.daslist.indexOf(t);-1!==e&&this.sizeForm.daslist.splice(e,1)},submitForm(t){1==_.isEmpty(this.topokonvathing)?this.thingType="post":this.thingType="put",this.toponobound.forEach(e=>{t.identifier==e.identifier&&(this.thingType="put")});let e={item:t,productid:this.$route.query.productid};"post"==this.thingType?Object(r["postThing"])(e).then(e=>{if(200==e.code){this.$message({type:"success",message:"编辑成功"});let e={identifier:t.identifier,name:t.name,productid:this.$route.query.productid,shapeid:this.shapeid};Object(n["edit_konva_thing"])(e).then(t=>{}),this.wmxhandleClose()}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"编辑失败"+e.msg})}):Object(r["putThing"])(e).then(e=>{if(200==e.code){this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"});let e={identifier:t.identifier,name:t.name,productid:this.$route.query.productid,shapeid:this.shapeid};Object(n["edit_konva_thing"])(e).then(t=>{}),this.wmxhandleClose()}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"编辑失败"+e.msg})})},removeDomain(t){var e=this.sizeForm.struct.indexOf(t);-1!==e&&this.sizeForm.struct.splice(e,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},updataTopo(){return v(this,null,(function*(){const t=this.$baseLoading();localStorage.setItem("konvaStale",canvas.stage.toJSON());yield Object(d["putView"])(this.$route.query.viewid,{data:_.merge({konva:{Stage:JSON.parse(canvas.stage.toJSON())}},this.viewInfo)});t.close(),this.$baseMessage(this.$translateTitle("user.update completed"),"success","dgiot-hey-message-success")}))},bindTopo(t){return v(this,null,(function*(){const e=this.$baseLoading();this.thingArgs={args:t,id:t.id,productid:t.id.split("_")[0],text:t.text};try{let s={productid:t.id.split("_")[0],shapeid:t.id.slice(11).replace("_text","")};this.shapeid=t.id;const{data:r,code:l=200,message:d="",error:c=""}=yield Object(n["get_konva_thing"])(s);if(204==l||c)return this.$baseMessage(d||c,"error",!1,"dgiot-hey-message-error"),void e.close();const{konvathing:u={},nobound:p=[]}=r;if(this.toponobound=p,this.topokonvathing=u,Object.values(u).length>0){this.reset(p);var a={},o=[];if(u.dataType.das.forEach(t=>{o.push({addr:t})}),-1!=["float","double","int","long"].indexOf(u.dataType.type))a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,endnumber:this.$objGet(u,"dataType.specs.max"),startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),precision:this.$objGet(u,"dataType.specs.precision"),dis:this.$objGet(u,"dataForm.address"),round:this.$objGet(u,"dataForm.round"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),slaveid:this.$objGet(u,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,identifier:u.identifier,editdatatype:!0},u.dataForm&&(a.collection=u.dataForm.collection,a.control=u.dataForm.control,a.strategy=u.dataForm.strategy);else if("bool"==u.dataType.type)a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,true:u.dataType.specs[1],false:u.dataType.specs[0],startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!1,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0};else if("image"==u.dataType.type)a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,imagevalue:u.dataType.imagevalue,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!1,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0};else if("enum"==u.dataType.type){var i=[];for(const t in u.dataType.specs)i.push({attribute:t,attributevalue:u.dataType.specs[t]});a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,specs:u.dataType.specs,struct:i,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,identifier:u.identifier,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}}else"struct"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,struct:u.dataType.specs,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,identifier:void 0==u.dataForm?"":u.identifier,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}:"text"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,string:u.dataType.size,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),order:this.$objGet(u,"dataForm.order"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isstorage:u.isstorage,isaccumulate:u.isaccumulate,identifier:u.identifier,strategy:void 0==u.dataForm?"":u.dataForm.strategy,editdatatype:!0}:"date"==u.dataType.type?a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),order:this.$objGet(u,"dataForm.order"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isaccumulate:u.isaccumulate,isstorage:u.isstorage,identifier:u.identifier,editdatatype:!0}:"geopoint"==u.dataType.type&&(a={name:u.name,devicetype:u.devicetype,type:u.dataType.type,daslist:o,gpstype:u.dataType.gpstype,collection:void 0==u.dataForm?"":u.dataForm.collection,control:void 0==u.dataForm?"":u.dataForm.control,strategy:void 0==u.dataForm?"":u.dataForm.strategy,startnumber:this.$objGet(u,"dataType.specs.min"),step:this.$objGet(u,"dataType.specs.step"),unit:this.$objGet(u,"dataType.specs.unit"),round:this.$objGet(u,"dataForm.round"),dis:this.$objGet(u,"dataForm.address"),order:this.$objGet(u,"dataForm.order"),dinumber:this.$objGet(u,"dataForm.data"),rate:this.$objGet(u,"dataForm.rate"),offset:this.$objGet(u,"dataForm.offset"),protocol:this.$objGet(u,"dataForm.protocol"),operatetype:this.$objGet(u,"dataForm.operatetype"),originaltype:this.$objGet(u,"dataForm.originaltype"),slaveid:this.$objGet(u,"dataForm.slaveid"),iscount:this.$objGet(u,"dataForm.iscount"),countstrategy:this.$objGet(u,"dataForm.countstrategy"),countround:this.$objGet(u,"dataForm.countround"),countcollection:this.$objGet(u,"dataForm.countcollection"),required:!0,ico:u.ico,isread:u.accessMode,isshow:u.isshow,isaccumulate:u.isaccumulate,isstorage:u.isstorage,identifier:u.identifier,editdatatype:!0});a.nobound=[],a.protocol=u.dataForm.protocol,this.setSizeForm(a),this.$nextTick(()=>v(this,null,(function*(){yield this.$refs["sizeForm"].queryResource(),yield this.$refs["sizeForm"].queryProtocol(),this.$refs["sizeForm"].resource.value=u.dataForm.protocol,this.$refs["sizeForm"].resource.disabled=!!u.dataForm.protocol.length,this.$refs["sizeForm"].resource.arrlist=u.dataSource,this.$nextTick(()=>{this.$refs["sizeForm"].resource.data.forEach((t,e)=>{if(this.$refs["sizeForm"].resource.value===t.cType)for(var a in t.arr.forEach(t=>{t.allowCreate&&this.$refs["sizeForm"].dynamicTable(t,"回显",u.dataSource[t.showname])}),this.$refs["sizeForm"].resource.addchannel=u.dataSource,u.dataSource)for(var o in t.obj)a===o&&(t.obj[a]=rowData.dataSource[o]);this.$refs["sizeForm"].resource.changeData=u.dataSource})})})))}else this.reset(p),this.wmxData=[],this.sizeForm.name=t.text,this.sizeForm.isdis=!0;this.thingDialog=!0,e.close()}catch(s){e.close()}}))},reset(t){const e={name:"",identifier:"",strategy:"20",resource:1,dis:"0X10",dinumber:"528590",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!1,isstorage:!0,isaccumulate:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,das:[],daslist:[],round:"all",struct:[{attribute:"",attributevalue:""}],rate:1,offset:0,order:0,byteorder:"big",protocol:"normal",operatetype:"holdingRegister",originaltype:"int16",slaveid:256,collection:"%s",control:"%q",nobound:t,editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"};this.setSizeForm(e)}})},w=$,F=a("2877"),j=Object(F["a"])(w,o,i,!1,null,null,null);e["default"]=j.exports},c198:function(t,e,a){},c23b:function(t,e,a){t.exports=a.p+"static/img/image_black_24dp.60931666.svg"},c250:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"TopoEvidence"},[e("el-dialog",{attrs:{title:t.$translateTitle("topo.topo")+t.$translateTitle("topo.thing"),visible:t.evidenceDialog,"append-to-body":"",top:"5vh"},on:{"update:visible":function(e){t.evidenceDialog=e}}},[t.evidence.id?e("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("i",{staticClass:"material-icons"},[t._v(" "+t._s(t.evidence.node.attrs.icon)+" ")]),e("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[t._v(" "+t._s(t.evidence.id?t.evidence.id.split("_")[0]:"")+" ")])],1),e("div",[t._v(" 类型的图元处理逻辑 "),e("br"),t._v(" 对应数据 "+t._s(t.evidence.evidenceList)+" "),"timeline"===t.evidence.node.attrs.icon?e("div",[e("dgiotChart",{ref:"charts",attrs:{"after-config":t.afterConfig,data:t.chartData,"data-zoom":t.chartDataZoom,extend:t.chartExtend,loading:t.loading,"set-option-opts":!1,settings:t.chartSettings,toolbox:t.toolbox,type:"line"}})],1):"live_tv"===t.evidence.node.attrs.icon||"videocam_black"===t.evidence.node.attrs.icon||"volume_mute"===t.evidence.node.attrs.icon?e("div"):"image"===t.evidence.node.attrs.icon?e("div",[e("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{"preview-src-list":t.srcList,src:t.url}})],1):"folder_black"===t.evidence.node.attrs.icon?e("div"):e("div",[t._v(" 无该类型取证类型 "+t._s(t.evidence)+" ")])])]):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.evidenceDialog=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.evidenceDialog=!1}}},[t._v(" 确 定 ")])],1)],1),e("div",{staticClass:"TopoEvidence-content"},t._l(t.materialIcons,(function(a,o){return e("div",{key:o,staticClass:"TopoEvidence-content-icons"},[e("i",{directives:[{name:"dragBox",rawName:"v-dragBox"}],staticClass:"material-icons",attrs:{draggable:""},on:{click:function(e){return t.evidenceHandle(a,o)}}},[t._v(" "+t._s(a.icon)+" "),e("br"),e("el-link",{attrs:{underline:!1}},[t._v(t._s(a.text))])],1)])})),0)],1)},i=[],s=a("5880"),r=Object.defineProperty,n=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,m=(t,e)=>{for(var a in e||(e={}))c.call(e,a)&&p(t,a,e[a]);if(d)for(var a of d(e))u.call(e,a)&&p(t,a,e[a]);return t},h=(t,e)=>n(t,l(e)),g=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),b={name:"TopoEvidence",components:{},directives:{dragBox:function(t){let e=t;e.onclick=t=>{},e.onmousedown=t=>{let a=t.clientX-e.offsetLeft,o=t.clientY-e.offsetTop;e.onmousemove=t=>{let i=t.clientX-a,s=t.clientY-o;e.style.left=i+"px",e.style.top=s+"px"},e.onmouseup=t=>{}}}},data(){return{url:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",srcList:["https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg","https://fuss10.elemecdn.com/1/8e/aeffeb4de74e2fde4bd74fc7b4486jpeg.jpeg"],loading:!1,evidence:{},chartSettings:{},chartExtend:{series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},dataEmpty:!0,chartDataZoom:[{type:"slider"}],chartData:{columns:["日期","销售额"],rows:[{"日期":"1月1日","销售额":123},{"日期":"1月2日","销售额":1223},{"日期":"1月3日","销售额":2123},{"日期":"1月4日","销售额":4123},{"日期":"1月5日","销售额":3123},{"日期":"1月6日","销售额":7123}]},toolbox:{orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},thingData:[],evidenceDialog:!1,coordinate:{client:{},elePosition:{}},materialIcons:[{icon:"videocam_black",type:"video",text:"视频",path:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"},{icon:"volume_mute",type:"audio",text:"音频",path:"M7 9v6h4l5 5V4l-5 5H7z"},{icon:"image",type:"image",text:"图片",path:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"},{icon:"folder_black",type:"file",text:"文件",path:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}]}},mounted(){this.$dgiotBus.$on(this.$dgiotBus.topicKey("dgiot_evidence","dgiotEvidence"),t=>{this.dgiotEvidence(t)})},methods:h(m({},Object(s["mapMutations"])({createdEvidence:"topo/createdEvidence"})),{afterConfig(t){return t.tooltip.showDelay=500,t},dgiotEvidence(t){return g(this,null,(function*(){this.evidenceDialog=!0,this.evidence=t}))},evidenceHandle(t,e){this.createdEvidence(_.merge(t,{index:e,fill:"orange",productid:this.$route.query.productid}))}})},y=b,f=(a("9d14"),a("8c6c"),a("2877")),v=Object(f["a"])(y,o,i,!1,null,"f83cad10",null);e["default"]=v.exports},c2d1:function(t,e,a){"use strict";a("1812")},c3d8:function(t,e,a){"use strict";a("162e")},ca4b:function(t,e,a){t.exports=a.p+"static/img/videocam_black_24dp.7834d8f5.svg"},cb8d:function(t,e,a){"use strict";a("c198")},e22f:function(t,e,a){},e35a:function(t,e,a){},e8d2:function(t,e,a){t.exports=a.p+"static/img/folder_black_24dp.143fa2e1.svg"},eb54:function(t,e,a){"use strict";a.r(e);var o=function(){var t,e,a,o,i=this,s=i._self._c;return s("el-dialog",{attrs:{"append-to-body":"",visible:i.dialogFormVisible,width:"100vh"},on:{"update:visible":function(t){i.dialogFormVisible=t},close:i.close},scopedSlots:i._u([{key:"footer",fn:function(){return[s("el-button",{attrs:{type:"primary"},on:{click:i.save}},[i._v(" "+i._s(i.$translateTitle("button.determine"))+" ")])]},proxy:!0}])},[s("el-form",{ref:"form",attrs:{"label-width":"80px",model:i.form,rules:i.rules}},[s("el-form-item",{attrs:{label:"绑定表单名",prop:"class"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",disabled:(null==(e=null==(t=i.$route.query)?void 0:t.id)?void 0:e.length)>0,filterable:""},on:{change:i.changeClass},model:{value:i.form.class,callback:function(t){i.$set(i.form,"class",t)},expression:"form.class"}},i._l(i.DbaTable,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[s("span",{staticStyle:{float:"left"}},[i._v(i._s(t.label))]),s("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[i._v(" "+i._s(t.value)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:"绑定表单Id",prop:"key"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",disabled:(null==(o=null==(a=i.$route.query)?void 0:a.id)?void 0:o.length)>0,filterable:"",size:"mini"},model:{value:i.form.key,callback:function(t){i.$set(i.form,"key",t)},expression:"form.key"}},i._l(i.keys,(function(t){return s("el-option",{key:t.objectId,attrs:{label:t.objectId,value:t.objectId}},[s("span",{staticStyle:{float:"left"}},[i._v(i._s(t.objectId))]),s("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[i._v(" "+i._s(t.description||t.name||t.title||t.username||t.type)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:i.$translateTitle("product.title"),prop:"title"}},[s("el-input",{model:{value:i.form.title,callback:function(t){i.$set(i.form,"title",t)},expression:"form.title"}})],1),s("el-form-item",{attrs:{label:i.$translateTitle("home.language")}},[s("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:""},model:{value:i.form.language,callback:function(t){i.$set(i.form,"language",t)},expression:"form.language"}},i._l(i.lang,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),s("el-form-item",{attrs:{label:"渲染框架",prop:"flag"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:""},on:{change:i.changeFlag},model:{value:i.form.flag,callback:function(t){i.$set(i.form,"flag",t)},expression:"form.flag"}},i._l(i.flags,(function(t){return s("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[s("span",{staticStyle:{float:"left"}},[i._v(i._s(t.label))]),s("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[i._v(" "+i._s(t.value)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:"参考模板",prop:"type"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"",clearable:"","default-first-option":"",filterable:""},on:{change:i.changeType},model:{value:i.form.type,callback:function(t){i.$set(i.form,"type",t)},expression:"form.type"}},i._l(i.Types,(function(t){return s("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[s("span",{staticStyle:{float:"left"}},[i._v(i._s(t.label))]),s("span",{staticStyle:{float:"right","font-size":"13px",color:"#8492a6"}},[i._v(" "+i._s(t.value)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:i.$translateTitle("task.data"),prop:"data"}},[s("div",{staticStyle:{height:"30vh",overflow:"auto"}},[s("dgiot-monaco-plus",{key:i.upKey,ref:"monacoCode",attrs:{codes:i.codes,lang:"json","read-only":!1,theme:"vs-dark"}})],1)])],1)],1)},i=[],s=a("8ba7"),r=a("5880"),n=a("22f9"),l=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,h=(t,e,a)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,g=(t,e)=>{for(var a in e||(e={}))p.call(e,a)&&h(t,a,e[a]);if(u)for(var a of u(e))m.call(e,a)&&h(t,a,e[a]);return t},b=(t,e)=>d(t,c(e)),y=(t,e,a)=>new Promise((o,i)=>{var s=t=>{try{n(a.next(t))}catch(e){i(e)}},r=t=>{try{n(a.throw(t))}catch(e){i(e)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);n((a=a.apply(t,e)).next())}),f={name:"TableEdit",data(){return{lang:[{label:"中文简体",value:"zh"},{label:"english",value:"en"},{label:"日本語",value:"jp"}],upKey:(new Date).getMilliseconds(),DbaTable:[],flags:[{value:"Amis",label:"动态表单"},{value:"Konva",label:"工业组态"}],Types:[],keys:[],activeName:"first",amisKey:moment(new Date).format("X"),type:"",codes:"{}",viewId:"",form:{class:"Product",title:"",author:"",flag:""},rules:{title:[{required:!0,trigger:"blur",message:"请输入标题"}],author:[{required:!0,trigger:"blur",message:"请输入作者"}]},title:"",dialogFormVisible:!1}},computed:g({},Object(r["mapGetters"])({amisJson:"amis/amisJson"})),watch:{"form.data":{handler(t){this.codes=JSON.stringify(t,null,4),this.upKey=(new Date).getMilliseconds()},immediate:!0,deep:!0}},created(){this.changeClass("Product")},methods:b(g({},Object(r["mapMutations"])({set_amisJson:"amis/set_amisJson"})),{showEdit(t){this.form=t,this.dialogFormVisible=!0},changeType(t){return y(this,null,(function*(){console.log(t),this.codes={},this.form.data={};try{const e=yield Object(n["getDlinkJson"])(this.form.flag,{subtype:t});this.form.data=e||{},this.codes=JSON.stringify(this.form.data,null,4),this.upKey=(new Date).getMilliseconds(),this.$refs["monacoCode"].setValue(this.codes)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},changeFlag(t){return y(this,null,(function*(){console.log(t);const e=yield Object(n["getDlinkJson"])(t,{subtype:"all"});console.log("列表",e),this.Types=e}))},changeClass(t){return y(this,null,(function*(){if(!t)return!1;try{console.log(t);const e={order:"-updatedAt"};switch(t){case"Notification":e.keys="objectId";break;case"Product":e.keys="objectId,name";break;case"Maintenance":e.keys="objectId,name";break}const{results:a=[]}=yield this.$query_object(t,e);this.keys=a}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},close(){this.dialogFormVisible=!1},save(){console.log(this.$refs.monacoCode.$refs.monacoEditor.editor.getValue()),this.$refs["form"].validate(t=>y(this,null,(function*(){if(t){const{title:t,type:e,key:a,flag:o}=this.form,i={data:JSON.parse(this.$refs.monacoCode.$refs.monacoEditor.editor.getValue()),language:this.form.language,class:this.form.class,title:t,type:e,key:a,flag:o};if("add"==this.type){yield Object(s["postView"])(i);this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.Save the template successfully"),type:"success"})}else{const{msg:t}=yield Object(s["putView"])(this.viewId,i);this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.Save the template successfully"),type:"success"})}this.$emit("fetch-data"),this.close()}})))}})},v=f,$=a("2877"),w=Object($["a"])(v,o,i,!1,null,null,null);e["default"]=w.exports},f14e:function(t,e,a){t.exports=a.p+"static/img/live_tv_black_24dp.cb61ecfd.svg"},f27c:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"topo"}})},i=[],s=a("5880"),r=Object.defineProperty,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,u=(t,e)=>{for(var a in e||(e={}))l.call(e,a)&&c(t,a,e[a]);if(n)for(var a of n(e))d.call(e,a)&&c(t,a,e[a]);return t},p={name:"DgiotKonva",components:{},props:{objectId:{default:"",required:!0,type:String},code:{default:()=>{},required:!0,type:Object}},data(){return{infoData:"dgiotKonva"}},mounted(){this.initKonva({data:this.code.Stage,id:"topo"}),this.$nextTick(()=>{konvaUtils.loadKonva(canvas.layer)})},methods:u({},Object(s["mapMutations"])({initKonva:"topo/initKonva"}))},m=p,h=(a("17ea"),a("2877")),g=Object(h["a"])(m,o,i,!1,null,"d48bc0f2",null);e["default"]=g.exports},f8a2:function(t,e,a){},f8a8:function(t,e,a){"use strict";a("337b")}}]);