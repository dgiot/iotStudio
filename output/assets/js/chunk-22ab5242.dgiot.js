/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年06月27日12时11分25秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22ab5242","chunk-3b48ab62"],{"0329":function(e,t,s){},"08f3":function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"0a894":function(e,t,s){"use strict";s("d5f2")},"0c16":function(e,t,s){"use strict";s("d9ba")},"0c50":function(e,t,s){"use strict";s("bcdf7")},"0e34":function(e,t,s){},"0f56":function(e,t,s){},1605:function(e,t,s){"use strict";s("1870")},1808:function(e,t,s){},1870:function(e,t,s){},"19b1":function(e,t,s){},"1b17":function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"1d53":function(e,t,s){"use strict";s("42d7")},"1fa0":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"login-container",style:{backgroundImage:"url("+e.backgroundImage+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"form",staticClass:"login-form",attrs:{"label-position":"left",model:e.form,rules:e.rules}},[e.Default.title?s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")]):e._e(),s("el-form-item",{staticStyle:{"margin-top":"40px"},attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:e.$translateTitle("home.Please enter user name"),tabindex:"1",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}]),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{key:e.passwordType,ref:"password",attrs:{placeholder:e.$translateTitle("home.Please enter the password"),tabindex:"2",type:e.passwordType},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e.form.password.length?s("dgiot-icon",{attrs:{icon:"lock-line"}}):e._e()]},proxy:!0},"password"===e.passwordType&&e.form.password.length?{key:"suffix",fn:function(){return[s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-off-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}})]},proxy:!0}:{key:"suffix",fn:function(){return[e.form.password.length?s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}}):e._e()]},proxy:!0}],null,!0),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-input",{staticClass:"sbMc"},[s("el-button",{staticClass:"login-btn",attrs:{slot:"append",loading:e.loading,type:"primary"},nativeOn:{click:function(t){return e.handleLogin.apply(null,arguments)}},slot:"append"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")])],1)],1),s("span",[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{float:"left"},attrs:{to:"/register"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("home.registered"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px",cursor:"pointer"}})],1)],1)],1)],1)],1)},a=[],i=s("3e35f"),o=s.n(i),l=s("5880"),n=s("28d7"),c=s("1c4e"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"Quick",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},beforeRouteLeave(e,t,s){clearInterval(this.timer),clearInterval(this.interval),s()},data(){const e=(e,t,s)=>{""===t?s(new Error(this.info.empty)):s()},t=(e,t,s)=>{let r=4;Object(n["isPassword"])(t,r)?s():s(new Error(this.info.than+r+this.info.Bit))};return{interval:null,locationPath:location.href.split("/#")[0],info:{empty:this.$translateTitle("home.Username can not be empty"),than:this.$translateTitle("home.Password cannot be less than"),Bit:this.$translateTitle("home.Bit")},backgroundImage:o.a,nodeEnv:"production",form:{username:this.$route.query.username,password:this.$route.query.password},rules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},loading:!1,passwordType:"password",redirect:void 0,timer:0}},computed:b({},Object(l["mapGetters"])({language:"settings/language",Default:"acl/Default",license:"acl/license",logo:"user/logo",objectId:"user/objectId",backgroundimage:"user/backgroundimage"})),watch:{language:{handler(e){this.changeInfo(e),this.$nextTick(()=>{this.$refs.form.resetFields()})},deep:!0,immediate:!0},"Default.background":{handler(e){this.backgroundImage=e},immediate:!0},$route:{handler(e){this.redirect=e.query&&e.query.redirect||"/"},immediate:!0}},beforeDestroy(){window.removeEventListener("message",this.iframeLogin)},mounted(){return y(this,null,(function*(){yield this.dgiotReset(),yield this.initShuwa(),this.$nextTick(()=>y(this,null,(function*(){yield this.defaultSet(),yield this.init()})))}))},created(){if(this.$route.query.username){const{username:e,password:t}=this.$route.query;this.form={username:e,password:t}}window.addEventListener("message",this.iframeLogin)},methods:v(b(v(b({},Object(l["mapMutations"])({setTitle:"settings/setTitle",setCopyright:"acl/setCopyright",setDefault:"acl/setDefault"})),{iframeLogin(e){return y(this,null,(function*(){try{const t={value:moment().format("YYYY:MM:DD  HH:mm:ss"),key:"startIframe",action:"save",type:"cookie",time:moment().format("YYYY:MM:DD  HH:mm:ss")};e.source.postMessage(t,e.origin);moment().format("YYYY:MM:DD  HH:mm:ss"),moment().format("YYYY:MM:DD  HH:mm:ss")}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},routeDgiot(){return y(this,null,(function*(){try{yield setTimeout(()=>{this.objectId&&(console.log("userid",this.objectId),document.querySelector(".el-tree-node__content").click())},1200)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},init(){return y(this,null,(function*(){try{Cookies.remove("startIframe"),Cookies.remove("pwaLogin"),this.$nextTick(()=>y(this,null,(function*(){"dgiot_iframe"==window.name&&(Cookies.set("startIframe",moment().format("YYYY:MM:DD HH:mm:ss"),{expires:18e5}),yield this.goHome())})))}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},defaultSet(){return y(this,null,(function*(){console.log("dgiot build time: "+dgiot.dateTime),console.log("startIframe time: "+Cookies.get("startIframe")),this.backgroundImage=Cookies.get("startIframe")?"https://s2.loli.net/2021/12/15/ciVTb7w62rxQ3a9.jpg":this.backgroundimage;const e=location.origin;Cookies.set("fileServer",e,{expires:18e5})}))},changeInfo(e){this.$set(this.info,"empty",this.$translateTitle("home.Username can not be empty")),this.$set(this.info,"than",this.$translateTitle("home.Password cannot be less than")),this.$set(this.info,"Bit",this.$translateTitle("home.Bit")),this.$forceUpdate()},forgotPwd(){this.$message(this.$translateTitle("home.Forgot password"))}}),Object(l["mapActions"])({dgiotReset:"user/dgiotReset",login:"user/login",queryAll:"user/queryAll",jwtlogin:"user/jwtlogin"})),{getCategory(e){let t="";return this.category.filter(s=>{s.type==e&&(t=s.data.CategoryName)}),t},initShuwa(){return y(this,null,(function*(){const e=yield Object(c["SiteDefault"])(),{copyright:t,logo:s,objectId:r,title:a}=e;this.setDefault(e),this.setTitle(a),this.setCopyright(t)}))},handlePassword(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleRoute(){return"/404"===this.redirect||"/403"===this.redirect?"/":this.redirect},handleLogin(){this.$refs.form.validate(e=>y(this,null,(function*(){if(!e)return!1;try{this.loading=!0,yield this.login(this.form),yield this.goHome()}finally{this.loading=!1}})))},goHome(){return y(this,null,(function*(){try{this.interval=setInterval(()=>y(this,null,(function*(){""!=Cookies.get("handleRoute")&&(console.log("handleRoute 存在，跳转页面"),yield this.$router.push(this.handleRoute()),yield this.routeDgiot(),clearInterval(this.interval),window.clearInterval(this.interval))})),1500)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}})},_=w,$=(s("0c16"),s("2877")),k=Object($["a"])(_,r,a,!1,null,"9fd2a1fc",null);t["default"]=k.exports},2351:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{staticClass:"language-json"},[s("code",[s("span",{staticClass:"token punctuation"},[e._v("{")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"hidden"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//是否显示在菜单中显示隐藏路由（默认值：false）")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"menuHidden"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("false")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//是否显示在菜单中显示隐藏一级路由（默认值：false，除分栏布局有效）")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"alwaysShow"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当只有一级子路由时是否显示父路由是否显示在菜单中显示路由（默认值：false）")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"name"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"Demo"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//首字母大写，一定要与vue文件的name对应起来，用于noKeepAlive缓存控制（该项特别重要）")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"meta"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("{")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"title"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"title"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//菜单、面包屑、多标签页显示的名称")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"roles"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("[")]),s("span",{staticClass:"token string"},[e._v('"admin"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"..."')]),s("span",{staticClass:"token punctuation"},[e._v("]")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当config/settings.js中rolesControl配置开启时，用于控制角色（简写）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"roles"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("{")]),e._v("\n      "),s("span",{staticClass:"token comment"},[e._v("//当config/settings.js中rolesControl配置开启时，用于控制角色（全写）")]),e._v("\n      "),s("span",{staticClass:"token property"},[e._v('"role"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("[")]),s("span",{staticClass:"token string"},[e._v('"admin"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"..."')]),s("span",{staticClass:"token punctuation"},[e._v("]")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v("\n      "),s("span",{staticClass:"token property"},[e._v('"ability"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("[")]),s("span",{staticClass:"token string"},[e._v('"READ"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"WRITE"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"DELETE"')]),s("span",{staticClass:"token punctuation"},[e._v("]")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v('//ability: ["READ","WRITE"],')]),e._v("\n      "),s("span",{staticClass:"token property"},[e._v('"mode"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"allOf"')]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//allOf: 数组内所有角色都拥有，返回True oneOf: 数组内拥有任一角色，返回True(等价第1种数据) except: 不拥有数组内任一角色，返回True(取反)")]),e._v("\n    "),s("span",{staticClass:"token punctuation"},[e._v("}")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"remixIcon"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('""')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//旧版remix图标")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"icon"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('""')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//新版")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"isCustomSvgIcon"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("false")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//旧版，是否是自定义svg图标（默认值：false，如果设置true，那么需要把你的svg拷贝到icon/remixIcon下，然后remixIcon字段配置上你的图标名）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"isCustomSvg"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("false")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//新版，是否是自定义svg图标（默认值：false，如果设置true，那么需要把你的svg拷贝到icon/remixIcon下，然后remixIcon字段配置上你的图标名）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"noKeepAlive"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当前路由是否不缓存（默认值：false）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"affix"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当前路由是否固定多标签页（旧版）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"noCLosable"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当前路由是否可关闭多标签页，同上（新版）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"badge"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('"New"')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//badge小标签（只支持子级）")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"tabHidden"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("true")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//当前路由是否不显示多标签页")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"activeMenu"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token string"},[e._v('""')]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//高亮指定菜单")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"dot"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("false")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("//小圆点")]),e._v("\n    "),s("span",{staticClass:"token property"},[e._v('"dynamicNewTab"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token boolean"},[e._v("false")]),e._v(" "),s("span",{staticClass:"token comment"},[e._v("// 动态传参路由是否新开标签页")]),e._v("\n  "),s("span",{staticClass:"token punctuation"},[e._v("}")]),s("span",{staticClass:"token punctuation"},[e._v(",")]),e._v("\n  "),s("span",{staticClass:"token property"},[e._v('"children"')]),s("span",{staticClass:"token operator"},[e._v(":")]),e._v(" "),s("span",{staticClass:"token punctuation"},[e._v("[")]),s("span",{staticClass:"token punctuation"},[e._v("]")]),e._v("\n"),s("span",{staticClass:"token punctuation"},[e._v("}")]),e._v("\n")])])])}],i={name:"MenuCollapse"},o=i,l=(s("c94c6"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,"3bde814e",null);t["default"]=n.exports},"268c":function(e,t,s){"use strict";s("33dd")},"2b3d":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.title,visible:e.dialogFormVisible,width:"70%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[s("el-button",{on:{click:e.close}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.save.apply(null,arguments)}}},[e._v("确 定")])]},proxy:!0}])},[s("dgiot-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),s("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[s("el-collapse-item",{attrs:{name:"1",title:"菜单参数配置项"}},[s("menu-collapse")],1)],1),s("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{inline:!0,"label-width":"100px",model:e.form,rules:e.rules}},[s("el-form-item",{attrs:{label:"name",prop:"name"}},[s("el-input",{attrs:{disabled:"编辑菜单"==e.title,readonly:"编辑菜单"==e.title},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"pages-line"}})],1)],2)],1),s("el-form-item",{attrs:{label:"路径",prop:"url"}},[s("el-input",{model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"route-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"vue文件路径",prop:"meta.component"}},[s("el-input",{model:{value:e.form.meta.component,callback:function(t){e.$set(e.form.meta,"component",t)},expression:"form.meta.component"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"vuejs-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"重定向",prop:"redirect"}},[s("el-input",{model:{value:e.form.meta.redirect,callback:function(t){e.$set(e.form.meta,"redirect",t)},expression:"form.meta.redirect"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"infrared-thermometer-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"标题",prop:"meta.title"}},[s("el-input",{model:{value:e.form.meta.title,callback:function(t){e.$set(e.form.meta,"title",t)},expression:"form.meta.title"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"article-line"}})],1)],2)],1),s("el-form-item",{attrs:{label:"icon图标",prop:"meta.icon"}},[s("el-input",{staticStyle:{cursor:"pointer"},attrs:{"suffix-icon":"el-icon-upload2"},nativeOn:{click:function(t){return e.uploadIcon(e.form)}},model:{value:e.form.meta.icon,callback:function(t){e.$set(e.form.meta,"icon",t)},expression:"form.meta.icon"}},[s("el-popover",{attrs:{slot:"prepend","popper-class":"icon-selector-popper",size:"mini",trigger:"hover",width:"292"},slot:"prepend",scopedSlots:e._u([{key:"reference",fn:function(){return[e.form.meta.icon&&e.form.meta.icon.includes("dgiot")?s("el-image",{staticStyle:{width:"16px",height:"16px"},attrs:{src:e.$FileServe+e.form.meta.icon}},[s("img",{staticStyle:{width:"16px",height:"16px"},attrs:{slot:"error",src:e.$FileServe+e.form.meta.icon,title:e.$FileServe+e.form.meta.icon},slot:"error"})]):s("dgiot-icon",{attrs:{icon:e.form.meta.icon}})]},proxy:!0}])},[s("dgiot-icon-selector",{on:{"handle-icon":e.handleIcon}})],1)],1)],1),s("el-form-item",{attrs:{label:"badge",prop:"badge"}},[s("el-input",{model:{value:e.form.meta.badge,callback:function(t){e.$set(e.form.meta,"badge",t)},expression:"form.meta.badge"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{attrs:{icon:"notification-badge-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"隐藏",prop:"hidden",title:"隐藏后将不在菜单列表中展示，但是可以被访问"}},[s("el-switch",{model:{value:e.form.meta.hidden,callback:function(t){e.$set(e.form.meta,"hidden",t)},expression:"form.meta.hidden"}})],1),s("el-form-item",{attrs:{label:"固定",prop:"noClosable",title:"除首页外,其他页面不建议选择此项"}},[s("el-switch",{model:{value:e.form.meta.noClosable,callback:function(t){e.$set(e.form.meta,"noClosable",t)},expression:"form.meta.noClosable"}})],1),s("el-form-item",{attrs:{label:"无缓存",prop:"noKeepAlive",title:"开启后该页面的数据将不被缓存"}},[s("el-switch",{model:{value:e.form.meta.noKeepAlive,callback:function(t){e.$set(e.form.meta,"noKeepAlive",t)},expression:"form.meta.noKeepAlive"}})],1),s("el-form-item",{attrs:{label:"排序",prop:"orderBy"}},[s("el-input-number",{attrs:{label:"描述文字"},model:{value:e.form.orderBy,callback:function(t){e.$set(e.form,"orderBy",e._n(t))},expression:"form.orderBy"}})],1)],1)],1)},a=[],i=s("4a5e"),o=s("bc35"),l=s("2351"),n=s("5880"),c=Object.defineProperty,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,h=(e,t)=>{for(var s in t||(t={}))u.call(t,s)&&m(e,s,t[s]);if(d)for(var s of d(t))p.call(t,s)&&m(e,s,t[s]);return e},f=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),g={name:"MenuManagementEdit",components:{DgiotIconSelector:i["default"],menuCollapse:l["default"]},data(){return{router:[],visible:!1,inputParams:{},cascadervalue:[],jsonModel:{hidden:!0,menuHidden:!1,alwaysShow:!0,name:"Demo",meta:{title:"title",roles:{role:["admin","..."],ability:["READ","WRITE","DELETE"],mode:"allOf"},remixIcon:"",icon:"",isCustomSvgIcon:!1,isCustomSvg:!1,noKeepAlive:!0,affix:!0,noCLosable:!0,badge:"New",tabHidden:!0,activeMenu:"",dot:!1,dynamicNewTab:!1},children:[]},activeNames:["0"],menuid:"",form:{orderBy:100,name:"",url:"",meta:{icon:"",component:"",title:""}},rules:{name:[{type:"string",required:!0,message:"name,用做页面缓存,首字母大写,不可重复",trigger:"blur"},{type:"string",message:"name类型为string",trigger:"blur"},{type:"string",pattern:/^[A-Z][A-z0-9]*$/,message:"首字母请修改为大写",trigger:"blur"}],url:[{type:"string",required:!0,trigger:"blur",message:"路径地址,将展示在浏览器地址栏中"}],"meta.component":[{required:!0,trigger:"blur",message:"vue文件路径,一般为@views/下的文件路径"}],"meta.title":[{required:!0,trigger:"blur",message:"标题,展示在侧边栏菜单列表和顶部菜单列表"}],"meta.icon":[{required:!0,trigger:"blur",message:"图标，展示在侧边栏菜单列表和顶部菜单列表"}],orderBy:[{type:"number",required:!0,trigger:"blur",message:"排序层级,决定页面的排序"}]},title:"",dialogFormVisible:!1}},computed:h({},Object(n["mapGetters"])({ObjectId:"user/objectId"})),mounted(){},methods:{queryRouter(){return f(this,null,(function*(){const{results:e}=yield Object(o["queryMenu"])({});this.router=e,this.router.forEach(e=>{var t;e.title=e.meta.title,(null==(t=null==e?void 0:e.children)?void 0:t.length)&&e.children.forEach(e=>{e.title=e.meta.title})}),dgiotlog.log("router",this.router)}))},uploadIcon(e){dgiotlog.log(e,this.form),this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"user/profile/",filename:`${this.ObjectId}_${this.form.name}`}},fileInfo({path:e=""}=img){dgiotlog.log(e),this.form.meta.icon=e},files(e){this.inputParams.filename=`${this.ObjectId}_${this.form.name}`,this.inputParams.file=e},handleChange(e){const t=this.$refs["menuCascader"].getCheckedNodes();dgiotlog.log(t[0].data),dgiotlog.log(e,this.cascadervalue),this.form=t[0].data},handleIcon(e){this.form.meta.icon=e},showEdit(e,t){this.title="addChildMenu"==t?"新增子菜单":"one"==t?"新增一级菜单":"编辑菜单","addChildMenu"==t?(this.form={orderBy:10*e.orderBy+1,name:"",url:e.url,meta:{icon:"home-3-fill",component:"",redirect:"",title:"",badge:"",hidden:!1,alwaysShow:!1,isCustomSvg:!1,noClosable:!1,noKeepAlive:!1,tabHidden:!1}},this.menuid=e.objectId):"editMenu"==t?this.form=e:(dgiotlog.log("row",e),this.form={orderBy:e.orderBy,name:"",url:"",meta:{icon:"home-3-fill",component:"",redirect:"",title:"",badge:"",hidden:!1,alwaysShow:!1,isCustomSvg:!1,noClosable:!1,noKeepAlive:!1,tabHidden:!1}}),this.dialogFormVisible=!0},close(){this.menuid="",this.dialogFormVisible=!1},save(){this.$refs["form"].validate(e=>f(this,null,(function*(){e&&(this.form.objectId?this._putMenu(this.form.objectId,this.form):this._addMenu(this.form))})))},_putMenu(e,t){return f(this,null,(function*(){let s={url:t.url,name:t.name,icon:t.icon,orderBy:t.orderBy,meta:t.meta};const{updatedAt:r}=yield Object(o["putMenu"])(e,s);dgiotlog.log("updatedAt",r),r&&this.closeDialog()}))},closeDialog(){this.menuid="",this.$emit("fetch-data"),this.$refs["form"].resetFields(),this.dialogFormVisible=!1,this.form=this.$options.data().form},_addMenu(e){return f(this,null,(function*(){const t="*",s="role:admin",r={};r[t]={read:!0,write:!0},r[s]={read:!0,write:!0};let a={ACL:r,meta:e.meta,name:e.name,parent:{objectId:"0",__type:"Pointer",className:"Menu"},url:e.url,icon:e.meta.icon,orderBy:Number(e.orderBy)};if(""==this.menuid){a.parent.objectId="0";yield Object(o["postMenu"])(a);this.$message({showClose:!0,duration:2e3,message:"新增成功",type:"success"}),this.closeDialog()}else{a.parent.objectId=this.menuid;yield Object(o["postMenu"])(a);this.$message({showClose:!0,duration:2e3,message:"新增成功",type:"success"}),this.closeDialog()}}))}}},b=g,v=s("2877"),y=Object(v["a"])(b,r,a,!1,null,null,null);t["default"]=y.exports},"2d07":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"edituser"},[s("div",{staticClass:"admin",staticStyle:{"margin-bottom":"20px"}},[e._v(" "+e._s(e.$translateTitle("developer.edituser"))+" ")]),s("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm",attrs:{"label-width":"100px",model:e.ruleForm2,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$translateTitle("user.account"),prop:"account"}},[s("el-input",{attrs:{placeholder:e.$translateTitle("product.enteraccount")},model:{value:e.ruleForm2.account,callback:function(t){e.$set(e.ruleForm2,"account",t)},expression:"ruleForm2.account"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("product.phone"),prop:"phone"}},[s("el-input",{attrs:{maxlength:11,placeholder:e.$translateTitle("product.enterphonenumber")},model:{value:e.ruleForm2.phone,callback:function(t){e.$set(e.ruleForm2,"phone",t)},expression:"ruleForm2.phone"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.email"),prop:"email"}},[s("el-input",{attrs:{placeholder:e.$translateTitle("product.enteremail")},model:{value:e.ruleForm2.email,callback:function(t){e.$set(e.ruleForm2,"email",t)},expression:"ruleForm2.email"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.name1"),prop:"username"}},[s("el-input",{attrs:{maxlength:5,placeholder:e.$translateTitle("product.eqwords1")},model:{value:e.ruleForm2.username,callback:function(t){e.$set(e.ruleForm2,"username",t)},expression:"ruleForm2.username"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("developer.departmentselection")}},[s("el-cascader",{staticStyle:{width:"600px"},attrs:{"auto-complete":"off","change-on-select":"",options:e.data,placeholder:e.$translateTitle("product.selectdepartment"),props:e.treeprops,"show-all-levels":!1},model:{value:e.ruleForm2.departmentid,callback:function(t){e.$set(e.ruleForm2,"departmentid",t)},expression:"ruleForm2.departmentid"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submit_edituser(e.ruleForm2)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")])],1)],1)],1)},a=[],i=s("8665"),o=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),l={data(){return{data:[],treeprops:{value:"objectId",label:"name"},ruleForm2:{account:"",phone:"",username:"",password:"",email:"",checkPass:"",departmentid:[]},id:""}},computed:{},mounted(){this.editUser()},methods:{submit_edituser(e){return o(this,null,(function*(){dgiotlog.log(e);const t={username:this.ruleForm2.account,nick:this.ruleForm2.username,phone:this.ruleForm2.phone,email:this.ruleForm2.email,emailVerified:!0},s=yield Object(i["putUser"])(this.$route.query.id,t);s?this.$message({message:"更改成功",type:"success",showClose:!0,duration:2e3}):this.$message({type:"error",message:"修改用户失败"})}))},editUser(){Object(i["getUser"])(this.$route.query.id).then(e=>{this.ruleForm2.username=e.nick,this.ruleForm2.phone=e.phone,this.ruleForm2.account=e.username,this.ruleForm2.email=e.email,this.$dgiotBus.$emit("asyncTreeData")}).catch(e=>{this.$message({type:"error",message:"用户详情获取失败"}),dgiotlog.log(e)})}}},n=l,c=(s("91b3"),s("2877")),d=Object(c["a"])(n,r,a,!1,null,"32199712",null);t["default"]=d.exports},"2d92":function(e,t,s){"use strict";s("1b17")},3002:function(e,t,s){},3005:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main"},[s("linkedge")],1)},a=[],i=s("bae2"),o={components:{linkedge:i["default"]}},l=o,n=s("2877"),c=Object(n["a"])(l,r,a,!1,null,null,null);t["default"]=c.exports},"33dd":function(e,t,s){},3563:function(e,t,s){},3762:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"department department-container"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:10}},[s("el-table",{attrs:{border:"",data:e.roletempList,"highlight-current-row":"","row-class-name":e.tableRowClassName,"row-style":e.selectedHighlight,size:"small"},on:{"row-click":e.getDetailmenu}},[s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.name")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.data.name))]),s("span",[e._v("( "+e._s(r.key)+" )")])]}}])}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,a=t.$index;return[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.exportRoletemp(r)}}},[e._v(" "+e._s(e.$translateTitle("equipment.Updatetemplate"))+" ")]),s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return t.stopPropagation(),e.handleDelete(a,r.objectId,e.roletempList)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")])]}}])})],1)],1),s("el-col",{attrs:{span:14}},[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"footerleft"},[s("p",{staticClass:"top"},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"role_group"}})],1),s("span",[e._v(" "+e._s(e.$translateTitle("user.assignroles1"))+" ")])]),s("div",{staticStyle:{"margin-top":"5px","text-align":"center"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.checkAll("permissionTree","permissionTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.select all"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.inverse("permissionTree","permissionTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.Reverse election"))+" ")])],1),s("div",{staticClass:"rolecontrol"},[s("el-tree",{ref:"permissionTree",attrs:{accordion:"","check-on-click-node":"",data:e.permissionTreeData,"default-checked-keys":e.rolePermissonList,"default-expand-all":e.isExpand,"default-props":"","expand-on-click-node":!1,"node-key":"name","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return s("span",{staticClass:"custom-tree-node"},[s("span",[e._v(e._s(r.label))])])}}])})],1)])]),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"footerright"},[s("p",{staticClass:"top"},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"menu_group"}})],1),s("span",[e._v(" "+e._s(e.$translateTitle("user.assignmenu"))+" ")])]),s("div",{staticStyle:{"margin-top":"5px","text-align":"center"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.checkAll("menusTree","menuTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.select all"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.inverse("menusTree","menuTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.Reverse election"))+" ")])],1),s("div",{staticClass:"menucontrol"},[s("el-tree",{ref:"menusTree",attrs:{accordion:"","check-on-click-node":"",data:e.menuTreeData,"default-checked-keys":e.roleMenuList,"default-expand-all":e.menuExpand,"default-props":"","expand-on-click-node":!1,"node-key":"objectId","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,a=t.data;return s("span",{staticClass:"custom-tree-node"},[e._v(" "+e._s(a.title?a.title:r.label)+" ")])}}])})],1)])])],1),s("el-col",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{span:8}},[s("div",{staticClass:"footerleft2"},[s("p",{staticClass:"top"},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"role_group"}})],1)])]),s("div",{staticClass:"tags"},[s("el-form",{ref:"form",attrs:{"label-width":"170px",model:e.form,rules:e.Rule}},[s("el-form-item",{attrs:{label:e.$translateTitle("application.Accesskey")}},[s("el-input",{staticStyle:{width:"80%"},attrs:{readonly:""},model:{value:e.form.secret,callback:function(t){e.$set(e.form,"secret",t)},expression:"form.secret"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-refresh-right"},on:{click:e.handleClickRefresh},slot:"append"})],1)],1),s("el-form-item",{attrs:{label:e.$translateTitle("application.tokeneffectivetime")}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enterapptime"),type:"number"},model:{value:e.form.expires,callback:function(t){e.$set(e.form,"expires",t)},expression:"form.expires"}}),s("span",{staticStyle:{"margin-left":"5px"}},[e._v(" "+e._s(e.$translateTitle("task.Seconds"))+" ")])],1),s("el-form-item",{attrs:{label:e.$translateTitle("product.Wordpreviewserver")}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+e.$translateTitle("product.Wordpreviewserver")},model:{value:e.form.wordpreview,callback:function(t){e.$set(e.form,"wordpreview",t)},expression:"form.wordpreview"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("product.Wordproductionserver")}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+e.$translateTitle("product.Wordproductionserver")},model:{value:e.form.wordproduct,callback:function(t){e.$set(e.form,"wordproduct",t)},expression:"form.wordproduct"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("application.fileresources"),prop:"file"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+"url"},model:{value:e.form.file,callback:function(t){e.$set(e.form,"file",t)},expression:"form.file"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("application.Configurationresources"),prop:"topo"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+"url"},model:{value:e.form.topo,callback:function(t){e.$set(e.form,"topo",t)},expression:"form.topo"}})],1),s("el-form-item",{attrs:{label:"Graphql API",prop:"graphql"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+"url"},model:{value:e.form.graphql,callback:function(t){e.$set(e.form,"graphql",t)},expression:"form.graphql"}})],1),s("el-form-item",{attrs:{label:"Restful API",prop:"rest"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+"url"},model:{value:e.form.rest,callback:function(t){e.$set(e.form,"rest",t)},expression:"form.rest"}})],1),s("el-form-item",{attrs:{label:"home"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:e.$translateTitle("product.enter1")+e.$translateTitle("developer.path")},model:{value:e.form.home,callback:function(t){e.$set(e.form,"home",t)},expression:"form.home"}})],1)],1)],1)])],1)],1)},a=[],i=s("e0e9"),o=s("1ec2"),l=s("bc35"),n=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),c={name:"Department",components:{},data(){const e=(e,t,s)=>{var r=/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/;""===t||null===t?s(new Error("请输入url地址")):r.test(t)?s():s(new Error("请输入正确的url地址"))};return{Rule:{desc:[{required:!0,message:"请输入应用名称",trigger:"blur"},{validator:(e,t,s)=>{0===t.length?s(new Error("应用名称不能为空")):s()}}],file:[{trigger:"blur",validator:e}],topo:[{trigger:"blur",validator:e}],graphql:[{trigger:"blur",validator:e}],rest:[{trigger:"blur",validator:e}]},form:{file:"http://127.0.0.1:1250/shapes/upload",rest:"http://prod.iotn2n.com/iotapi",topo:"http://127.0.0.1:1350/",expires:18e3,wordpreview:"http://pump.iotn2n.com:8012",wordproduct:"http://pump.iotn2n.com/",graphql:"http://prod.iotn2n.com/graphql",secret:"RTc3MDk4MTgxNjAzMTc1MTUxMDY0",home:"E:/shuwa/4.1.0/shuwa_data_center/datacenter/file/files"},isExpand:!1,menuExpand:!1,roletempList:[],dataMenus:[],roleMenuList:[],dataPermissions:[],rolePermissonList:[]}},computed:{permissionTreeData(){return this.dataPermissions.filter(e=>{const t=[];return this.dataPermissions.forEach(s=>{e.objectId==s.parentId&&t.push(s)}),t.length>0&&(e.children=t),0==e.parentId})},menuTreeData(){const e=JSON.parse(JSON.stringify(this.dataMenus));return e.filter(t=>{t.title=t.meta&&t.meta.title?t.meta.title:"";const s=e.filter(e=>t.objectId==e.parentId);return s.length>0&&(t.children=s),0==t.parentId})}},mounted(){this.gettable(),this.getMenu(),this.getRoleschema()},methods:{expand(e,t){this[t]=!this[t],dgiotlog.log("tree",e,this.$refs[e],t);const s=this.$refs[e].store._getAllNodes();dgiotlog.log(s);for(let r in s)s[r].expanded=this[t]},checkAll(e,t){this.$refs[e].setCheckedNodes(this[t])},inverse(e,t){let s=this.$refs[e],r=s.getCheckedNodes(!0,!0);this.batchSelect(this[t],s,!0,r)},checkNot(e){this.$refs[e].setCheckedKeys([])},batchSelect(e,t,s,r){"undefined"!=typeof e&&e.forEach(e=>{t.setChecked(e,s,!0)}),"undefined"!=typeof r&&r.forEach(e=>{t.setChecked(e,!s,!0)})},handleClickRefresh(){const e=Math.ceil(25*Math.random());this.form.secret=Base64.encode(String.fromCharCode(65+e)+Math.ceil(1e7*Math.random())+Number(new Date))},getMenu(){return n(this,null,(function*(){this.data=[],this.dataMenus=[];const{results:e}=yield Object(l["queryMenu"])({});e&&(this.menuListRes=e,e.map(e=>{var t={};t.label=e.name,t.meta=e.meta,t.objectId=e.objectId,t.parentId=e.parent.objectId,t.createtime=new Date(e.createdAt).toLocaleDateString(),this.data.push(t),this.dataMenus.push(t)}))}))},gettable(){return n(this,null,(function*(){const{results:e}=yield Object(i["queryDict"])({where:{type:"roletemp"}});e&&(this.roletempList=e)}))},getRoleschema(){return n(this,null,(function*(){this.dataPermissions=[];const{results:e}=yield Object(o["queryPermission"])({});e&&(this.permissionListRes=e,e.map(e=>{var t={};t.label=e.alias,t.name=e.name,t.objectId=e.objectId,t.parentId=e.parent.objectId,t.createtime=new Date(e.createdAt).toLocaleDateString(),this.dataPermissions.push(t)}))}))},tableRowClassName({row:e,rowIndex:t}){e.index=t},selectedHighlight({row:e,rowIndex:t}){if(this.currentSelectIndex===t)return{color:"#409EFF","font-weight":"bold"}},getDetailmenu(e,t,s,r){e.data.tag&&e.data.tag.appconfig?this.form=e.data.tag.appconfig:this.handleClickRefresh(),t&&"操作"==t.label||(this.currentSelectIndex=e.index,this.doSetChecked(e.data.menus,e.data.rules))},doSetChecked(e,t){this.roleMenuList=[],this.rolePermissonList=[];const s=[];this.menuListRes.map(t=>{e.map(e=>{t.name==e&&this.roleMenuList.push(t.objectId)})}),this.$refs.menusTree.setCheckedKeys(this.roleMenuList),this.permissionListRes.map(e=>{t.map(t=>{e.name==t&&s.push(e.name)})}),this.rolePermissonList=[...new Set(s)],this.$refs.permissionTree.setCheckedKeys(this.rolePermissonList)},handleDelete(e,t,s){return n(this,null,(function*(){const r=yield Object(i["delDict"])(t);r?(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),s.splice(e,1)):this.$message({type:"error",message:"删除失败"})}))},exportRoletemp(e){this.$confirm("确定要更新吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>n(this,null,(function*(){const t=[],s=[],r=this.$refs.menusTree.getCheckedNodes(),a=this.$refs.permissionTree.getCheckedNodes();if(!(r&&a&&r.length>0&&a.length>0))return void this.$message({mesaage:"数据为空",showClose:!0,duration:2e3});r.forEach(e=>{s.push(e.label)}),a.forEach(e=>{t.push(e.name)});var o=e.data;e.data.tag||(o.tag={}),o["tag"].appconfig=this.form,o.menus=s,o.rules=t;const l=this.$loading({background:"rgba(0, 0, 0, 0.5)"}),n=yield Object(i["putDict"])(e.objectId,{data:o});n?(l.close(),n&&this.$message({message:"更新成功",showClose:!0,duration:2e3})):(l.close(),this.$message({message:"更新失败"}))}))).catch(e=>{dgiotlog.log(e)})}}},d=c,u=(s("4215"),s("7d8b"),s("2877")),p=Object(u["a"])(d,r,a,!1,null,"40baf680",null);t["default"]=p.exports},"378e":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"departmentforuser"},[e._v("岗位管理")])},a=[],i={data(){return{}},mounted(){},methods:{}},o=i,l=s("2877"),n=Object(l["a"])(o,r,a,!1,null,"5d2c5413",null);t["default"]=n.exports},3912:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"rolescontrol dgiot-container"},[s("div",{staticClass:"search"},[s("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.$translateTitle("concentrator.input")},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),s("el-button",{staticStyle:{"margin-left":"20px"},attrs:{icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.getcontrolrole({name:e.search})}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),s("el-button",{attrs:{disabled:"",icon:"el-icon-plus",type:"primary"},on:{click:e.addcontrol}},[e._v(" "+e._s(e.$translateTitle("developer.add"))+" ")])],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.treeData.length,attrs:{border:"",data:e.treeData,"default-expand-all":"",height:e.tableHeight,"row-key":"objectId",size:"mini","tree-props":{children:"children",hasChildren:"hasChildren"}}},[s("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"index",width:"55"}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.alias"),prop:"alias","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.createdtime"),prop:"createtime","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("task.Operation"),"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"success"},on:{click:function(t){return e.handleEdit(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),s("el-button",{attrs:{disabled:"",icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1),s("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.count,expression:"count"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.count},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.getcontrolrole}}),s("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.edit"),visible:e.roleEdit,width:"28%"},on:{"update:visible":function(t){e.roleEdit=t}}},[s("el-form",{attrs:{model:e.form}},[s("el-form-item",{attrs:{label:e.$translateTitle("user.name"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",disabled:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.Remarks"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off"},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",rows:2,type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.roleEdit=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.updaterole.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1)},a=[],i=s("1ec2"),o=s("ed08"),l=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),n={components:{},data(){return{count:0,queryForm:{number:"",product:"",type:"",searchDate:[],limit:100,skip:0,order:"-createdAt",keys:"count(*)"},listLoading:!1,formLabelWidth:"120px",roleEdit:!1,tableHeight:this.$baseTableHeight(0),form:{name:"",alias:"",description:""},search:"",defaultExpandAll:!0,key:1,permissionid:"",columns:[{label:"Name",key:"alias",expand:!0,align:"left"},{label:"Alias",key:"name",width:200,align:"center"},{label:"Created Time",key:"scope"},{label:"Operation",key:"operation"}],data:[],treeData:[]}},computed:{},mounted(){this.getcontrolrole({})},methods:{handleEdit(e){return l(this,null,(function*(){this.permissionid=e.objectId;const t=yield Object(i["getPermission"])(e.objectId);this.form.name=t.name,this.form.description=t.description,this.form.alias=t.alias,this.roleEdit=!0}))},handleDelete(e){},addcontrol(){},getcontrolrole(e){return l(this,null,(function*(){dgiotlog.log(e),this.listLoading=!0,this.data=[];const t={count:"objectId",limit:e.limit?e.limit:this.queryForm.limit,order:this.queryForm.order,skip:e.skip?e.skip:this.queryForm.skip,where:{}};e.name&&(t.where.name={$regex:e.name});const{results:s,count:r}=yield Object(i["queryPermission"])(t);this.listLoading=!1,s?s.map(e=>{var t={};t.name=e.name,t.alias=e.alias,t.objectId=e.objectId,t.parent=e.parent.objectId,t.createtime=Object(o["utc2beijing"])(e.createdAt),this.data.push(t),this.count=r}):this.data=[],dgiotlog.log("results",this.data),this.setTreeData(this.data),dgiotlog.log(this.treeData,"cloneData")}))},setTreeData(e){return l(this,null,(function*(){const t=JSON.parse(JSON.stringify(e));this.treeData=t.filter(e=>{const s=t.filter(t=>e.objectId==t.parent);return s.length>0&&(e.children=s),0==e.parent})}))},updaterole(){return l(this,null,(function*(){const e=yield Object(i["putPermission"])(this.permissionid,{alias:this.form.alias,description:this.form.description});e&&this.$message({type:"success",message:"更新成功",showClose:!0,duration:2e3}),this.roleEdit=!1}))}}},c=n,d=(s("b3f0"),s("2877")),u=Object(d["a"])(c,r,a,!1,null,"2aa38ee5",null);t["default"]=u.exports},"3b52":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-alert",{attrs:{title:e.title,type:"success"}})},a=[],i={name:"Readme",props:{title:{required:!1,default:"新功能测试界面，为了方便开发新功能/测试时不重启页面的统一配置",type:String}},data(){return{}}},o=i,l=s("2877"),n=Object(l["a"])(o,r,a,!1,null,"196d09a4",null);t["default"]=n.exports},"3bd9":function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"3fb4":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"login-container",style:{backgroundImage:"url("+e.backgroundImage+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[e.isShow?s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"form",staticClass:"login-form",attrs:{"label-position":"left",model:e.form,rules:e.rules}},[e.Default.title?s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")]):e._e(),s("el-form-item",{staticStyle:{"margin-top":"40px"},attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:e.$translateTitle("home.Please enter user name"),tabindex:"1",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}],null,!1,584386874),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{key:e.passwordType,ref:"password",attrs:{placeholder:e.$translateTitle("home.Please enter the password"),tabindex:"2",type:e.passwordType},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e.form.password.length?s("dgiot-icon",{attrs:{icon:"lock-line"}}):e._e()]},proxy:!0},"password"===e.passwordType&&e.form.password.length?{key:"suffix",fn:function(){return[s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-off-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}})]},proxy:!0}:{key:"suffix",fn:function(){return[e.form.password.length?s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}}):e._e()]},proxy:!0}],null,!0),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-input",{staticClass:"sbMc"},[s("el-button",{staticClass:"login-btn",attrs:{slot:"append",loading:e.loading,type:"primary"},nativeOn:{click:function(t){return e.handleLogin.apply(null,arguments)}},slot:"append"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")])],1)],1),s("span",[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{float:"left"},attrs:{to:"/register"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("home.registered"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px",cursor:"pointer"}})],1)],1)],1)],1):e._e()],1)},a=[],i=s("3e35f"),o=s.n(i),l=s("5880"),n=s("28d7"),c=s("1c4e"),d=s("bc35"),u=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,s)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,v=(e,t)=>{for(var s in t||(t={}))f.call(t,s)&&b(e,s,t[s]);if(h)for(var s of h(t))g.call(t,s)&&b(e,s,t[s]);return e},y=(e,t)=>p(e,m(t)),w=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),_={name:"Login",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},beforeRouteLeave(e,t,s){clearInterval(this.timer),clearInterval(this.interval),s()},data(){const e=(e,t,s)=>{""===t?s(new Error(this.info.empty)):s()},t=(e,t,s)=>{let r=4;Object(n["isPassword"])(t,r)?s():s(new Error(this.info.than+r+this.info.Bit))};return{interval:null,isShow:"dgiot_iframe"!=window.name,locationPath:location.href.split("/#")[0],info:{empty:this.$translateTitle("home.Username can not be empty"),than:this.$translateTitle("home.Password cannot be less than"),Bit:this.$translateTitle("home.Bit")},backgroundImage:o.a,nodeEnv:"production",form:{username:"",password:""},rules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},loading:!1,passwordType:"password",redirect:void 0,timer:0}},computed:v({},Object(l["mapGetters"])({language:"settings/language",Default:"acl/Default",license:"acl/license",logo:"user/logo",objectId:"user/objectId",backgroundimage:"user/backgroundimage",currentDepartment:"user/currentDepartment"})),watch:{language:{handler(e){this.changeInfo(e),this.$nextTick(()=>{this.$refs.form.resetFields()})},deep:!0,immediate:!0},"Default.background":{handler(e){this.backgroundImage=e},immediate:!0},$route:{handler(e){this.redirect=e.query&&e.query.redirect||"/"},immediate:!0}},beforeDestroy(){window.removeEventListener("message",this.iframeLogin)},mounted(){return w(this,null,(function*(){yield this.initShuwa(),this.$nextTick(()=>w(this,null,(function*(){yield this.defaultSet(),yield this.init()})))}))},created(){this.$removeToken(),this.isShow="dgiot_iframe"!=window.name,window.addEventListener("message",this.iframeLogin)},methods:y(v(y(v({},Object(l["mapMutations"])({setTitle:"settings/setTitle",setCopyright:"acl/setCopyright",setDefault:"acl/setDefault",setRoleTree:"user/setRoleTree"})),{iframeLogin(e){return w(this,null,(function*(){try{const t={value:moment().format("YYYY:MM:DD  HH:mm:ss"),key:"startIframe",action:"save",type:"cookie",time:moment().format("YYYY:MM:DD  HH:mm:ss")};e.source.postMessage(t,e.origin);moment().format("YYYY:MM:DD  HH:mm:ss"),moment().format("YYYY:MM:DD  HH:mm:ss")}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},init(){return w(this,null,(function*(){try{Cookies.remove("startIframe"),Cookies.remove("pwaLogin"),this.$nextTick(()=>w(this,null,(function*(){"dgiot_iframe"==window.name&&(Cookies.set("startIframe",moment().format("YYYY:MM:DD HH:mm:ss"),{expires:18e5}),yield this.login({username:"feiiplat",password:"feiiplat"}),yield this.goHome())})))}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},defaultSet(){return w(this,null,(function*(){console.log("dgiot build time: "+dgiot.dateTime),console.log("startIframe time: "+Cookies.get("startIframe")),this.backgroundImage=Cookies.get("startIframe")?"https://s2.loli.net/2021/12/15/ciVTb7w62rxQ3a9.jpg":this.backgroundimage;const e=location.origin;Cookies.set("fileServer",e,{expires:18e5})}))},changeInfo(e){this.$set(this.info,"empty",this.$translateTitle("home.Username can not be empty")),this.$set(this.info,"than",this.$translateTitle("home.Password cannot be less than")),this.$set(this.info,"Bit",this.$translateTitle("home.Bit")),this.$forceUpdate()},forgotPwd(){this.$message(this.$translateTitle("home.Forgot password"))}}),Object(l["mapActions"])({login:"user/login",queryAll:"user/queryAll",jwtlogin:"user/jwtlogin"})),{getCategory(e){let t="";return this.category.filter(s=>{s.type==e&&(t=s.data.CategoryName)}),t},initShuwa(){return w(this,null,(function*(){const e=yield Object(c["SiteDefault"])(),{copyright:t,logo:s,objectId:r,title:a}=e;this.setDefault(e),this.setTitle(a),this.setCopyright(t)}))},handlePassword(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleRoute(){return"/404"===this.redirect||"/403"===this.redirect?"/":this.redirect},handleLogin(){this.$refs.form.validate(e=>w(this,null,(function*(){if(!e)return!1;try{this.loading=!0,yield this.login(this.form),yield this.goHome()}finally{this.loading=!1}})))},goHome(){return w(this,null,(function*(){try{this.interval=setInterval(()=>w(this,null,(function*(){if(""!=Cookies.get("handleRoute")){console.log("handleRoute 存在，跳转页面");const{results:e=[]}=yield Object(d["Roletree"])();this.setRoleTree(e),yield this.$router.push(this.handleRoute()),clearInterval(this.interval),window.clearInterval(this.interval)}})),800)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}})},$=_,k=(s("b789"),s("2877")),T=Object(k["a"])($,r,a,!1,null,"2c92de8a",null);t["default"]=T.exports},4215:function(e,t,s){"use strict";s("0f56")},"42d7":function(e,t,s){},"4d4a":function(e,t,s){"use strict";s("e6bd")},"4e5b":function(e,t,s){"use strict";s.r(t);var r,a,i=s("2877"),o={},l=Object(i["a"])(o,r,a,!1,null,null,null);t["default"]=l.exports},"4f28":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"userinfo"},[s("div",{staticClass:"personal-center-container"},[s("el-dialog",{attrs:{"append-to-body":"",title:"关联大屏",visible:e.bigModule},on:{"update:visible":function(t){e.bigModule=t}}},[s("el-table",{attrs:{data:e.bigView},on:{"current-change":e.handleCurrentChange}},[s("el-table-column",{attrs:{label:"名称",property:"title",width:"auto"}}),s("el-table-column",{attrs:{label:"objectId",property:"objectId",width:"auto"}}),s("el-table-column",{attrs:{label:"class",property:"class"}})],1)],1),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{lg:12,md:12,sm:24,xl:8,xs:24}},[s("el-card",{attrs:{shadow:"hover"}},[s("div",{staticClass:"personal-center-user-info"},[s("el-avatar",{attrs:{shape:"square",size:100,src:e.$FileServe+e.avatar},nativeOn:{click:function(t){return e.uploadCkick("userinfo.avatar")}}}),s("dgiot-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),s("ul",{staticClass:"personal-center-user-info-list"},[s("li",[s("dgiot-icon",{attrs:{icon:"user-2-line"}}),e._v(" "+e._s(e.username)+" ")],1),s("li",[s("dgiot-icon",{attrs:{icon:"user-3-line"}}),e._v(" "+e._s(e.nick)+" ")],1),s("li",[s("dgiot-icon",{attrs:{icon:"women-line"}}),e._v(" "+e._s(e.userinfo.sex)+" ")],1),s("li",[s("dgiot-icon",{attrs:{icon:"phone-line"}}),e._v(" "+e._s(e.userinfo.phone)+" ")],1),s("li",[s("dgiot-icon",{attrs:{icon:"file-text-line"}}),e._v(" "+e._s(e.userinfo.description)+" ")],1)])],1)])],1),s("el-col",{attrs:{lg:12,md:12,sm:24,xl:16,xs:24}},[s("el-card",{attrs:{shadow:"hover"}},[s("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"个人信息",name:"first"}},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("el-form",{ref:"userinfo",attrs:{"label-width":"80px",model:e.userinfo,rules:e.registerRules}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{attrs:{readonly:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),s("el-form-item",{attrs:{label:"姓名"}},[s("el-input",{model:{value:e.nick,callback:function(t){e.nick=t},expression:"nick"}})],1),s("el-form-item",{attrs:{label:"性别"}},[s("el-select",{staticStyle:{width:"100%"},model:{value:e.userinfo.sex,callback:function(t){e.$set(e.userinfo,"sex",t)},expression:"userinfo.sex"}},[s("el-option",{attrs:{label:"保密",value:"保密"}}),s("el-option",{attrs:{label:"男",value:"男"}}),s("el-option",{attrs:{label:"女",value:"女"}})],1)],1),s("el-form-item",{attrs:{label:"绑定手机",prop:"phone"}},[s("el-input",{model:{value:e.userinfo.phone,callback:function(t){e.$set(e.userinfo,"phone",t)},expression:"userinfo.phone"}})],1),s("el-form-item",{attrs:{label:"个人简介"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.userinfo.description,callback:function(t){e.$set(e.userinfo,"description",t)},expression:"userinfo.description"}})],1),s("el-form-item",{attrs:{label:"重置密码"}},[s("el-input",{model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.onSubmit.apply(null,arguments)}}},[e._v(" 保存 ")])],1)],1)],1)],1),s("el-tab-pane",{attrs:{label:"平台设置",name:"second"}},[s("div",{staticClass:"personal-center-item"},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("el-form",{ref:"companyinfo",attrs:{"label-width":"120px",model:e.companyinfo}},[s("el-form-item",{attrs:{label:"企业名称"}},[s("el-input",{model:{value:e.companyinfo.name,callback:function(t){e.$set(e.companyinfo,"name",t)},expression:"companyinfo.name"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"community-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"企业logo"}},[s("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.companyinfo.logo,callback:function(t){e.$set(e.companyinfo,"logo",t)},expression:"companyinfo.logo"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"remixicon-fill"}})],1),s("template",{slot:"append"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"chat-upload-fill"},nativeOn:{click:function(t){return e.uploadCkick("companyinfo.logo")}}})],1)],2)],1),s("el-form-item",{attrs:{label:"登录提示欢迎语"}},[s("el-input",{model:{value:e.companyinfo.title,callback:function(t){e.$set(e.companyinfo,"title",t)},expression:"companyinfo.title"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"text"}})],1)],2)],1),s("el-form-item",{attrs:{label:"企业版权信息"}},[s("el-input",{model:{value:e.companyinfo.Copyright,callback:function(t){e.$set(e.companyinfo,"Copyright",t)},expression:"companyinfo.Copyright"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"copyright-fill"}})],1)],2)],1),s("el-form-item",{attrs:{label:"首页背景图"}},[s("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.companyinfo.backgroundimage,callback:function(t){e.$set(e.companyinfo,"backgroundimage",t)},expression:"companyinfo.backgroundimage"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"bank-card-line"}})],1),s("template",{slot:"append"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"chat-upload-fill"},nativeOn:{click:function(t){return e.uploadCkick("companyinfo.backgroundimage")}}})],1)],2)],1),s("el-form-item",{attrs:{label:"侧边栏展开图"}},[s("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.companyinfo._mimg,callback:function(t){e.$set(e.companyinfo,"_mimg",t)},expression:"companyinfo._mimg"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"bank-card-line"}})],1),s("template",{slot:"append"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"chat-upload-fill"},nativeOn:{click:function(t){return e.uploadCkick("companyinfo._mimg")}}})],1)],2)],1),s("el-form-item",{attrs:{label:"侧边栏收起图"}},[s("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.companyinfo._pcimg,callback:function(t){e.$set(e.companyinfo,"_pcimg",t)},expression:"companyinfo._pcimg"}},[s("template",{slot:"prepend"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"bank-card-line"}})],1),s("template",{slot:"append"},[s("dgiot-icon",{staticStyle:{color:"#3492ed"},attrs:{icon:"chat-upload-fill"},nativeOn:{click:function(t){return e.uploadCkick("companyinfo._pcimg")}}})],1)],2)],1),s("el-form-item",{attrs:{label:"总控台大屏"}},[s("el-input",{attrs:{readonly:0!=e.bigView.length},model:{value:e.companyinfo.homeScreen,callback:function(t){e.$set(e.companyinfo,"homeScreen",t)},expression:"companyinfo.homeScreen"}},[s("template",{slot:"append"},[s("el-button",{nativeOn:{click:function(t){e.bigModule=!0}}},[e._v(" 选择 ")])],1)],2)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.onSubmit.apply(null,arguments)}}},[e._v(" 保存 ")])],1)],1)],1)],1)])],1)],1)],1)],1)],1)])},a=[],i=s("5880"),o=s("28d7"),l=s("8665"),n=s("7a3f"),c=s("8ba7"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"Userinfo",components:{},data(){const e=(e,t,s)=>{t&&!Object(o["isPhone"])(t)?s(new Error(this.$translateTitle("请输入正确的手机号"))):s()};return{bigModule:!1,bigView:[],inputParams:{},channeindex:0,password:"",registerRules:{phone:[{required:!1,trigger:"blur",message:this.$translateTitle("请输入手机号")},{validator:e,trigger:"blur"}]},filetype:"",objectId:"",dialogVisible:!1,activeName:"first",userinfo:{sex:"女",description:""},username:"",nick:"",phone:"",companyinfo:{name:"",logo:"",title:"",Copyright:"",backgroundimage:"",homeScreen:""},upNodeType:""}},computed:b({},Object(i["mapGetters"])({avatar:"user/avatar",token:"user/token",_pcimg:"dashboard/_pcimg",_mimg:"dashboard/_mimg",Default:"acl/Default",ObjectId:"user/objectId",theme:"settings/theme"})),mounted(){this.$nextTick(()=>{this.ObjectId&&this.queryUserInfo(this.ObjectId),this.queryBigView()})},methods:v(b({},Object(i["mapMutations"])({setAvatar:"user/setAvatar",setlogo:"user/setlogo",setBackgroundimage:"user/setBackgroundimage",setname:"user/setname",setcopyright:"user/setCopyright",set_pcimg:"dashboard/set_pcimg",set_mimg:"dashboard/set_mimg"})),{handleCurrentChange(e){return y(this,null,(function*(){yield console.log(e.objectId),this.companyinfo.homeScreen=e.objectId,this.bigModule=!1}))},queryBigView(){return y(this,null,(function*(){const{results:e=[]}=yield Object(c["queryView"])({where:{type:"bigScreen"}});this.bigView=e}))},fileInfo(e){dgiotlog.log("uploadFinish",e);let t=this.upNodeType;switch(dgiotlog.log("upNodeType",this[t]),this[t]=e.path,t){case"userinfo.avatar":this.userinfo.avatar=e.path,this.setAvatar(e.path);break;case"companyinfo._pcimg":this.set_pcimg(e.path),this.companyinfo._pcimg=e.path;break;case"companyinfo._mimg":this.companyinfo._mimg=e.path,this.set_mimg(e.path);break;case"companyinfo.logo":this.companyinfo.logo=e.path,this.setlogo(e.path);break;case"companyinfo.backgroundimage":this.companyinfo.backgroundimage=e.path,this.setBackgroundimage(e.path),Object(n["putProject"])(this.Default.objectId,{background:e.url}).then(e=>{dgiotlog.log(e),this.$baseMessage(this.$translateTitle("保存成功"),"success",!1,"dgiot-hey-message-success")}).catch(e=>{dgiotlog.log(e),this.$baseMessage(this.$translateTitle("保存失败"+e),"success",!1,"dgiot-hey-message-success")});break;default:dgiotlog.log("type",this.filetype);break}this.$forceUpdate(),this.onSubmit()},onSubmit(){return y(this,null,(function*(){if(this.setname(this.companyinfo.name),this.setcopyright(this.companyinfo.Copyright),0!=this.userinfo.phone.length&&!Object(o["isPhone"])(this.userinfo.phone))return void this.$refs["userinfo"].validateField("phone");dgiotlog.log("this.companyinfo===========",this.companyinfo);let e={tag:{companyinfo:this.companyinfo,userinfo:this.userinfo,theme:this.theme},nick:this.nick,username:this.username,phone:this.userinfo.phone};this.password&&(e["password"]=this.password);const t=yield Object(l["putUser"])(this.objectId,e);t&&this.$baseMessage(this.$translateTitle("保存成功"),"success",!1,"dgiot-hey-message-success")}))},uploadCkick(e){this.upNodeType=e,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"user/profile/",filename:`${this.ObjectId}_${this.upNodeType.replace(".","_")}.${e}`}},files(e,t){this.inputParams.filename=`${this.ObjectId}_${this.upNodeType.replace(".","_")}.${t}`,this.inputParams.file=e},queryUserInfo(e){return y(this,null,(function*(){const{username:t,nick:s,phone:r,objectId:a,tag:i={companyinfo:{backgroundimage:"",name:"",logo:"",title:"",Copyright:"",homeScreen:""},userinfo:{},theme:{}}}=yield this.$get_object("_User",e);this.userinfo=i.userinfo,this.objectId=a,this.username=t,this.nick=s,this.phone=r,this.userinfo.phone=this.phone,this.companyinfo=Object.assign(i.companyinfo,{_pcimg:this._pcimg||"",_mimg:this._mimg||"",homeScreen:""}),dgiotlog.log("this.userinfo",this.userinfo),dgiotlog.log("this.companyinfo",this.$FileServe+this.userinfo.avatar)}))}})},_=w,$=(s("268c"),s("2877")),k=Object($["a"])(_,r,a,!1,null,"01850b87",null);t["default"]=k.exports},"58ae":function(e,t,s){},"58da":function(e,t,s){},"69a5":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"alarms-view"},[s("div",{staticClass:"page-title"},[e._v(" "+e._s(e.$translateTitle("leftbar.alarms"))+" ")]),s("div",{staticClass:"table-title"},[e._v(" "+e._s(e.$translateTitle("analysis.currentAlarms"))+" ")]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.currentTableData}},[s("el-table-column",{attrs:{label:e.$translateTitle("analysis.alarmName"),prop:"name"}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.alarmMessage"),"min-width":"140px",prop:"message","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("el-popover",{attrs:{"open-delay":500,placement:"top",trigger:"hover",width:"160"}},[e._l(r.details,(function(t,r){return s("div",{key:r},[e._v(" "+e._s(r)+": "+e._s(t)+" ")])})),s("span",{staticClass:"details",attrs:{slot:"reference"},slot:"reference"},[s("i",{staticClass:"iconfont icon-bangzhu"})])],2),s("span",[e._v(e._s(r.message))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("clients.node"),"min-width":"60px",prop:"node","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.activateAt"),prop:"activate_at"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.dateFormat(s.activate_at))+" ")]}}])}),s("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.getDuration(s.duration))+" ")]}}])},[s("span",{attrs:{slot:"header"},slot:"header"},[e._v(" "+e._s(e.$translateTitle("analysis.duration"))+" "),s("el-popover",{attrs:{placement:"top",trigger:"hover"}},[e._v(" "+e._s(e.$translateTitle("analysis.durationTips"))+" "),s("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1)]),s("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("oper.oper"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,a=t.$index,i=t._self;return[s("el-popover",{ref:"popover-"+a,attrs:{placement:"right",trigger:"click"}},[s("p",[e._v(e._s(e.$translateTitle("analysis.confirmDeactivate")))]),s("div",{staticStyle:{"text-align":"right"}},[s("el-button",{staticClass:"cache-btn",attrs:{size:"mini",type:"text"},on:{click:function(e){i.$refs["popover-"+a].doClose()}}},[e._v(" "+e._s(e.$translateTitle("oper.cancel"))+" ")]),s("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleCancelAlarm(r,a,i)}}},[e._v(" "+e._s(e.$translateTitle("oper.confirm"))+" ")])],1),s("el-button",{attrs:{slot:"reference",plain:"",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("analysis.deactivate"))+" ")])],1)]}}])})],1),s("div",{staticClass:"table-title"},[e._v(" "+e._s(e.$translateTitle("analysis.historicalAlarm"))+" "),s("el-button",{staticClass:"table-oper",attrs:{disabled:!e.historicalTableData.length,plain:"",size:"mini",type:"danger"},on:{click:e.handleClearAll}},[e._v(" "+e._s(e.$translateTitle("analysis.clearAll"))+" ")])],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.historicalTableData}},[s("el-table-column",{attrs:{label:e.$translateTitle("analysis.alarmName"),prop:"name"}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.alarmMessage"),"min-width":"140px",prop:"message","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("el-popover",{attrs:{"open-delay":500,placement:"top",trigger:"hover",width:"160"}},[e._l(r.details,(function(t,r){return s("div",{key:r},[e._v(" "+e._s(r)+": "+e._s(t)+" ")])})),s("span",{staticClass:"details",attrs:{slot:"reference"},slot:"reference"},[s("i",{staticClass:"iconfont icon-bangzhu"})])],2),s("span",[e._v(e._s(r.message))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("clients.node"),"min-width":"60px",prop:"node","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.activateAt"),prop:"activate_at"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.dateFormat(s.activate_at))+" ")]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.deactivateAt"),prop:"deactivate_at"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.dateFormat(s.deactivate_at))+" ")]}}])})],1)],1)},a=[],i=s("5c96"),o=s("ed08"),l=s("926a"),n={name:"AlarmsView",components:{"el-table":i["Table"],"el-table-column":i["TableColumn"],"el-popover":i["Popover"],"el-tooltip":i["Tooltip"]},data(){return{loading:!1,currentTableData:[],historicalTableData:[],lang:window.localStorage.getItem("language")||"en"}},created(){this.loadData()},methods:{loadData(){this.loadAlarmData("activated","currentTableData"),this.loadAlarmData("deactivated","historicalTableData")},loadAlarmData(e,t){this.loading=!0,this.$httpGet("/alarms/"+e).then(e=>{const s=e.data,r=[];s.forEach(e=>{e.alarms.forEach(t=>{t.node=e.node,r.push(t)})}),this[t]=r,this.loading=!1}).catch(e=>{this.loading=!1,this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})},getDuration(e){return Object(o["getDateDiff"])(e/1e3)},dateFormat(e){return"number"!==typeof e&&"infinity"===e?"":Object(l["default"])(e/1e3,"yyyy-mm-dd HH:MM:ss")},handleCancelAlarm(e,t,s){const r={node:e.node,name:e.name};this.$httpPost("/alarms/deactivated",r).then(()=>{s.$refs["popover-"+t].doClose(),this.loadData()}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})},handleClearAll(){this.$confirm(this.$translateTitle("analysis.confirmClear"),this.$translateTitle("oper.warning"),{confirmButtonClass:"confirm-btn",cancelButtonClass:"cache-btn el-button--text",type:"warning"}).then(()=>{this.$httpDelete("/alarms/deactivated").then(()=>{this.loadData()}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})}).catch(()=>{})}}},c=n,d=(s("e76f"),s("2877")),u=Object(d["a"])(c,r,a,!1,null,null,null);t["default"]=u.exports},"6ca3":function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"6de3":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"clients-subscriptions"},[s("el-card",{staticClass:"el-card--self tabs-card"},[s("el-row",[s("el-col",{staticClass:"card-subtitle",attrs:{span:12}},[e._v(" "+e._s(e.$translateTitle("clients.currentSubs"))+" ")]),s("el-col",{staticClass:"oper-btn-group",attrs:{span:12}},[s("el-button",{attrs:{icon:"el-icon-refresh",plain:"",size:"mini",type:"success"},on:{click:e.reload}},[e._v(" "+e._s(e.$translateTitle("oper.refresh"))+" ")]),s("el-button",{attrs:{icon:"el-icon-plus",plain:"",size:"mini",type:"success"},on:{click:e.open}},[e._v(" "+e._s(e.$translateTitle("clients.addSubs"))+" ")])],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.loading,expression:"$store.state.loading"}],staticClass:"client-sub-table",attrs:{border:"",data:e.tableData}},[s("el-table-column",{attrs:{label:e.$translateTitle("subscriptions.topic"),prop:"topic"}}),s("el-table-column",{attrs:{label:e.$translateTitle("subscriptions.qoS"),prop:"qos"}}),s("el-table-column",{attrs:{label:e.$translateTitle("oper.oper"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.handleUnsub(r)}}},[e._v(" "+e._s(e.$translateTitle("oper.unsubscribe"))+" ")])]}}])})],1)],1),s("el-dialog",{staticClass:"create-subscribe",attrs:{"append-to-body":!0,title:e.$translateTitle("clients.addSubs"),visible:e.addVisible,width:"400px"},on:{"update:visible":function(t){e.addVisible=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleAdd.apply(null,arguments)}}},[s("el-form",{ref:"record",staticClass:"el-form--public",attrs:{"label-position":"top",model:e.record,rules:e.rules,size:"small"}},[s("el-form-item",{attrs:{label:e.$translateTitle("subscriptions.topic"),prop:"topic"}},[s("el-input",{attrs:{placeholder:"Topic"},model:{value:e.record.topic,callback:function(t){e.$set(e.record,"topic",t)},expression:"record.topic"}})],1),s("el-form-item",{attrs:{label:"QoS",prop:"qos"}},[s("dgiot-emq-select",{staticClass:"el-select--public",attrs:{field:{list:[0,1,2]},"popper-class":"el-select--public",size:"small"},model:{value:e.record.qos,callback:function(t){e.$set(e.record,"qos",t)},expression:"record.qos"}})],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"cache-btn",attrs:{type:"text"},on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("oper.cancel"))+" ")]),s("el-button",{staticClass:"confirm-btn",attrs:{loading:e.$store.state.loading,type:"success"},on:{click:e.handleAdd}},[e._v(" "+e._s(e.$translateTitle("oper.add"))+" ")])],1)],1)],1)},a=[],i={name:"ClientsSubscriptions",components:{},props:{clientId:{type:String,required:!0},tableData:{type:Array,required:!0},reload:{type:Function,default:()=>{}},mountpoint:{type:String,default:""}},data(){return{addVisible:!1,record:{topic:"",qos:0},rules:{clientid:{required:!0,message:this.$translateTitle("oper.pleaseEnter")},topic:{required:!0,message:this.$translateTitle("oper.pleaseEnter")}}}},methods:{handleUnsub(e){this.$msgbox.confirm(this.$translateTitle("oper.unsubscribeConfirm"),this.$translateTitle("oper.warning"),{type:"warning"}).then(()=>{const{topic:t,clientid:s}=e;let r=this.mountpoint?t.replace(this.mountpoint,""):t;const a={topic:r,clientid:s};this.$httpPost("/mqtt/unsubscribe",a).then(()=>{this.reload()}).catch(()=>{})}).catch(()=>{})},open(){this.addVisible=!0,this.record.clientid=this.clientId},handleAdd(){this.$refs.record.validate(e=>{if(!e)return;const t={};Object.assign(t,this.record),this.$httpPost("/mqtt/subscribe",t).then(()=>{this.handleClose(),this.reload()}).catch(()=>{})})},handleClose(){this.$refs.record.resetFields(),this.addVisible=!1}}},o=i,l=(s("e374"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,null,null);t["default"]=n.exports},7050:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"structure dgiot-container"},[s("div",{staticClass:"adduserDiadlog"},[s("a-drawer",{directives:[{name:"loading",rawName:"v-loading",value:e.isloading,expression:"isloading"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),title:e.$translateTitle("user.newusers"),visible:e.adduserDiadlog,width:"600px"},on:{"update:visible":function(t){e.adduserDiadlog=t},close:function(t){e.adduserDiadlog=!e.adduserDiadlog}}},[s("el-form",{ref:"userInfoFormRef",staticClass:"demo-ruleForm",attrs:{"label-width":"160px",model:e.userInfoForm,rules:e.userFormRules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$translateTitle("product.Current department"),prop:"departmentid"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:e.$translateTitle("product.Current department")},model:{value:e.userInfoForm.departmentid,callback:function(t){e.$set(e.userInfoForm,"departmentid",t)},expression:"userInfoForm.departmentid"}},e._l(e.deptOption,(function(e){return s("el-option",{key:e.objectId,attrs:{label:e.name,title:e.name+":"+e.desc,value:e.objectId}})})),1)],1),e.centerDialogRole?s("el-form-item",{attrs:{"label-width":"78px"}},[s("addroles",{ref:"addRoleRef",attrs:{"dept-data":e.deptOption[0],"is-structures":e.isStructures}})],1):e._e(),s("el-form-item",{attrs:{label:e.$translateTitle("user.name1"),prop:"nick"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:e.$translateTitle("product.eqwords")},model:{value:e.userInfoForm.nick,callback:function(t){e.$set(e.userInfoForm,"nick",t)},expression:"userInfoForm.nick"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("product.phone"),prop:"phone",width:85}},[s("el-input",{attrs:{"auto-complete":"off",maxlength:11,placeholder:e.$translateTitle("product.enterphonenumber")},model:{value:e.userInfoForm.phone,callback:function(t){e.$set(e.userInfoForm,"phone",t)},expression:"userInfoForm.phone"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.email"),prop:"email"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:e.$translateTitle("product.enteremail")},model:{value:e.userInfoForm.email,callback:function(t){e.$set(e.userInfoForm,"email",t)},expression:"userInfoForm.email"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.account"),prop:"account"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:e.$translateTitle("product.enteraccount")},model:{value:e.userInfoForm.account,callback:function(t){e.$set(e.userInfoForm,"account",t)},expression:"userInfoForm.account"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("developer.password"),prop:"password"}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:e.userInfoForm.password,callback:function(t){e.$set(e.userInfoForm,"password",t)},expression:"userInfoForm.password"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("developer.confirmpassword"),prop:"checkPass"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:e.$translateTitle("product.enterpwa")},model:{value:e.userInfoForm.checkPass,callback:function(t){e.$set(e.userInfoForm,"checkPass",t)},expression:"userInfoForm.checkPass"}})],1)],1),s("div",{style:{position:"absolute",bottom:0,width:"100%",borderTop:"1px solid #e8e8e8",padding:"10px 16px",left:40,textAlign:"center",background:"#fff",borderRadius:"0 0 4px 4px"}},[s("el-button",{attrs:{disabled:e.centerDialogRole},on:{click:function(t){e.adduserDiadlog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),s("el-button",{attrs:{disabled:e.centerDialogRole,type:"primary"},on:{click:e.addUser}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("div",{staticClass:"tabContent"},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{span:24}},[s("dgiot-query-form",{directives:[{name:"show",rawName:"v-show",value:e.currentDepartment.depname,expression:"currentDepartment.depname"}]},[s("dgiot-query-form-top-panel",[s("el-button",{nativeOn:{click:function(t){return e.addItemUser(e.currentDepartment)}}},[e._v(" "+e._s(e.$translateTitle("user.newusers"))+" ")])],1)],1),s("div",{staticClass:"elTable"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.pictLoading,expression:"pictLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableFilterData}},[s("el-table-column",{attrs:{label:e.$translateTitle("user.username")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("div",[e._v(e._s(r.username))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("user.name1")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("div",[e._v(e._s(r.nick))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("user.phonenumber")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("div",[e._v(e._s(r.phone))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("user.email"),"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("div",[e._v(e._s(r.email))])]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("user.createdtime"),"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(" "+e._s(new Date(r.createdAt).toLocaleDateString())+" ")])]}}])}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e.objectId!==r.objectId?s("div",[s("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.handleLeaving(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.leaving"))+" ")]),s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDetele(r)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")]),s("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.handleResign(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.resign"))+" ")])],1):e._e()]}}])}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.Disable")+e.$translateTitle("user.account"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e.objectId!==r.objectId?s("el-tooltip",{attrs:{content:e.$translateTitle("user.Current state")+r.emailVerified?e.$translateTitle("user.Enable"):e.$translateTitle("user.Disable"),placement:"top"}},[s("el-switch",{attrs:{"active-color":"#13ce66","active-text":e.$translateTitle("user.Enable"),"inactive-color":"#ff4949","inactive-text":e.$translateTitle("user.Disable")},on:{change:function(t){return e.disableRow(r.objectId,r.emailVerified)}},model:{value:r.emailVerified,callback:function(t){e.$set(r,"emailVerified",t)},expression:"row.emailVerified"}})],1):e._e()]}}])})],1)],1)],1)],1)],1)]),e.leaving?s("el-dialog",{attrs:{"append-to-body":"",center:"",title:e.$translateTitle("Maintenance.The current user department")+e.leavingUser.role.depname,visible:e.leaving,width:"30%"},on:{"update:visible":function(t){e.leaving=t}}},[s("el-tree",{attrs:{data:e.deptTreeData,"default-expand-all":"",props:e.defaultProps},on:{"node-click":e.Resign}})],1):e._e(),s("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.$translateTitle("user.assignroles"),visible:e.roleacl},on:{"update:visible":function(t){e.roleacl=t}}},[s("el-table",{ref:"multipleTable",attrs:{data:e.rolelist,size:"mini"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.name")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.alias))])]}}])}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.describe")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.desc))])]}}])}),s("el-table-column",{attrs:{align:"center",label:"ID"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.objectId))])]}}])})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.roleacl=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.adduseracl.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1)],1)},a=[],i=s("d10c"),o=s("4be7"),l=s("5880"),n=s("8665"),c=s("5da9"),d=s("bc35"),u=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,s)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,v=(e,t)=>{for(var s in t||(t={}))f.call(t,s)&&b(e,s,t[s]);if(h)for(var s of h(t))g.call(t,s)&&b(e,s,t[s]);return e},y=(e,t)=>p(e,m(t)),w=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),_={components:{addroles:i["default"]},data(){var e=(e,t,s)=>{""===t?s(new Error("请输入密码")):(/^\w{4,20}$/.test(t)||s(new Error("密码长度必须大于4位")),s())},t=(e,t,s)=>{""===t?s(new Error("请再次输入密码")):t!==this.userInfoForm.password?s(new Error("两次输入密码不一致!")):s()};return{leaving:!1,leavingUser:{},tableHeight:this.$baseTableHeight(0)-20,isloading:!1,isStructures:!0,upKey:Number(moment().unix()),isEvent:!1,depobjectId:"",centerDialogRole:!1,deptData:{},roleProps:{children:"children",label:"name"},treeDataValue:"",queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,access_token:""},departmentObj:[],departmentname:"",curDepartmentId:"",deptTreeData:[],deptOption:[],departmentidFlag:"false",height:document.documentElement.clientHeight-180+"px;",delLoading:!1,sup_this:this,loading:!1,deptName:"",depts:[],deptId:null,structure:[],defaultProps:{children:"children",label:"name"},data:[],elTreedefaultProps:{children:"children",label:"name"},dataforuser:[],total:0,query:{value:"",type:"",enabled:""},tableData:[],pagesize:10,start:0,departmentid:[],userlist:[],rolelist:[],userId:"",roleacl:!1,multipleSelection:[],userrolelist:[],tempData:[],adduserDiadlog:!1,userInfoForm:{account:"",phone:"",nick:"",password:"",email:"",checkPass:"",departmentid:[]},userFormRules:{account:[{required:!0,message:"请输入账号名",trigger:"blur"}],phone:[{required:!1,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,s){var r=/^1[34578]\d{9}$/;t?r.test(t)?s():s(new Error("手机号码格式不正确！")):s()},trigger:"blur"}],password:[{validator:e,trigger:"blur",required:!0}],checkPass:[{validator:t,trigger:"blur",required:!0}],departmentid:[{required:!0,message:"请选择部门",trigger:"blur"}],nick:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]},treeprops:{value:"objectId",label:"name"},pictLoading:!1}},computed:y(v({},Object(l["mapGetters"])({roleTree:"user/roleTree",title:"settings/title",tag:"settings/tag",objectId:"user/objectId",currentDepartment:"user/currentDepartment"})),{tableFilterData(){return this.tempData}}),mounted(){this.isEvent=!1,this.searchAllOption(),this.$dgiotBus.$on("dialogHide2",e=>{dgiotlog.log(e),(null==e?void 0:e.length)&&(this.depobjectId=e,this.isEvent=!0),this.$nextTick(()=>{this.centerDialogRole=!1,this.getRoletree()})})},methods:y(v({},Object(l["mapMutations"])({setRoleTree:"user/setRoleTree"})),{getRoletree(){return w(this,null,(function*(){this.upKey++;const{results:e=[]}=yield Object(d["Roletree"])();dgiotlog.log(e,"results"),this.$dgiotBus.$emit("asyncTreeData"),this.deptTreeData=this.currentDepartment,dgiotlog.log(this.deptTreeData,"this.deptTreeData",this.currentDepartment),this.isloading=!0,setTimeout(()=>{this.isEvent&&this.$query_object("_Role",{limit:1,where:{objectId:this.depobjectId}}).then(e=>{var t;(null==(t=e.results)?void 0:t.length)&&(this.addItemUser(e.results[0]),this.departmentname=e.results[0].name,this.curDepartmentId=e.results[0].objectId,this.treeDataValue=e.results[0].label,this.queryForm.workGroupName=e.results[0].label)}).catch(e=>{dgiotlog.log(e)}),this.isloading=!1},1500)}))},closeDialogRole(){this.centerDialogRole=!1},addGroup(e){dgiotlog.log(e)},addItemUser(e){this.deptOption=[],this.departmentObj=e,dgiotlog.log(e),this.deptOption.push(e),this.adduserDiadlog=!0,this.userInfoForm.departmentid=e.objectId},change(e){dgiotlog.log(e),e&&$(".el-tree").css({height:"300px",display:"block","overflow-x":"auto"})},addUser(){this.$refs["userInfoFormRef"].validate(e=>w(this,null,(function*(){if(dgiotlog.log("tag",this.tag),this.$delete(this.tag,"wechat"),!e)return this.$message({message:"用户信息不完整",type:"danger"}),!1;const t={username:this.userInfoForm.account,nick:this.userInfoForm.nick,password:this.userInfoForm.password,phone:this.userInfoForm.phone,email:this.userInfoForm.email,department:this.userInfoForm.departmentid,emailVerified:!0,tag:this.tag},s=yield Object(n["EmployeesHired"])(t);s?(this.$message({showClose:!0,duration:2e3,message:"用户添加成功！",type:"success"}),this.adduserDiadlog=!1,this.handleNodeClick(this.departmentObj)):this.$message("添加失败")})))},editorrole(e){return w(this,null,(function*(){const t={order:"createdAt",where:{users:{className:"_User",__type:"Pointer"}}};this.rolelist=[],this.userrolelist=[],this.userId=e;const{results:s}=yield this.$query_object("_User",{limit:1,where:{objectId:this.userId}});s.length&&(t.where.users.objectId=s[0].objectId);const r=yield this.$query_object("_Role",t),a=r.results;this.rolelist=a,dgiotlog.log("result",r.results),a.length&&(a.map((e,t)=>{dgiotlog.log(e.objectId,e,this.userId==e.objectId),this.userId==e.objectId&&(this.$refs.multipleTable.toggleRowSelection(this.rolelist[t],!0),this.userrolelist.push(e.objectId))}),dgiotlog.log(this.userrolelist),this.roleacl=!0)}))},seleItem(e,t,s){dgiotlog.log("arr1, arr2, arr3",e,t,s),e.map(e=>{t.includes(e)||s.push(e)}),t.map(t=>{e.includes(t)||s.push(t)}),this.userRolereset(s)},userRolereset(e){o["Promise"].all([e.map(e=>{dgiotlog.log(e),this.testroles(e)})]).then(e=>{0!=e.length&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"分配成功"}),this.roleacl=!1)})},testroles(e){dgiotlog.log(e)},adduseracl(){this.seleItem(this.userrolelist,this.multipleSelection,[])},handleSelectionChange(e){this.multipleSelection=[],e.map(e=>{this.multipleSelection.push(e.id)})},handleLeaving(e){this.currentDepartment.depname?this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to remove the user from this post")+this.currentDepartment.depname,null,()=>w(this,null,(function*(){const t={userid:e.objectId,filter:{where:{name:this.currentDepartment.depname}}};dgiotlog.log(typeof t);yield Object(c["deleteRoleuser"])(t);this.searchAllOption(),this.$baseMessage(this.$translateTitle("user.Role information updated successfully"),"success","dgiot-hey-message-success")}))):this.$baseMessage(this.$translateTitle("product.selectdepartment"))},disableRow(e,t){let s="enable";s=t?"enable":"disable";const r={userid:e,action:s};Object(n["disableuser"])(r).then(e=>{dgiotlog.log(e),void 0!=e?t?this.$message({showClose:!0,duration:2e3,type:"success",message:"启用成功!"}):this.$message({showClose:!0,duration:2e3,type:"success",message:"禁用成功!"}):(this.userFordepartment(),t?this.$message({type:"error",message:"权限不足,启用失败!"}):this.$message({type:"error",message:"权限不足,禁用失败!"}))})},Resign(e){return w(this,null,(function*(){dgiotlog.log(e);try{this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to transfer this user to")+e.depname,null,()=>w(this,null,(function*(){const t={addfilter:{where:{depname:e.depname}},delfilter:{where:{depname:this.leavingUser.role.depname}},userid:this.leavingUser.objectId},s=this.$baseLoading(1);yield Object(c["putRoleuser"])(t);s.close(),this.leaving=!1,this.searchAllOption()})))}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},handleResign(e){this.leaving=!0,this.leavingUser=e},handleDetele(e){this.currentDepartment.depname?this.$confirm("此操作将永久删除此用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>w(this,null,(function*(){const t={department:this.currentDepartment.objectId,username:e.username},s=yield Object(n["EmployeeTurnover"])(t);s&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功!"}),this.searchAllOption())}))):this.$baseMessage(this.$translateTitle("product.selectdepartment"))},handleSizeChange(e){this.pagesize=e,this.userFordepartment()},handleCurrentChange(e){this.start=Number(e-1)*Number(this.pagesize),this.userFordepartment()},userFordepartment(e){return w(this,null,(function*(){this.pictLoading=!0,this.tempData=[],0==e?this.start=0:this.query.value="";let t={where:{objectId:this.currentDepartment.objectId},include:!0,limit:10};const{results:s}=yield Object(c["getRoleuser"])(t);s?(this.query.value?this.tempData=s.filter(e=>-1!=e.username.indexOf(this.query.value)):this.tempData=s,this.pictLoading=!1):this.pictLoading=!1,this.total=this.tempData.length}))},handleNodeClick(e){return w(this,null,(function*(){this.treeDataValue=e.label,this.queryForm.workGroupName=e.label,dgiotlog.log(this.treeDataValue),this.departmentname=e.name,this.curDepartmentId=e.objectId,this.tempData=[],this.pictLoading=!0;const t={name:e.name},{users:s}=yield Object(c["queryRoledepartment"])(t);s?(this.tempData=s.filter(e=>-1==e.username.indexOf("user_for_")),this.pictLoading=!1,this.total=this.tempData.length):(this.pictLoading=!1,this.total=0)}))},searchAllOption(){this.deptTreeData=this.roleTree,this.userFordepartment()}})},k=_,T=(s("d6f2"),s("75ae"),s("2877")),x=Object(T["a"])(k,r,a,!1,null,"097ae559",null);t["default"]=x.exports},"72de":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"player-container"},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.$route.query.url,expression:"!$route.query.url"}],attrs:{gutter:24}},[s("el-col",{attrs:{span:23}},[s("el-input",{staticClass:"input-with-select",attrs:{disabled:e.$route.query.url,placeholder:"请输入内容"},model:{value:e.flvsrc,callback:function(t){e.flvsrc=t},expression:"flvsrc"}},[s("el-select",{staticStyle:{width:"200px"},attrs:{slot:"append",disabled:e.$route.query.type,placeholder:"请选择視頻流格式"},on:{change:e.changeType},slot:"append",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.videoType,(function(e){return s("el-option",{key:e.type,attrs:{label:e.type,value:e.type}})})),1)],1)],1),s("el-col",{attrs:{span:1}},[s("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.Play()}}},[e._v("播放")])],1)],1),s("el-card",{staticClass:"player_card",attrs:{shadow:"hover"}},[s("dgiot-player",{ref:"dgiotPlayer",attrs:{autoplay:e.mp4Play,height:e.height,source:e.flvsrc,type:e.type,width:e.width}})],1)],1)],1)],1)},a=[],i={name:"Player",data(){return{height:this.$baseTableHeight(0),type:this.$route.query?this.$route.query.type:"mp4",width:1600,flvsrc:this.$route.query?this.$route.query.url:"https://media.w3.org/2010/05/sintel/trailer.mp4",mp4Play:!1,videoType:[{type:"mp4",url:"https://media.w3.org/2010/05/sintel/trailer.mp4"},{type:"flv",url:"https://rtmp01open.ys7.com:9188/v3/openlive/C45644828_1_2.flv?expire=1656812988&id=333182878081585152&t=9d9c1b3187ff62633be8573281bff2ae7318ae200908c388bb6c092f54f29c52&ev=100"}]}},computed:{},mounted(){this.$route.query.type&&this.$route.query.url&&setTimeout(()=>{this.mp4Play=!0},1500)},methods:{changeType(e){let t=this.videoType.filter(t=>{if(t.type==e)return t});dgiotlog.log(e,t[0].url),this.flvsrc=t[0].url},Play(){this.$refs.dgiotPlayer.createVideo()}}},o=i,l=(s("0a894"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,"4df7b074",null);t["default"]=n.exports},7418:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"login-container",style:{backgroundImage:"url("+e.backgroundImage+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"form",staticClass:"login-form",attrs:{"label-position":"left",model:e.form,rules:e.rules}},[e.Default.title?s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")]):e._e(),s("el-form-item",{staticStyle:{"margin-top":"40px"},attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:e.$translateTitle("home.Please enter user name"),tabindex:"1",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}]),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{key:e.passwordType,ref:"password",attrs:{placeholder:e.$translateTitle("home.Please enter the password"),tabindex:"2",type:e.passwordType},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e.form.password.length?s("dgiot-icon",{attrs:{icon:"lock-line"}}):e._e()]},proxy:!0},"password"===e.passwordType&&e.form.password.length?{key:"suffix",fn:function(){return[s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-off-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}})]},proxy:!0}:{key:"suffix",fn:function(){return[e.form.password.length?s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}}):e._e()]},proxy:!0}],null,!0),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-input",{staticClass:"sbMc"},[s("el-button",{staticClass:"login-btn",attrs:{slot:"append",loading:e.loading,type:"primary"},nativeOn:{click:function(t){return e.handleLogin.apply(null,arguments)}},slot:"append"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")])],1)],1),s("span",[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{float:"left"},attrs:{to:"/register"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("home.registered"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px",cursor:"pointer"}})],1)],1)],1)],1)],1)},a=[],i=s("3e35f"),o=s.n(i),l=s("5880"),n=s("28d7"),c=s("1c4e"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"Admin",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},beforeRouteLeave(e,t,s){clearInterval(this.timer),clearInterval(this.interval),s()},data(){const e=(e,t,s)=>{""===t?s(new Error(this.info.empty)):s()},t=(e,t,s)=>{let r=4;Object(n["isPassword"])(t,r)?s():s(new Error(this.info.than+r+this.info.Bit))};return{interval:null,locationPath:location.href.split("/#")[0],info:{empty:this.$translateTitle("home.Username can not be empty"),than:this.$translateTitle("home.Password cannot be less than"),Bit:this.$translateTitle("home.Bit")},backgroundImage:o.a,nodeEnv:"production",form:{username:"dgiot_admin",password:"dgiot_admin"},rules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},loading:!1,passwordType:"password",redirect:void 0,timer:0}},computed:b({},Object(l["mapGetters"])({language:"settings/language",Default:"acl/Default",license:"acl/license",logo:"user/logo",objectId:"user/objectId",backgroundimage:"user/backgroundimage"})),watch:{language:{handler(e){this.changeInfo(e),this.$nextTick(()=>{this.$refs.form.resetFields()})},deep:!0,immediate:!0},"Default.background":{handler(e){this.backgroundImage=e},immediate:!0},$route:{handler(e){this.redirect=e.query&&e.query.redirect||"/"},immediate:!0}},beforeDestroy(){window.removeEventListener("message",this.iframeLogin)},mounted(){return y(this,null,(function*(){yield this.dgiotReset(),yield this.initShuwa(),this.$nextTick(()=>y(this,null,(function*(){yield this.defaultSet(),yield this.init()})))}))},created(){window.addEventListener("message",this.iframeLogin)},methods:v(b(v(b({},Object(l["mapMutations"])({setTitle:"settings/setTitle",setCopyright:"acl/setCopyright",setDefault:"acl/setDefault"})),{iframeLogin(e){return y(this,null,(function*(){try{const t={value:moment().format("YYYY:MM:DD  HH:mm:ss"),key:"startIframe",action:"save",type:"cookie",time:moment().format("YYYY:MM:DD  HH:mm:ss")};e.source.postMessage(t,e.origin);moment().format("YYYY:MM:DD  HH:mm:ss"),moment().format("YYYY:MM:DD  HH:mm:ss")}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},routeDgiot(){return y(this,null,(function*(){try{yield setTimeout(()=>{this.objectId&&(console.log("userid",this.objectId),document.querySelector(".el-tree-node__content").click())},1200)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},init(){return y(this,null,(function*(){try{Cookies.remove("startIframe"),Cookies.remove("pwaLogin"),this.$nextTick(()=>y(this,null,(function*(){"dgiot_iframe"==window.name&&(Cookies.set("startIframe",moment().format("YYYY:MM:DD HH:mm:ss"),{expires:18e5}),yield this.goHome())})))}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},defaultSet(){return y(this,null,(function*(){console.log("dgiot build time: "+dgiot.dateTime),console.log("startIframe time: "+Cookies.get("startIframe")),this.backgroundImage=Cookies.get("startIframe")?"https://s2.loli.net/2021/12/15/ciVTb7w62rxQ3a9.jpg":this.backgroundimage;const e=location.origin;Cookies.set("fileServer",e,{expires:18e5})}))},changeInfo(e){this.$set(this.info,"empty",this.$translateTitle("home.Username can not be empty")),this.$set(this.info,"than",this.$translateTitle("home.Password cannot be less than")),this.$set(this.info,"Bit",this.$translateTitle("home.Bit")),this.$forceUpdate()},forgotPwd(){this.$message(this.$translateTitle("home.Forgot password"))}}),Object(l["mapActions"])({dgiotReset:"user/dgiotReset",login:"user/login",queryAll:"user/queryAll",jwtlogin:"user/jwtlogin"})),{getCategory(e){let t="";return this.category.filter(s=>{s.type==e&&(t=s.data.CategoryName)}),t},initShuwa(){return y(this,null,(function*(){const e=yield Object(c["SiteDefault"])(),{copyright:t,logo:s,objectId:r,title:a}=e;this.setDefault(e),this.setTitle(a),this.setCopyright(t)}))},handlePassword(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleRoute(){return"/404"===this.redirect||"/403"===this.redirect?"/":this.redirect},handleLogin(){this.$refs.form.validate(e=>y(this,null,(function*(){if(!e)return!1;try{this.loading=!0,yield this.login(this.form),yield this.goHome()}finally{this.loading=!1}})))},goHome(){return y(this,null,(function*(){try{this.interval=setInterval(()=>y(this,null,(function*(){""!=Cookies.get("handleRoute")&&(console.log("handleRoute 存在，跳转页面"),yield this.$router.push(this.handleRoute()),yield this.routeDgiot(),clearInterval(this.interval),window.clearInterval(this.interval))})),1500)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}})},_=w,$=(s("f0e4"),s("2877")),k=Object($["a"])(_,r,a,!1,null,"a43a4fce",null);t["default"]=k.exports},"75ae":function(e,t,s){"use strict";s("3563")},"7d37":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"login-container",style:{backgroundImage:"url("+e.backgroundImage+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[e.isShow?s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"form",staticClass:"login-form",attrs:{"label-position":"left",model:e.form,rules:e.rules}},[e.Default.title?s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")]):e._e(),s("el-form-item",{staticStyle:{"margin-top":"40px"},attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:e.$translateTitle("home.Please enter user name"),tabindex:"1",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}],null,!1,584386874),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{key:e.passwordType,ref:"password",attrs:{placeholder:e.$translateTitle("home.Please enter the password"),tabindex:"2",type:e.passwordType},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e.form.password.length?s("dgiot-icon",{attrs:{icon:"lock-line"}}):e._e()]},proxy:!0},"password"===e.passwordType&&e.form.password.length?{key:"suffix",fn:function(){return[s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-off-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}})]},proxy:!0}:{key:"suffix",fn:function(){return[e.form.password.length?s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}}):e._e()]},proxy:!0}],null,!0),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-input",{staticClass:"sbMc"},[s("el-button",{staticClass:"login-btn",attrs:{slot:"append",loading:e.loading,type:"primary"},nativeOn:{click:function(t){return e.handleLogin.apply(null,arguments)}},slot:"append"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")])],1)],1),s("span",[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{float:"left"},attrs:{to:"/register"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("home.registered"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px",cursor:"pointer"}})],1)],1)],1)],1):e._e()],1)},a=[],i=s("3e35f"),o=s.n(i),l=s("5880"),n=s("28d7"),c=s("1c4e"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"JwtLogin",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},beforeRouteLeave(e,t,s){clearInterval(this.timer),clearInterval(this.interval),s()},data(){const e=(e,t,s)=>{""===t?s(new Error(this.info.empty)):s()},t=(e,t,s)=>{let r=4;Object(n["isPassword"])(t,r)?s():s(new Error(this.info.than+r+this.info.Bit))};return{interval:null,isShow:!1,locationPath:location.href.split("/#")[0],info:{empty:this.$translateTitle("home.Username can not be empty"),than:this.$translateTitle("home.Password cannot be less than"),Bit:this.$translateTitle("home.Bit")},backgroundImage:o.a,nodeEnv:"production",form:{username:"dgiot_admin",password:"dgiot_admin"},rules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},loading:!1,passwordType:"password",redirect:void 0,timer:0}},computed:b({},Object(l["mapGetters"])({language:"settings/language",Default:"acl/Default",license:"acl/license",logo:"user/logo",objectId:"user/objectId",backgroundimage:"user/backgroundimage"})),watch:{language:{handler(e){this.changeInfo(e),this.$nextTick(()=>{this.$refs.form.resetFields()})},deep:!0,immediate:!0},"Default.background":{handler(e){this.backgroundImage=e},immediate:!0},$route:{handler(e){this.redirect=e.query&&e.query.redirect||"/"},immediate:!0}},beforeDestroy(){window.removeEventListener("message",this.iframeLogin)},mounted(){return y(this,null,(function*(){yield this.initShuwa(),this.$nextTick(()=>y(this,null,(function*(){yield this.defaultSet(),yield this.init()})))}))},created(){this.$route.query.id_token&&this.jwtlogin(this.$route.query.id_token),window.addEventListener("message",this.iframeLogin)},methods:v(b(v(b({},Object(l["mapMutations"])({setTitle:"settings/setTitle",setCopyright:"acl/setCopyright",setDefault:"acl/setDefault"})),{iframeLogin(e){return y(this,null,(function*(){try{const t={value:moment().format("YYYY:MM:DD  HH:mm:ss"),key:"startIframe",action:"save",type:"cookie",time:moment().format("YYYY:MM:DD  HH:mm:ss")};e.source.postMessage(t,e.origin);moment().format("YYYY:MM:DD  HH:mm:ss"),moment().format("YYYY:MM:DD  HH:mm:ss")}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},routeDgiot(){return y(this,null,(function*(){try{yield setTimeout(()=>{this.objectId&&(console.log("userid",this.objectId),document.querySelector(".el-tree-node__content").click())},1200)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},init(){return y(this,null,(function*(){try{Cookies.remove("startIframe"),Cookies.remove("pwaLogin"),this.$nextTick(()=>y(this,null,(function*(){"dgiot_iframe"==window.name&&(Cookies.set("startIframe",moment().format("YYYY:MM:DD HH:mm:ss"),{expires:18e5}),yield this.goHome())})))}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},defaultSet(){return y(this,null,(function*(){console.log("dgiot build time: "+dgiot.dateTime),console.log("startIframe time: "+Cookies.get("startIframe")),this.backgroundImage=Cookies.get("startIframe")?"https://s2.loli.net/2021/12/15/ciVTb7w62rxQ3a9.jpg":this.backgroundimage;const e=location.origin;Cookies.set("fileServer",e,{expires:18e5})}))},changeInfo(e){this.$set(this.info,"empty",this.$translateTitle("home.Username can not be empty")),this.$set(this.info,"than",this.$translateTitle("home.Password cannot be less than")),this.$set(this.info,"Bit",this.$translateTitle("home.Bit")),this.$forceUpdate()},forgotPwd(){this.$message(this.$translateTitle("home.Forgot password"))}}),Object(l["mapActions"])({login:"user/login",queryAll:"user/queryAll",jwtlogin:"user/jwtlogin"})),{getCategory(e){let t="";return this.category.filter(s=>{s.type==e&&(t=s.data.CategoryName)}),t},initShuwa(){return y(this,null,(function*(){const e=yield Object(c["SiteDefault"])(),{copyright:t,logo:s,objectId:r,title:a}=e;this.setDefault(e),this.setTitle(a),this.setCopyright(t)}))},handlePassword(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleRoute(){return"/404"===this.redirect||"/403"===this.redirect?"/":this.redirect},handleLogin(){this.$refs.form.validate(e=>y(this,null,(function*(){if(!e)return!1;try{this.loading=!0,yield this.login(this.form),yield this.goHome()}finally{this.loading=!1}})))},goHome(){return y(this,null,(function*(){try{this.interval=setInterval(()=>y(this,null,(function*(){""!=Cookies.get("handleRoute")&&(console.log("handleRoute 存在，跳转页面"),yield this.$router.push(this.handleRoute()),yield this.routeDgiot(),clearInterval(this.interval),window.clearInterval(this.interval))})),1500)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}})},_=w,$=(s("f8d5"),s("2877")),k=Object($["a"])(_,r,a,!1,null,"45a34e17",null);t["default"]=k.exports},"7d50":function(e,t,s){"use strict";s("d4df")},"7d8b":function(e,t,s){"use strict";s("08f3")},8054:function(e,t,s){},"832e":function(e,t,s){},"8a1d":function(e,t,s){},"8c57":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"player-container"},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("el-card",{staticClass:"player_card",attrs:{shadow:"hover"}},[s("dgiot-aliplayer",{ref:"dgiotPlayer",attrs:{autoplay:e.mp4Play,height:e.height,playsource:e.flvsrc,type:e.type,width:e.width}})],1)],1)],1)],1)},a=[],i={name:"Player",data(){return{height:this.$baseTableHeight(0)+"px",type:this.$route.query?this.$route.query.type:"mp4",width:"100%",flvsrc:this.$route.query?this.$route.query.url:"https://media.w3.org/2010/05/sintel/trailer.mp4",mp4Play:!1,videoType:[{type:"mp4",url:"https://media.w3.org/2010/05/sintel/trailer.mp4"},{type:"flv",url:"https://rtmp01open.ys7.com:9188/v3/openlive/C45644828_1_2.flv?expire=1656812988&id=333182878081585152&t=9d9c1b3187ff62633be8573281bff2ae7318ae200908c388bb6c092f54f29c52&ev=100"}]}},computed:{},mounted(){this.$route.query.type&&this.$route.query.url&&setTimeout(()=>{this.mp4Play=!0},1500)},methods:{changeType(e){let t=this.videoType.filter(t=>{if(t.type==e)return t});dgiotlog.log(e,t[0].url),this.flvsrc=t[0].url},Play(){this.$refs.dgiotPlayer.createVideo()}}},o=i,l=(s("c426"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,"0cbad52c",null);t["default"]=n.exports},"8f7d":function(e,t,s){},"904a":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"topics"},[e._v(" "+e._s(e.pageTitle)+" ")])},a=[],i={name:"Topics",components:{},data(){return{pageTitle:"topics"}},computed:{},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{}},o=i,l=(s("1605"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,"38f2ee62",null);t["default"]=n.exports},"91b3":function(e,t,s){"use strict";s("f50c")},"920a":function(e,t,s){},"9a55":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"listeners-view"},[s("div",{staticClass:"page-title"},[e._v(" "+e._s(e.$translateTitle("leftbar.listeners"))+" "),s("el-select",{staticClass:"select-radius",attrs:{disabled:e.$store.state.loading,placeholder:e.$translateTitle("select.placeholder")},on:{change:e.loadListeners},model:{value:e.nodeName,callback:function(t){e.nodeName=t},expression:"nodeName"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.node,attrs:{label:e.node,value:e.node}})})),1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.loading,expression:"$store.state.loading"}],attrs:{border:"",data:e.listeners}},[s("el-table-column",{attrs:{label:e.$translateTitle("listeners.protocol"),prop:"protocol",width:"240"}}),s("el-table-column",{attrs:{label:e.$translateTitle("listeners.listenOn"),"min-width":"240",prop:"listen_on"}}),s("el-table-column",{attrs:{label:e.$translateTitle("listeners.maxConnections"),"min-width":"180",prop:"max_conns"}}),s("el-table-column",{attrs:{label:e.$translateTitle("listeners.currentConnections"),"min-width":"120",prop:"current_conns"}})],1)],1)},a=[],i=s("5880"),o=s("5c96"),l=Object.defineProperty,n=Object.defineProperties,c=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,s)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,h=(e,t)=>{for(var s in t||(t={}))u.call(t,s)&&m(e,s,t[s]);if(d)for(var s of d(t))p.call(t,s)&&m(e,s,t[s]);return e},f=(e,t)=>n(e,c(t)),g={name:"ListenersView",components:{"el-select":o["Select"],"el-option":o["Option"],"el-table":o["Table"],"el-table-column":o["TableColumn"]},data(){return{nodeName:"",nodes:[],listeners:[]}},methods:f(h({},Object(i["mapActions"])(["CURRENT_NODE"])),{loadData(){this.$httpGet("/nodes").then(e=>{this.nodeName=this.$store.state.nodeName||e.data[0].node,this.nodes=e.data,this.loadListeners()}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})},loadListeners(){this.CURRENT_NODE(this.nodeName),this.$httpGet(`/nodes/${this.nodeName}/listeners`).then(e=>{this.listeners=e.data}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})}}),created(){this.loadData()}},b=g,v=(s("b464"),s("2877")),y=Object(v["a"])(b,r,a,!1,null,null,null);t["default"]=y.exports},"9c3f":function(e,t,s){"use strict";s("8a1d")},"9dce":function(e,t,s){"use strict";s("1808")},a280:function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},abc5:function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},adb9:function(e,t,s){"use strict";s("19b1")},ae24:function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},b3f0:function(e,t,s){"use strict";s("58ae")},b464:function(e,t,s){"use strict";s("ae24")},b789:function(e,t,s){"use strict";s("58da")},b926:function(e,t,s){"use strict";s("3bd9")},b9f1:function(e,t,s){"use strict";s("8054")},bae2:function(e,t,s){"use strict";s.r(t);var r,a,i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"addengine"},[s("div",{staticClass:"addcontent"},[s("el-card",{staticClass:"box-card"},[s("el-form",{ref:"formInline",attrs:{"label-width":"75px",model:e.formInline,rules:e.formlinerule,size:"mini"}},[s("div",{staticClass:"form-block__title"},[e._v(" "+e._s(e.$translateTitle("rule.condtion"))+" "),s("div",{staticClass:"form-block__title-tips"},[e._v(" "+e._s(e.$translateTitle("rule.Processing"))+" ")])]),s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{span:e.row1}},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{span:6}},[s("el-form-item",{attrs:{label:"触发器","label-width":"70px",prop:"trigger"}},[s("el-select",{attrs:{placeholder:"请选择触发器类型"},on:{change:e.tiggerAction},model:{value:e.formInline.from.trigger,callback:function(t){e.$set(e.formInline.from,"trigger",t)},expression:"formInline.from.trigger"}},e._l(e.formInline.triggerSelect,(function(e){return s("el-option",{key:e.value,attrs:{disabled:e.disabled,label:e.value,value:e.label}})})),1)],1)],1),"device"==e.formInline.from.trigger?s("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.formInline.triggerSelect[0].loading,expression:"formInline.triggerSelect[0].loading"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":"查询产品列表",span:6}},[s("el-form-item",{attrs:{label:"产品信息","label-width":"80px",prop:"from.from.productid"}},[s("el-select",{attrs:{placeholder:"请选择产品"},on:{change:e.tiggerProduct},model:{value:e.formInline.from.from.productid,callback:function(t){e.$set(e.formInline.from.from,"productid",t)},expression:"formInline.from.from.productid"}},e._l(e.formInline.triggerSelect[0].children,(function(e){return s("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1):e._e(),e.formInline.from.from.productid?s("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.formInline.triggerSelect[0].devaddr,expression:"formInline.triggerSelect[0].devaddr"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":"查询设备列表",span:6}},[s("el-form-item",{attrs:{label:"设备信息","label-width":"80px",prop:"from.from.devaddr"}},[s("el-select",{attrs:{placeholder:"请选择设备"},on:{change:e.tiggerDevice},model:{value:e.formInline.from.from.devaddr,callback:function(t){e.$set(e.formInline.from.from,"devaddr",t)},expression:"formInline.from.from.devaddr"}},e._l(e.formInline.device,(function(e){return s("el-option",{key:e.devaddr,attrs:{label:e.name,value:e.devaddr}})})),1)],1)],1):e._e(),e.formInline.from.from.devaddr?s("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.formInline.triggerSelect[0].device,expression:"formInline.triggerSelect[0].device"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":"查询设备列表",span:6}},[s("el-form-item",{attrs:{label:"事件信息","label-width":"80px",prop:"from.method"}},[s("el-select",{attrs:{placeholder:"请选择触发方式"},on:{change:e.setDefaultWhere},model:{value:e.formInline.from.method,callback:function(t){e.$set(e.formInline.from,"method",t)},expression:"formInline.from.method"}},e._l(e.formInline.methodSelect,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),s("el-col",{directives:[{name:"show",rawName:"v-show",value:"cron"==e.formInline.from.trigger,expression:"formInline.from.trigger == 'cron'"}],attrs:{span:6}},[s("el-form-item",{attrs:{label:"触发器",prop:"trigger"}},[s("el-input",{attrs:{placeholder:"请输入Cron表达式"},model:{value:e.formInline.from.cron,callback:function(t){e.$set(e.formInline.from,"cron",t)},expression:"formInline.from.cron"}})],1)],1)],1),e._l(e.formInline.from.where,(function(t,r){return s("el-row",{directives:[{name:"show",rawName:"v-show",value:"device"==e.formInline.from.trigger,expression:"formInline.from.trigger == 'device'"}],key:t.key,attrs:{gutter:24}},[s("el-divider",{attrs:{"content-position":"left"}},[e._v(" "+e._s("执行条件:"+Number(r+1))+" ")]),s("el-col",{attrs:{prop:"trigger",span:"mqttEvent"===e.formInline.from.method?20:6}},[s("el-form-item",{attrs:{label:"属性","label-width":"70px",prop:"trigger"}},["properties"==e.formInline.from.method?s("el-select",{attrs:{placeholder:"物模型属性"},model:{value:e.formInline.from.where[r].identifier,callback:function(t){e.$set(e.formInline.from.where[r],"identifier",t)},expression:"formInline.from.where[index].identifier"}},e._l(e.formInline.data.properties,(function(t){return s("el-option",{key:t.lable+t.disable,attrs:{disabled:e.computedDisable(t),label:t.lable,value:t.value}})})),1):e._e(),"Event"==e.formInline.from.method?s("el-select",{attrs:{placeholder:"物模型事件"},model:{value:e.formInline.from.where[r].identifier,callback:function(t){e.$set(e.formInline.from.where[r],"identifier",t)},expression:"formInline.from.where[index].identifier"}},e._l(e.formInline.data.events,(function(t){return s("el-option",{key:t.lable+t.disable,attrs:{disabled:e.computedDisable(t),label:t.lable,value:t.value}})})),1):e._e(),"mqttEvent"==e.formInline.from.method?s("el-select",{attrs:{placeholder:"mqtt事件"},model:{value:e.formInline.from.where[r].identifier,callback:function(t){e.$set(e.formInline.from.where[r],"identifier",t)},expression:"formInline.from.where[index].identifier"}},e._l(e.formInline.mqttEvent,(function(t){return s("el-option",{key:t.lable,attrs:{disabled:e.computedDisable(t),label:t.label,value:t.value}})})),1):e._e(),"mqttConfig"==e.formInline.from.method?s("el-select",{attrs:{placeholder:"mqtt属性"},model:{value:e.formInline.from.where[r].identifier,callback:function(t){e.$set(e.formInline.from.where[r],"identifier",t)},expression:"formInline.from.where[index].identifier"}},e._l(e.formInline.mqttConfig,(function(t){return s("el-option",{key:t.label,attrs:{disabled:e.computedDisable(t),label:t.label,value:t.value}})})),1):e._e()],1)],1),"mqttEvent"!==e.formInline.from.method?s("el-col",{attrs:{span:6}},[s("el-form-item",{attrs:{label:"条件","label-width":"70px",prop:"trigger"}},[s("el-select",{attrs:{placeholder:"请选择比较条件"},model:{value:e.formInline.from.where[r].operator,callback:function(t){e.$set(e.formInline.from.where[r],"operator",t)},expression:"formInline.from.where[index].operator"}},e._l(e.formInline.erlOperator,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1):e._e(),"mqttEvent"!==e.formInline.from.method?s("el-col",{attrs:{span:6}},[s("el-form-item",{attrs:{label:"值","label-width":"70px",prop:"trigger"}},[s("el-input",{attrs:{placeholder:"请输入比较参数"},model:{value:e.formInline.from.where[r].value,callback:function(t){e.$set(e.formInline.from.where[r],"value",t)},expression:"formInline.from.where[index].value"}})],1)],1):e._e(),s("el-col",{attrs:{span:4}},[s("el-form-item",{attrs:{label:"","label-width":"0px"}},[0===r&&"mqttEvent"!==e.formInline.from.method?s("el-button",{attrs:{disabled:1==e.calculateDisable,type:"info"},on:{click:function(t){return t.preventDefault(),e.addWhere(e.formInline.from.method)}}},[e._v(" 新增 ")]):e._e(),0===r?s("el-button",{attrs:{disabled:1==e.calculateDisable,type:"success"},nativeOn:{click:function(t){return e.generatorSql(e.formInline.from)}}},[e._v(" 生成sql ")]):e._e(),0!==r?s("el-button",{attrs:{type:"warning"},on:{click:function(s){return s.preventDefault(),e.removeDomain(e.formInline.from.method,t)}}},[e._v(" 删除 ")]):e._e()],1)],1)],1)})),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formInline.from.method.length,expression:"formInline.from.method.length"}],attrs:{label:"执行动作","label-width":"80px",prop:"trigger"}},[s("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:"请选择执行动作"},model:{value:e.formInline.from.action,callback:function(t){e.$set(e.formInline.from,"action",t)},expression:"formInline.from.action"}},e._l(e.formInline.actionSelect,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.RuleSQL"),prop:"enginesql"}},[s("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor1"}},[s("el-input",{staticClass:"ace_text-input",attrs:{type:"textarea"},model:{value:e.formInline.enginesql,callback:function(t){e.$set(e.formInline,"enginesql",t)},expression:"formInline.enginesql"}})],1)]),s("el-form-item",{attrs:{label:e.$translateTitle("rule.rule Id")}},[s("el-input",{attrs:{readonly:"编辑"==e.title,type:"text"},model:{value:e.formInline.ruleId,callback:function(t){e.$set(e.formInline,"ruleId",t)},expression:"formInline.ruleId"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.Remarks")}},[s("el-input",{attrs:{type:"text"},model:{value:e.formInline.remarks,callback:function(t){e.$set(e.formInline,"remarks",t)},expression:"formInline.remarks"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.SQLtest")}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"gray"},on:{change:e.getEditor2},model:{value:e.formInline.sqltest,callback:function(t){e.$set(e.formInline,"sqltest",t)},expression:"formInline.sqltest"}}),s("el-popover",{attrs:{content:"自定义模拟数据进行 SQL 命令测试，仅用于测试功能",placement:"top-start",trigger:"hover",width:"200"}},[s("i",{staticClass:"el-icon-question",staticStyle:{color:"#71737d"},attrs:{slot:"reference"},slot:"reference"})])],1)],2),s("el-col",{staticClass:"animated fadeInRightBig",attrs:{span:e.row2}},[1==e.formInline.sqltest?s("el-form-item",{attrs:{label:"clientid","label-width":"80px",prop:"clientid",rules:[{required:!0,message:"clientid 不能为空",trigger:"blur"}]}},[s("el-input",{model:{value:e.formInline.clientid,callback:function(t){e.$set(e.formInline,"clientid",t)},expression:"formInline.clientid"}})],1):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:"username","label-width":"80px",prop:"username",rules:[{required:!0,message:"username 不能为空",trigger:"blur"}]}},[s("el-input",{model:{value:e.formInline.username,callback:function(t){e.$set(e.formInline,"username",t)},expression:"formInline.username"}})],1):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:"topic","label-width":"80px",prop:"topic",rules:[{required:!0,message:"topic 不能为空",trigger:"blur"}]}},[s("el-input",{model:{value:e.formInline.topic,callback:function(t){e.$set(e.formInline,"topic",t)},expression:"formInline.topic"}})],1):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:"qos","label-width":"80px",prop:"qos",rules:[{required:!0,message:"qos 不能为空",trigger:"blur"}]}},[s("el-input",{model:{value:e.formInline.qos,callback:function(t){e.$set(e.formInline,"qos",e._n(t))},expression:"formInline.qos"}})],1):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:"payload","label-width":"80px",prop:"payload",rules:[{required:!0,message:"请填写payload",trigger:"blur"}]}},[s("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"100px"},attrs:{id:"editor2"}})]):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:" ","label-width":"80px"}},[s("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.testRule("formInline")}}},[e._v(" "+e._s(e.$translateTitle("rule.Test"))+" ")]),s("el-input",{staticStyle:{visibility:"hidden"},attrs:{type:"text"},model:{value:e.formInline.payload,callback:function(t){e.$set(e.formInline,"payload",t)},expression:"formInline.payload"}}),s("el-input",{staticClass:"ace_text-input",attrs:{type:"textarea"},model:{value:e.formInline.payload,callback:function(t){e.$set(e.formInline,"payload",t)},expression:"formInline.payload"}})],1):e._e(),1==e.formInline.sqltest?s("el-form-item",{attrs:{label:e.$translateTitle("rule.TestJie")}},[s("dgiot-editor",{key:e.formInline.result,staticStyle:{"min-height":"100px"},attrs:{height:100,lang:"sql","min-lines":100,readonly:!0,theme:"eclipse"},model:{value:e.formInline.result,callback:function(t){e.$set(e.formInline,"result",t)},expression:"formInline.result"}})],1):e._e()],1)],1),s("div",{staticClass:"tablebottom"},[s("div",{staticClass:"form-block__title"},[s("span",{staticStyle:{color:"rgb(255, 109, 109)"}},[e._v("*")]),e._v(" "+e._s(e.$translateTitle("rule.ResponseAction"))+" "),s("div",{staticClass:"form-block__title-tips"},[e._v(" "+e._s(e.$translateTitle("rule.Processing"))+" ")])]),s("div",{staticClass:"bottomtable",staticStyle:{"padding-left":"20px"}},[s("div",{staticClass:"tableaction"},[s("el-table",{staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.actionData,"header-cell-style":{"text-align":"center"}}},[s("el-table-column",{attrs:{label:e.$translateTitle("rule.channel")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.params.$resource?s("span",[e._v(" "+e._s("关联资源:"+r.params.$resource)+" ")]):s("span")]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("rule.target_topic")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(s.params.target_topic)+" ")]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("rule.target_qos")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(s.params.target_qos)+" ")]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("rule.payload_tmpl")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(s.params.payload_tmpl)+" ")]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,a=t.$index;return[s("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editAisle(r)}}},[e._v(" "+e._s(e.$translateTitle("button.edit"))+" ")]),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteOneData(a)}}},[e._v(" "+e._s(e.$translateTitle("button.delete"))+" ")])]}}])})],1),s("div",[s("el-button",{staticStyle:{"margin-top":"20px"},attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"small",type:"success"},on:{click:e.addresouce}},[e._v(" "+e._s(e.$translateTitle("rule.Addto"))+" ")])],1)],1)]),s("div",[s("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.$translateTitle("rule.ResponseAction"),top:"10%",visible:e.dialogFormVisible,width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:function(t){return e.resetForm("params")}}},[s("el-form",{ref:"params",attrs:{"label-position":"left","label-width":"140px",model:e.params,rules:e.paramsrules}},[s("el-form-item",{attrs:{prop:"channel"}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"span-box"},[s("i",{staticClass:"icon-dd-schetit"}),s("span",[e._v(e._s(e.$translateTitle("rule.channel")))]),s("el-tooltip",{staticClass:"item",attrs:{content:"重新发布消息到物联网通道",effect:"dark",placement:"top-start"}},[s("i",{staticClass:"el-icon-question"})])],1)]),s("el-select",{staticStyle:{width:"100%"},model:{value:e.params.channel,callback:function(t){e.$set(e.params,"channel",t)},expression:"params.channel"}},e._l(e.channellist,(function(t){return s("el-option",{key:t.name,attrs:{disabled:"dgiot"!=t.name,label:t.title.zh,value:t.title.zh}},[s("span",{staticStyle:{float:"left"}},[t.title?s("i",[e._v(" "+e._s(t.title.zh)+" ")]):e._e()]),s("span",{staticStyle:{float:"right",color:"#8492a6"}},[e._v(" "+e._s(t.description.zh)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.resource"),prop:"resources"}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"span-box"},[s("i",{staticClass:"icon-dd-schetit"}),s("span",[e._v(e._s(e.$translateTitle("rule.resource")))]),s("el-tooltip",{staticClass:"item",attrs:{content:e.$translateTitle("rule.resource"),effect:"dark",placement:"top-start"}},[s("i",{staticClass:"el-icon-question"})])],1)]),s("el-select",{staticStyle:{width:"100%"},model:{value:e.params.resources,callback:function(t){e.$set(e.params,"resources",t)},expression:"params.resources"}},e._l(e.resources,(function(t){return s("el-option",{key:t.id,attrs:{label:t.description,value:t.id}},[s("span",{staticStyle:{float:"left"}},[t.description?s("i",[e._v(" "+e._s(t.description)+" ")]):e._e()]),s("span",{staticStyle:{float:"right",color:"#8492a6"}},[e._v(" "+e._s(t.id)+" ")])])})),1)],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.target_qos")}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"span-box"},[s("i",{staticClass:"icon-dd-schetit"}),s("span",[e._v(e._s(e.$translateTitle("rule.target_qos")))]),s("el-tooltip",{staticClass:"item",attrs:{content:"重新发布消息时用的 QoS 级别, 设置为 -1 以使用原消息中的 QoS",effect:"dark",placement:"top-start"}},[s("i",{staticClass:"el-icon-question"})])],1)]),s("el-select",{staticStyle:{width:"100%"},model:{value:e.params.target_qos,callback:function(t){e.$set(e.params,"target_qos",t)},expression:"params.target_qos"}},e._l(e.params.target_qosSelect,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.target_topic")}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"span-box"},[s("i",{staticClass:"icon-dd-schetit"}),s("span",[e._v(e._s(e.$translateTitle("rule.target_topic")))]),s("el-tooltip",{staticClass:"item",attrs:{content:"重新发布消息到哪个主题",effect:"dark",placement:"top-start"}},[s("i",{staticClass:"el-icon-question"})])],1)]),s("el-input",{model:{value:e.params.target_topic,callback:function(t){e.$set(e.params,"target_topic",t)},expression:"params.target_topic"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("rule.payload_tmpl")}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"span-box"},[s("i",{staticClass:"icon-dd-schetit"}),s("span",[e._v(e._s(e.$translateTitle("rule.payload_tmpl")))]),s("el-tooltip",{staticClass:"item",attrs:{content:"消息内容模板，支持变量",effect:"dark",placement:"top-start"}},[s("i",{staticClass:"el-icon-question"})])],1)]),s("el-input",{attrs:{rows:2,type:"textarea"},model:{value:e.params.payload_tmpl,callback:function(t){e.$set(e.params,"payload_tmpl",t)},expression:"params.payload_tmpl"}})],1),s("el-form-item",[e.aisleRow.name?s("el-button",{on:{click:function(t){return e.editFom("formInline")}}},[e._v(" "+e._s(e.$translateTitle("button.modify"))+" ")]):s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("params")}}},[e._v(" "+e._s(e.$translateTitle("button.create"))+" ")]),s("el-button",{on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("button.cancel"))+" ")])],1)],1)],1)],1)]),s("el-form-item",{attrs:{"label-width":"90"}},[e.ruleId.length?s("el-button",{attrs:{type:"success"},on:{click:function(t){return e.editrules(e.ruleId,"formInline")}}},[e._v(" "+e._s(e.$translateTitle("button.modify"))+" ")]):s("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.addrules("formInline")}}},[e._v(" "+e._s(e.$translateTitle("button.create"))+" ")]),s("el-button",[e._v(e._s(e.$translateTitle("button.cancel")))])],1)],1)],1)],1)])},o=[],l=s("1b07"),n=s("f61a"),c=s("7212"),d=s("1285"),u=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),p={data(){return{calculateDisable:!0,ruleId:this.$route.query.id||"",uid:this.$route.query.uid||"",ruleType:this.$route.query.type||"",resources:[],aisleRow:{},params:{name:"",payload_tmpl:"${payload}",target_qos:0,target_qosSelect:[-1,0,1,2],target_topic:"thing/${productid}/${clientid}/post",$resource:"",resources:"",channel:""},dialogVisible:!1,resourceform:{objectId:"",region:"data_resource",desc:""},resourcerule:{objectId:[{required:!0,message:"请填写通道编号",trigger:"blur"}],desc:[{required:!0,message:"请填写通道描述",trigger:"blur"}]},row1:24,row2:0,dialogFormVisible:!1,title:"",formInline:{data:{},mqttEvent:[{label:"消息投递",value:"message_delivered"},{label:"消息确认",value:"message_acked"},{label:"消息丢弃",value:"message_dropped"},{label:"连接完成",value:"client_connected"},{label:"连接断开",value:"client_disconnected"},{label:"订阅",value:"session_subscribed"},{label:"取消订阅",value:"session_unsubscribed"}],mqttConfig:[{label:"消息目的 Client ID",value:"clientid"},{label:"终端连接完成时间 (s)",value:"connected_at"},{label:"MQTT 消息 ID",value:"id"},{label:"用户名",value:"username"},{label:"客户端地址",value:"peerhost"},{label:"MQTT topic",value:"topic"},{label:"MQTT qos",value:"qos"},{label:"MQTT flags",value:"flags"},{label:"事件触发时间 (ms)",value:"timestamp"},{label:"PUBLISH 消息到达 Broker 的时间 (ms)",value:"publish_received_at"},{label:"事件触发节点",value:"node"}],Event:[],triggerSelect:[{label:"device",value:"设备触发",children:[],loading:!1,device:!1}],device:[{name:"全部设备",devaddr:"#"}],sqlOperator:[">",">=","<","<=","==","!=","in"],erlOperator:[">",">=","<","<=","==","=:=","/=","=/="],value:"",actionSelect:[{label:"设备输出",value:"device output"},{label:"规则输出",value:"rule output"},{label:"函数输出",value:"function output"},{label:"告警输出",value:"Alarm output"}],methodSelect:[{value:"properties",label:"物模型属性触发"},{value:"Event",label:"物模型事件触发"},{value:"mqttConfig",label:"mqtt属性触发",disable:!0},{value:"mqttEvent",label:"mqtt事件触发",disable:!0}],property:[],user:"",region:"",enginesql:"SELECT\n    payload.msg as msg,\n    clientid,\n    'productid' as productid\nFROM\n    \"t/#\"\nWHERE\n    msg = 'hello'",remarks:"",sqltest:!1,clientid:"c_swqx",username:"u_swqx",qos:1,topic:"t/a",payload:"",result:"",productid:"",devaddr:"",select:{mqttConfig:[],thingConfig:[]},trigger:"device",cron:"",method:"properties",from:{productid:"",devaddr:"",select:{mqttConfig:[],thingConfig:[]},trigger:"device",cron:"",method:"properties",from:{productid:"",devaddr:""},where:[{identifier:"",operator:"",value:"",config:"clientid",event:"message_delivered"}],action:[]},where:[{identifier:"",operator:"",value:"",config:"clientid",event:"message_delivered"}],action:[]},formlinerule:{region:[{required:!0,message:"请选择触发事件",trigger:"change"}],"from.from.productid":[{required:!0,message:"请选择产品",trigger:"change"}],"from.method":[{required:!0,message:"请选择触发方式",trigger:"change"}],"from.from.devaddr":[{required:!0,message:"请选择设备",trigger:"change"}],enginesql:[{required:!0,message:"请填写规则SQL",trigger:"blur"}],trigger:[{required:!0,message:"请选择触发规则",trigger:"change"}],method:[{required:!0,message:"请选择触发方式",trigger:"change"}],"where.identifier":[{required:!0,message:"请选择物模型",trigger:"change"}],"where.operator":[{required:!0,message:"请选择物模型执行条件",trigger:"change"}],"where.value":[{required:!0,message:"请输入比较参数",trigger:"blue"}]},actionData:[],form:{action:"dgiot_resource",resource:""},paramsrules:{channel:[{required:!0,message:"请选择通道",trigger:"change"}],resources:[{required:!0,message:"请选择关联资源",trigger:"change"}]},formrule:{action:[{required:!0,message:"请选择动作",trigger:"change"}]},productid:"",resourcelist:[],channellist:[],ctype:"",originlist:n["default"],client:[],sqlexample:"SELECT payload.msg as msg\n                 FROM \"t/#\"\n                 WHERE msg = 'hello'",actionslist:[],allChannelstart:0}},watch:{"formInline.from.where":{handler(e,t){""==this.formInline.from.from.devaddr&&(this.calculateDisable=!0),e.forEach(e=>{""==e.identifier?this.calculateDisable=!0:this.calculateDisable=!1,this.formInline.data[this.formInline.from.method]&&this.formInline.data[this.formInline.from.method].forEach(t=>{t.disabled=!1,e.identifier==t.value&&(t.disabled=!0)})})},deep:!0}},mounted(){this.$route.query.type&&this.$route.query.uid&&this.queryRule(`rule:${this.$route.query.type}_${this.$route.query.uid}`),this.$nextTick(()=>{this.tiggerAction("device"),r=ace.edit("editor1"),this.ruleId&&this.queryRule(this.ruleId),this.title=this.$route.query.title,this.productid=this.$route.query.productid,r.session.setMode("ace/mode/sql"),r.setTheme("ace/theme/eclipse"),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r.setValue(this.formInline.enginesql)})},methods:{computedDisable(e){let t=!1;return this.formInline.from.where.forEach(s=>{s.identifier==e.value&&(t=!0)}),t},setDefaultWhere(){this.formInline.from.where=[{identifier:"",operator:"",value:"",config:"",event:""}],console.log("toggle",this.formInline.from.method)},addWhere(e){return u(this,null,(function*(){console.log(e),this.formInline.data[this.formInline.from.method].length<=this.formInline.from.where.length?this.$message({showClose:!0,duration:2e3,message:`最多只能添加${this.formInline.data[this.formInline.from.method].length}个比较参数`,type:"warning"}):yield this.formInline.from.where.push({identifier:"",operator:"",value:""})}))},removeDomain(e,t){var s=this.formInline.from.where.indexOf(t);-1!==s&&this.formInline.from.where.splice(s,1)},generatorSql(e){console.error(e);const t="#"==e.devaddr?`SELECT\n      payload.msg as msg,\n      clientid,\n      'productid' as productid\nFROM\n      "thing/${e.productid}/#"\nWHERE\n      msg = 'hello'`:`SELECT\n      payload.msg as msg,\n      clientid,\n      'productid' as productid\nFROM\n      "thing/${e.productid}/${e.devaddr}"\nWHERE\n      msg = 'hello'`;switch(e.method){case"device":e.select.payload=e.where.map(e=>e.identifier);break;case"properties":e.select.payload=e.where.map(e=>e.identifier);break;case"mqttConfig":e.select.mqttConfig=e.where.map(e=>e.identifier);break;case"mqttEvent":e.select.thingConfig=e.where.map(e=>e.identifier);break}this.$refs.formInline.validate(s=>u(this,null,(function*(){if(!s)return console.log("error submit!!"),!1;try{const s=this.$baseLoading(1);dgiotlogger.log("处理后的form表单",e),dgiotlogger.log("处理后的form表单select参数",e.select);const{template:a=t}=yield Object(l["sqlTpl"])(e);this.formInline.enginesql=a,yield r.setValue(a),dgiotlogger.log(a),s.close()}catch(a){console.log(a),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+a,"error","dgiot-hey-message-error")}})))},tiggerAction(e){return u(this,null,(function*(){yield console.log(e),"device"===e&&(yield this.getProduct())}))},getProduct(){return u(this,null,(function*(){this.formInline.triggerSelect[0].loading=!0;try{const e={order:"-updatedAt",count:"objectId"},{results:t=[]}=yield Object(c["queryProduct"])(e);this.formInline.triggerSelect[0].loading=!1,this.formInline.triggerSelect[0].children=t}catch(e){this.formInline.triggerSelect[0].loading=!1}}))},tiggerProduct(e){return u(this,null,(function*(){this.formInline.property=[],this.formInline.from.identifier="",this.formInline.from.devaddr="",this.formInline.from.where=[{identifier:"",operator:"",value:""}];var t=[];for(var s in this.formInline.triggerSelect[0].children.forEach(s=>{s.objectId==e&&(t=s.thing||[])}),dgiotlogger.log("Thing",t),t){this.formInline.data[s]=[],console.error(t[s]);for(let e in t[s])this.formInline.data[s].push({lable:t[s][e].name,value:t[s][e].identifier,data:t[s][e],disabled:!1})}dgiotlogger.log(this.formInline.property,"line 928 property"),dgiotlogger.log(this.formInline.data,"line 1160 linkedge"),this.formInline.triggerSelect[0].device=!0,yield console.log(e);const r={order:"-updatedAt",count:"objectId",where:{product:e}},{results:a=[]}=yield Object(d["queryDevice"])(r);dgiotlogger.info("results",a),this.formInline.device=a,this.formInline.device.unshift({name:"全部设备",devaddr:"#"}),this.formInline.triggerSelect[0].device=!1}))},selectRegion(e){this.originlist.map(t=>{t.event==e&&(this.client=t.columns,this.sqlexample=t.sql_example)})},tiggerDevice(e){return u(this,null,(function*(){dgiotlogger.log(e)}))},getEditor2(e){1==e?(this.row1=16,this.row2=8,this.$nextTick(()=>{a=ace.edit("editor2"),a=ace.edit("editor2"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.setValue('{"msg":"hello"}'),window.editor2=a})):(this.row1=24,this.row2=0)},queryRule(e){return u(this,null,(function*(){try{const{data:t={id:e,actions:[],description:"",rawsql:"SELECT\n      payload.msg as msg,\n      clientid,\n      'productid' as productid\nFROM\n      \"t/#\"\nWHERE\n      msg = 'hello'"}}=yield Object(l["get_rule_id"])(e);dgiotlogger.log(t),this.actionData=t.actions,this.formInline.enginesql=t.rawsql,r.setValue(this.formInline.enginesql),this.formInline.ruleId=t.id,this.formInline.remarks=t.description,r.setValue(t.rawsql)}catch(t){dgiotlogger.error(t),this.formInline.ruleId=e}}))},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.relationChannel(this.params)})},editFom(e){console.log(this.params),this.aisleRow.name=this.params.name,this.aisleRow.params.payload_tmpl=this.params.payload_tmpl,this.aisleRow.params.target_qos=this.params.target_qos,this.aisleRow.params.target_topic=this.params.target_topic,this.aisleRow.params.$resource=this.params.$resource,this.aisleRow.params.resources=this.params.resources,this.aisleRow.params.channel=this.params.channel,this.dialogFormVisible=!this.dialogFormVisible,this.aisleRow={}},resetForm(e){this.$refs[e].resetFields(),this.aisleRow={}},relationChannel(e){console.log(e),this.actionData.push({name:"dgiot",params:{$resource:e.resources,target_topic:e.target_topic,target_qos:e.target_qos,payload_tmpl:e.payload_tmpl,channel:this.params.channel},fallbacks:[]}),console.log(this.actionData,"this.actionData"),this.dialogFormVisible=!this.dialogFormVisible},_get_actions(){return u(this,null,(function*(){const{data:e}=yield Object(l["get_actions"])();this.channellist=e}))},_get_resources(){return u(this,null,(function*(){const{data:e}=yield Object(l["get_resources"])();this.resources=e}))},testRule(e){this.formInline.result="{}",this.formInline.payload=a.getValue(),this.formInline.enginesql=r.getValue(),this.$refs[e].validate(e=>{if(e){var t=/from[^"]+?"([^"]+)"/im,s={clientid:this.formInline.clientid,payload:a.getValue(),qos:this.formInline.qos,topic:this.formInline.topic,username:this.formInline.username};console.log(r.getValue(),"rawsql"),window.editor1=r,window.editor1Value=r.getValue(),console.log(r,r.getValue().match(t)[1],"for");const e={actions:this.actionData,ctx:s,description:this.formInline.remarks,for:r.getValue().match(t)[1],name:this.formInline.username,rawsql:r.getValue(),test:"true"};Object(l["addRule"])(e).then(e=>{console.log("response",e);const{code:t,message:s="",data:r={}}=e;0==t?(this.formInline.result=JSON.stringify(r,null,2),console.log("     this.formInline.result ",this.formInline.result),this.$message({showClose:!0,duration:2e3,message:"sql测试成功",type:"success"})):(this.formInline.result=JSON.stringify(e,null,2),this.$message({message:"sql测试失败"+s,type:"error"}))}).catch(e=>{this.$message({message:"sql测试失败，原因"+e,type:"error"}),console.log(e)})}})},editrules(e,t){return u(this,null,(function*(){var s={clientid:this.formInline.clientid,payload:a.getValue(),qos:this.formInline.qos,topic:this.formInline.topic,username:this.formInline.username};const i={actions:this.actionData,ctx:s,description:this.formInline.remarks,for:'["t/#"]',rawsql:r.getValue()},o=yield Object(l["put_rule_id"])(e,i);console.log(e,t,o),this.$message("修改成功"),this.$router.push({path:"/rules_engine/engine"})}))},addrules(e){this.formInline.payload=a.getValue(),this.formInline.enginesql=r.getValue(),this.$refs[e].validate(e=>{if(e){if(0==this.actionData.length)return void this.$message("动作不能为空");var t={clientid:this.formInline.clientid,payload:a.getValue(),qos:this.formInline.qos,topic:this.formInline.topic,username:this.formInline.username};const e={actions:this.actionData,ctx:t,description:this.formInline.remarks,for:'["t/#"]',rawsql:r.getValue()};this.$route.query.type&&this.$route.query.uid&&(e.id=`rule:${this.$route.query.type}_${this.$route.query.uid}`),Object(l["addRule"])(e).then(e=>{console.log(e),e&&(this.$message("创建成功"),this.$router.push({path:"/rules_engine/engine"}))}).catch(e=>{console.log(e),this.$baseMessage(""+e.error,"error","dgiot-hey-message-error")})}else this.$message("有必填项未填写")})},addresouce(){console.log(this.aisleRow),this._get_actions(),this._get_resources(),this.aisleRow.name&&(this.params={name:this.aisleRow.name,payload_tmpl:this.aisleRow.params.payload_tmpl,target_qos:this.aisleRow.params.target_qos,target_qosSelect:[-1,0,1,2],target_topic:this.aisleRow.params.target_topic,$resource:this.aisleRow.params.$resource,resources:this.aisleRow.params.$resource,channel:this.aisleRow.params.channel}),this.dialogFormVisible=!0},addRes(e){this.$refs[e].validate(t=>{if(!t)return this.$baseMessage("error submit!!","error","dgiot-hey-message-error"),!1;Object(l["postResource"])({channel:this.resourceform.objectId},this.resourceform.desc,"","data_resource").then(t=>{t&&(this.$message("创建成功"),this.$refs[e].resetFields(),this.dialogVisible=!1)})})},deleteOneData(e){this.actionData.splice(e,1)},editAisle(e){this.aisleRow=e,this.addresouce()}}},m=p,h=(s("deff"),s("2877")),f=Object(h["a"])(m,i,o,!1,null,"61408db3",null);t["default"]=f.exports},bbb7:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"login-container",style:{backgroundImage:"url("+e.backgroundImage+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"form",staticClass:"login-form",attrs:{"label-position":"left",model:e.form,rules:e.rules}},[e.Default.title?s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")]):e._e(),s("el-form-item",{staticStyle:{"margin-top":"40px"},attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:e.$translateTitle("home.Please enter user name"),tabindex:"1",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}]),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{key:e.passwordType,ref:"password",attrs:{placeholder:e.$translateTitle("home.Please enter the password"),tabindex:"2",type:e.passwordType},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e.form.password.length?s("dgiot-icon",{attrs:{icon:"lock-line"}}):e._e()]},proxy:!0},"password"===e.passwordType&&e.form.password.length?{key:"suffix",fn:function(){return[s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-off-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}})]},proxy:!0}:{key:"suffix",fn:function(){return[e.form.password.length?s("dgiot-icon",{staticClass:"show-password",attrs:{icon:"eye-line"},nativeOn:{click:function(t){return e.handlePassword.apply(null,arguments)}}}):e._e()]},proxy:!0}],null,!0),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-input",{staticClass:"sbMc"},[s("el-button",{staticClass:"login-btn",attrs:{slot:"append",loading:e.loading,type:"primary"},nativeOn:{click:function(t){return e.handleLogin.apply(null,arguments)}},slot:"append"},[e._v(" "+e._s(e.$translateTitle("home.login"))+" ")])],1)],1),s("span",[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{float:"left"},attrs:{to:"/register"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("home.registered"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px",cursor:"pointer"}})],1)],1)],1)],1)],1)},a=[],i=s("3e35f"),o=s.n(i),l=s("5880"),n=s("28d7"),c=s("1c4e"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"Dev",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},beforeRouteLeave(e,t,s){clearInterval(this.timer),clearInterval(this.interval),s()},data(){const e=(e,t,s)=>{""===t?s(new Error(this.info.empty)):s()},t=(e,t,s)=>{let r=4;Object(n["isPassword"])(t,r)?s():s(new Error(this.info.than+r+this.info.Bit))};return{interval:null,locationPath:location.href.split("/#")[0],info:{empty:this.$translateTitle("home.Username can not be empty"),than:this.$translateTitle("home.Password cannot be less than"),Bit:this.$translateTitle("home.Bit")},backgroundImage:o.a,nodeEnv:"production",form:{username:"dgiot_dev",password:"dgiot_dev"},rules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},loading:!1,passwordType:"password",redirect:void 0,timer:0}},computed:b({},Object(l["mapGetters"])({language:"settings/language",Default:"acl/Default",license:"acl/license",logo:"user/logo",objectId:"user/objectId",backgroundimage:"user/backgroundimage"})),watch:{language:{handler(e){this.changeInfo(e),this.$nextTick(()=>{this.$refs.form.resetFields()})},deep:!0,immediate:!0},"Default.background":{handler(e){this.backgroundImage=e},immediate:!0},$route:{handler(e){this.redirect=e.query&&e.query.redirect||"/"},immediate:!0}},beforeDestroy(){window.removeEventListener("message",this.iframeLogin)},mounted(){return y(this,null,(function*(){yield this.dgiotReset(),yield this.initShuwa(),this.$nextTick(()=>y(this,null,(function*(){yield this.defaultSet(),yield this.init()})))}))},created(){window.addEventListener("message",this.iframeLogin)},methods:v(b(v(b({},Object(l["mapMutations"])({setTitle:"settings/setTitle",setCopyright:"acl/setCopyright",setDefault:"acl/setDefault"})),{iframeLogin(e){return y(this,null,(function*(){try{const t={value:moment().format("YYYY:MM:DD  HH:mm:ss"),key:"startIframe",action:"save",type:"cookie",time:moment().format("YYYY:MM:DD  HH:mm:ss")};e.source.postMessage(t,e.origin);moment().format("YYYY:MM:DD  HH:mm:ss"),moment().format("YYYY:MM:DD  HH:mm:ss")}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},routeDgiot(){return y(this,null,(function*(){try{yield setTimeout(()=>{this.objectId&&(console.log("userid",this.objectId),document.querySelector(".el-tree-node__content").click())},1200)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},init(){return y(this,null,(function*(){try{Cookies.remove("startIframe"),Cookies.remove("pwaLogin"),this.$nextTick(()=>y(this,null,(function*(){"dgiot_iframe"==window.name&&(Cookies.set("startIframe",moment().format("YYYY:MM:DD HH:mm:ss"),{expires:18e5}),yield this.goHome())})))}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))},defaultSet(){return y(this,null,(function*(){console.log("dgiot build time: "+dgiot.dateTime),console.log("startIframe time: "+Cookies.get("startIframe")),this.backgroundImage=Cookies.get("startIframe")?"https://s2.loli.net/2021/12/15/ciVTb7w62rxQ3a9.jpg":this.backgroundimage;const e=location.origin;Cookies.set("fileServer",e,{expires:18e5})}))},changeInfo(e){this.$set(this.info,"empty",this.$translateTitle("home.Username can not be empty")),this.$set(this.info,"than",this.$translateTitle("home.Password cannot be less than")),this.$set(this.info,"Bit",this.$translateTitle("home.Bit")),this.$forceUpdate()},forgotPwd(){this.$message(this.$translateTitle("home.Forgot password"))}}),Object(l["mapActions"])({dgiotReset:"user/dgiotReset",login:"user/login",queryAll:"user/queryAll",jwtlogin:"user/jwtlogin"})),{getCategory(e){let t="";return this.category.filter(s=>{s.type==e&&(t=s.data.CategoryName)}),t},initShuwa(){return y(this,null,(function*(){const e=yield Object(c["SiteDefault"])(),{copyright:t,logo:s,objectId:r,title:a}=e;this.setDefault(e),this.setTitle(a),this.setCopyright(t)}))},handlePassword(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleRoute(){return"/404"===this.redirect||"/403"===this.redirect?"/":this.redirect},handleLogin(){this.$refs.form.validate(e=>y(this,null,(function*(){if(!e)return!1;try{this.loading=!0,yield this.login(this.form),yield this.goHome()}finally{this.loading=!1}})))},goHome(){return y(this,null,(function*(){try{this.interval=setInterval(()=>y(this,null,(function*(){""!=Cookies.get("handleRoute")&&(console.log("handleRoute 存在，跳转页面"),yield this.$router.push(this.handleRoute()),yield this.routeDgiot(),clearInterval(this.interval),window.clearInterval(this.interval))})),1500)}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}}))}})},_=w,$=(s("d565"),s("2877")),k=Object($["a"])(_,r,a,!1,null,"bc7df836",null);t["default"]=k.exports},bcdf7:function(e,t,s){},c010:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"menu dgiot-container"},[r("el-row",[r("el-col",{attrs:{lg:24,md:24,sm:2244,xl:24,xs:24}},[r("dgiot-query-form",[r("dgiot-query-form-top-panel",{attrs:{span:12}},[r("div",{staticClass:"search"},[r("el-button",{attrs:{icon:"el-icon-s-tools",size:"mini",type:"primary"},on:{click:function(t){return e.toggleExpandAll(e.isdefaultExpandAll)}}},[e._v(" "+e._s(e.$translateTitle("product.Expandcollapsemenu"))+" ")]),r("el-button",{attrs:{icon:"el-icon-plus",size:"mini",type:"info"},on:{click:function(t){return e.handleEdit({},"one")}}},[e._v(" "+e._s(e.$translateTitle("product.Newfirstlevelmenu"))+" ")]),r("el-button",{attrs:{icon:"el-icon-upload",size:"mini",type:"success"},on:{click:function(t){return e.centerUploadBox("Importmenu")}}},[e._v(" "+e._s(e.$translateTitle("product.Importmenu"))+" ")]),r("el-button",{attrs:{icon:"el-icon-upload",size:"mini",type:"warning"},on:{click:function(t){return e.centerUploadBox("Export")}}},[e._v(" "+e._s(e.$translateTitle("product.Export menu"))+" ")]),r("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"inputer",attrs:{id:"fileExport",type:"file",value:"上传菜单"},on:{change:e.handleFileChange}})],1)])],1),e.refreshTable?r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{border:"",data:e.treeData,"default-expand-all":e.isdefaultExpandAll,"default-sort":{prop:"order",order:"ascending"},height:e.tableHeight,"row-key":"objectId",size:"mini","tree-props":{children:"children",hasChildren:"hasChildren"}},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:s("c2ad")}})]},proxy:!0}],null,!1,3347433009)},[r("el-table-column",{attrs:{align:"center",fixed:"",label:e.$translateTitle("product.title"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("span",[e._v(" "+e._s(s.meta.title)+" ")])]}}],null,!1,1074967671)}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.name"),prop:"name"}}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.path"),prop:"url","show-overflow-tooltip":"",width:"220"}}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("menu.sort"),prop:"orderBy",sortable:""}}),r("el-table-column",{attrs:{align:"center",label:"vue "+e.$translateTitle("developer.filepath"),"show-overflow-tooltip":"",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("span",[e._v(" "+e._s(s.meta.component.replace("src","@").replace(".vue",""))+" ")])]}}],null,!1,2419331890)}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.redirect"),"show-overflow-tooltip":"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("span",[e._v(" "+e._s(s.meta.redirect)+" ")])]}}],null,!1,2214697965)}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("task.Advancedconfiguration"),"show-overflow-tooltip":"",width:200},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("el-popover",{attrs:{placement:"top",trigger:"hover"}},[r("p",[e._v(" "+e._s(e.$translateTitle("product.Hideornot")+":")+" "),r("el-tag",{attrs:{title:e.$translateTitle("product.Hideornot"),type:"success"}},[e._v(" "+e._s(s.meta.hidden?e.$translateTitle("product.yes"):e.$translateTitle("product.no"))+" ")])],1),r("p",[e._v(" "+e._s(e.$translateTitle("product.Whetherthecurrentroutecanclosemultipletabs")+":")+" "),s.meta?r("el-tag",{attrs:{title:e.$translateTitle("product.Whetherthecurrentroutecanclosemultipletabs"),type:"info"}},[e._v(" "+e._s(s.meta.noClosable?e.$translateTitle("product.yes"):e.$translateTitle("product.no"))+" ")]):e._e()],1),r("p",[e._v(" "+e._s(e.$translateTitle("product.Nocache")+":")+" "),s.meta?r("el-tag",{attrs:{title:e.$translateTitle("product.Nocache")}},[e._v(" "+e._s(s.meta.noKeepAlive?e.$translateTitle("product.yes"):e.$translateTitle("product.no"))+" ")]):e._e()],1),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"medium"}},[s.meta.icon?r("dgiot-icon",{attrs:{icon:s.meta.icon}}):e._e()],1)],1)])]}}],null,!1,1738300618)}),r("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"220px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("el-button",{attrs:{icon:"el-icon-plus",size:"mini",title:e.$translateTitle("menu.childrenmenu"),type:"primary"},on:{click:function(t){return e.handleEdit(s,"addChildMenu")}}}),r("el-button",{attrs:{icon:"el-icon-edit",size:"mini",title:e.$translateTitle("developer.edit"),type:"success"},on:{click:function(t){return e.handleEdit(s,"editMenu")}}}),r("el-button",{attrs:{icon:"el-icon-delete",size:"mini",title:e.$translateTitle("developer.delete")+s.meta.title,type:"danger"},on:{click:function(t){return e.handleDelete(s)}}})]}}],null,!1,1290176477)})],1):e._e()],1)],1),r("edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},a=[],i=s("2b3d"),o=s("ed08"),l=s("bc35"),n=s("0af3"),c=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),d={name:"TreeTableDemo",components:{Edit:i["default"]},data(){return{tableHeight:this.$baseTableHeight(0)+46,refreshTable:"false",isdefaultExpandAll:!1,MenuForm:{name:"",url:"",roles:[],number:"",fathername:[]},list:[],listLoading:!0,data:[],defaultProps:{children:"children",label:"label"},props:{value:"objectId",label:"name",children:"children"},options:[],formLabelWidth:"120px",defaultExpandAll:!0,showCheckbox:!0,key:1,columns:[{label:"Menu name",key:"name",expand:!0,align:"left"},{label:"Menu path",key:"url",width:200,expand:!0,align:"center"},{label:"Navigation",key:"showtopmenu",expand:!0,align:"center"},{label:"Index",key:"number",expand:!0,width:100},{label:"Icon",key:"icon",expand:!0,width:100},{label:"Created Time",key:"createtime",align:"center"},{label:"Operation",key:"operation",width:400}],search:"",dialogVisible:!1,tableData:[],form:{name:"",resource:"菜单",topname:"",menuroad:"",iconfont:"",number:""},parent:"",current:"",parentmenu:[{id:"0",attributes:{name:"顶级菜单"}}],originacl:[],menuid:"",originmenuurl:[],isaddmenu:!0,file:"",inputDOM:"",size:"",formData:""}},computed:{treeData(){const e=JSON.parse(JSON.stringify(this.data));var t=[];return t=e.filter(t=>{const s=e.filter(e=>t.objectId==e.parent);return s.length>0&&(t.children=s),0==t.parent&&(t.parent="0"),0==t.parent}),t}},watch:{showCheckbox(e){e?this.columns.unshift({label:"Checkbox",checkbox:!0}):this.columns.shift(),this.reset()}},mounted(){this.fetchData(),this.originmenuurl=[],this.getoriginmenu(this.$router.options.routes),this.getRole()},methods:{toggleExpandAll(e){this.refreshTable=!1,this.isdefaultExpandAll=!e,this.$nextTick(()=>{this.refreshTable=!0})},handleNodeClick(){this.fetchData()},SelectTopmenu(e){dgiotlog.log(e)},getoriginmenu(e){e.map(e=>{if(!e.hidden&&e.path){if("/"!=e.path){var t={};t.path=e.path,t.name=e.name,this.originmenuurl.push(t)}e.children&&this.getoriginmenu(e.children)}})},centerUploadBox(e){"Importmenu"==e?this.$refs.inputer.click():this.exportMenu()},exportMenu(){return c(this,null,(function*(){const e=this.$baseColorfullLoading(2);try{const t=yield Object(n["ExportParse"])("Menu",{});dgiotlog.log(t,"res"),e.close(),this.$convertRes2Blob(t)}catch(t){e.close(),this.$baseMessage(t,"error","dgiot-hey-message-error")}e.close()}))},handleFileChange(e){return c(this,null,(function*(){if(this.inputDOM=this.$refs.inputer,!/\.zip$/.test(this.inputDOM.files[0].name))return this.$message({showClose:!0,duration:2e3,type:"warning",message:"仅支持zip文件"}),!1;{this.file=this.inputDOM.files[0];const t=this.$baseColorfullLoading(3);try{const e=yield Object(n["ImportParse"])("Menu",this.file);t.close(),dgiotlog.log("eresresrror",e),this.$message({type:"success",message:"菜单导入成功",showClose:!0}),setTimeout(()=>{this.file="",this.inputDOM="",this.size="",this.formData="",this.fetchData()},1500)}catch(e){t.close(),this.$message({type:"error",message:"菜单导入失败"+e}),dgiotlog.log("error",e),this.$baseMessage(e,"error","dgiot-hey-message-error")}t.close()}}))},reset(){++this.key},click(e){const t=e,s=Object.keys(t).map(e=>`<p>${e}: ${t[e]}</p>`).join("");this.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:s,type:"success"})},getParent(e,t,s){return e.map(r=>{r.objectId==t?(s.push(r.objectId),this.getParent(e,r.parent,s)):0==r.parent&&r.objectId==t&&s.push(r.objectId)}),s.length>=1&&0!=s[0]&&s.unshift("0"),s},handleDelete(e){e.children?this.$message({type:"warning",message:"请先删除此菜单中的子菜单!"}):this.$del_object("Menu",e.objectId).then(e=>{e.error?this.$message({type:"error",message:"删除失败!"}):(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功!"}),this.fetchData())})},searchvalue(){},handleClose(){this.dialogVisible=!1},handleEdit(e,t){this.$refs["edit"].showEdit(e,t)},fetchData(){return c(this,null,(function*(){this.data=[],this.listLoading=!0;const{results:e}=yield Object(l["queryMenu"])({});e.map(e=>{var t={};t.objectId=e.objectId,t.alias=e.alias,t.name=e.name,this.options.push(t)}),e.map(e=>{const{meta:t={},name:s,objectId:r,icon:a,parent:i,createdAt:l,orderBy:n,url:c}=e;var d={};d.name=s,d.meta=t,d.objectId=r,d.icon=a,d.parent=i.objectId,d.createtime=Object(o["utc2beijing"])(l),d.orderBy=n,d.url=c,this.data.push(d)}),this.listLoading=!1}))}}},u=d,p=(s("adb9"),s("2877")),m=Object(p["a"])(u,r,a,!1,null,"44026106",null);t["default"]=m.exports},c086:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-container"},[s("div",{staticClass:"loginbanner"},[s("el-form",{ref:"ruleForm2",staticClass:"login-form",attrs:{"label-width":"100px",model:e.ruleForm2,rules:e.rules2,"status-icon":""}},[s("div",{staticClass:"logo"},[s("img",{staticStyle:{width:"80px",height:"80px"},attrs:{alt:"logo",src:e.logosrc}}),s("p",[e._v(e._s(e.title))])]),s("el-form-item",{attrs:{prop:"phone"}},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"user"}})],1),s("el-input",{attrs:{"auto-complete":"on",clearable:"",maxlength:11,name:"phone",placeholder:"请输入手机号",type:"text"},model:{value:e.ruleForm2.phone,callback:function(t){e.$set(e.ruleForm2,"phone",t)},expression:"ruleForm2.phone"}})],1),s("el-form-item",{attrs:{prop:"password",required:""}},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"password"}})],1),s("el-input",{attrs:{"auto-complete":"on",name:"password",placeholder:"请输入密码",type:e.pwdType},model:{value:e.ruleForm2.password,callback:function(t){e.$set(e.ruleForm2,"password",t)},expression:"ruleForm2.password"}}),s("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[s("dgiot-icon",{attrs:{icon:"eye"}})],1)],1),s("el-form-item",{attrs:{prop:"checkPass",required:""}},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"password"}})],1),s("el-input",{attrs:{"auto-complete":"on",placeholder:"请再次输入密码",type:e.pwdType},model:{value:e.ruleForm2.checkPass,callback:function(t){e.$set(e.ruleForm2,"checkPass",t)},expression:"ruleForm2.checkPass"}}),s("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[s("dgiot-icon",{attrs:{icon:"eye"}})],1)],1),s("el-form-item",{staticStyle:{"margin-top":"50px"}},[s("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticStyle:{width:"100%","letter-spacing":"10px"},attrs:{"element-loading-background":"rgba(0, 0, 0, 0.5)","element-loading-spinner":"el-icon-loading","element-loading-text":"正在初始化环境,请稍后",type:"primary"},on:{click:function(t){return e.submitForm("ruleForm2")}}},[e._v(" 立即注册 ")])],1),s("div",{staticClass:"hasuser"},[s("span",{staticStyle:{"font-size":"14px",color:"#409eff",cursor:"pointer"},on:{click:e.login}},[e._v(" 已有账号登陆 ")])])],1)],1)])},a=[],i=s("be65"),o=s.n(i);const l=s("f43e").Base64;var n={data(){var e=(e,t,s)=>{""===t?s(new Error("请输入密码")):(/^\w{8,20}/.test(t)||s(new Error("密码长度为8-20位")),s())},t=(e,t,s)=>{""===t?s(new Error("请再次输入密码")):t!==this.ruleForm2.password?s(new Error("两次输入密码不一致!")):s()};return{fullscreenLoading:!1,time:60,sendMsgDisabled:!1,logosrc:"",title:"",ruleForm2:{account:"",phone:"",username:"",password:"",email:"",checkPass:"",roles:""},pwdType:"password",protype:"",rules2:{account:[{required:!0,message:"请输入账号",trigger:"blur"},{min:1,max:10,message:"长度在 1到 10 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,s){var r=/^1[3-9]\d{9}$/;r.test(t)?s():s(new Error("手机号码格式不正确！"))},trigger:"blur"}],password:[{validator:e,trigger:"blur",required:!0}],checkPass:[{validator:t,trigger:"blur",required:!0}],username:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:5,message:"姓名格式不正确",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],roles:[{required:!0,message:"请选择平台",trigger:"change"}]}}},mounted(){this.protype=sessionStorage.getItem("roletype"),this.title=sessionStorage.getItem("product_title"),this.logosrc=sessionStorage.getItem("imgsrc")},methods:{showPwd(){"password"===this.pwdType?this.pwdType="":this.pwdType="password"},login(){this.$router.push({path:"/login"})},submitForm(e){var t=/^1[3-9]\d{9}$/;this.$refs[e].validate(e=>{if(!e)return this.$message({message:"信息错误",type:"error"}),!1;var s=new Parse.User;s.set("username",this.ruleForm2.phone.toString()),s.set("password",this.ruleForm2.password),t.test(this.ruleForm2.phone)?s.set("phone",this.ruleForm2.phone.toString()):s.set("phone",""),this.fullscreenLoading=!0,s.set("productId",this.protype);new Parse.ACL;s.save().then(e=>{dgiotlog.log(e.attributes.sessionToken),o.a.set("sessionToken",e.attributes.sessionToken),this.$router.push({path:"/phonelogin",query:{phone:l.encode(this.ruleForm2.phone),action:"register"}}),this.fullscreenLoading=!1}).catch(e=>{202==e.code?this.$message({message:"用户名已存在",type:"error"}):this.$message({message:e.message,type:"error"}),this.fullscreenLoading=!1})})},send(){const e=this;e.sendMsgDisabled=!0;const t=window.setInterval((function(){e.time--<=0&&(e.time=60,e.sendMsgDisabled=!1,window.clearInterval(t))}),1e3)}}},c=n,d=(s("2d92"),s("7d50"),s("9c3f"),s("2877")),u=Object(d["a"])(c,r,a,!1,null,"99f2460e",null);t["default"]=u.exports},c426:function(e,t,s){"use strict";s("920a")},c787:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"player-container"},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[s("el-card",{staticClass:"player_card",attrs:{shadow:"hover"}},[s("div",{attrs:{id:"video-container"}})])],1)],1)],1)},a=[],i={name:"Ys7",data(){return{}},computed:{},created(){},mounted(){this.initYs7()},methods:{initYs7(){axios.get("https://hotel.coboriel.com/api_screen").then(e=>{const{data:t}=e;dgiotlog.log(t),t.data.data.accessToken&&t.data.data.look_url&&(this.$message("初始化"+t.data.data.village_name),this.init(t.data.data.look_url[0],t.data.data.accessToken))}).catch(e=>{dgiotlog.log("e",e)})},init(e,t){player=new EZUIKit.EZUIKitPlayer({autoplay:!0,id:"video-container",accessToken:t,url:e,template:"simple",width:600,height:400}),setTimeout(()=>{dgiotlog.log(player),player.play()},2e3)}}},o=i,l=(s("0c50"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,"1d8d51f6",null);t["default"]=n.exports},c94c6:function(e,t,s){"use strict";s("8f7d")},ccbf:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"register-container"},[s("el-row",[s("el-col",{attrs:{lg:14,md:11,sm:24,xl:14,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])]),s("el-col",{attrs:{lg:9,md:12,sm:24,xl:9,xs:24}},[s("el-form",{ref:"registerForm",staticClass:"register-form",attrs:{model:e.form,rules:e.registerRules,size:"mini"}},[s("div",{staticClass:"title-tips"},[e._v(" "+e._s(e.$translateTitle("注册"))+" ")]),s("el-form-item",{attrs:{prop:"username"}},[s("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"auto-complete":"off",placeholder:e.$translateTitle("请输入用户名"),type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"user-line"}})]},proxy:!0}]),model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{prop:"phone"}},[s("el-input",{attrs:{maxlength:"11",placeholder:e.$translateTitle("请输入手机号"),"show-word-limit":"",type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"smartphone-line"}})]},proxy:!0}]),model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone","string"===typeof t?t.trim():t)},expression:"form.phone"}})],1),s("el-form-item",{staticStyle:{position:"relative"},attrs:{prop:"phoneCode"}},[s("el-input",{attrs:{placeholder:e.$translateTitle("请输入手机验证码"),type:"text"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"barcode-box-line"}})]},proxy:!0}]),model:{value:e.form.phoneCode,callback:function(t){e.$set(e.form,"phoneCode","string"===typeof t?t.trim():t)},expression:"form.phoneCode"}}),s("el-button",{staticClass:"phone-code",attrs:{disabled:e.isGetPhone,type:"primary"},on:{click:e.getPhoneCode}},[e._v(" "+e._s(e.phoneCode)+" ")])],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{attrs:{autocomplete:"new-password",placeholder:e.$translateTitle("请输入密码"),type:"password"},scopedSlots:e._u([{key:"prefix",fn:function(){return[s("dgiot-icon",{attrs:{icon:"lock-line"}})]},proxy:!0}]),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1),s("el-form-item",[s("el-button",{staticClass:"register-btn",attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleRegister.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("注册"))+" ")]),s("span",[s("router-link",{staticStyle:{float:"left"},attrs:{to:"/login"}},[s("div",{staticStyle:{"margin-top":"20px"}},[e._v(" "+e._s(e.$translateTitle("登录"))+" ")])]),s("dgiot-language",{staticStyle:{float:"right","margin-top":"20px","margin-right":"28px",cursor:"pointer"}})],1)],1)],1)],1),s("el-col",{attrs:{lg:1,md:1,sm:24,xl:1,xs:24}},[s("div",{staticStyle:{color:"transparent"}},[e._v("占位符")])])],1)],1)},a=[],i=s("28d7"),o=s("8665"),l=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),n={name:"Register",directives:{focus:{inserted(e){e.querySelector("input").focus()}}},data(){const e=(e,t,s)=>{""===t?s(new Error(this.$translateTitle("用户名不能为空"))):s()},t=(e,t,s)=>{Object(i["isPassword"])(t)?s():s(new Error(this.$translateTitle("密码不能少于6位")))},s=(e,t,s)=>{Object(i["isPhone"])(t)?s():s(new Error(this.$translateTitle("请输入正确的手机号")))};return{isGetPhone:!1,getPhoneInterval:null,phoneCode:this.$translateTitle("获取验证码"),showRegister:!1,nodeEnv:"production",form:{},registerRules:{username:[{required:!0,trigger:"blur",message:this.$translateTitle("请输入用户名")},{validator:e,trigger:"blur"}],phone:[{required:!0,trigger:"blur",message:this.$translateTitle("请输入手机号")},{validator:s,trigger:"blur"}],password:[{required:!0,trigger:"blur",message:this.$translateTitle("请输入密码")},{validator:t,trigger:"blur"}],phoneCode:[{required:!0,trigger:"blur",message:this.$translateTitle("请输入手机验证码")}]},loading:!1,passwordType:"password"}},beforeUnmount(){this.getPhoneInterval=null,clearInterval(this.getPhoneInterval)},methods:{getPhoneCode(){if(!Object(i["isPhone"])(this.form.phone))return void this.$refs["registerForm"].validateField("phone");this.isGetPhone=!0;let e=60;this.getPhoneInterval=setInterval(()=>{e>0?(e--,this.phoneCode=this.$translateTitle("获取验证码 ")+e+"s"):(this.getPhoneInterval=null,clearInterval(this.getPhoneInterval),this.phoneCode=this.$translateTitle("获取验证码"),this.isGetPhone=!1)},1e3)},handleRegister(){this.$refs["registerForm"].validate(e=>l(this,null,(function*(){if(e){const{msg:e}=yield Object(o["register"])(this.form);this.$baseMessage(e,"success",!1,"dgiot-hey-message-success")}})))}}},c=n,d=(s("9dce"),s("2877")),u=Object(d["a"])(c,r,a,!1,null,"56520f64",null);t["default"]=u.exports},ce2d:function(e,t,s){},ce70:function(e,t,s){"use strict";s.r(t),s.d(t,"ruleEngineProvider",(function(){return i}));const r="en",a=lang[r],i=[{name:"clientid",documentation:a.rule.clientid_doc,type:"Field",default:"c_emqx",valueType:"string"},{name:"username",documentation:a.rule.username_doc,type:"Field",default:"u_emqx",valueType:"string"},{name:"event",documentation:a.rule.event_doc,type:"Field",default:"disconnect",valueType:"string"},{name:"id",documentation:a.rule.id_doc,type:"Field",default:"--",valueType:"string"},{name:"payload",documentation:a.rule.payload_doc,type:"Field",default:'{"msg": "hello"}',valueType:"string"},{name:"peername",documentation:a.rule.peername_doc,type:"Field",default:"127.0.0.1:63412",valueType:"string"},{name:"qos",documentation:a.rule.qos_doc,type:"Field",default:1,valueType:"integer"},{name:"timestamp",documentation:a.rule.timestamp_doc,type:"Field",default:1576549961086,valueType:"integer"},{name:"topic",documentation:a.rule.topic_doc,type:"Field",default:"t/a",valueType:"string"},{name:"node",documentation:a.rule.node_doc,type:"Field",default:"emqx@127.0.0.1",valueType:"string"},{name:'"$events/message_delivered"',documentation:a.rule.message_delivered,type:"Method"},{name:'"$events/message_acked"',documentation:a.rule.message_acked,type:"Method"},{name:'"$events/message_dropped"',documentation:a.rule.message_dropped,type:"Method"},{name:'"$events/client_connected"',documentation:a.rule.client_connected,type:"Method"},{name:'"$events/client_disconnected"',documentation:a.rule.client_disconnected,type:"Method"},{name:'"$events/session_subscribed"',documentation:a.rule.session_subscribed,type:"Method"},{name:'"$events/session_unsubscribed"',documentation:a.rule.session_unsubscribed,type:"Method"}];t["default"]=[]},cf57:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"topic-metrics"},[s("div",{staticClass:"page-title"},[e._v(" "+e._s(e.$translateTitle("analysis.topicMetrics"))+" "),s("span",{staticClass:"sub-tip"},[e._v(e._s(e.$translateTitle("analysis.metricsTip")))]),e.modClosed?s("el-button",{staticClass:"confirm-btn",staticStyle:{float:"right"},attrs:{disable:e.$store.state.loading,plain:"",round:"",size:"medium",type:"success"},on:{click:e.handleModLoad}},[e._v(" "+e._s(e.$translateTitle("modules.enable"))+" ")]):s("el-button",{staticClass:"confirm-btn",staticStyle:{float:"right"},attrs:{disable:e.$store.state.loading,icon:"el-icon-plus",plain:"",round:"",size:"medium",type:"success"},on:{click:e.handleOperation}},[e._v(" "+e._s(e.$translateTitle("rule.create"))+" ")])],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.loading,expression:"$store.state.loading"}],ref:"crudTable",attrs:{border:"",data:e.topics,"expand-row-keys":e.expands,"row-key":e.getRowKeys},on:{"expand-change":e.handleExpandChange}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"expand-header"},[e._v(" "+e._s(e.$translateTitle("analysis.details"))+" "),s("el-radio-group",{staticClass:"topic-qos-radio",attrs:{prop:t,size:"mini"},model:{value:e.topicQos,callback:function(t){e.topicQos=t},expression:"topicQos"}},[s("el-radio-button",{attrs:{label:"all"}},[e._v(" "+e._s(e.$translateTitle("analysis.all"))+" ")]),s("el-radio-button",{attrs:{label:"qos0"}},[e._v("QoS 0")]),s("el-radio-button",{attrs:{label:"qos1"}},[e._v("QoS 1")]),s("el-radio-button",{attrs:{label:"qos2"}},[e._v("QoS 2")])],1)],1),s("el-row",{staticClass:"expand-body",attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"message-card in"},[s("div",[e._v(" "+e._s(e.$translateTitle("analysis.messageIn"))+" "),s("span",{staticClass:"message-rate"},[e._v(" "+e._s(e.$translateTitle("analysis.rateItem",[e.getCurrentTopicData("in","rate")]))+" "+e._s(e.$translateTitle("analysis.rate"))+" ")])]),s("div",{staticClass:"message-card--body"},[e._v(" "+e._s(e.getCurrentTopicData("in","count"))+" ")])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"message-card out"},[s("div",[e._v(" "+e._s(e.$translateTitle("analysis.messageOut"))+" "),s("span",{staticClass:"message-rate"},[e._v(" "+e._s(e.$translateTitle("analysis.rateItem",[e.getCurrentTopicData("out","rate")]))+" "+e._s(e.$translateTitle("analysis.rate"))+" ")])]),s("div",{staticClass:"message-card--body"},[e._v(" "+e._s(e.getCurrentTopicData("out","count"))+" ")])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"message-card drop"},[s("div",[e._v(" "+e._s(e.$translateTitle("analysis.messageDrop"))+" "),s("span",{staticClass:"message-rate"},[e._v(" "+e._s(e.$translateTitle("analysis.rateItem",[e.getCurrentTopicDropRate(e.currentTopic["messages.dropped.rate"])]))+" "+e._s(e.$translateTitle("analysis.rate"))+" ")])]),s("div",{staticClass:"message-card--body"},[e._v(" "+e._s(e.currentTopic["messages.dropped.count"])+" ")])])])],1)]}}])}),s("el-table-column",{attrs:{label:e.$translateTitle("topics.topic"),prop:"topic"}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.messageIn"),prop:"messageIn"}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.messageOut"),prop:"messageOut"}}),s("el-table-column",{attrs:{label:e.$translateTitle("analysis.messageDrop"),prop:"messageDrop"}}),s("el-table-column",{attrs:{label:e.$translateTitle("oper.oper"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{plain:"",size:"mini",type:"success"},on:{click:function(s){return e.viewTopicDetails(t.row,t.$index)}}},[e._v(" "+e._s(e.$translateTitle("oper.view"))+" ")]),s("el-popover",{attrs:{placement:"right",trigger:"click",value:e.popoverVisible}},[s("p",[e._v(e._s(e.$translateTitle("oper.confirmDelete")))]),s("div",{staticStyle:{"text-align":"right"}},[s("el-button",{staticClass:"cache-btn",attrs:{size:"mini",type:"text"},on:{click:e.hidePopover}},[e._v(" "+e._s(e.$translateTitle("oper.cancel"))+" ")]),s("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(s){return e.deleteTopicMetric(t.row)}}},[e._v(" "+e._s(e.$translateTitle("oper.confirm"))+" ")])],1),s("el-button",{attrs:{slot:"reference",plain:"",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("oper.delete"))+" ")])],1)]}}])})],1),s("el-dialog",{staticClass:"create-subscribe",attrs:{"append-to-body":!0,title:e.$translateTitle("analysis.addTopic"),visible:e.addVisible,width:"400px"},on:{"update:visible":function(t){e.addVisible=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleAdd.apply(null,arguments)}}},[s("el-form",{ref:"record",staticClass:"el-form--public",attrs:{"label-position":"top",model:e.record,rules:e.rules,size:"small"}},[s("el-form-item",{attrs:{label:e.$translateTitle("subscriptions.topic"),prop:"topic"}},[s("el-input",{attrs:{placeholder:"Topic"},model:{value:e.record.topic,callback:function(t){e.$set(e.record,"topic",t)},expression:"record.topic"}})],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"cache-btn",attrs:{type:"text"},on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("oper.cancel"))+" ")]),s("el-button",{staticClass:"confirm-btn",attrs:{loading:e.$store.state.loading,type:"success"},on:{click:e.handleAdd}},[e._v(" "+e._s(e.$translateTitle("oper.add"))+" ")])],1)],1)],1)},a=[],i={name:"TopicMetrics",components:{},beforeRouteLeave(e,t,s){clearInterval(this.timer),s()},props:{},data(){return{expands:[],addVisible:!1,popoverVisible:!1,modClosed:!1,topicQos:"all",timer:0,topics:{},currentExpandRow:{},currentTopic:{},record:{},rules:{topic:{required:!0,message:this.$translateTitle("oper.pleaseEnter")}}}},watch:{currentExpandRow:{deep:!0,handler(){clearInterval(this.timer)}}},created(){this.loadData()},beforeDestroy(){clearInterval(this.timer)},methods:{getRowKeys(e){return e.topic},loadData(){this.$httpGet("/topic-metrics").then(e=>{const{data:t}=e;this.topics=t.map(e=>{const{metrics:t}=e;return{topic:e.topic,messageIn:t["messages.in.count"],messageOut:t["messages.out.count"],messageDrop:t["messages.dropped.count"]}}),this.modClosed=!1}).catch(e=>{this.$message.warning(this.$translateTitle("error."+e.message)),this.modClosed=!0})},hidePopover(){this.popoverVisible=!0,setTimeout(()=>{this.popoverVisible=!1},0)},handleOperation(){this.addVisible=!0},handleModLoad(){this.$httpPut("/modules/emqx_mod_topic_metrics/load").then(()=>{this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("oper.enableSuccess"),type:"success"}),this.loadData(),this.modClosed=!1}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})},deleteTopicMetric(e){this.$httpDelete("/topic-metrics/"+encodeURIComponent(e.topic)).then(()=>{this.loadData(),this.hidePopover()}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})},handleAdd(){this.$refs.record.validate(e=>{if(!e)return;const t={};Object.assign(t,this.record),this.$httpPost("/topic-metrics",t).then(()=>{this.handleClose(),this.loadData()}).catch(()=>{})})},handleClose(){this.addVisible=!1,this.$refs.record.resetFields()},viewTopicDetails(e,t){const s=document.querySelectorAll(".el-table__expand-icon")[t];s&&s.click()},loadDetail(){this.$httpGet("/topic-metrics/"+encodeURIComponent(this.currentTopic.topic)).then(e=>{this.currentTopic=e.data,this.loadData()}).catch(()=>{})},setLoadDetailInterval(){this.timer=setInterval(()=>{this.$httpGet("/topic-metrics/"+encodeURIComponent(this.currentExpandRow.topic)).then(e=>{this.currentTopic=e.data}).catch(()=>{})},1e4)},handleExpandChange(e,t){if(!t.length)return this.currentExpandRow={},void clearInterval(this.timer);this.currentExpandRow=e,this.currentTopic={},this.$httpGet("/topic-metrics/"+encodeURIComponent(e.topic)).then(s=>{this.currentTopic=s.data,this.$refs.crudTable.store.states.expandRows=t.length?[e]:[],this.loadData(),this.setLoadDetailInterval()}).catch(()=>{})},getCurrentTopicData(e,t){const s={all:"messages",qos0:"messages.qos0",qos1:"messages.qos1",qos2:"messages.qos2"},r=s[this.topicQos],a=this.currentTopic[`${r}.${e}.${t}`];return"rate"===t&&a?a.toFixed(2):a},getCurrentTopicDropRate(e){return e?e.toFixed(2):e}}},o=i,l=(s("4d4a"),s("2877")),n=Object(l["a"])(o,r,a,!1,null,null,null);t["default"]=n.exports},d10c:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"roles dgiot-container"},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{span:13,xs:8}},[s("div",{staticClass:"rightTable"},[s("div",{staticClass:"search"},[s("dgiot-query-form",{directives:[{name:"show",rawName:"v-show",value:e.currentDepartment.depname,expression:"currentDepartment.depname"}]},[s("dgiot-query-form-top-panel",[s("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm}},[s("el-form-item",{attrs:{label:e.$translateTitle("user.rolename")}},[s("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("user.rolename"),size:"mini"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),s("el-form-item",[s("el-button",{staticStyle:{"margin-left":"20px"},attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:function(t){return e.getRolesList(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.getRolesList()}}},[e._v(" "+e._s(e.$translateTitle("product.allroles"))+" ")])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.setDialogRole(e.currentDepartment)}}},[e._v(" "+e._s(e.$translateTitle("user.new group"))+" ")])],1)],1)],1)],1)],1),s("div",{staticClass:"tableroles",staticStyle:{"margin-top":"20px"}},[s("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.roleList,height:e.tableHeight,"highlight-current-row":"","row-class-name":e.tableRowClassName,"row-style":e.selectedHighlight,size:"small"},on:{"row-click":e.getDetailmenu}},[s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.rolename"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"200"}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.Remarks"),prop:"alias","show-overflow-tooltip":"",sortable:"",width:"180"}}),s("el-table-column",{attrs:{align:"center",label:"ID",prop:"objectId","show-overflow-tooltip":"",sortable:"",width:"100"}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("el-dropdown",{staticStyle:{"margin-right":"5px"},attrs:{disabled:r.disabled,size:"mini","split-button":"",type:"primary"},on:{click:function(t){return e.exportRolerole(r)}}},[s("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.$translateTitle("product.Update Acl"))+" ")]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{icon:"el-icon-document"},nativeOn:{click:function(t){return e.exportRoletemp(r)}}},[e._v(" "+e._s(e.$translateTitle("product.savetemplate"))+" ")]),s("el-dropdown-item",{attrs:{disabled:r.objectId===e.currentDepartment.objectId,icon:"el-icon-delete",size:"mini"},nativeOn:{click:function(t){return e.handleDelete(r)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")])],1)],1),s("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.dynamicForm(r)}}},[s("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.$translateTitle("product.dynamic form"))+" ")])])]}}])})],1),s("div",{staticClass:"rightPagination"},[s("el-pagination",{attrs:{layout:"prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)])]),s("el-col",{attrs:{span:11,xs:16}},[s("div",{staticClass:"rolefooter"},[s("div",{staticClass:"footerleft"},[s("p",{staticClass:"top"},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"role_group"}})],1),s("span",[e._v(" "+e._s(e.$translateTitle("user.assignroles1"))+" ")])]),s("div",{staticClass:"rolecontrol"},[s("div",{staticStyle:{"margin-top":"5px","text-align":"center"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.checkAll("permissionTree","permissionTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.select all"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.inverse("permissionTree","permissionTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.Reverse election"))+" ")])],1),s("el-tree",{key:e.hashKey,ref:"permissionTree",attrs:{accordion:"","check-on-click-node":"",data:e.permissionTreeData,"default-checked-keys":e.rolePermissonList,"default-expand-all":e.isExpand,"default-props":"","expand-on-click-node":!1,"node-key":"objectId","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return s("span",{staticClass:"custom-tree-node"},[s("span",[e._v(e._s(r.label))])])}}])},[s("span",[s("i",{staticClass:"el-icon-circle-plus-outline",attrs:{title:e.$translateTitle("product.addrole")},on:{click:function(t){return e.setDialogRole(e.data)}}})])])],1)]),s("div",{staticClass:"footerright"},[s("p",{staticClass:"top"},[s("span",{staticClass:"svg-container"},[s("dgiot-icon",{attrs:{icon:"menu_group"}})],1),s("span",[e._v(" "+e._s(e.$translateTitle("user.assignmenu"))+" ")])]),s("div",{staticStyle:{"margin-top":"5px","text-align":"center"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.checkAll("menusTree","menuTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.select all"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.inverse("menusTree","menuTreeData")}}},[e._v(" "+e._s(e.$translateTitle("button.Reverse election"))+" ")])],1),s("div",{staticClass:"menucontrol",staticStyle:{"margin-top":"0px"}},[s("el-tree",{key:e.hashKey,ref:"menusTree",attrs:{accordion:"","check-on-click-node":"",data:e.menuTreeData,"default-checked-keys":e.roleMenuList,"default-expand-all":e.menuExpand,"default-props":"","expand-on-click-node":!1,"node-key":"objectId","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,a=t.data;return s("span",{staticClass:"custom-tree-node"},[e._v(" "+e._s(a.title?a.title:r.label)+" ")])}}])})],1)])])])],1),s("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],attrs:{"append-to-body":"",size:"80%",visible:e.dynamicform.visible},on:{"update:visible":function(t){return e.$set(e.dynamicform,"visible",t)}}},[s("dgiot-views",{ref:"dgiotView",attrs:{"class-disable":!0,"edit-row":e.editRow,"select-row":e.selectRow,type:"role","view-form":e.viewForm},on:{BusRole:e.BusRole}})],1),s("a-modal",{attrs:{footer:null,title:e.$translateTitle("product.addrole"),visible:e.centerDialogRole},on:{cancel:e.closeDialogRole}},[s("addroles",{key:e.$moment().unix(),ref:"addRoleRef",attrs:{"dept-data":e.deptData}})],1),s("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.add"),visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-table",{ref:"multipleTable",staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tableDataroles,height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.name")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.name))])]}}])}),s("el-table-column",{attrs:{align:"center",label:e.$translateTitle("user.Remarks")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.desc))])]}}])}),s("el-table-column",{attrs:{align:"center",label:"ID"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("span",[e._v(e._s(r.objectId))])]}}])})],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addacl.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),s("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.edit"),visible:e.roleEdit},on:{"update:visible":function(t){e.roleEdit=t}}},[s("el-form",{attrs:{model:e.form}},[s("el-form-item",{attrs:{label:e.$translateTitle("user.rolename"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",disabled:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("user.Remarks"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off"},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),s("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),"label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",rows:2,type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.roleEdit=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.updaterole.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1)},a=[],i=s("5da9"),o=s("5880"),l=s("fc849"),n=s("0c3c"),c=s("5dca"),d=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(m)for(var s of m(t))f.call(t,s)&&g(e,s,t[s]);return e},v=(e,t)=>u(e,p(t)),y=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),w={name:"Role",data(){return{selectRow:[],editRow:{},viewForm:{showRow:!1,class:"Product",type:"amis",key:"",title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]},dynamicform:{visible:!1,activeName:"0",data:[]},hashKey:"",tableHeight:this.$baseTableHeight(2),isExpand:!1,menuExpand:!1,curDepartmentId:"",formLabelWidth:"120px",roleEdit:!1,form:{name:"",alias:"",desc:""},data:[],dialogVisible:!1,multipleSelection:[],search:"",total:0,pagesize:10,start:0,roleList:[],tableDataroles:[],centerDialogVisible:!1,editroleid:"",currentSelectIndex:null,roleProps:{children:"children",label:"name"},treeDataValue:"",queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,access_token:""},checkMenus:[],checkRoles:[],dataMenus:[],menusTreeloading:!1,permissionTreeloading:!1,roleMenuList:[],dataPermissions:[],rolePermissonList:[],loadingService:{},roleItem:[],centerDialogRole:!1,deptData:{}}},computed:v(b({},Object(o["mapGetters"])({currentDepartment:"user/currentDepartment",roleTree:"user/roleTree",Menu:"user/Menu",Permission:"user/Permission"})),{permissionTreeData(){const e=JSON.parse(JSON.stringify(this.dataPermissions));return e.filter(t=>{const s=e.filter(e=>t.objectId==e.parentId);return s.length>0&&(t.children=s),0==t.parentId})},menuTreeData(){const e=JSON.parse(JSON.stringify(this.dataMenus)),t=e.filter(t=>{t.title=t.meta&&t.meta.title?t.meta.title:"";const s=e.filter(e=>t.objectId==e.parentId);return s.length>0&&(t.children=s),0==t.parentId});return t}}),components:{addroles:l["default"],dgiotViews:n["default"]},mounted(){this.getRoleschema(),this.getMenu(),this.getRolesList(),this.$dgiotBus.$on("dialogHide",()=>{this.centerDialogRole=!1,this.getMenu()})},methods:v(b({BusRole(e){return y(this,arguments,(function*({row:e,type:t}){const s=this.editRow.objectId,r=e.objectId;console.log(this.editRow),console.log(e.objectId);const a={destClass:"_Role",destField:"views",destId:s,srcClass:"View",srcId:r};"关联"==t?yield Object(c["postRelation"])(a):yield Object(c["delRelation"])(a);this.$message({showClose:!0,type:"success",message:t+"成功",duration:2e3}),yield this.querySelectRow(this.editRow)}))},querySelectRow(e){return y(this,null,(function*(){const t={destClass:"_Role",destId:e.objectId,srcClass:"View",destField:"views"},{results:s=[]}=yield Object(c["queryRelation"])(t);this.selectRow=_.drop(s,"objectId")}))},dynamicForm(e){return y(this,null,(function*(){yield this.querySelectRow(e),console.log(this.selectRow),this.editRow=e,console.log(e),this.dynamicform.visible=!0,this.$nextTick(()=>{this.$refs.dgiotView.fetchData(),console.log(this.$refs.dgiotView)})}))},expand(e,t){this[t]=!this[t],dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","tree",e,this.$refs[e],t);const s=this.$refs[e].store._getAllNodes();dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",s);for(let r in s)s[r].expanded=this[t]},checkAll(e,t){this.$refs[e].setCheckedNodes(this[t])},inverse(e,t){let s=this.$refs[e],r=s.getCheckedNodes(!0,!0);this.batchSelect(this[t],s,!0,r)},checkNot(e){this.$refs[e].setCheckedKeys([])},batchSelect(e,t,s,r){"undefined"!=typeof e&&e.forEach(e=>{t.setChecked(e,s,!0)}),"undefined"!=typeof r&&r.forEach(e=>{t.setChecked(e,!s,!0)})}},Object(o["mapMutations"])({})),{change(e){dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",e),e&&$(".el-tree").css({height:"300px",display:"block","overflow-x":"auto"})},getMenu(){if(dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","this.Menu",this.Menu),this.menusTreeloading=!0,this.data=[],this.dataMenus=[],this.Menu){const e=this.Menu;e.map(e=>{var t={};t.label=e.name,t.meta=e.meta,t.objectId=e.objectId,t.parentId=e.parent.objectId,t.createtime=new Date(e.createdAt).toLocaleDateString(),this.data.push(t),this.dataMenus.push(t)}),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","this.dataMenus",this.dataMenus),this.handleNodeClick(this.roleTree[0])}this.menusTreeloading=!1},diguiquchu(e,t,s,r){t.map(t=>{t.key==s&&t.children.length>0?(r.push(s),this.diguiquchu(e,t.children,s,r)):t.key!=s&&t.children.length>0&&this.diguiquchu(e,t.children,s,r)})},add(){this.$router.push({path:"roles/editroles",query:{insert:0}})},handleSelectionChange(e){this.multipleSelection=e},addacl(){this.$get_object("_Role",this.objectId).then(e=>{})},handleClose(){this.dialogVisible=!1},handleDelete(e){return y(this,null,(function*(){const t={name:e.name},{users:s}=yield Object(i["queryRoledepartment"])(t);s.length>0?this.$message({showClose:!0,duration:2e3,type:"warning",message:"请先删除该角色下的用户"}):this.$confirm(this.$translateTitle("user.This operation will permanently delete this role, do you want to continue?"),this.$translateTitle("user.prompt"),{confirmButtonText:this.$translateTitle("developer.determine"),cancelButtonText:this.$translateTitle("developer.cancel"),type:"warning"}).then(()=>{this.delConfirm(e.objectId)}).catch(()=>{})}))},delConfirm(e){return y(this,null,(function*(){let t=yield Object(i["delRole"])(e);t&&(this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.successfully deleted"),type:"success"}),this.getRolesList(),this.$dgiotBus.$emit("asyncTreeData"),this.getMenu())}))},addmenu(e){this.rolename=e.attributes.name,this.getMenu(),this.$dgiotBus.$emit("asyncTreeData")},tableRowClassName({row:e,rowIndex:t}){e.index=t},selectedHighlight({row:e,rowIndex:t}){if(this.currentSelectIndex===t)return{color:"#409EFF","font-weight":"bold"}},getDetailmenu(e,t,s,r){return y(this,null,(function*(){if(console.log(e),this.editRow=e,this.roleList.forEach(e=>{e.disabled=!0}),e.disabled=!1,t&&"操作"==t.label)return;this.loadingService=this.$loading({lock:!0,text:this.$translateTitle("developer.Data is loading")+"...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.6)"}),this.currentSelectIndex=e.index;const{menus:s,rules:r,roles:a,users:o,objectId:l}=yield Object(i["roleMenu"])(e.name);this.roleItem={menus:s,rules:r,users:o,roles:a,objectId:l},dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue"," this.roleItem",this.roleItem),this.loadingService.close(),s&&r?(this.checkMenus=s,this.checkRoles=r,this.hashKey=e.objectId,this.roleMenuList=[],this.rolePermissonList=[],this.Menu.map(e=>{this.checkMenus.map(t=>{e.name==t.name&&this.$nextTick(()=>{this.$refs.menusTree.setChecked(e.objectId,!0,!1)})})}),this.Permission.map(e=>{this.checkRoles.map(t=>{e.name===t.name&&this.$nextTick(()=>{this.$refs.permissionTree.setChecked(e.objectId,!0,!1)})})})):this.$message({showClose:!0,duration:2e3,type:"warning",message:"获取角色菜单失败"})}))},doSetChecked(e,t){e.forEach(e=>{console.error(this.roleMenuList),this.$refs.menusTree.setChecked(e,!0,!1)}),t.forEach(e=>{this.$refs.permissionTree.setChecked(e,!0,!1)})},getRolesList(e,t){return y(this,null,(function*(){0==e&&(this.start=0);let s={};this.search&&(s.name={$regex:this.search}),t&&"admin"!=t.name&&(s.objectId=t.objectId);const r=this.$loading({background:"rgba(0, 0, 0, 0.5)"});let a={skip:this.start,limit:this.pagesize,order:"-createdAt",keys:"name,objectId,alias",include:"views",excludeKeys:"menus,rules,users,roles",where:s,count:"objectId"},{results:o,count:l}=yield Object(i["queryRole"])(a);o.forEach(e=>{e.disable=!0}),o&&(r.close(),this.roleList=o,this.total=l)}))},handleSizeChange(e){this.pagesize=e,this.getRolesList()},handleCurrentChange(e){this.start=Number(e-1)*Number(this.pagesize),this.getRolesList()},handleCheckChange(e,t){dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",e,t)},getRoleschema(){if(dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","this.Permission",this.Permission),this.permissionTreeloading=!0,this.dataPermissions=[],this.Permission){const e=this.Permission;e.map(e=>{var t={};t.label=e.alias,t.alias=e.name,t.objectId=e.objectId,t.parentId=e.parent.objectId,t.createtime=new Date(e.createdAt).toLocaleDateString(),this.dataPermissions.push(t)})}this.permissionTreeloading=!1},getCheckedKeys(e,t,s){var r=[];return a(e,!1),r;function a(e,i){for(var o=[],l=0;l<e.length;l++){var n=e[l];o[l]=!1,n.children&&(o[l]=!!a(n.children,!0)||o[l],o[l]&&r.push(n));for(var c=0;c<t.length;c++)if(n[s]==t[c]){o[l]=!0,-1==r.indexOf(n[s])&&r.push(n);break}}if(i)return-1!=o.indexOf(!0)}},exportRolerole(e){return y(this,null,(function*(){let t=[],s=this.getCheckedKeys(this.menuTreeData,this.$refs.menusTree.getCheckedKeys(),"objectId"),r=[],a=[],o=[],l=this.$refs.permissionTree.getCheckedNodes(),n=this.roleItem.roles,c=this.roleItem.users;if(!c||!n)return this.$baseMessage(""+this.$translateTitle("user.The correct role permissions and menus are not selected"),"error","dgiot-hey-message-error"),!1;if(c.forEach(e=>{r.push(e.username)}),n.forEach(e=>{dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","lodash",_.assign(...n)),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","item",e),a.push(e.name)}),s&&l){if(s.forEach(e=>{t.push(e.label)}),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","selectMenu",t),l.forEach(e=>{o.push(e.alias)}),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue","selectRermission",o),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",e,"row",e),dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",_.uniq(o)),0==_.uniq(o).length||0==_.uniq(t))return this.$message.warning(""+this.$translateTitle("user.It is forbidden to set permissions/menus to empty")),!1;yield Object(i["saveRole"])({objectId:this.roleItem.objectId,rules:_.uniq(o),menus:_.uniq(t)}).then(e=>{e?this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.Role information updated successfully"),type:"success"}):this.$baseMessage(""+this.$translateTitle("user.Role information updated failed"),"error","dgiot-hey-message-error")}).catch(e=>{this.$baseMessage(`${this.$translateTitle("user.Role information updated successfully")}${e}`,"error","dgiot-hey-message-error")})}else this.$baseMessage(""+this.$translateTitle("user.Please select the menu list and permission list"),"info","dgiot-hey-message-error")}))},exportRoletemp(e){return y(this,null,(function*(){const t=yield Object(i["saveRoletemp"])(e.name);t&&this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.Save the template successfully"),type:"success"})}))},updaterole(){const e={alias:this.form.alias,desc:this.form.desc};this.$update_object(this.editroleid,e).then(e=>{this.$message({showClose:!0,duration:2e3,message:""+this.$translateTitle("user.update completed"),type:"success"}),this.roleEdit=!1,this.getRolesList()})},handleNodeClick(e){this.treeDataValue=e.label,this.queryForm.workGroupName=e.label,$(".workGroup").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),this.curDepartmentId=e.objectId,this.currentSelectIndex=null,this.getRolesList(0,e)},appendChildTree(e){dgiotlog.log("src/views/MultiTenant/roles/list/roles.vue",e,"添加子节点")},setDialogRole(e){this.deptData=e,this.centerDialogRole=!0},closeDialogRole(){this.centerDialogRole=!1}})},k=w,T=(s("1d53"),s("b926"),s("2877")),x=Object(T["a"])(k,r,a,!1,null,"c6c90ca0",null);t["default"]=x.exports},d4df:function(e,t,s){},d565:function(e,t,s){"use strict";s("3002")},d5f2:function(e,t,s){},d6f2:function(e,t,s){"use strict";s("0329")},d9ba:function(e,t,s){},deff:function(e,t,s){"use strict";s("ce2d")},e302:function(e){e.exports=JSON.parse('{"PersonAuthtication":{"userphone":"Number","joblicense":"String","suggestion":"String","positional_titles":"String","professional":"String","education":"String","auditDate":"Number","start_time":"Number","ukey":"String","name":"String","graduate_institutions":"String","training_experience":"String","practitioners_experience":"String","working_seniority":"String","addr":"Array","status":"String","contraryimageUrl":"String","birthday":"Number","frontimageUrl":"String","job":"String","identity":"String","unumber":"String","politic_status":"String","department":"Pointer"}}')},e374:function(e,t,s){"use strict";s("abc5")},e6bd:function(e,t,s){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},e76f:function(e,t,s){"use strict";s("6ca3")},e83b:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"clients-view"},[s("div",{staticClass:"page-title"},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/clients"}}},[e._v(" "+e._s(e.$translateTitle("leftbar.clients"))+" ")]),s("el-breadcrumb-item",{staticClass:"breadcrumb-name"},[e._v(" "+e._s(e.$translateTitle("clients.view"))+" ")])],1)],1),s("div",{staticClass:"client-oper"},[s("span",{class:[e.basicRecord.connected?"connected":"disconnected","status-circle"]}),e.clientId.length>90?s("el-popover",{attrs:{content:e.clientId,placement:"top-start",trigger:"hover"}},[s("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.interceptString(e.clientId,90)))])]):s("span",[e._v(e._s(e.clientId))]),s("el-button",{class:[e.basicRecord.connected?"connected":"disconnected","connect-btn"],attrs:{size:"mini"},on:{click:e.handleDisconnect}},[e._v(" "+e._s(e.basicRecord.connected?e.$translateTitle("clients.kickOut"):e.$translateTitle("websocket.cleanSession"))+" ")])],1),s("el-tabs",{staticClass:"normal-tabs",attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:e.$translateTitle("clients.basicInfo"),name:"basic"}},[s("dgiot-clients-basic",{attrs:{record:e.basicRecord}})],1),s("el-tab-pane",{attrs:{label:e.$translateTitle("clients.subsInfo"),name:"subscription"}},[s("dgiot-clients-subscriptions",{attrs:{"client-id":e.clientId,mountpoint:e.mountpoint,reload:e.loadSubscription,"table-data":e.subscriptionsData}})],1)],1)],1)},a=[],i=s("ed08"),o={name:"ClientsView",data(){return{activeName:"basic",basicRecord:{},subscriptionsData:[],nodeName:"",mountpoint:""}},computed:{clientId(){return this.$route.params.id}},watch:{activeName(e){"basic"===e?this.loadBasicData():"subscription"===e&&this.loadSubscription()}},created(){this.loadBasicData()},methods:{interceptString(e,t){return Object(i["intercept"])(e,t)},handleCommand(e){this[e]()},handleDisconnect(){const e=this.basicRecord.connected?this.$translateTitle("oper.confirmKickOut"):this.$translateTitle("oper.confirmCleanSession");this.$confirm(e,this.$translateTitle("oper.warning"),{confirmButtonClass:"confirm-btn",cancelButtonClass:"cache-btn el-button--text",type:"warning"}).then(()=>{this.$httpDelete("/clients/"+encodeURIComponent(this.clientId)).then(()=>{this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("oper.disconnectSuccess"),type:"success"}),this.$set(this.basicRecord,"connected",!1),setTimeout(()=>{this.$router.push({path:"/clients"})},500)}).catch(e=>{this.$baseMessage(e||this.$translateTitle("error.networkError"),"error","dgiot-hey-message-error")})}).catch(()=>{})},loadBasicData(){this.$httpGet("/clients/"+encodeURIComponent(this.clientId)).then(e=>{this.basicRecord=e.data[0],this.nodeName=this.basicRecord.node,e.data[0].mountpoint&&(this.mountpoint=e.data[0].mountpoint),this.loadSubscription()}).catch(()=>{})},loadSubscription(){this.$httpGet(`/nodes/${this.nodeName}/subscriptions/${encodeURIComponent(this.clientId)}`).then(e=>{this.subscriptionsData=e.data}).catch(()=>{})}}},l=o,n=(s("ecf5"),s("2877")),c=Object(n["a"])(l,r,a,!1,null,null,null);t["default"]=c.exports},ecf5:function(e,t,s){"use strict";s("a280")},eecf:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("dgiot-mqtt-dashboard",{ref:"mqtt-dashboard"})},a=[],i=s("01b2"),o=s.n(i);console.error("mqtt",o.a);var l={name:"Mqtt",components:{"dgiot-mqtt-dashboard":o.a},mounted(){this.hiddenClass(["websocket-container-header","websocket-container-footer"]),this.$dgiotBus.$emit("MqttStatus",this.routerKey)},methods:{hiddenClass(e){const t=this.$refs["mqtt-dashboard"].$el;t&&e.forEach(e=>{t.getElementsByClassName(""+e)[0].style.display="none"})}}},n=l,c=s("2877"),d=Object(c["a"])(n,r,a,!1,null,null,null);t["default"]=d.exports},efbe:function(e){e.exports=JSON.parse('{"RegionId":"cn-shanghai","RuleId":"37edf416df5c41a384d8e265d020e25e","RuleName":"温度告警规则","RuleContent":{"type":"IFTTT","trigger":{"uri":"logical/or","items":[{"uri":"trigger/product/event","params":{"productKey":"a1lcmeFVu97","compareType":"!=","compareValue":"55","propertyName":"Payload","eventCode":"OnSync"}},{"uri":"trigger/product/property","params":{"productKey":"a11Ecu7de6V"}},{"uri":"trigger/timer","params":{"cron":"0 0 3 3 0","cronType":"linux"}}]},"condition":{"uri":"logical/and","items":[{"uri":"condition/device/stateContinue","params":{"stateName":"event.status","duration":8,"compareType":"==","compareValue":1}},{"uri":"condition/device/property","params":{"productKey":"a1lcmeFVu97","deviceName":"csk84X8upjtNlkdyrry8","propertyName":"Direction","compareType":"==","compareValue":1}},{"uri":"condition/device/property","params":{"productKey":"a1lcmeFVu97","deviceName":"csk84X8upjtNlkdyrry8","propertyName":"Direction","compareType":"==","compareValue":0}}]},"action":[{"uri":"action/device/setProperty","params":{"productKey":"a1lcmeFVu97","deviceName":"kEdtCEM8p9bYJYUO1rDI","propertyItems":{"Direction":1}}},{"uri":"action/scene/trigger","params":{"automationRuleId":"b362b597dacc4da58d63ec2abb95355d"}},{"uri":"action/event/triggerAlarm","params":{}}]},"SceneType":"IFTTT","RuntimeEnv":""}')},f0e4:function(e,t,s){"use strict";s("832e")},f50c:function(e,t,s){},f8d5:function(e,t,s){"use strict";s("0e34")},fa5c:function(e,t){```
│   ├── views                                   # 页面组件目录结构图
│   │   ├── dashboard                           # 总控台
│   │   ├── DeviceCloud                         # 设备云
│   │   ├── MultiTenant                         # 多租户
│   │   ├── CloudOT                             # 云运维
│   │   ├── ClodTest                            # 云检测
│   │   ├── CloudSystem                         # 云系统
│   │   ├── CloudFunction                       # 云函数
│   │   ├── Tools                               # 工具集
│   │   ├── 403                                 # 403权限页面
│   │   ├── 404                                 # 404权限页面
│   │
```},fc849:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"role-box"},[s("el-form",{ref:"roleFormObj",attrs:{"label-width":"80px",loading:e.isloading,model:e.roleFormObj,rules:e.roleFormRules}},[e.isStructures?e._e():s("el-form-item",{attrs:{label:"父级部门",prop:"ParentId"}},[s("el-input",{attrs:{readonly:""},model:{value:e.currentDepartment.depname,callback:function(t){e.$set(e.currentDepartment,"depname",t)},expression:"currentDepartment.depname"}})],1),s("el-form-item",{attrs:{label:"部门",prop:"depname"}},[s("el-input",{staticStyle:{width:"75%"},attrs:{placeholder:"请输入部门名称"},model:{value:e.roleFormObj.depname,callback:function(t){e.$set(e.roleFormObj,"depname",t)},expression:"roleFormObj.depname"}}),s("span",{staticStyle:{float:"right","font-size":"14px",color:"#8492a6"}},[0==e.insert||1==e.insert?s("el-button",{attrs:{type:"success"},on:{click:function(t){return e.addroles("roleFormObj")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]):e._e()],1)],1),s("el-form-item",{attrs:{label:"岗位",prop:"dictvalue"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:e.clearFlag,placeholder:"请选择角色模版"},model:{value:e.roleFormObj.dictvalue,callback:function(t){e.$set(e.roleFormObj,"dictvalue",t)},expression:"roleFormObj.dictvalue"}},e._l(e.Option.dictOption,(function(e,t){return s("el-option",{key:t,attrs:{change:"changeOption('dict',item.name)",value:e.key}})})),1)],1),e.isStructures?e._e():s("el-form-item",{attrs:{label:"备注"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.roleFormObj.description,callback:function(t){e.$set(e.roleFormObj,"description",t)},expression:"roleFormObj.description"}})],1),e.isStructures?e._e():s("el-form-item",{staticClass:"el_btn"},[s("el-button",{attrs:{type:"warning"},nativeOn:{click:function(t){return e.resetFrom()}}},[e._v("重置")]),0==e.insert||1==e.insert?s("el-button",{attrs:{type:"success"},on:{click:function(t){return e.addroles("roleFormObj")}}},[e._v(" 确定 ")]):e._e()],1)],1)],1)])},a=[],i=s("e0e9"),o=s("5da9"),l=s("5880"),n=Object.defineProperty,c=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(e,t,s)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))d.call(t,s)&&p(e,s,t[s]);if(c)for(var s of c(t))u.call(t,s)&&p(e,s,t[s]);return e},h=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{l(s.next(e))}catch(t){a(t)}},o=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);l((s=s.apply(e,t)).next())}),f={props:{deptData:{type:Object,default:()=>{},required:!0},isStructures:{type:Boolean,required:!1,default:!1}},data(){return{isloading:"",treeModu:[],treeprops:{value:"name",label:"name"},defaultProps:{children:"children",label:"label"},originrole:[],needdelarr:[],parentrole:[],deptLevel:0,userid:"",roleId:"",insert:"",Option:{deptvalue:"",deptOption:[],dictvalue:"",dictOption:[],objectId:0,ParentId:0},clearFlag:!0,roleFormObj:{parentId:"",name:"",phoneNum:"",mail:"",department:"",gender:"男",role:"",description:"",type:[],list:[],defaultProps:{children:"children",label:"label"},dictvalue:""},roleFormRules:{name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],depname:[{required:!0,message:"请选择部门",trigger:"blur"}],dictvalue:[{required:!0,message:"请选择岗位",trigger:"change"}],ParentId:[{required:!0,message:"请选择部门父级",trigger:"blur"}]},roleList:[],deptInfo:{}}},computed:m({},Object(l["mapGetters"])({currentDepartment:"user/currentDepartment"})),mounted(){var e;this.searchAllOption(),(null==(e=this.deptData)?void 0:e.objectId)&&(dgiotlog.log(this.deptData),this.isloading=this.$baseLoading(3),this.getData(this.deptData),setTimeout(()=>{this.isloading.close()},1500))},methods:{handleChangeDeptId(e){this.roleList.forEach(t=>{t.objectId==e&&(dgiotlog.log(t),this.deptLevel=t.level,this.searchAllOption())}),dgiotlog.log(this.deptLevel,"deptLevel")},getData(e){this.deptInfo=e,this.deptLevel=e.level,this.roleFormObj.ParentId=this.deptInfo.objectId,dgiotlog.log("this.deptInfo",this.deptLevel,this.deptInfo.objectId),this.searchAllOption()},changeOption(e,t){switch(e){case"tree":this.Option.deptvalue=this.$refs["cascaderAddr"].currentLabels[1];const e=this.$refs["cascaderAddr"].options;e.forEach(e=>{this.$refs["cascaderAddr"].currentLabels[0]===e.name&&(this.Option.objectId=e.children[0].objectId),this.Option.ParentId=e.objectId});break;case"dict":this.Option.dictvalue=t;break}},searchAllOption(){return h(this,null,(function*(){dgiotlog.log(this.deptInfo,"deptInfo");const{results:e}=yield Object(i["queryDict"])({where:{"data.level":{$gt:this.deptLevel},type:"roletemp"}});(null==e?void 0:e.length)&&(this.Option.dictOption=e,this.roleFormObj.dictvalue=e[0].key,dgiotlog.log(this.roleFormObj.dictvalue,e[0].key));const{results:t=[]}=yield Object(o["queryRole"])({});dgiotlog.log(t,"roleresults");const s=[];(null==t?void 0:t.length)?(t.forEach((e,t)=>{const r={};r.ParentId=e.ParentId,r.name=e.name,r.objectId=e.objectId,r.org_type=e.org_type,r.desc=e.desc,r.level=e.level,r.createdAt=e.createdAt,s.push(r)}),this.roleList=s,this.Option.deptOption=t):(this.roleList=[],this.$message("部门列表获取失败"),this.Option.deptOption=[])}))},resetFrom(){this.roleFormObj={name:"",phoneNum:"",duty:"",gender:"男",role:"",description:"",alias:""},this.Option.deptvalue="",this.Option.dictvalue="",this.Option.objectId=0,this.Option.ParentId=0,this.treeModu=[],setTimeout(()=>{this.searchAllOption()},1e3)},diguiquchu(e,t,s,r){t.map(t=>{t.key==s&&t.children.length>0?(r.push(s),this.diguiquchu(e,t.children,s,r)):t.key!=s&&t.children.length>0&&this.diguiquchu(e,t.children,s,r)})},addroles(e){this.$refs[e].validate(t=>h(this,null,(function*(){var s,r,a;if(dgiotlog.log(this.$refs[e],this.roleFormObj),!t)return!1;{const e={depname:this.roleFormObj.depname,desc:(null==(s=this.roleFormObj.description)?void 0:s.length)?this.roleFormObj.description:this.roleFormObj.depname+this.roleFormObj.name,name:(null==(r=this.roleFormObj.name)?void 0:r.length)?this.roleFormObj.name:this.roleFormObj.depname,parent:this.roleFormObj.ParentId,tempname:this.roleFormObj.dictvalue};try{const t=yield Object(o["addRoles"])(e);(null==(a=null==t?void 0:t.createdAt)?void 0:a.length)?(this.$message({message:"新增成功",type:"success",showClose:!0,duration:2e3}),this.$dgiotBus.$emit("asyncTreeData"),this.$dgiotBus.$emit("dialogHide"),this.$dgiotBus.$emit("dialogHide2",t.objectId)):(dgiotlog.log(t),this.$message({message:"角色添加出錯"+t,type:"error",showClose:!0,duration:2e3}))}catch(i){this.$message({message:"角色添加出錯"+i,type:"error",showClose:!0,duration:2e3}),dgiotlog.log(i,"_error")}}})))},getdetail(){this.insert=this.$route.query.insert,this.roleId=this.$route.query.roleId}}},g=f,b=(s("b9f1"),s("2877")),v=Object(b["a"])(g,r,a,!1,null,"15ae656a",null);t["default"]=v.exports}}]);